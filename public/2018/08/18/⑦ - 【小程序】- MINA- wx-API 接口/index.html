<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="小米粥e博客"><meta name="keywords" content="html, css, vue, JavaScript,js,vuex,element-ui,iveiw-ui,axios"><title>API 接口 | liuxmoo</title><link rel="stylesheet" type="text/css" href="//fonts.neworld.org/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.1"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.1"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">API 接口</h1><a id="logo" href="/.">liuxmoo</a><p class="description">半路被拎来的前端。(*^▽^*)。学习最快的方法→慢慢来</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="Arama"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">API 接口</h1><div class="post-meta"><a href="/2018/08/18/⑦ - 【小程序】- MINA- wx-API 接口/#comments" class="comment-count"></a><p><span class="date">Aug 18, 2018</span><span><a href="/categories/⑦-小程序/" class="category">⑦ 小程序</a><a href="/categories/⑦-小程序/MINA-框架/" class="category">MINA 框架</a></span></p></div><div class="post-content"><h2 id="一、前言"><a href="#一、前言" class="headerlink" title="一、前言"></a>一、前言</h2><p>API 是微信小程序的 API 接口，原生 MINA 框架下 API 接口都是在 wx 这个对象上，在 wepy 框架使用的是 wepy 对象，因为 wepy 对象继承了 wx 对象的所有属性与方法。</p>
<p>并且 wepy 还优化了 wx 的某些个方法。具体看 wepy-cli 的框架中的 API</p>
<h2 id="二、网络"><a href="#二、网络" class="headerlink" title="二、网络"></a>二、网络</h2><h3 id="2-1-下载"><a href="#2-1-下载" class="headerlink" title="2.1 下载"></a>2.1 下载</h3><h4 id="2-1-1-wx-downloadFile-下载文件资源到本地。"><a href="#2-1-1-wx-downloadFile-下载文件资源到本地。" class="headerlink" title="2.1.1 wx.downloadFile 下载文件资源到本地。"></a>2.1.1 wx.downloadFile 下载文件资源到本地。</h4><p>客户端直接发起一个 HTTPS GET 请求，返回文件的本地临时路径。使用前请注意阅读相关 <a href="https://developers.weixin.qq.com/miniprogram/dev/framework/ability/network.html" target="_blank" rel="noopener">使用说明</a>。</p>
<p>注意：请在服务端响应的 header 中指定合理的 Content-Type 字段，以保证客户端正确处理文件类型。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回值是一个  DownloadTask 实例 对象：一个可以监听下载进度变化事件和取消下载的对象</span></span><br><span class="line"><span class="keyword">const</span> downloadTask = wx.downloadFile(&#123;</span><br><span class="line">  url: <span class="string">'https://example.com/audio/123'</span>, <span class="comment">//下载资源的 url    必填</span></span><br><span class="line">  header:&#123;&#125;,<span class="comment">//HTTP 请求的 Header，Header 中不能设置 Referer   否</span></span><br><span class="line">  filePath:<span class="string">''</span>,<span class="comment">//指定文件下载后存储的路径  否</span></span><br><span class="line">  success (res) &#123;</span><br><span class="line">    <span class="comment">// 只要服务器有响应数据，就会把响应内容写入文件并进入 success 回调，业务需要自行判断是否下载到了想要的内容</span></span><br><span class="line">    <span class="comment">//res.statusCode // number开发者服务器返回的 HTTP 状态码</span></span><br><span class="line">    <span class="comment">//res.tempFilePath//string 临时文件路径。如果没传入 filePath 指定文件存储路径，则下载后的文件会存储到一个临时文件</span></span><br><span class="line">    <span class="keyword">if</span> (res.statusCode === <span class="number">200</span>) &#123;</span><br><span class="line">      wx.playVoice(&#123;</span><br><span class="line">        filePath: res.tempFilePath</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  fail(res)&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">  &#125;,</span><br><span class="line">  complete(res)&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="2-1-1-DownloadTask-abort（）-中断下载任务-无参数"><a href="#2-1-1-DownloadTask-abort（）-中断下载任务-无参数" class="headerlink" title="2.1.1 DownloadTask.abort（） 中断下载任务  无参数"></a>2.1.1 DownloadTask.abort（） 中断下载任务  无参数</h4><p>语法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> downloadTask = wx.downloadFile(&#123;....&#125;)</span><br><span class="line">downloadTask.abort()</span><br></pre></td></tr></table></figure>
<h4 id="2-1-1-DownloadTask-offHeadersReceived-取消监听-HTTP-Response-Header-事件。会比请求完成事件更早"><a href="#2-1-1-DownloadTask-offHeadersReceived-取消监听-HTTP-Response-Header-事件。会比请求完成事件更早" class="headerlink" title="2.1.1 DownloadTask.offHeadersReceived 取消监听 HTTP Response Header 事件。会比请求完成事件更早"></a>2.1.1 DownloadTask.offHeadersReceived 取消监听 HTTP Response Header 事件。会比请求完成事件更早</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> downloadTask = wx.downloadFile(&#123;....&#125;)</span><br><span class="line">downloadTask.offHeadersReceived(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">  <span class="comment">//function callback</span></span><br><span class="line">  <span class="comment">//HTTP Response Header 事件的回调函数</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="2-1-1-DownloadTask-offProgressUpdate-取消监听下载进度变化事件"><a href="#2-1-1-DownloadTask-offProgressUpdate-取消监听下载进度变化事件" class="headerlink" title="2.1.1 DownloadTask.offProgressUpdate 取消监听下载进度变化事件"></a>2.1.1 DownloadTask.offProgressUpdate 取消监听下载进度变化事件</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> downloadTask = wx.downloadFile(&#123;....&#125;)</span><br><span class="line">downloadTask.offProgressUpdate(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">  <span class="comment">//function callback</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="2-1-1-DownloadTask-onHeadersReceived-监听-HTTP-Response-Header-事件。会比请求完成事件更早"><a href="#2-1-1-DownloadTask-onHeadersReceived-监听-HTTP-Response-Header-事件。会比请求完成事件更早" class="headerlink" title="2.1.1 DownloadTask.onHeadersReceived 监听 HTTP Response Header 事件。会比请求完成事件更早"></a>2.1.1 DownloadTask.onHeadersReceived 监听 HTTP Response Header 事件。会比请求完成事件更早</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> downloadTask = wx.downloadFile(&#123;....&#125;)</span><br><span class="line">downloadTask.onHeadersReceived(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="comment">//function callback</span></span><br><span class="line">  <span class="comment">//res.header:obj 开发者服务器返回的 HTTP Response Header</span></span><br><span class="line">  <span class="comment">/* &#123;</span></span><br><span class="line"><span class="comment">    //</span></span><br><span class="line"><span class="comment">  &#125; */</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="2-1-1-DownloadTask-onProgressUpdate-监听下载进度变化事件"><a href="#2-1-1-DownloadTask-onProgressUpdate-监听下载进度变化事件" class="headerlink" title="2.1.1 DownloadTask.onProgressUpdate 监听下载进度变化事件"></a>2.1.1 DownloadTask.onProgressUpdate 监听下载进度变化事件</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> downloadTask = wx.downloadFile(&#123;....&#125;)</span><br><span class="line">downloadTask.onProgressUpdate(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">  res.progress<span class="comment">//80,                 //下载进度百分比</span></span><br><span class="line">  res.totalBytesWritten<span class="comment">//1024,      //已经下载的数据长度，单位 Bytes</span></span><br><span class="line">  res.totalBytesExpectedToWrite<span class="comment">//5000,//预期需要下载的数据总长度，单位 Bytes</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="2-2-mDNS-服务器-IP-使用"><a href="#2-2-mDNS-服务器-IP-使用" class="headerlink" title="2.2 mDNS 服务器/IP 使用"></a>2.2 mDNS 服务器/IP 使用</h3><p>在局域网内，你要通过一台主机和其他主机进行通信，你需要知道对方的 ip 地址，但是有些时候，你并不知道对方的 ip 地址，因为一般使用 DHCP 动态分配 ip 地址的局域网内，各个主机的 IP 地址是由 DHCP 服务器来帮你分配 IP 地址的。所以在很多情况下，你要知道对方的 IP 地址是比较麻烦的。</p>
<p>mDNS 的工作原理：<br>首先，在 IP 协议里规定了一些保留地址，其中有一个是 224.0.0.251，对应的 IPv6 地址是 [FF02::FB]。mDNS 协议规定了一个端口，5353。mDNS 基于 UDP 协议。</p>
<p>每个进入局域网的主机，如果开启了 mDNS 服务的话，都会向局域网内的所有主机组播一个消息，我是谁，和我的 IP 地址是多少。然后其他也有该服务的主机就会响应，也会告诉你，它是谁，它的 IP 地址是多少。</p>
<h4 id="2-2-1-wx-offLocalServiceDiscoveryStop-取消监听-mDNS-服务停止搜索的事件"><a href="#2-2-1-wx-offLocalServiceDiscoveryStop-取消监听-mDNS-服务停止搜索的事件" class="headerlink" title="2.2.1 wx.offLocalServiceDiscoveryStop 取消监听 mDNS 服务停止搜索的事件"></a>2.2.1 wx.offLocalServiceDiscoveryStop 取消监听 mDNS 服务停止搜索的事件</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wx.offLocalServiceDiscoveryStop(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">  <span class="comment">//mDNS 服务停止搜索的事件的回调函数</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="2-2-1-wx-offLocalServiceFound-取消监听-mDNS-服务发现的事件"><a href="#2-2-1-wx-offLocalServiceFound-取消监听-mDNS-服务发现的事件" class="headerlink" title="2.2.1 wx.offLocalServiceFound 取消监听 mDNS 服务发现的事件"></a>2.2.1 wx.offLocalServiceFound 取消监听 mDNS 服务发现的事件</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wx.offLocalServiceFound(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">  <span class="comment">//mDNS 服务发现的事件的回调函数</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="2-2-1-wx-offLocalServiceLost-取消监听-mDNS-服务离开的事件"><a href="#2-2-1-wx-offLocalServiceLost-取消监听-mDNS-服务离开的事件" class="headerlink" title="2.2.1 wx.offLocalServiceLost 取消监听 mDNS 服务离开的事件"></a>2.2.1 wx.offLocalServiceLost 取消监听 mDNS 服务离开的事件</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wx.offLocalServiceLost(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">  <span class="comment">//mDNS 服务离开的事件的回调函数</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="2-2-1-wx-offLocalServiceResolveFail-取消监听-mDNS-服务解析失败的事件"><a href="#2-2-1-wx-offLocalServiceResolveFail-取消监听-mDNS-服务解析失败的事件" class="headerlink" title="2.2.1 wx.offLocalServiceResolveFail 取消监听 mDNS 服务解析失败的事件"></a>2.2.1 wx.offLocalServiceResolveFail 取消监听 mDNS 服务解析失败的事件</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wx.offLocalServiceResolveFail(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">  <span class="comment">//mDNS 服务解析失败的事件的回调函数</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="2-2-1-wx-onLocalServiceDiscoveryStop-监听-mDNS-服务停止搜索的事件"><a href="#2-2-1-wx-onLocalServiceDiscoveryStop-监听-mDNS-服务停止搜索的事件" class="headerlink" title="2.2.1 wx.onLocalServiceDiscoveryStop 监听 mDNS 服务停止搜索的事件"></a>2.2.1 wx.onLocalServiceDiscoveryStop 监听 mDNS 服务停止搜索的事件</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wx.onLocalServiceDiscoveryStop(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">  <span class="comment">//mDNS 服务停止搜索的事件的回调函数</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="2-2-1-wx-onLocalServiceFound-监听-mDNS-服务发现的事件"><a href="#2-2-1-wx-onLocalServiceFound-监听-mDNS-服务发现的事件" class="headerlink" title="2.2.1 wx.onLocalServiceFound 监听 mDNS 服务发现的事件"></a>2.2.1 wx.onLocalServiceFound 监听 mDNS 服务发现的事件</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">wx.onLocalServiceFound(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="comment">//mDNS 服务发现的事件的回调函数</span></span><br><span class="line">  res.serviceType:<span class="string">''</span>,<span class="comment">//服务的类型</span></span><br><span class="line">  res.serviceName:<span class="string">''</span>,<span class="comment">//服务的名称</span></span><br><span class="line">  res.ip:<span class="string">''</span>,<span class="comment">//服务的 ip 地址</span></span><br><span class="line">  res.port:<span class="number">8080</span><span class="comment">//服务的端口</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="2-2-1-wx-onLocalServiceLost-监听-mDNS-服务离开的事件"><a href="#2-2-1-wx-onLocalServiceLost-监听-mDNS-服务离开的事件" class="headerlink" title="2.2.1 wx.onLocalServiceLost 监听 mDNS 服务离开的事件"></a>2.2.1 wx.onLocalServiceLost 监听 mDNS 服务离开的事件</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wx.onLocalServiceLost(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="comment">//mDNS 服务离开的事件的回调函数</span></span><br><span class="line">  res.serviceType:<span class="string">''</span>,<span class="comment">//服务的类型</span></span><br><span class="line">  res.serviceName:<span class="string">''</span><span class="comment">//服务的名称</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="2-2-1-wx-onLocalServiceResolveFail-监听-mDNS-服务解析失败的事件"><a href="#2-2-1-wx-onLocalServiceResolveFail-监听-mDNS-服务解析失败的事件" class="headerlink" title="2.2.1 wx.onLocalServiceResolveFail 监听 mDNS 服务解析失败的事件"></a>2.2.1 wx.onLocalServiceResolveFail 监听 mDNS 服务解析失败的事件</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wx.onLocalServiceResolveFail(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="comment">//mDNS 服务解析失败的事件的回调函数</span></span><br><span class="line">  res.serviceType:<span class="string">''</span>,<span class="comment">//服务的类型</span></span><br><span class="line">  res.serviceName:<span class="string">''</span><span class="comment">//服务的名称</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="2-2-1-wx-startLocalServiceDiscovery-开始搜索局域网下的-mDNS-服务。搜索的结果会通过-wx-onLocalService-事件返回。"><a href="#2-2-1-wx-startLocalServiceDiscovery-开始搜索局域网下的-mDNS-服务。搜索的结果会通过-wx-onLocalService-事件返回。" class="headerlink" title="2.2.1 wx.startLocalServiceDiscovery 开始搜索局域网下的 mDNS 服务。搜索的结果会通过 wx.onLocalService* 事件返回。"></a>2.2.1 wx.startLocalServiceDiscovery 开始搜索局域网下的 mDNS 服务。搜索的结果会通过 wx.onLocalService* 事件返回。</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">wx.startLocalServiceDiscovery(&#123;</span><br><span class="line">  <span class="comment">//// 当前手机所连的局域网下有一个 _http._tcp. 类型的服务</span></span><br><span class="line">  serviceType:<span class="string">'_http._tcp.'</span>,<span class="comment">//string 服务的类型  必填</span></span><br><span class="line">  success()&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">  &#125;,</span><br><span class="line">  fail(res)&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="built_in">console</span>.log(res.errMsg) <span class="comment">// string 错误信息</span></span><br><span class="line">    <span class="comment">//值为：'invalid param'      表示： serviceType 为空</span></span><br><span class="line">    <span class="comment">//值为：'scan task already exist'</span></span><br><span class="line">    <span class="comment">//表示：在当前 startLocalServiceDiscovery 发起的搜索未停止的情况下，再次调用 startLocalServiceDiscovery</span></span><br><span class="line">  &#125;,</span><br><span class="line">  complete()&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<p>注意</p>
<ul>
<li>wx.startLocalServiceDiscovery 是一个消耗性能的行为，开始 30 秒后会自动 stop 并执行 wx.onLocalServiceDiscoveryStop 注册的回调函数。</li>
<li>在调用 wx.startLocalServiceDiscovery 后，在这次搜索行为停止后才能发起下次 wx.startLocalServiceDiscovery。停止本次搜索行为的操作包括调用 wx.stopLocalServiceDiscovery 和 30 秒后系统自动 stop 本次搜索。</li>
</ul>
<h4 id="2-2-1-wx-stopLocalServiceDiscovery-停止搜索-mDNS-服务"><a href="#2-2-1-wx-stopLocalServiceDiscovery-停止搜索-mDNS-服务" class="headerlink" title="2.2.1 wx.stopLocalServiceDiscovery 停止搜索 mDNS 服务"></a>2.2.1 wx.stopLocalServiceDiscovery 停止搜索 mDNS 服务</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">wx.stopLocalServiceDiscovery(&#123;</span><br><span class="line">  <span class="comment">//// 当前手机所连的局域网下有一个 _http._tcp. 类型的服务</span></span><br><span class="line">  serviceType:<span class="string">'_http._tcp.'</span>,<span class="comment">//string 服务的类型  必填</span></span><br><span class="line">  success()&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">  &#125;,</span><br><span class="line">  fail(res)&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="built_in">console</span>.log(res.errMsg) <span class="comment">// 得到值为：'task not found' 说明：在当前没有处在搜索服务中的情况下调用 stopLocalServiceDiscovery</span></span><br><span class="line">  &#125;,</span><br><span class="line">  complete()&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<h3 id="2-3-发起请求-（请求后端数据）"><a href="#2-3-发起请求-（请求后端数据）" class="headerlink" title="2.3 发起请求 （请求后端数据）"></a>2.3 发起请求 （请求后端数据）</h3><p><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/ability/network.html" target="_blank" rel="noopener">网络</a></p>
<h4 id="2-3-1-wx-request-发起-HTTPS-网络请求。"><a href="#2-3-1-wx-request-发起-HTTPS-网络请求。" class="headerlink" title="2.3.1 wx.request 发起 HTTPS 网络请求。"></a>2.3.1 wx.request 发起 HTTPS 网络请求。</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回一个 请求任务对象</span></span><br><span class="line"><span class="keyword">const</span> request = wx.request(&#123;</span><br><span class="line">  url: <span class="string">'test.php'</span>, <span class="comment">//仅为示例，并非真实的接口地址  开发者服务器接口地址  必填</span></span><br><span class="line">  data: &#123;    <span class="comment">// data ：string/object/ArrayBuffer 请求的参数           否</span></span><br><span class="line">    x: <span class="string">''</span>,<span class="comment">// 可以是字符串，可以是对象，可以是 JavaScript 操作二进制数据的一个接口（ArrayBuffer 对象）。</span></span><br><span class="line">    y: <span class="string">''</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 请求头，设置请求的 header， ① header 中不能设置 Referer， ② content-type 默认为 application/json    否</span></span><br><span class="line">  header: &#123;</span><br><span class="line">    <span class="string">'content-type'</span>: <span class="string">'application/json'</span> <span class="comment">// 默认值</span></span><br><span class="line">  &#125;,</span><br><span class="line">  method:<span class="string">'GET'</span>,<span class="comment">//HTTP 请求方法          默认值为 'GET'                否 ,和法制学习 http 文档，看后端给的文档</span></span><br><span class="line">  dataType:<span class="string">'json'</span>,<span class="comment">//返回的数据格式      默认值   'json'               否</span></span><br><span class="line">  <span class="comment">//返回的数据为 JSON 格式，返回后自行会对返回的数据进行一次 JSON.parse，不需要开发者去解析（只有 JSON 格式）</span></span><br><span class="line">  <span class="comment">// 其他格式不对返回的内容进行 JSON.parse</span></span><br><span class="line">  responseType:<span class="string">'text'</span>,<span class="comment">//响应的数据类型  默认值   'text'               否</span></span><br><span class="line">  <span class="comment">//① text  响应的数据为文本, ② arraybuffer 响应的数据为 ArrayBuffer</span></span><br><span class="line">  success (res) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res.data)<span class="comment">//string/Object/Arraybuffer  开发者服务器返回的数据</span></span><br><span class="line">    <span class="built_in">console</span>.log(res.statusCode)<span class="comment">//200 开发者服务器返回的 HTTP 状态码</span></span><br><span class="line">    <span class="built_in">console</span>.log(res.header)<span class="comment">//&#123;&#125; 开发者服务器返回的 HTTP Response Header</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 或者是可以写成下面这样的箭头函数</span></span><br><span class="line">  <span class="comment">// success:(res)=&gt;&#123;</span></span><br><span class="line">  <span class="comment">//   console.log(res.data)//string/Object/Arraybuffer  开发者服务器返回的数据</span></span><br><span class="line">  <span class="comment">//   console.log(res.statusCode)//200 开发者服务器返回的 HTTP 状态码</span></span><br><span class="line">  <span class="comment">//   console.log(res.header)//&#123;&#125; 开发者服务器返回的 HTTP Response Header</span></span><br><span class="line">  <span class="comment">// &#125;</span></span><br><span class="line">  fail(res)&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">  &#125;<span class="comment">/* ,</span></span><br><span class="line"><span class="comment">  complete(res)&#123;</span></span><br><span class="line"><span class="comment">    //</span></span><br><span class="line"><span class="comment">  &#125; */</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h5 id="2-3-1-1-ArrayBuffer-对象-就是各种类数组对象"><a href="#2-3-1-1-ArrayBuffer-对象-就是各种类数组对象" class="headerlink" title="2.3.1.1 ArrayBuffer 对象(就是各种类数组对象)"></a>2.3.1.1 ArrayBuffer 对象(就是各种类数组对象)</h5><p><a href="http://es6.ruanyifeng.com/#docs/arraybuffer" target="_blank" rel="noopener">ArrayBuffer 对象 网址</a>是 JavaScript 操作二进制数据的一个接口，<br>代表内存之中的一段二进制数据，可以通过“视图”进行操作。“视图”部署了数组接口，这意味着，可以用数组的方法操作内存。</p>
<p>rrayBuffer 有两种视图，一种是 TypedArray 视图，另一种是 DataView 视图。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">目前，TypedArray 视图一共包括 9 种类型，每一种视图都是一种构造函数。</span><br><span class="line"></span><br><span class="line">Int8Array：         8 位有符号整数，长度 1 个字节。</span><br><span class="line">Uint8Array：        8 位无符号整数，长度 1 个字节。</span><br><span class="line">Uint8ClampedArray： 8 位无符号整数，长度 1 个字节，溢出处理不同。</span><br><span class="line">Int16Array：        16 位有符号整数，长度 2 个字节。</span><br><span class="line">Uint16Array：       16 位无符号整数，长度 2 个字节。</span><br><span class="line">Int32Array：        32 位有符号整数，长度 4 个字节。</span><br><span class="line">Uint32Array：       32 位无符号整数，长度 4 个字节。</span><br><span class="line">Float32Array：      32 位浮点数，长度 4 个字节。</span><br><span class="line">Float64Array：      64 位浮点数，长度 8 个字节。</span><br></pre></td></tr></table></figure>
<h5 id="2-3-1-2-http-文档学习请求头"><a href="#2-3-1-2-http-文档学习请求头" class="headerlink" title="2.3.1.2 http 文档学习请求头"></a>2.3.1.2 http 文档学习请求头</h5><p><a href="https://liuxmoo.com/2018/09/02/1-(3">请求头 学习</a>-24.1-http-rumen/)</p>
<h5 id="2-3-1-3-data-参数说明"><a href="#2-3-1-3-data-参数说明" class="headerlink" title="2.3.1.3 data 参数说明"></a>2.3.1.3 data 参数说明</h5><p>最终发送给服务器的数据是 String 类型，如果传入的 data 不是 String 类型，会被转换成 String 。转换规则如下：</p>
<ul>
<li>对于 GET 方法的数据，会将数据转换成 query<br>  <code>string（encodeURIComponent(k)=encodeURIComponent(v)&amp;encodeURIComponent(k)=encodeURIComponent(v)...）</code></li>
<li>对于 POST 方法且 header[‘content-type’] 为 <code>application/json</code> 的数据，会对数据进行 JSON 序列化</li>
<li>对于 POST 方法且 header[‘content-type’] 为 <code>application/x-www-form-urlencoded</code> 的数据，会将数据转换成 query string<br>  `（encodeURIComponent(k)=encodeURIComponent(v)&amp;encodeURIComponent(k)=encodeURIComponent(v)…）</li>
</ul>
<h4 id="2-3-1-RequestTask-abort-中断请求任务"><a href="#2-3-1-RequestTask-abort-中断请求任务" class="headerlink" title="2.3.1 RequestTask.abort 中断请求任务"></a>2.3.1 RequestTask.abort 中断请求任务</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> request = wx.request(&#123;....&#125;)</span><br><span class="line">request.abort() <span class="comment">//中断请求，无参数</span></span><br></pre></td></tr></table></figure>
<h4 id="2-3-1-RequestTask-offHeadersReceived-取消监听-HTTP-Response-Header-事件。会比请求完成事件更早"><a href="#2-3-1-RequestTask-offHeadersReceived-取消监听-HTTP-Response-Header-事件。会比请求完成事件更早" class="headerlink" title="2.3.1 RequestTask.offHeadersReceived 取消监听 HTTP Response Header 事件。会比请求完成事件更早"></a>2.3.1 RequestTask.offHeadersReceived 取消监听 HTTP Response Header 事件。会比请求完成事件更早</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> request = wx.request(&#123;....&#125;)</span><br><span class="line">request.offHeadersReceived(<span class="function"><span class="params">()</span>=&gt;</span>&#123; <span class="comment">//HTTP Response Header 事件的回调函数</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="2-3-1-RequestTask-onHeadersReceived-监听-HTTP-Response-Header-事件。会比请求完成事件更早"><a href="#2-3-1-RequestTask-onHeadersReceived-监听-HTTP-Response-Header-事件。会比请求完成事件更早" class="headerlink" title="2.3.1 RequestTask.onHeadersReceived 监听 HTTP Response Header 事件。会比请求完成事件更早"></a>2.3.1 RequestTask.onHeadersReceived 监听 HTTP Response Header 事件。会比请求完成事件更早</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> request = wx.request(&#123;....&#125;)</span><br><span class="line">request.onHeadersReceived(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123; <span class="comment">//HTTP Response Header 事件的回调函数</span></span><br><span class="line">  <span class="comment">//res.header &#123;....&#125; 开发者服务器返回的 HTTP Response Header</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="2-4-上传"><a href="#2-4-上传" class="headerlink" title="2.4 上传"></a>2.4 上传</h3><h4 id="2-4-1-wx-uploadFile-将本地资源上传到服务器。"><a href="#2-4-1-wx-uploadFile-将本地资源上传到服务器。" class="headerlink" title="2.4.1 wx.uploadFile 将本地资源上传到服务器。"></a>2.4.1 wx.uploadFile 将本地资源上传到服务器。</h4><p>客户端发起一个 HTTPS POST 请求，其中 content-type 为 multipart/form-data。使用前请注意阅读相关说明。 <a href="https://developers.weixin.qq.com/miniprogram/dev/framework/ability/network.html" target="_blank" rel="noopener">使用说明</a>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">wx.chooseImage(&#123;</span><br><span class="line">  success (res) &#123;</span><br><span class="line">    <span class="keyword">const</span> tempFilePaths = res.tempFilePaths</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回一个 上传任务对象</span></span><br><span class="line">    <span class="keyword">const</span> uploadFile = wx.uploadFile(&#123;</span><br><span class="line">      url: <span class="string">'https://example.weixin.qq.com/upload'</span>, <span class="comment">//仅为示例，非真实的接口地址 开发者服务器地址   必填</span></span><br><span class="line">      filePath: tempFilePaths[<span class="number">0</span>],<span class="comment">// 要上传文件资源的路径       必填</span></span><br><span class="line">      name: <span class="string">'file'</span>,   <span class="comment">//文件对应的 key，开发者在服务端可以通过这个 key 获取文件的二进制内容   必填</span></span><br><span class="line">      <span class="comment">// 请求头，设置请求的 header， ① header 中不能设置 Referer， ② content-type 默认为 application/json    否</span></span><br><span class="line">      header: &#123;                                              <span class="comment">// 否</span></span><br><span class="line">        <span class="string">'content-type'</span>: <span class="string">'application/json'</span> <span class="comment">// 默认值</span></span><br><span class="line">      &#125;,</span><br><span class="line">      formData: &#123;          <span class="comment">//HTTP 请求中其他额外的 form data    否</span></span><br><span class="line">        <span class="string">'user'</span>: <span class="string">'test'</span></span><br><span class="line">      &#125;,</span><br><span class="line">      success (res)&#123;</span><br><span class="line">        <span class="keyword">const</span> data = res.data</span><br><span class="line">        <span class="built_in">console</span>.log(res.data)<span class="comment">//''  开发者服务器返回的数据</span></span><br><span class="line">        <span class="built_in">console</span>.log(res.statusCode)<span class="comment">//200 开发者服务器返回的 HTTP 状态码</span></span><br><span class="line">      &#125;,</span><br><span class="line">    <span class="comment">// 或者是可以写成下面这样的箭头函数</span></span><br><span class="line">    <span class="comment">// success:(res)=&gt;&#123;</span></span><br><span class="line">    <span class="comment">//   console.log(res.data)//string/Object/Arraybuffer  开发者服务器返回的数据</span></span><br><span class="line">    <span class="comment">//   console.log(res.statusCode)//200 开发者服务器返回的 HTTP 状态码</span></span><br><span class="line">    <span class="comment">//   console.log(res.header)//&#123;&#125; 开发者服务器返回的 HTTP Response Header</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">      fail(res)&#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">      &#125;<span class="comment">/* ,</span></span><br><span class="line"><span class="comment">      complete(res)&#123;</span></span><br><span class="line"><span class="comment">        //</span></span><br><span class="line"><span class="comment">      &#125; */</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="2-4-2-UploadTask-abort-中断上传任务"><a href="#2-4-2-UploadTask-abort-中断上传任务" class="headerlink" title="2.4.2 UploadTask.abort 中断上传任务"></a>2.4.2 UploadTask.abort 中断上传任务</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> uploadFile = wx.uploadFile(&#123;....&#125;)</span><br><span class="line">uploadFile.abort() <span class="comment">//中断上传任务，无参数</span></span><br></pre></td></tr></table></figure>
<h4 id="2-4-3-UploadTask-offHeadersReceived-取消监听-HTTP-Response-Header-事件。会比请求完成事件更早"><a href="#2-4-3-UploadTask-offHeadersReceived-取消监听-HTTP-Response-Header-事件。会比请求完成事件更早" class="headerlink" title="2.4.3 UploadTask.offHeadersReceived 取消监听 HTTP Response Header 事件。会比请求完成事件更早"></a>2.4.3 UploadTask.offHeadersReceived 取消监听 HTTP Response Header 事件。会比请求完成事件更早</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> uploadFile = wx.uploadFile(&#123;....&#125;)</span><br><span class="line">uploadFile.offHeadersReceived(<span class="function"><span class="params">()</span>=&gt;</span>&#123; <span class="comment">//HTTP Response Header 事件的回调函数</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="2-4-4-UploadTask-offProgressUpdate-取消监听上传进度变化事件"><a href="#2-4-4-UploadTask-offProgressUpdate-取消监听上传进度变化事件" class="headerlink" title="2.4.4 UploadTask.offProgressUpdate 取消监听上传进度变化事件"></a>2.4.4 UploadTask.offProgressUpdate 取消监听上传进度变化事件</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> uploadFile = wx.uploadFile(&#123;....&#125;)</span><br><span class="line">uploadFile.offProgressUpdate(<span class="function"><span class="params">()</span>=&gt;</span>&#123; <span class="comment">//上传进度变化事件的回调函数</span></span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="2-4-5-UploadTask-onHeadersReceived-监听-HTTP-Response-Header-事件。会比请求完成事件更早"><a href="#2-4-5-UploadTask-onHeadersReceived-监听-HTTP-Response-Header-事件。会比请求完成事件更早" class="headerlink" title="2.4.5 UploadTask.onHeadersReceived 监听 HTTP Response Header 事件。会比请求完成事件更早"></a>2.4.5 UploadTask.onHeadersReceived 监听 HTTP Response Header 事件。会比请求完成事件更早</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> uploadFile = wx.uploadFile(&#123;....&#125;)</span><br><span class="line">uploadFile.onHeadersReceived(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123; <span class="comment">//HTTP Response Header 事件的回调函数</span></span><br><span class="line">  <span class="comment">//res.header &#123;....&#125; 开发者服务器返回的 HTTP Response Header</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="2-4-6-UploadTask-onProgressUpdate-监听上传进度变化事件"><a href="#2-4-6-UploadTask-onProgressUpdate-监听上传进度变化事件" class="headerlink" title="2.4.6 UploadTask.onProgressUpdate 监听上传进度变化事件"></a>2.4.6 UploadTask.onProgressUpdate 监听上传进度变化事件</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> uploadFile = wx.uploadFile(&#123;....&#125;)</span><br><span class="line">uploadFile.onHeadersReceived(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123; <span class="comment">//上传进度变化事件的回调函数</span></span><br><span class="line">  res.progress                <span class="comment">//80 上传进度百分比</span></span><br><span class="line">  res.totalBytesSent          <span class="comment">//80 已经上传的数据长度，单位 Bytes</span></span><br><span class="line">  res.totalBytesExpectedToSend<span class="comment">//200 预期需要上传的数据总长度，单位 Bytes</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="2-5-WebSocket"><a href="#2-5-WebSocket" class="headerlink" title="2.5 WebSocket"></a>2.5 WebSocket</h3><p><strong>并发数</strong></p>
<p>1.7.0 及以上版本，最多可以同时存在 5（小游戏）/2（小程序）个 WebSocket 连接。<br>1.7.0 以下版本，一个小程序同时只能有一个 WebSocket 连接，如果当前已存在一个 WebSocket 连接，会自动关闭该连接，并重新创建一个 WebSocket 连接。</p>
<ul>
<li>wx.connectSocket     创建一个 WebSocket 连接。</li>
<li>wx.onSocketOpen      监听 WebSocket 连接打开事件</li>
<li>wx.closeSocket       关闭 WebSocket 连接，需要先用wx.onSocketOpen 监听 WebSocket 连接打开事件，才能关闭</li>
<li>wx.onSocketClose     监听 WebSocket 连接关闭事件</li>
<li>wx.onSocketError     监听 WebSocket 错误事件</li>
<li>wx.onSocketMessage   监听 WebSocket 接受到服务器的消息事件</li>
<li>wx.sendSocketMessage 通过 WebSocket 连接发送数据。需要先 wx.connectSocket，并在 wx.onSocketOpen 回调之后才能发送。</li>
</ul>
<p>使用前请注意阅读相关说明。<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/ability/network.html" target="_blank" rel="noopener">网络使用说明</a>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> socketOpen = <span class="literal">false</span></span><br><span class="line"><span class="keyword">const</span> socketMsgQueue = []</span><br><span class="line"><span class="comment">// ① 返回一个 WebSocket 任务</span></span><br><span class="line"><span class="keyword">const</span> socketTask = wx.connectSocket(&#123;</span><br><span class="line">  url: <span class="string">'wss://example.qq.com'</span>,  <span class="comment">//开发者服务器 wss 接口地址   必填</span></span><br><span class="line">  data:&#123;                        <span class="comment">// 这个好像官网没有说啊？？？？官网写的文档有问题的啊？？？所以别的的接口应该也是可以传参的把？？？</span></span><br><span class="line">    x: <span class="string">''</span>,<span class="comment">// 比如 navigateBack 没有写传参，我想应该也是可以传参的？？？？？？</span></span><br><span class="line">    y: <span class="string">''</span></span><br><span class="line">  &#125;,</span><br><span class="line">  header:&#123;                      <span class="comment">//HTTP Header，Header 中不能设置 Referer   否</span></span><br><span class="line">    <span class="string">'content-type'</span>: <span class="string">'application/json'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  protocols: [<span class="string">'protocol1'</span>],   <span class="comment">//子协议数组                      否</span></span><br><span class="line">  method:<span class="string">"GET"</span>,<span class="comment">//这个好像官网没有说啊？？？？  </span></span><br><span class="line">  success()&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">  &#125;,</span><br><span class="line">    <span class="comment">// 或者是可以写成下面这样的箭头函数</span></span><br><span class="line">    <span class="comment">// success:(res)=&gt;&#123;</span></span><br><span class="line">    <span class="comment">//   console.log(res.data)//string/Object/Arraybuffer  开发者服务器返回的数据</span></span><br><span class="line">    <span class="comment">//   console.log(res.statusCode)//200 开发者服务器返回的 HTTP 状态码</span></span><br><span class="line">    <span class="comment">//   console.log(res.header)//&#123;&#125; 开发者服务器返回的 HTTP Response Header</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">  fail()&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">  &#125;<span class="comment">/* ,</span></span><br><span class="line"><span class="comment">  complete()&#123;</span></span><br><span class="line"><span class="comment">    //</span></span><br><span class="line"><span class="comment">  &#125; */</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//注意这里有时序问题，</span></span><br><span class="line"><span class="comment">//如果 wx.connectSocket 还没回调 wx.onSocketOpen，而先调用 wx.closeSocket，那么就做不到关闭 WebSocket 的目的。</span></span><br><span class="line"><span class="comment">//必须在 WebSocket 打开期间调用 wx.closeSocket 才能关闭。</span></span><br><span class="line"><span class="comment">// ② 监测 是否是链接状态</span></span><br><span class="line">wx.onSocketOpen(<span class="function">(<span class="params">res</span>)=&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//res.header//object  连接成功的 HTTP 响应 Header 2.0.0</span></span><br><span class="line">  socketOpen = <span class="literal">true</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; socketMsgQueue.length; i++)&#123;</span><br><span class="line">    <span class="comment">//sendSocketMessage(socketMsgQueue[i]) 当然可以把这段写到外面的 作为一个函数调用</span></span><br><span class="line">    <span class="keyword">if</span> (socketOpen) &#123;</span><br><span class="line">      <span class="comment">//通过 WebSocket 连接发送数据。需要先 wx.connectSocket，并在 wx.onSocketOpen 回调之后才能发送。也是时序的问题</span></span><br><span class="line">      wx.sendSocketMessage(&#123;</span><br><span class="line">        data:msg,<span class="comment">// string/ArrayBuffer  需要发送的内容   必填</span></span><br><span class="line">        success()&#123;&#125;,<span class="comment">//</span></span><br><span class="line">            <span class="comment">// 或者是可以写成下面这样的箭头函数</span></span><br><span class="line">        <span class="comment">// success:(res)=&gt;&#123;</span></span><br><span class="line">        <span class="comment">//   console.log(res.data)//string/Object/Arraybuffer  开发者服务器返回的数据</span></span><br><span class="line">        <span class="comment">//   console.log(res.statusCode)//200 开发者服务器返回的 HTTP 状态码</span></span><br><span class="line">        <span class="comment">//   console.log(res.header)//&#123;&#125; 开发者服务器返回的 HTTP Response Header</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line">        fail()&#123;&#125;,<span class="comment">//</span></span><br><span class="line">        complete()&#123;&#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      socketMsgQueue.push(msg)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  socketMsgQueue = []</span><br><span class="line">  wx.closeSocket(&#123;</span><br><span class="line">    code:<span class="number">1000</span>,<span class="comment">//一个数字值表示关闭连接的状态号，表示连接被关闭的原因。 默认值 1000，表示正常关闭连接  否</span></span><br><span class="line">    reason:<span class="string">''</span>,<span class="comment">//一个可读的字符串，表示连接被关闭的原因。这个字符串必须是不长于 123 字节的 UTF-8 文本（不是字符） 否</span></span><br><span class="line">    success()&#123;&#125;,</span><br><span class="line">    <span class="comment">// 或者是可以写成下面这样的箭头函数</span></span><br><span class="line">    <span class="comment">// success:(res)=&gt;&#123;</span></span><br><span class="line">    <span class="comment">//   console.log(res.data)//string/Object/Arraybuffer  开发者服务器返回的数据</span></span><br><span class="line">    <span class="comment">//   console.log(res.statusCode)//200 开发者服务器返回的 HTTP 状态码</span></span><br><span class="line">    <span class="comment">//   console.log(res.header)//&#123;&#125; 开发者服务器返回的 HTTP Response Header</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    fail()&#123;&#125;,</span><br><span class="line">    complete()&#123;&#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">wx.onSocketClose(<span class="function">(<span class="params">res</span>)=&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'WebSocket 已关闭！'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//下面这两个是应该写在这里的么？？？正确的应该是怎么样的</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">wx.onSocketError(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="comment">//WebSocket 错误事件的回调函数</span></span><br><span class="line">  res.errMsg<span class="comment">//''错误信息</span></span><br><span class="line">&#125;)</span><br><span class="line">wx.onSocketMessage(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">  res.data<span class="comment">//string/ArrayBuffer  服务器返回的消息</span></span><br><span class="line">  <span class="comment">//WebSocket 接受到服务器的消息事件的回调函数</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="2-5-4-SocketTask-close，SocketTask-onClose，SocketTask-onError，SocketTask-onMessage，SocketTask-onOpen，SocketTask-send"><a href="#2-5-4-SocketTask-close，SocketTask-onClose，SocketTask-onError，SocketTask-onMessage，SocketTask-onOpen，SocketTask-send" class="headerlink" title="2.5.4 SocketTask.close，SocketTask.onClose，SocketTask.onError，SocketTask.onMessage，SocketTask.onOpen，SocketTask.send"></a>2.5.4 SocketTask.close，SocketTask.onClose，SocketTask.onError，SocketTask.onMessage，SocketTask.onOpen，SocketTask.send</h4><p>这里就是使用实例的方法来 监控操作 SocketTask 对象，不是使用 API 接口咯。功能与 wx 对象的方法是一样的。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> socketOpen = <span class="literal">false</span></span><br><span class="line"><span class="keyword">const</span> socketMsgQueue = []</span><br><span class="line"></span><br><span class="line"><span class="comment">// ① 创建/返回一个 WebSocket 任务</span></span><br><span class="line"><span class="keyword">const</span> socketTask = wx.connectSocket(&#123;</span><br><span class="line">  url: <span class="string">'wss://example.qq.com'</span>,  <span class="comment">//开发者服务器 wss 接口地址   必填</span></span><br><span class="line">  data:&#123;                        <span class="comment">// 这个好像官网没有说啊？？？？官网写的文档有问题的啊？？？所以别的的接口应该也是可以传参的把？？？</span></span><br><span class="line">    x: <span class="string">''</span>,<span class="comment">// 比如 navigateBack 没有写传参，我想应该也是可以传参的？？？？？？</span></span><br><span class="line">    y: <span class="string">''</span></span><br><span class="line">  &#125;,</span><br><span class="line">  header:&#123;                      <span class="comment">//HTTP Header，Header 中不能设置 Referer   否</span></span><br><span class="line">    <span class="string">'content-type'</span>: <span class="string">'application/json'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  protocols: [<span class="string">'protocol1'</span>],   <span class="comment">//子协议数组                      否</span></span><br><span class="line">  method:<span class="string">"GET"</span>,<span class="comment">//这个好像官网没有说啊？？？？  </span></span><br><span class="line">  success()&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">  &#125;,</span><br><span class="line">    <span class="comment">// 或者是可以写成下面这样的箭头函数</span></span><br><span class="line">    <span class="comment">// success:(res)=&gt;&#123;</span></span><br><span class="line">    <span class="comment">//   console.log(res.data)//string/Object/Arraybuffer  开发者服务器返回的数据</span></span><br><span class="line">    <span class="comment">//   console.log(res.statusCode)//200 开发者服务器返回的 HTTP 状态码</span></span><br><span class="line">    <span class="comment">//   console.log(res.header)//&#123;&#125; 开发者服务器返回的 HTTP Response Header</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">  fail()&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">  &#125;<span class="comment">/* ,</span></span><br><span class="line"><span class="comment">  complete()&#123;</span></span><br><span class="line"><span class="comment">    //</span></span><br><span class="line"><span class="comment">  &#125; */</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//注意这里有时序问题，</span></span><br><span class="line"><span class="comment">//如果 wx.connectSocket 还没回调 wx.onSocketOpen，而先调用 wx.closeSocket，那么就做不到关闭 WebSocket 的目的。</span></span><br><span class="line"><span class="comment">//必须在 WebSocket 打开期间调用 wx.closeSocket 才能关闭。</span></span><br><span class="line"><span class="comment">// ② 监测 是否是链接状态</span></span><br><span class="line"><span class="comment">//wx.onSocketOpen((res)=&gt; &#123;&#125;) 上面的 API 是使用 wx.xxxx 这里换成 socketTask.xxxx  实例对象的 方法</span></span><br><span class="line">socketTask.onOpen(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="comment">//res.header//object  连接成功的 HTTP 响应 Header 2.0.0</span></span><br><span class="line">  socketOpen = <span class="literal">true</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; socketMsgQueue.length; i++)&#123;</span><br><span class="line">    <span class="comment">//sendSocketMessage(socketMsgQueue[i]) 当然可以把这段写到外面的 作为一个函数调用</span></span><br><span class="line">    <span class="keyword">if</span> (socketOpen) &#123;</span><br><span class="line">      <span class="comment">//通过 WebSocket 连接发送数据。需要先 wx.connectSocket，并在 wx.onSocketOpen 回调之后才能发送。也是时序的问题</span></span><br><span class="line">      socketTask.send(&#123;</span><br><span class="line">        data:msg,<span class="comment">// string/ArrayBuffer  需要发送的内容   必填</span></span><br><span class="line">        success()&#123;&#125;,<span class="comment">//</span></span><br><span class="line">            <span class="comment">// 或者是可以写成下面这样的箭头函数</span></span><br><span class="line">            <span class="comment">// success:(res)=&gt;&#123;</span></span><br><span class="line">            <span class="comment">//   console.log(res.data)//string/Object/Arraybuffer  开发者服务器返回的数据</span></span><br><span class="line">            <span class="comment">//   console.log(res.statusCode)//200 开发者服务器返回的 HTTP 状态码</span></span><br><span class="line">            <span class="comment">//   console.log(res.header)//&#123;&#125; 开发者服务器返回的 HTTP Response Header</span></span><br><span class="line">            <span class="comment">// &#125;</span></span><br><span class="line">        fail()&#123;&#125;,<span class="comment">//</span></span><br><span class="line">        complete()&#123;&#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      socketMsgQueue.push(msg)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  socketMsgQueue = []</span><br><span class="line">  socketTask.close(&#123;</span><br><span class="line">    code:<span class="number">1000</span>,<span class="comment">//一个数字值表示关闭连接的状态号，表示连接被关闭的原因。 默认值 1000，表示正常关闭连接  否</span></span><br><span class="line">    reason:<span class="string">''</span>,<span class="comment">//一个可读的字符串，表示连接被关闭的原因。这个字符串必须是不长于 123 字节的 UTF-8 文本（不是字符） 否</span></span><br><span class="line">    success()&#123;&#125;,</span><br><span class="line">    <span class="comment">// 或者是可以写成下面这样的箭头函数</span></span><br><span class="line">    <span class="comment">// success:(res)=&gt;&#123;</span></span><br><span class="line">    <span class="comment">//   console.log(res.data)//string/Object/Arraybuffer  开发者服务器返回的数据</span></span><br><span class="line">    <span class="comment">//   console.log(res.statusCode)//200 开发者服务器返回的 HTTP 状态码</span></span><br><span class="line">    <span class="comment">//   console.log(res.header)//&#123;&#125; 开发者服务器返回的 HTTP Response Header</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    fail()&#123;&#125;,</span><br><span class="line">    complete()&#123;&#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">wx.onClose(<span class="function">(<span class="params">res</span>)=&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'WebSocket 已关闭！'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//下面这两个是应该写在这里的么？？？正确的应该是怎么样的</span></span><br><span class="line"></span><br><span class="line">wx.onError(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="comment">//WebSocket 错误事件的回调函数</span></span><br><span class="line">  res.errMsg<span class="comment">//''错误信息</span></span><br><span class="line">&#125;)</span><br><span class="line">wx.onMessage(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">  res.data<span class="comment">//string/ArrayBuffer  服务器返回的消息</span></span><br><span class="line">  <span class="comment">//WebSocket 接受到服务器的消息事件的回调函数</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="三、媒体"><a href="#三、媒体" class="headerlink" title="三、媒体"></a>三、媒体</h2><h3 id="3-1-音频-AudioContext-对象-（是单个组件的音频对象？？？？？）"><a href="#3-1-音频-AudioContext-对象-（是单个组件的音频对象？？？？？）" class="headerlink" title="3.1 音频 AudioContext  对象 （是单个组件的音频对象？？？？？）"></a>3.1 音频 AudioContext  对象 （是单个组件的音频对象？？？？？）</h3><h4 id="3-1-1-wx-createAudioContext-创建音频对象"><a href="#3-1-1-wx-createAudioContext-创建音频对象" class="headerlink" title="3.1.1 wx.createAudioContext  创建音频对象"></a>3.1.1 wx.createAudioContext  创建音频对象</h4><p>创建 音频 audio 上下文 AudioContext 对象。（返回一个 AudioContext 对象</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">audio</span> <span class="attr">poster</span>=<span class="string">"&#123;&#123;poster&#125;&#125;"</span> <span class="attr">name</span>=<span class="string">"&#123;&#123;name&#125;&#125;"</span> <span class="attr">author</span>=<span class="string">"&#123;&#123;author&#125;&#125;"</span> <span class="attr">src</span>=<span class="string">"&#123;&#123;src&#125;&#125;"</span> <span class="attr">id</span>=<span class="string">"myAudio"</span> <span class="attr">controls</span> <span class="attr">loop</span>&gt;</span><span class="tag">&lt;/<span class="name">audio</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"primary"</span> <span class="attr">bindtap</span>=<span class="string">"audioPlay"</span>&gt;</span>播放<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"primary"</span> <span class="attr">bindtap</span>=<span class="string">"audioPause"</span>&gt;</span>暂停<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"primary"</span> <span class="attr">bindtap</span>=<span class="string">"audio14"</span>&gt;</span>设置当前播放时间为14秒<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"primary"</span> <span class="attr">bindtap</span>=<span class="string">"audioStart"</span>&gt;</span>回到开头<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wx.createAudioContext(<span class="string">'myAudio'</span>,<span class="keyword">this</span>)<span class="comment">// this ：在自定义组件下，当前组件实例的this，以操作组件内 &lt;audio&gt; 组件 是可选参数</span></span><br></pre></td></tr></table></figure>
<h4 id="3-1-2-wx-getAvailableAudioSources-获取当前支持的音频输入源"><a href="#3-1-2-wx-getAvailableAudioSources-获取当前支持的音频输入源" class="headerlink" title="3.1.2 wx.getAvailableAudioSources 获取当前支持的音频输入源"></a>3.1.2 wx.getAvailableAudioSources 获取当前支持的音频输入源</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">wx.getAvailableAudioSources(&#123;</span><br><span class="line">  success(res)&#123;</span><br><span class="line">    <span class="comment">//res.audioSources:['']//支持的音频输入源列表，可在 RecorderManager.start() 接口中使用。</span></span><br><span class="line">  &#125;,</span><br><span class="line">    <span class="comment">// 或者是可以写成下面这样的箭头函数</span></span><br><span class="line">    <span class="comment">// success:(res)=&gt;&#123;</span></span><br><span class="line">    <span class="comment">//   console.log(res.data)//string/Object/Arraybuffer  开发者服务器返回的数据</span></span><br><span class="line">    <span class="comment">//   console.log(res.statusCode)//200 开发者服务器返回的 HTTP 状态码</span></span><br><span class="line">    <span class="comment">//   console.log(res.header)//&#123;&#125; 开发者服务器返回的 HTTP Response Header</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">  fail(res)&#123;</span><br><span class="line">  &#125;,<span class="comment">//</span></span><br><span class="line">  complete(res)&#123;&#125;<span class="comment">//</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><a href="https://developer.android.com/reference/kotlin/android/media/MediaRecorder.AudioSource" target="_blank" rel="noopener">返回值定义参考</a><br>res.audioSources 的合法值</p>
<ul>
<li>auto        自动设置，默认使用手机麦克风，插上耳麦后自动切换使用耳机麦克风，所有平台适用</li>
<li>buildInMic  手机麦克风，仅限 iOS</li>
<li>headsetMic  耳机麦克风，仅限 iOS</li>
<li>mic         麦克风（没插耳麦时是手机麦克风，插耳麦时是耳机麦克风），仅限 Android</li>
<li>camcorder   同 mic，适用于录制音视频内容，仅限 Android</li>
<li>voice_communication   同 mic，适用于实时沟通，仅限 Android</li>
<li>voice_recognition     同 mic，适用于语音识别，仅限 Android</li>
</ul>
<h4 id="3-1-3-wx-playVoice、wx-pauseVoice、wx-stopVoice-暂停-播放-停止-正在播放的语音"><a href="#3-1-3-wx-playVoice、wx-pauseVoice、wx-stopVoice-暂停-播放-停止-正在播放的语音" class="headerlink" title="3.1.3 wx.playVoice、wx.pauseVoice、wx.stopVoice 暂停/播放/停止 正在播放的语音"></a>3.1.3 wx.playVoice、wx.pauseVoice、wx.stopVoice 暂停/播放/停止 正在播放的语音</h4><ul>
<li>wx.playVoice<br>  开始播放语音。同时只允许一个语音文件正在播放，如果前一个语音文件还没播放完，将中断前一个语音播放。</li>
<li>wx.pauseVoice:<br>  暂停正在播放的语音。再次调用 wx.playVoice <strong>播放同一个文件时，会从暂停处开始播放</strong>。如果想从头开始播放，需要先调用 wx.stopVoice。</li>
<li>wx.stopVoice<br>  结束播放语音。下次播放同一个文件，也只会从头开始播放。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//wx.startRecord 开始录音</span></span><br><span class="line">wx.startRecord(&#123;</span><br><span class="line">  success (res) &#123;</span><br><span class="line">    <span class="keyword">const</span> tempFilePath = res.tempFilePath</span><br><span class="line">    <span class="comment">//暂停正在播放的语音</span></span><br><span class="line">    wx.playVoice(&#123;</span><br><span class="line">      filePath: tempFilePath,<span class="comment">//string 需要播放的语音文件的文件路径            必填</span></span><br><span class="line">      duration:<span class="number">60</span>,<span class="comment">//指定录音时长，到达指定的录音时长后会自动停止录音，单位：秒   否     默认值 60</span></span><br><span class="line">      success(res)&#123;&#125;,<span class="comment">//否</span></span><br><span class="line">      fail()&#123;&#125;,<span class="comment">//否</span></span><br><span class="line">      <span class="comment">/* complete()&#123;&#125; */</span> <span class="comment">// 成功与失败都会执行</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 为什么这里用 延迟执行？？？？？？</span></span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      wx.pauseVoice(&#123;</span><br><span class="line">        success(res)&#123;&#125;,<span class="comment">//否</span></span><br><span class="line">        fail()&#123;&#125;,<span class="comment">//否</span></span><br><span class="line">        <span class="comment">/* complete()&#123;&#125; */</span> <span class="comment">// 成功与失败都会执行</span></span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="comment">// 暂停或者是停止</span></span><br><span class="line">      wx.stopVoice(&#123;</span><br><span class="line">        success(res)&#123;&#125;,<span class="comment">//否</span></span><br><span class="line">        fail()&#123;&#125;,<span class="comment">//否</span></span><br><span class="line">        <span class="comment">/* complete()&#123;&#125; */</span> <span class="comment">// 成功与失败都会执行</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;, <span class="number">5000</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="3-1-4-AudioContext-音频对象的方法"><a href="#3-1-4-AudioContext-音频对象的方法" class="headerlink" title="3.1.4  AudioContext 音频对象的方法"></a>3.1.4  AudioContext 音频对象的方法</h4><p>AudioContext.pause、 AudioContext.play、AudioContext.seek、AudioContext.setSrc</p>
<p>对象的方法，与上面的 wx 接口的方法功能一样的。</p>
<ul>
<li>AudioContext.pause   暂停音频</li>
<li>AudioContext.play    播放音频</li>
<li>AudioContext.seek    跳转到指定位置</li>
<li>AudioContext.setSrc  设置音频地址</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- audio.wxml --&gt;</span><br><span class="line">&lt;audio  src=<span class="string">"&#123;&#123;src&#125;&#125;"</span> id=<span class="string">"myAudio"</span> &gt;<span class="xml"><span class="tag">&lt;/<span class="name">audio</span>&gt;</span></span></span><br><span class="line">&lt;button type=<span class="string">"primary"</span> bindtap=<span class="string">"audioPlay"</span>&gt;播放&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">&lt;button type="primary" bindtap="audioPause"&gt;暂停&lt;/</span>button&gt;</span><br><span class="line">&lt;button type=<span class="string">"primary"</span> bindtap=<span class="string">"audio14"</span>&gt;设置当前播放时间为<span class="number">14</span>秒&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">&lt;button type="primary" bindtap="audioStart"&gt;回到开头&lt;/</span>button&gt;</span><br><span class="line"><span class="comment">// audio.js</span></span><br><span class="line">Page(&#123;</span><br><span class="line">  onReady (e) &#123;</span><br><span class="line">    <span class="comment">// 使用 wx.createAudioContext 获取 audio 上下文 context</span></span><br><span class="line">    <span class="comment">// 创建音频对象   wx.createAudioContext('idNamd',this)</span></span><br><span class="line">    <span class="keyword">this</span>.audioCtx = wx.createAudioContext(<span class="string">'myAudio'</span>)</span><br><span class="line">    <span class="comment">// 设置音频地址 AudioContext.setSrc('url')</span></span><br><span class="line">    <span class="keyword">this</span>.audioCtx.setSrc(<span class="string">'http://ws.stream.qqmusic.qq.com/M500001VfvsJ21xFqb.mp3?guid=ffffffff82def4af4b12b3cd9337d5e7&amp;uin=346897220&amp;vkey=6292F51E1E384E06DCBDC9AB7C49FD713D632D313AC4858BACB8DDD29067D3C601481D36E62053BF8DFEAF74C0A5CCFADD6471160CAF3E6A&amp;fromtag=46'</span>)</span><br><span class="line">    <span class="keyword">this</span>.audioCtx.play()<span class="comment">// 播放音频 无参数</span></span><br><span class="line">  &#125;,</span><br><span class="line">  data: &#123;</span><br><span class="line">    src: <span class="string">''</span></span><br><span class="line">  &#125;,</span><br><span class="line">  audioPlay () &#123;</span><br><span class="line">    <span class="keyword">this</span>.audioCtx.play()<span class="comment">// 播放音频 无参数</span></span><br><span class="line">  &#125;,</span><br><span class="line">  audioPause () &#123;</span><br><span class="line">    <span class="keyword">this</span>.audioCtx.pause()<span class="comment">// 暂停音频 无参数</span></span><br><span class="line">  &#125;,</span><br><span class="line">  audio14 () &#123;</span><br><span class="line">    <span class="keyword">this</span>.audioCtx.seek(<span class="number">14</span>)<span class="comment">// 跳转位置，单位 s   AudioContext.seek(number) 跳转到几秒的时间播放</span></span><br><span class="line">  &#125;,</span><br><span class="line">  audioStart () &#123;</span><br><span class="line">    <span class="keyword">this</span>.audioCtx.seek(<span class="number">0</span>) <span class="comment">//从头开始播放</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="3-2-音频-InnerAudioContext-对象-（是整个小程序的音频对象？？？？？）"><a href="#3-2-音频-InnerAudioContext-对象-（是整个小程序的音频对象？？？？？）" class="headerlink" title="3.2 音频 InnerAudioContext  对象 （是整个小程序的音频对象？？？？？）"></a>3.2 音频 InnerAudioContext  对象 （是整个小程序的音频对象？？？？？）</h3><h4 id="3-2-1-wx-createInnerAudioContext-创建-内部音频对象"><a href="#3-2-1-wx-createInnerAudioContext-创建-内部音频对象" class="headerlink" title="3.2.1 wx.createInnerAudioContext   创建 内部音频对象"></a>3.2.1 wx.createInnerAudioContext   创建 内部音频对象</h4><p>创建 内部音频 audio 上下文 InnerAudioContext 对象。（返回一个 内部 InnerAudioContext 对象）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wx.createInnerAudioContext() <span class="comment">//无参数</span></span><br></pre></td></tr></table></figure>
<h4 id="3-2-2-wx-setInnerAudioOption-设置-InnerAudioContext-的播放选项。设置之后对当前小程序全局生效。"><a href="#3-2-2-wx-setInnerAudioOption-设置-InnerAudioContext-的播放选项。设置之后对当前小程序全局生效。" class="headerlink" title="3.2.2 wx.setInnerAudioOption 设置 InnerAudioContext 的播放选项。设置之后对当前小程序全局生效。"></a>3.2.2 wx.setInnerAudioOption 设置 InnerAudioContext 的播放选项。设置之后对当前小程序全局生效。</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">wx.setInnerAudioOption(&#123;</span><br><span class="line">  mixWithOther:<span class="literal">true</span>,<span class="comment">//是否与其他音频混播，设置为 true 之后，不会终止其他应用或微信内的音乐  否  默认值为 true</span></span><br><span class="line">  obeyMuteSwitch:<span class="literal">true</span>,<span class="comment">//（仅在 iOS 生效）是否遵循静音开关，设置为 false 之后，即使是在静音模式下，也能播放声音  否  默认值为 true</span></span><br><span class="line">  success(res)&#123;&#125;,<span class="comment">//否</span></span><br><span class="line">  fail()&#123;&#125;,<span class="comment">//否</span></span><br><span class="line">  <span class="comment">/* complete()&#123;&#125; */</span> <span class="comment">// 成功与失败都会执行</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="3-2-3-内部音频对象的方法"><a href="#3-2-3-内部音频对象的方法" class="headerlink" title="3.2.3 内部音频对象的方法"></a>3.2.3 内部音频对象的方法</h4><ul>
<li>InnerAudioContext.destroy    销毁当前实例    无参数</li>
<li>InnerAudioContext.offCanplay 取消监听音频进入可以播放状态的事件。但不保证后面可以流畅播放 回调函数</li>
<li>InnerAudioContext.offEnded   取消监听音频自然播放至结束的事件   回调函数</li>
<li>InnerAudioContext.offError   取消监听音频播放错误事件          回调函数</li>
<li>InnerAudioContext.offPause   取消监听音频暂停事件            回调函数</li>
<li>InnerAudioContext.offPlay   取消监听音频播放事件             回调函数</li>
<li>InnerAudioContext.offSeeked  取消监听音频完成跳转操作的事件   回调函数</li>
<li>InnerAudioContext.offSeeking  取消监听音频进行跳转操作的事件   回调函数</li>
<li>InnerAudioContext.offStop    取消监听音频停止事件              回调函数</li>
<li>InnerAudioContext.offTimeUpdate  取消监听音频播放进度更新事件</li>
<li>InnerAudioContext.offWaiting    取消监听音频加载中事件。当音频因为数据不足，需要停下来加载时会触发  回调函数</li>
<li>InnerAudioContext.onCanplay   监听音频进入可以播放状态的事件。但不保证后面可以流畅播放    回调函数</li>
<li>InnerAudioContext.onEnded     监听音频自然播放至结束的事件   回调函数</li>
<li>InnerAudioContext.onError     监听音频播放错误事件    回调函数<br>  audioContext.onError(()=&gt;{<pre><code>res.errCode//
  10001 系统错误
  10002 网络错误
  10003 文件错误
  10004 格式错误
  -1    未知错误
</code></pre>  })</li>
<li>InnerAudioContext.onPause   监听音频暂停事件                        回调函数</li>
<li>InnerAudioContext.onPlay    监听音频播放事件                        回调函数</li>
<li>InnerAudioContext.onSeeked  监听音频完成跳转操作的事件              回调函数</li>
<li>InnerAudioContext.onSeeking  监听音频进行跳转操作的事件             回调函数</li>
<li>InnerAudioContext.onStop    监听音频停止事件                        回调函数</li>
<li>InnerAudioContext.onTimeUpdate  监听音频播放进度更新事件             回调函数</li>
<li>InnerAudioContext.onWaiting  监听音频加载中事件。当音频因为数据不足，需要停下来加载时会触发  回调函数</li>
<li>InnerAudioContext.pause     暂停。暂停后的音频再播放会从暂停处开始播放  无参数</li>
<li>InnerAudioContext.play      播放                                    无参数</li>
<li>InnerAudioContext.seek     跳转到指定位置                            参数为 s</li>
<li>InnerAudioContext.stop     停止。停止后的音频再播放会从头开始播放。     无参数</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> innerAudioContext = wx.createInnerAudioContext()<span class="comment">// ① 创建内部 音频对象 返回值赋值给 innerAudioContext  对象</span></span><br><span class="line">innerAudioContext.autoplay = <span class="literal">true</span> <span class="comment">// data 数据</span></span><br><span class="line">innerAudioContext.src = <span class="string">'http://ws.stream.qqmusic.qq.com/M500001VfvsJ21xFqb.mp3?guid=ffffffff82def4af4b12b3cd9337d5e7&amp;uin=346897220&amp;vkey=6292F51E1E384E061FF02C31F716658E5C81F5594D561F2E88B854E81CAAB7806D5E4F103E55D33C16F3FAC506D1AB172DE8600B37E43FAD&amp;fromtag=46'</span> <span class="comment">// data 数据</span></span><br><span class="line">innerAudioContext.onPlay(<span class="function"><span class="params">()</span> =&gt;</span> &#123;<span class="comment">//② 监听音频 播放音频</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'开始播放'</span>)</span><br><span class="line">&#125;)</span><br><span class="line">innerAudioContext.onError(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;<span class="comment">//③ 监听 音频回调错误  输出错误信息</span></span><br><span class="line">  <span class="built_in">console</span>.log(res.errMsg)<span class="comment">//这个有么？？？</span></span><br><span class="line">  <span class="built_in">console</span>.log(res.errCode)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="3-3-背景音频-BackgroundAudioManager-对象-（背景音频对象）"><a href="#3-3-背景音频-BackgroundAudioManager-对象-（背景音频对象）" class="headerlink" title="3.3 背景音频 BackgroundAudioManager 对象 （背景音频对象）"></a>3.3 背景音频 BackgroundAudioManager 对象 （背景音频对象）</h3><h4 id="3-3-1-创建-背景音频-BackgroundAudioManager-对象"><a href="#3-3-1-创建-背景音频-BackgroundAudioManager-对象" class="headerlink" title="3.3.1 创建 背景音频 BackgroundAudioManager 对象"></a>3.3.1 创建 背景音频 BackgroundAudioManager 对象</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wx.getBackgroundAudioManager()  <span class="comment">//无参数</span></span><br></pre></td></tr></table></figure>
<p>获取全局唯一的背景音频管理器。 小程序切入后台，如果音频处于播放状态，可以继续播放。但是后台状态不能通过调用API操纵音频的播放状态。</p>
<p>从微信客户端6.7.2版本开始，若需要在小程序切后台后继续播放音频，需要在 app.json 中配置 requiredBackgroundModes 属性。开发版和体验版上可以直接生效，正式版还需通过审核。</p>
<h4 id="3-3-2-背景音频-BackgroundAudioManager-对象-wx-API-接口方法"><a href="#3-3-2-背景音频-BackgroundAudioManager-对象-wx-API-接口方法" class="headerlink" title="3.3.2 背景音频 BackgroundAudioManager 对象  wx.API 接口方法"></a>3.3.2 背景音频 BackgroundAudioManager 对象  wx.API 接口方法</h4><ul>
<li>wx.getBackgroundAudioPlayerState 获取后台音乐播放状态  success，fail ，complete 三个回调函数</li>
<li>wx.onBackgroundAudioPause 监听音乐暂停事件。 回调函数</li>
<li>wx.onBackgroundAudioPlay  监听音乐播放事件。回调函数</li>
<li>wx.onBackgroundAudioStop  监听音乐停止事件。回调函数</li>
<li>wx.pauseBackgroundAudio   暂停播放音乐。 success，fail ，complete 三个回调函数</li>
<li>wx.playBackgroundAudio   使用后台播放器播放音乐。三个回调函数，还有其他必填与不必填的属性<br>  对于微信客户端来说，只能同时有一个后台音乐在播放。当用户离开小程序后，音乐将暂停播放；当用户在其他小程序占用了音乐播放器，原有小程序内的音乐将停止播放。</li>
<li>wx.seekBackgroundAudio 控制音乐播放进度。三个回调函数，还有个必填的位置属性</li>
<li>wx.stopBackgroundAudio 停止播放音乐。三个回调函数，</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">wx.getBackgroundAudioPlayerState(&#123;</span><br><span class="line">  success (res) &#123;</span><br><span class="line">    <span class="keyword">const</span> status = res.status<span class="comment">// number   播放状态   0:暂停中  1:播放中  2：没有音乐播放</span></span><br><span class="line">    <span class="keyword">const</span> dataUrl = res.dataUrl<span class="comment">//''      歌曲数据链接，只有在音乐播放中时返回</span></span><br><span class="line">    <span class="keyword">const</span> currentPosition = res.currentPosition<span class="comment">//number  选定音频的播放位置（单位：s），只有在音乐播放中时返回</span></span><br><span class="line">    <span class="keyword">const</span> duration = res.duration<span class="comment">//number  选定音频的长度（单位：s），只有在音乐播放中时返回</span></span><br><span class="line">    <span class="keyword">const</span> downloadPercent = res.downloadPercent<span class="comment">//number 音频的下载进度百分比，只有在音乐播放中时返回</span></span><br><span class="line">  &#125;,</span><br><span class="line">  fail(res)&#123;&#125;,</span><br><span class="line">  complete(res)&#123;&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">wx.pauseBackgroundAudio(&#123;</span><br><span class="line">  success (res) &#123;&#125;,</span><br><span class="line">  fail(res)&#123;&#125;,</span><br><span class="line">  complete(res)&#123;&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">wx.playBackgroundAudio(&#123;</span><br><span class="line">  dataUrl: <span class="string">''</span>,<span class="comment">//音乐链接，目前支持的格式有 m4a, aac, mp3, wav   必填</span></span><br><span class="line">  title: <span class="string">''</span>,<span class="comment">//音乐标题  否</span></span><br><span class="line">  coverImgUrl: <span class="string">''</span>,<span class="comment">//封面URL 否</span></span><br><span class="line">  success (res) &#123;&#125;,</span><br><span class="line">  fail(res)&#123;&#125;,</span><br><span class="line">  complete(res)&#123;&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">wx.seekBackgroundAudio(&#123;</span><br><span class="line">  position: <span class="number">30</span>,<span class="comment">//s</span></span><br><span class="line">  success (res) &#123;&#125;,</span><br><span class="line">  fail(res)&#123;&#125;,</span><br><span class="line">  complete(res)&#123;&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">wx.stopBackgroundAudio(&#123;</span><br><span class="line">  success (res) &#123;&#125;,</span><br><span class="line">  fail(res)&#123;&#125;,</span><br><span class="line">  complete(res)&#123;&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="3-3-2-背景音频-BackgroundAudioManager-对象-的方法"><a href="#3-3-2-背景音频-BackgroundAudioManager-对象-的方法" class="headerlink" title="3.3.2 背景音频 BackgroundAudioManager 对象  的方法"></a>3.3.2 背景音频 BackgroundAudioManager 对象  的方法</h4><ul>
<li>.onCanplay 监听背景音频进入可播放状态事件。但不保证后面可以流畅播放      回调函数</li>
<li>.onEnded   监听背景音频自然播放结束事件                                回调函数</li>
<li>.onError   监听背景音频播放错误事件                                    回调函数</li>
<li>.onNext    监听用户在系统音乐播放面板点击下一曲事件（仅iOS）             回调函数</li>
<li>.onPause   监听背景音频暂停事件                                        回调函数</li>
<li>.onPlay    监听背景音频播放事件                                         回调函数</li>
<li>.onPrev    监听用户在系统音乐播放面板点击上一曲事件（仅iOS）               回调函数</li>
<li>.onSeeked  监听背景音频完成跳转操作事件                                   回调函数</li>
<li>.onSeeking 监听背景音频开始跳转操作事件                                   回调函数</li>
<li>.onStop    监听背景音频停止事件                                          回调函数</li>
<li>.onTimeUpdate 监听背景音频播放进度更新事件                                回调函数</li>
<li>.onWaiting    监听音频加载中事件。当音频因为数据不足，需要停下来加载时会触发 回调函数</li>
<li>.pause   暂停音乐  无参数<pre><code>错误码 10001  系统错误
      10002   网络错误
      10003   文件错误
      10004   格式错误
      -1      未知错误
</code></pre></li>
<li>.play    播放音乐，无参数  ，错误码同 .pause</li>
<li>.seek    跳转到指定位置  <pre><code>参数：跳转的位置，单位 s。精确到小数点后 3 位，即支持 ms 级别精确度。
错误码同 .pause
</code></pre></li>
<li>.stop    停止音乐 错误码同 .pause</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> backgroundAudioManager = wx.getBackgroundAudioManager()<span class="comment">// 创建 背景音频对象 赋值给 backgroundAudioManager 对象</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置 data 值</span></span><br><span class="line">backgroundAudioManager.title = <span class="string">'此时此刻'</span></span><br><span class="line">backgroundAudioManager.epname = <span class="string">'此时此刻'</span></span><br><span class="line">backgroundAudioManager.singer = <span class="string">'许巍'</span></span><br><span class="line">backgroundAudioManager.coverImgUrl = <span class="string">'http://y.gtimg.cn/music/photo_new/T002R300x300M000003rsKF44GyaSk.jpg?max_age=2592000'</span></span><br><span class="line"><span class="comment">// 设置了 src 之后会自动播放</span></span><br><span class="line">backgroundAudioManager.src = <span class="string">'http://ws.stream.qqmusic.qq.com/M500001VfvsJ21xFqb.mp3?guid=ffffffff82def4af4b12b3cd9337d5e7&amp;uin=346897220&amp;vkey=6292F51E1E384E061FF02C31F716658E5C81F5594D561F2E88B854E81CAAB7806D5E4F103E55D33C16F3FAC506D1AB172DE8600B37E43FAD&amp;fromtag=46'</span></span><br><span class="line"></span><br><span class="line">backgroundAudioManager.onCanplay(<span class="function"><span class="params">()</span>=&gt;</span>&#123;....&#125;)</span><br><span class="line">backgroundAudioManager.onEnded(<span class="function"><span class="params">()</span>=&gt;</span>&#123;....&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="3-4-相机"><a href="#3-4-相机" class="headerlink" title="3.4 相机"></a>3.4 相机</h3><h4 id="3-4-1-wx-createCameraContext-创建-相机上下文对象-无参数"><a href="#3-4-1-wx-createCameraContext-创建-相机上下文对象-无参数" class="headerlink" title="3.4.1 wx.createCameraContext 创建 相机上下文对象 [无参数]"></a>3.4.1 wx.createCameraContext 创建 相机上下文对象 [无参数]</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wx.createCameraContext()<span class="comment">//无参数</span></span><br></pre></td></tr></table></figure>
<h4 id="3-4-2-CameraContext-相机上下文对象-的方法"><a href="#3-4-2-CameraContext-相机上下文对象-的方法" class="headerlink" title="3.4.2 CameraContext  相机上下文对象 的方法"></a>3.4.2 CameraContext  相机上下文对象 的方法</h4><ul>
<li>.startRecord 开始录像</li>
<li>.stopRecord  停止录像</li>
<li>.takePhoto   拍照</li>
</ul>
<h4 id="3-4-3-相机完整的代码实例"><a href="#3-4-3-相机完整的代码实例" class="headerlink" title="3.4.3 相机完整的代码实例"></a>3.4.3 相机完整的代码实例</h4><p><a href="">效果图</a></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"page-body"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"page-body-wrapper"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">camera</span> <span class="attr">device-position</span>=<span class="string">"back"</span> <span class="attr">flash</span>=<span class="string">"off"</span> <span class="attr">binderror</span>=<span class="string">"error"</span> <span class="attr">style</span>=<span class="string">"width: 100%; height: 300px;"</span>&gt;</span><span class="tag">&lt;/<span class="name">camera</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"btn-area"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"primary"</span> <span class="attr">bindtap</span>=<span class="string">"takePhoto"</span>&gt;</span>拍照<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"btn-area"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"primary"</span> <span class="attr">bindtap</span>=<span class="string">"startRecord"</span>&gt;</span>开始录像<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"btn-area"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"primary"</span> <span class="attr">bindtap</span>=<span class="string">"stopRecord"</span>&gt;</span>结束录像<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"preview-tips"</span>&gt;</span>预览<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">image</span> <span class="attr">wx:if</span>=<span class="string">"&#123;&#123;src&#125;&#125;"</span> <span class="attr">mode</span>=<span class="string">"widthFix"</span> <span class="attr">src</span>=<span class="string">"&#123;&#123;src&#125;&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">video</span> <span class="attr">wx:if</span>=<span class="string">"&#123;&#123;videoSrc&#125;&#125;"</span> <span class="attr">class</span>=<span class="string">"video"</span> <span class="attr">src</span>=<span class="string">"&#123;&#123;videoSrc&#125;&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">video</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">  onLoad() &#123;</span><br><span class="line">    <span class="keyword">this</span>.ctx = wx.createCameraContext()<span class="comment">// 创建 对象  赋值给  ctx</span></span><br><span class="line">  &#125;,</span><br><span class="line">  takePhoto() &#123;</span><br><span class="line">    <span class="keyword">this</span>.ctx.takePhoto(&#123;</span><br><span class="line">      quality: <span class="string">'high'</span>,<span class="comment">//成像质量   否  'high': 高质量   'low':低质量   'normal':普通质量（默认值）</span></span><br><span class="line">      success: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">//res.tempImagePath '' 照片文件的临时路径</span></span><br><span class="line">        <span class="keyword">this</span>.setData(&#123;</span><br><span class="line">          src: res.tempImagePath</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      fail:<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">      &#125;,</span><br><span class="line">      complete:<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;..&#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  startRecord() &#123;</span><br><span class="line">    <span class="keyword">this</span>.ctx.startRecord(&#123;</span><br><span class="line">      timeoutCallback:<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="comment">//超过30s或页面 onHide 时会结束录像   否</span></span><br><span class="line">        res.tempThumbPath<span class="comment">//string 封面图片文件的临时路径</span></span><br><span class="line">        res.tempVideoPath<span class="comment">//string 视频的文件的临时路径</span></span><br><span class="line">      &#125;,</span><br><span class="line">      success: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'startRecord'</span>)</span><br><span class="line">      &#125;,</span><br><span class="line">      fail:<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">      &#125;,</span><br><span class="line">      complete:<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;..&#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  stopRecord() &#123;</span><br><span class="line">    <span class="keyword">this</span>.ctx.stopRecord(&#123;</span><br><span class="line">      success: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">//res.tempThumbPath//string 封面图片文件的临时路径</span></span><br><span class="line">        <span class="comment">//res.tempVideoPath//string 视频的文件的临时路径</span></span><br><span class="line">        <span class="keyword">this</span>.setData(&#123;</span><br><span class="line">          src: res.tempThumbPath,</span><br><span class="line">          videoSrc: res.tempVideoPath</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      fail:<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">      &#125;,</span><br><span class="line">      complete:<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;..&#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  error(e) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(e.detail)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//page</span></span><br><span class="line"><span class="selector-class">.preview-tips</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">20</span>rpx <span class="number">0</span>;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.video</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">50px</span> auto;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">300px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//app</span></span><br><span class="line"><span class="selector-tag">page</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#F8F8F8</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">32</span>rpx;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">1.6</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.page-body</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">20</span>rpx <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.page-body-wrapper</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">flex-direction</span>: column;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.btn-area</span> &#123;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">60</span>rpx;</span><br><span class="line">  <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">30</span>rpx;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-5-字体-wx-loadFontFace-动态加载网络字体。"><a href="#3-5-字体-wx-loadFontFace-动态加载网络字体。" class="headerlink" title="3.5 字体 wx.loadFontFace 动态加载网络字体。"></a>3.5 字体 wx.loadFontFace 动态加载网络字体。</h3><p>文件地址需为下载类型。iOS 仅支持 https 格式文件地址。</p>
<p>注意：</p>
<ul>
<li>引入中文字体，体积过大时会发生错误，建议抽离出部分中文，减少体积，或者用图片替代</li>
<li>字体链接必须是 https（ios 不支持 http 仅支持 https 格式文件地址)</li>
<li>字体链接必须是同源下的，或开启了cors支持，小程序的域名是 servicewechat.com</li>
<li>canvas 等原生组件不支持使用接口添加的字体</li>
<li>工具里提示 Faild to load font可以忽略</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"page-body"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"page-section"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"page-body-info display-area &#123;&#123; loaded ? 'font-loaded' : '' &#125;&#125;"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">wx:if</span>=<span class="string">"&#123;&#123;!loaded&#125;&#125;"</span>&gt;</span>Load &#123;&#123; fontFamily &#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">text</span> <span class="attr">wx:else</span>&gt;</span>&#123;&#123; fontFamily &#125;&#125; is loaded<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"btn-area"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"primary"</span> <span class="attr">bindtap</span>=<span class="string">"loadFontFace"</span>&gt;</span>加载字体<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">  data: &#123;</span><br><span class="line">    fontFamily: <span class="string">'Bitstream Vera Serif Bold'</span>,</span><br><span class="line">    loaded: <span class="literal">false</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  onLoad() &#123;</span><br><span class="line">    <span class="keyword">this</span>.setData(&#123;</span><br><span class="line">      loaded: <span class="literal">false</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  loadFontFace() &#123;</span><br><span class="line">    <span class="keyword">const</span> self = <span class="keyword">this</span></span><br><span class="line">    wx.loadFontFace(&#123;</span><br><span class="line">      family: <span class="keyword">this</span>.data.fontFamily,<span class="comment">// 定义的字体名称   必填</span></span><br><span class="line">      source: <span class="string">'url("https://sungd.github.io/Pacifico.ttf")'</span>,  <span class="comment">//必填</span></span><br><span class="line">      <span class="comment">//字体资源的地址。建议格式为 TTF 和 WOFF，WOFF2 在低版本的iOS上会不兼容。</span></span><br><span class="line">      desc:&#123;   <span class="comment">//可选的字体描述符                      否</span></span><br><span class="line">        style: <span class="string">'normal'</span><span class="comment">//  否      字体样式，可选值为 normal / italic / oblique</span></span><br><span class="line">        weight: <span class="string">'normal'</span><span class="comment">// 否     字体粗细，可选值为 normal / bold / 100 / 200../ 900</span></span><br><span class="line">        variant: <span class="string">'normal'</span><span class="comment">//否    设置小型大写字母的字体显示文本，可选值为 normal / small-caps / inherit</span></span><br><span class="line">      &#125;,</span><br><span class="line">      success(res) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(res.status)</span><br><span class="line">        self.setData(&#123; <span class="attr">loaded</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      fail: <span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(res.status)</span><br><span class="line">      &#125;,</span><br><span class="line">      complete: <span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(res.status)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.page-body-info</span> &#123;</span><br><span class="line">  <span class="attribute">align-items</span>: center;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">200</span>rpx <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.font-loaded</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: <span class="string">"Bitstream Vera Serif Bold"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.display-area</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">40</span>rpx;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-6-图片"><a href="#3-6-图片" class="headerlink" title="3.6 图片"></a>3.6 图片</h3><ul>
<li>wx.chooseImage    从本地相册选择图片或使用相机拍照。</li>
<li>wx.compressImage  压缩图片接口，可选压缩质量</li>
<li>wx.getImageInfo   获取图片信息。网络图片需先配置 download 域名才能生效。</li>
<li>wx.previewImage   在新页面中全屏预览图片。预览的过程中用户可以进行保存图片、发送给朋友等操作。</li>
<li>wx.saveImageToPhotosAlbum 保存图片到系统相册。 调用前需要 <strong>用户授权</strong></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">wx.chooseImage(&#123;</span><br><span class="line">  count: <span class="number">1</span>,<span class="comment">// 最多可以选择的图片张数   否，默认值为 9</span></span><br><span class="line">  sizeType: [<span class="string">'original'</span>, <span class="string">'compressed'</span>],<span class="comment">//所选的图片的尺寸   否  默认值为 ['original', 'compressed']</span></span><br><span class="line">  <span class="comment">//original : 原图    compressed:压缩图</span></span><br><span class="line">  sourceType: [<span class="string">'album'</span>, <span class="string">'camera'</span>],<span class="comment">//选择图片的来源          否 默认值为  ['album', 'camera']</span></span><br><span class="line">  <span class="comment">//album 从相册选图    camera 使用相机</span></span><br><span class="line">  success (res) &#123;</span><br><span class="line">    <span class="comment">// tempFilePath 可以作为 img 标签的 src 属性显示图片</span></span><br><span class="line">    <span class="keyword">const</span> tempFilePaths = res.tempFilePaths<span class="comment">//[''] 图片的本地临时文件 路径列表</span></span><br><span class="line">    <span class="keyword">const</span> tempFiles = res.tempFiles        <span class="comment">//[&#123;&#125;] 图片的本地临时     文件列表</span></span><br><span class="line">    <span class="comment">/*  res.tempFiles&#123;</span></span><br><span class="line"><span class="comment">          path:'',//本地临时文件路径</span></span><br><span class="line"><span class="comment">          size:200//本地临时文件大小，单位 B</span></span><br><span class="line"><span class="comment">        &#125; */</span></span><br><span class="line">        <span class="comment">//网络图片需先配置 download 域名才能生效。！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！</span></span><br><span class="line">    wx.getImageInfo(&#123;</span><br><span class="line">      src: res.tempFilePaths[<span class="number">0</span>],<span class="comment">//'images/a.jpg',//图片的路径，可以是相对路径、临时文件路径、存储文件路径、网络图片路径  必填</span></span><br><span class="line">      success (res) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(res.width)<span class="comment">//number 图片原始宽度，单位px。不考虑旋转。</span></span><br><span class="line">        <span class="built_in">console</span>.log(res.height)<span class="comment">//number 图片原始高度，单位px。不考虑旋转。</span></span><br><span class="line">        res.path<span class="comment">//''  图片的本地路径</span></span><br><span class="line">        res.orientation<span class="comment">//''     拍照时设备方向</span></span><br><span class="line">            <span class="comment">//'up'              默认方向（手机横持拍照），对应 Exif 中的 1。或无 orientation 信息。</span></span><br><span class="line">            <span class="comment">//'up-mirrored'     同 up，但镜像翻转，对应 Exif 中的 2</span></span><br><span class="line">            <span class="comment">//'down'            旋转180度，对应 Exif 中的 3</span></span><br><span class="line">            <span class="comment">//'down-mirrored'   同 down，但镜像翻转，对应 Exif 中的 4</span></span><br><span class="line">            <span class="comment">//'left-mirrored'   同 left，但镜像翻转，对应 Exif 中的 5</span></span><br><span class="line">            <span class="comment">//'right'           顺时针旋转90度，对应 Exif 中的 6</span></span><br><span class="line">            <span class="comment">//'right-mirrored'  同 right，但镜像翻转，对应 Exif 中的 7</span></span><br><span class="line">            <span class="comment">//'left'            逆时针旋转90度，对应 Exif 中的 8</span></span><br><span class="line">        re.type<span class="comment">//'' 图片格式</span></span><br><span class="line">      &#125;,</span><br><span class="line">      fail(res)&#123;&#125;,</span><br><span class="line">      complete(res)&#123;&#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  fail(res)&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">  &#125;,</span><br><span class="line">  complete(res)&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//两个方法的结合使用</span></span><br><span class="line">wx.chooseImage(&#123;</span><br><span class="line">  success (res) &#123;</span><br><span class="line">    wx.getImageInfo(&#123;</span><br><span class="line">      src: res.tempFilePaths[<span class="number">0</span>],</span><br><span class="line">      success (res) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(res.width)</span><br><span class="line">        <span class="built_in">console</span>.log(res.height)</span><br><span class="line">      &#125;,</span><br><span class="line">      fail(res)&#123;&#125;,</span><br><span class="line">      complete(res)&#123;&#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//压缩图片接口，可选压缩质量</span></span><br><span class="line">wx.compressImage(&#123;</span><br><span class="line">  src: <span class="string">''</span>, <span class="comment">// 图片路径,图片路径，图片的路径，可以是相对路径、临时文件路径、存储文件路径  必填</span></span><br><span class="line">  quality: <span class="number">80</span>, <span class="comment">// 压缩质量，压缩质量，范围0～100，数值越小，质量越低，压缩率越高（仅对jpg有效）。  否 默认值 80</span></span><br><span class="line">  success(res)&#123;&#125;,</span><br><span class="line">  fail(res)&#123;&#125;,</span><br><span class="line">  complete(res)&#123;&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">wx.previewImage(&#123;</span><br><span class="line">  current: <span class="string">''</span>, <span class="comment">// 当前显示图片的 http 链接  否    默认值：urls 的第一张</span></span><br><span class="line">  urls: [], <span class="comment">// 需要预览的图片 http 链接列表,2.2.3 起支持云文件ID。  必填</span></span><br><span class="line">  success(res) &#123; &#125;,</span><br><span class="line">  fail(res) &#123; &#125;,</span><br><span class="line">  complete(res) &#123; &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">wx.saveImageToPhotosAlbum(&#123;</span><br><span class="line">  filePath:<span class="string">''</span>,<span class="comment">//图片文件路径，可以是临时文件路径或永久文件路径，不支持网络图片路径  必填</span></span><br><span class="line">  success(res) &#123; &#125;,</span><br><span class="line">  fail(res) &#123; &#125;,</span><br><span class="line">  complete(res) &#123; &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="3-6-1-运用实例"><a href="#3-6-1-运用实例" class="headerlink" title="3.6.1 运用实例"></a>3.6.1 运用实例</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"weui-panel"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"weui-panel__hd"</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"weui-panel__bd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">image</span> <span class="attr">mode</span>=<span class="string">'widthFix'</span> <span class="attr">src</span>=<span class="string">"&#123;&#123;src&#125;&#125;"</span> <span class="attr">style</span>=<span class="string">'width: 300px;'</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">bindtap</span>=<span class="string">"getImageInfo"</span>&gt;</span>getImageInfo<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"weui-panel__ft"</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:if</span>=<span class="string">"&#123;&#123;!!info&#125;&#125;"</span> <span class="attr">class</span>=<span class="string">'result'</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">text</span> <span class="attr">space</span>=<span class="string">"nbsp"</span>&gt;</span>&#123;&#123;info&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> app = getApp()</span><br><span class="line"></span><br><span class="line">Page(&#123;</span><br><span class="line">  data: &#123;</span><br><span class="line">    src: <span class="string">'http://mmbiz.qpic.cn/mmbiz_png/icTdbqWNOwNTTiaKet81gQJDXYnPiaJFSzRlp9frTTX2hSN01xhiackVLHHrG7ZQI3XQsbM7Gr9USZdN4f26SO5xjg/0?wx_fmt=png'</span>,</span><br><span class="line">    info: <span class="string">''</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  getImageInfo() &#123;</span><br><span class="line">    wx.getImageInfo(&#123;</span><br><span class="line">      src: <span class="keyword">this</span>.data.src,</span><br><span class="line">      complete: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.setData(&#123;</span><br><span class="line">          info: <span class="keyword">this</span>.format(res)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  format(obj) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'&#123;\n'</span> +</span><br><span class="line">      <span class="built_in">Object</span>.keys(obj).map(<span class="function"><span class="keyword">function</span> (<span class="params">key</span>) </span>&#123; <span class="keyword">return</span> <span class="string">'  '</span> + key + <span class="string">': '</span> + obj[key] + <span class="string">','</span> &#125;).join(<span class="string">'\n'</span>) + <span class="string">'\n'</span> +</span><br><span class="line">    <span class="string">'&#125;'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="3-7-实时音视频-直播"><a href="#3-7-实时音视频-直播" class="headerlink" title="3.7 实时音视频 (直播)"></a>3.7 实时音视频 (直播)</h3><h4 id="3-7-1-LivePlayerContext-对象-观看直播"><a href="#3-7-1-LivePlayerContext-对象-观看直播" class="headerlink" title="3.7.1 LivePlayerContext 对象  (观看直播)"></a>3.7.1 LivePlayerContext 对象  (观看直播)</h4><ul>
<li>wx.createLivePlayerContext  创建对象  参数为 <code>&lt;live-player&gt;</code> 组件的 id, 第二个可选参数 this</li>
<li>.exitFullScreen     退出全屏  三个回调函数</li>
<li>.mute               静音     三个回调函数</li>
<li>.pause              暂停     三个回调函数</li>
<li>.play               播放     三个回调函数</li>
<li>.requestFullScreen  进入全屏  direction 以及 三个回调函数   0：正常竖向  90：屏幕逆时针90度  -90：屏幕顺时针90度</li>
<li>.resume             恢复         三个回调函数</li>
<li>.stop               停止         三个回调函数</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"page-body"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"page-section tc"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">live-player</span> <span class="attr">id</span>=<span class="string">"player"</span> <span class="attr">src</span>=<span class="string">"https://domain/pull_stream"</span> <span class="attr">mode</span>=<span class="string">"RTC"</span> <span class="attr">autoplay</span> <span class="attr">bindstatechange</span>=<span class="string">"statechange"</span> <span class="attr">binderror</span>=<span class="string">"error"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"btn-area"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">bindtap</span>=<span class="string">"bindPlay"</span> <span class="attr">class</span>=<span class="string">"page-body-button"</span> <span class="attr">type</span>=<span class="string">"primary"</span>&gt;</span>播放<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">bindtap</span>=<span class="string">"bindPause"</span> <span class="attr">class</span>=<span class="string">"page-body-button"</span> <span class="attr">type</span>=<span class="string">"primary"</span>&gt;</span>暂停<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">bindtap</span>=<span class="string">"bindStop"</span> <span class="attr">class</span>=<span class="string">"page-body-button"</span> <span class="attr">type</span>=<span class="string">"primary"</span>&gt;</span>停止<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">bindtap</span>=<span class="string">"bindResume"</span> <span class="attr">class</span>=<span class="string">"page-body-button"</span> <span class="attr">type</span>=<span class="string">"primary"</span>&gt;</span>恢复<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">bindtap</span>=<span class="string">"bindMute"</span> <span class="attr">class</span>=<span class="string">"page-body-button"</span> <span class="attr">type</span>=<span class="string">"primary"</span>&gt;</span>静音<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">  onReady(res) &#123;</span><br><span class="line">    <span class="keyword">this</span>.ctx = wx.createLivePlayerContext(<span class="string">'player'</span>)<span class="comment">// 创建</span></span><br><span class="line">  &#125;,</span><br><span class="line">  statechange(e) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'live-player code:'</span>, e.detail.code)</span><br><span class="line">  &#125;,</span><br><span class="line">  error(e) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(<span class="string">'live-player error:'</span>, e.detail.errMsg)</span><br><span class="line">  &#125;,</span><br><span class="line">  bindPlay() &#123;</span><br><span class="line">    <span class="comment">// 播放</span></span><br><span class="line">    <span class="keyword">this</span>.ctx.play(&#123;</span><br><span class="line">      success: <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'play success'</span>)</span><br><span class="line">      &#125;,</span><br><span class="line">      fail: <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'play fail'</span>)</span><br><span class="line">      &#125;,</span><br><span class="line">      complete:<span class="function"><span class="params">res</span> =&gt;</span> &#123;&#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  bindPause() &#123;</span><br><span class="line">    <span class="keyword">this</span>.ctx.pause(&#123;</span><br><span class="line">      success: <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'pause success'</span>)</span><br><span class="line">      &#125;,</span><br><span class="line">      fail: <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'pause fail'</span>)</span><br><span class="line">      &#125;,</span><br><span class="line">      complete:<span class="function"><span class="params">res</span> =&gt;</span> &#123;&#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  bindStop() &#123;</span><br><span class="line">    <span class="keyword">this</span>.ctx.stop(&#123;</span><br><span class="line">      success: <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'stop success'</span>)</span><br><span class="line">      &#125;,</span><br><span class="line">      fail: <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'stop fail'</span>)</span><br><span class="line">      &#125;,</span><br><span class="line">      complete:<span class="function"><span class="params">res</span> =&gt;</span> &#123;&#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  bindResume() &#123;</span><br><span class="line">    <span class="keyword">this</span>.ctx.resume(&#123;</span><br><span class="line">      success: <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'resume success'</span>)</span><br><span class="line">      &#125;,</span><br><span class="line">      fail: <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'resume fail'</span>)</span><br><span class="line">      &#125;,</span><br><span class="line">      complete:<span class="function"><span class="params">res</span> =&gt;</span> &#123;&#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  bindMute() &#123;</span><br><span class="line">    <span class="keyword">this</span>.ctx.mute(&#123;</span><br><span class="line">      success: <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'mute success'</span>)</span><br><span class="line">      &#125;,</span><br><span class="line">      fail: <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'mute fail'</span>)</span><br><span class="line">      &#125;,</span><br><span class="line">      complete:<span class="function"><span class="params">res</span> =&gt;</span> &#123;&#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.page-body-button</span> &#123;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">30</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">live-player</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">225px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-7-2-LivePusherContext-对象-（开直播）"><a href="#3-7-2-LivePusherContext-对象-（开直播）" class="headerlink" title="3.7.2 LivePusherContext 对象 （开直播）"></a>3.7.2 LivePusherContext 对象 （开直播）</h4><ul>
<li>wx.createLivePusherContext 创建对象  参数为 id</li>
<li>.pause        暂停推流        三个回调函数</li>
<li>.pauseBGM     暂停背景音      三个回调函数</li>
<li>.playBGM      播放背景音      三个回调函数 必填 url 与<br>  livePusherContext.playBGM({<pre><code>url:&apos;&apos;,       // 加入背景混音的资源地址 必填
success(res){},
fail(res){},
complete(res){}
</code></pre>  })</li>
<li>.resume       恢复推流        三个回调函数</li>
<li>.resumeBGM    恢复背景音      三个回调函数</li>
<li>.setBGMVolume 设置背景音音量  三个回调函数 必填 Volume<br>  livePusherContext.setBGMVolume({<pre><code>Volume:&apos;&apos;,   //音量大小     必填
success(res){},
fail(res){},
complete(res){}
</code></pre>  })</li>
<li>.snapshot     快照           三个回调函数</li>
<li>.start        播放推流       三个回调函数</li>
<li>.stop         停止推流       三个回调函数</li>
<li>.stopBGM      停止背景音     三个回调函数</li>
<li>.switchCamera 切换前后摄像头  三个回调函数</li>
<li>.toggleTorch  切换           三个回调函数</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"page-body"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"page-section tc"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">live-pusher</span> <span class="attr">id</span>=<span class="string">"pusher"</span> <span class="attr">url</span>=<span class="string">"https://domain/push_stream"</span> <span class="attr">mode</span>=<span class="string">"RTC"</span> <span class="attr">autopush</span> <span class="attr">bindstatechange</span>=<span class="string">"statechange"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"btn-area"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">bindtap</span>=<span class="string">"bindStart"</span> <span class="attr">class</span>=<span class="string">"page-body-button"</span> <span class="attr">type</span>=<span class="string">"primary"</span>&gt;</span>播放推流<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">bindtap</span>=<span class="string">"bindPause"</span> <span class="attr">class</span>=<span class="string">"page-body-button"</span> <span class="attr">type</span>=<span class="string">"primary"</span>&gt;</span>暂停推流<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">bindtap</span>=<span class="string">"bindStop"</span> <span class="attr">class</span>=<span class="string">"page-body-button"</span> <span class="attr">type</span>=<span class="string">"primary"</span>&gt;</span>停止推流<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">bindtap</span>=<span class="string">"bindResume"</span> <span class="attr">class</span>=<span class="string">"page-body-button"</span> <span class="attr">type</span>=<span class="string">"primary"</span>&gt;</span>恢复推流<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">bindtap</span>=<span class="string">"bindSwitchCamera"</span> <span class="attr">class</span>=<span class="string">"page-body-button"</span> <span class="attr">type</span>=<span class="string">"primary"</span>&gt;</span>切换前后摄像头<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">  onReady(res) &#123;</span><br><span class="line">    <span class="keyword">this</span>.ctx = wx.createLivePusherContext(<span class="string">'pusher'</span>)<span class="comment">// 创建对象</span></span><br><span class="line">  &#125;,</span><br><span class="line">  statechange(e) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'live-pusher code:'</span>, e.detail.code)</span><br><span class="line">  &#125;,</span><br><span class="line">  bindStart() &#123;</span><br><span class="line">    <span class="comment">// 播放</span></span><br><span class="line">    <span class="keyword">this</span>.ctx.start(&#123;</span><br><span class="line">      success: <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'start success'</span>)</span><br><span class="line">      &#125;,</span><br><span class="line">      fail: <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'start fail'</span>)</span><br><span class="line">      &#125;,</span><br><span class="line">      complete:<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  bindPause() &#123;</span><br><span class="line">    <span class="keyword">this</span>.ctx.pause(&#123;</span><br><span class="line">      success: <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'pause success'</span>)</span><br><span class="line">      &#125;,</span><br><span class="line">      fail: <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'pause fail'</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  bindStop() &#123;</span><br><span class="line">    <span class="keyword">this</span>.ctx.stop(&#123;</span><br><span class="line">      success: <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'stop success'</span>)</span><br><span class="line">      &#125;,</span><br><span class="line">      fail: <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'stop fail'</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  bindResume() &#123;</span><br><span class="line">    <span class="keyword">this</span>.ctx.resume(&#123;</span><br><span class="line">      success: <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'resume success'</span>)</span><br><span class="line">      &#125;,</span><br><span class="line">      fail: <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'resume fail'</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  bindSwitchCamera() &#123;</span><br><span class="line">    <span class="keyword">this</span>.ctx.switchCamera(&#123;</span><br><span class="line">      success: <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'switchCamera success'</span>)</span><br><span class="line">      &#125;,</span><br><span class="line">      fail: <span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'switchCamera fail'</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.page-body-button</span> &#123;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">30</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">live-pusher</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span> auto;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">225px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="3-7-3-实时音视频-直播-权限"><a href="#3-7-3-实时音视频-直播-权限" class="headerlink" title="3.7.3 实时音视频 (直播) 权限"></a>3.7.3 实时音视频 (直播) 权限</h4><p>当然不是小程序使用了这些标签 <code>&lt;live-pusher&gt;</code>,<code>&lt;live-player&gt;</code> 就可以做到实时直播功能的，<br>这个需要是符合微信的某些分类，并且在后台接口端设置之后才可以用的。<br>符合类目要求的小程序，需要在小程序管理后台的 “设置 - 接口设置” 中自助开通该组件权限。</p>
<p><a href="https://cloud.tencent.com/document/product/454/13037" target="_blank" rel="noopener">官网常见问题解析</a></p>
<h3 id="3-7-录音"><a href="#3-7-录音" class="headerlink" title="3.7 录音"></a>3.7 录音</h3><h4 id="3-7-1-wx-getRecorderManager-获取全局唯一的录音管理器-RecorderManager-对象-无参数"><a href="#3-7-1-wx-getRecorderManager-获取全局唯一的录音管理器-RecorderManager-对象-无参数" class="headerlink" title="3.7.1 wx.getRecorderManager  获取全局唯一的录音管理器 RecorderManager 对象   无参数"></a>3.7.1 wx.getRecorderManager  获取全局唯一的录音管理器 RecorderManager 对象   无参数</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">``</span><span class="string">`</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#### 3.7.2  RecorderManager  的 wx.API</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">- wx.startRecord        开始录音。**需要授权**</span></span><br><span class="line"><span class="string">    当主动调用 wx.stopRecord，或者录音超过1分钟时自动结束录音。当用户离开小程序时，此接口无法调用。    三个回电函数</span></span><br><span class="line"><span class="string">    success(res.tempFilePath)  // 录音文件的临时路径</span></span><br><span class="line"><span class="string">- wx.stopRecord         停止录音。无参数</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>JS</span><br><span class="line">wx.startRecord(&#123;</span><br><span class="line">  success (res) &#123;</span><br><span class="line">    <span class="keyword">const</span> tempFilePath = res.tempFilePath</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  wx.stopRecord() <span class="comment">// 结束录音</span></span><br><span class="line">&#125;, <span class="number">10000</span>)</span><br></pre></td></tr></table></figure>
<h4 id="3-7-3-RecorderManager-对象的方法"><a href="#3-7-3-RecorderManager-对象的方法" class="headerlink" title="3.7.3  RecorderManager 对象的方法"></a>3.7.3  RecorderManager 对象的方法</h4><ul>
<li>.onError    监听录音错误事件                                                                回调函数<br>  (res)=&gt;{<pre><code>res.errMsg  //&apos;&apos; 错误信息
</code></pre>  }</li>
<li>.onFrameRecorded    监听已录制完指定帧大小的文件事件。如果设置了 frameSize，则会回调此事件。    回调函数<br>  (res)=&gt;{<pre><code>res.frameBuffer  //ArrayBuffer  录音分片数据
res.isLastFrame  //boolean      当前帧是否正常录音结束前的最后一帧
</code></pre>  }</li>
<li>.onInterruptionBegin 监听录音因为受到系统占用而被中断开始事件。                                回调函数<br>  以下场景会触发此事件：微信语音聊天、微信视频聊天。此事件触发后，录音会被暂停。pause 事件在此事件后触发</li>
<li>.onInterruptionEnd   监听录音中断结束事件。                                                  回调函数<br>  在收到 interruptionBegin 事件之后，小程序内所有录音会暂停，收到此事件之后才可再次录音成功。</li>
<li>.onPause      监听录音暂停事件     回调函数</li>
<li>.onResume     监听录音继续事件     回调函数</li>
<li>.onStart      监听录音开始事件     回调函数</li>
<li>.onStop       监听录音结束事件     回调函数<br>  (res)=&gt;{<pre><code>res.tempFilePath  //&apos;&apos; 录音文件的临时路径
</code></pre>  }</li>
<li>.pause     暂停录音             无参数</li>
<li>.resume    继续录音             无参数</li>
<li>.start     开始录音<br>  recorderManager.start({<pre><code>duration:60000,//录音的时长，单位 ms，最大值 600000（10 分钟）      否，默认为 60000 即 10 分钟
sampleRate:8000,// 采样率      否，默认8000
numberOfChannels:2,//录音通道数  否，默认2
encodeBitRate:48000,//编码码率，有效值见下表格 否，默认48000
format:&apos;abc&apos;,//音频格式       否，默认 &apos;abc&apos;
frameSize:90,//指定帧大小，单位 KB。  否
            //传入 frameSize 后，每录制指定帧大小的内容后，会回调录制的文件内容，不指定则不会回调。暂仅支持 mp3 格式。
audioSource:&apos;auto&apos;//指定录音的音频输入源，可通过 wx.getAvailableAudioSources() 获取当前可用的音频源   否
        [**以上这些返回值的可取值参考** 微信官方文档](https://developers.weixin.qq.com/miniprogram/dev/api/RecorderManager.start.html)
</code></pre>  })</li>
<li>.stop      停止录音             无参数</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> recorderManager = wx.getRecorderManager()<span class="comment">//获取全局唯一的录音管理器 RecorderManager 无参数</span></span><br><span class="line"></span><br><span class="line">recorderManager.onStart(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'recorder start'</span>)</span><br><span class="line">&#125;)</span><br><span class="line">recorderManager.onPause(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'recorder pause'</span>)</span><br><span class="line">&#125;)</span><br><span class="line">recorderManager.onStop(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'recorder stop'</span>, res)</span><br><span class="line">  <span class="keyword">const</span> &#123; tempFilePath &#125; = res</span><br><span class="line">&#125;)</span><br><span class="line">recorderManager.onFrameRecorded(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; frameBuffer &#125; = res</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'frameBuffer.byteLength'</span>, frameBuffer.byteLength)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> options = &#123;</span><br><span class="line">  duration: <span class="number">10000</span>,</span><br><span class="line">  sampleRate: <span class="number">44100</span>,</span><br><span class="line">  numberOfChannels: <span class="number">1</span>,</span><br><span class="line">  encodeBitRate: <span class="number">192000</span>,</span><br><span class="line">  format: <span class="string">'aac'</span>,</span><br><span class="line">  frameSize: <span class="number">50</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">recorderManager.start(options)</span><br></pre></td></tr></table></figure>
<h3 id="3-8-视频"><a href="#3-8-视频" class="headerlink" title="3.8 视频"></a>3.8 视频</h3><h4 id="3-8-1-VideoContext-的-wx-Api"><a href="#3-8-1-VideoContext-的-wx-Api" class="headerlink" title="3.8.1 VideoContext 的 wx.Api"></a>3.8.1 VideoContext 的 wx.Api</h4><ul>
<li>wx.createVideoContext     创建 video 上下文 VideoContext 对象 ，参数 id，第二个 可选参数 this</li>
<li>wx.chooseVideo            拍摄视频或从手机相册中选视频。</li>
<li>wx.saveVideoToPhotosAlbum 保存视频到系统相册 <strong>需要先用户授权</strong></li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">video</span> <span class="attr">id</span>=<span class="string">"myVideo"</span> <span class="attr">src</span>=<span class="string">"http://wxsnsdy.tc.qq.com/105/20210/snsdyvideodownload?filekey=30280201010421301f0201690402534804102ca905ce620b1241b726bc41dcff44e00204012882540400&amp;bizid=1023&amp;hy=SH&amp;fileparam=302c020101042530230204136ffd93020457e3c4ff02024ef202031e8d7f02030f42400204045a320a0201000400"</span> <span class="attr">danmu-list</span>=<span class="string">"&#123;&#123;danmuList&#125;&#125;"</span> <span class="attr">enable-danmu</span> <span class="attr">danmu-btn</span> <span class="attr">controls</span>&gt;</span><span class="tag">&lt;/<span class="name">video</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">onReady: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.videoContext = wx.createVideoContext(<span class="string">'myVideo'</span>)<span class="comment">// 创建视频 对象</span></span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">wx.saveVideoToPhotosAlbum(&#123;</span><br><span class="line">  filePath: <span class="string">'wxfile://xxx'</span>,<span class="comment">//视频文件路径，可以是临时文件路径也可以是永久文件路径   必填</span></span><br><span class="line">  success (res) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res.errMsg)</span><br><span class="line">  &#125;,</span><br><span class="line">  fail(res)&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">  &#125;,</span><br><span class="line">  complete(res)&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">wx.chooseVideo(&#123;</span><br><span class="line">  sourceType: [<span class="string">'album'</span>,<span class="string">'camera'</span>],<span class="comment">//视频选择的来源 否 默认值 ['album', 'camera']</span></span><br><span class="line">  <span class="comment">//album 从相册选择视频     camera 使用相机拍摄视频</span></span><br><span class="line">  compressed:<span class="literal">true</span>,<span class="comment">//是否压缩所选择的视频文件       否 默认值 true</span></span><br><span class="line">  maxDuration: <span class="number">60</span>,<span class="comment">//拍摄视频最长拍摄时间，单位秒   否 默认值 60</span></span><br><span class="line">  camera: <span class="string">'back'</span>,<span class="comment">//默认拉起的是前置或者后置摄像头。部分 Android 手机下由于系统 ROM 不支持无法生效  否 默认值 'back'</span></span><br><span class="line">  <span class="comment">//back  默认拉起后置摄像头   front  默认拉起前置摄像头</span></span><br><span class="line">  success(res) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res.tempFilePath)</span><br><span class="line">      empFilePath<span class="comment">//string 选定视频的临时文件路径</span></span><br><span class="line">      duration<span class="comment">//number    选定视频的时间长度</span></span><br><span class="line">      size<span class="comment">//number        选定视频的数据量大小</span></span><br><span class="line">      height<span class="comment">//number      返回选定视频的高度</span></span><br><span class="line">      width<span class="comment">//number       返回选定视频的宽度</span></span><br><span class="line">  &#125;,</span><br><span class="line">  fail(res)&#123;&#125;,</span><br><span class="line">  complete(res)&#123;&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="3-8-1-VideoContext-对象的-方法"><a href="#3-8-1-VideoContext-对象的-方法" class="headerlink" title="3.8.1 VideoContext 对象的 方法"></a>3.8.1 VideoContext 对象的 方法</h4><ul>
<li>.exitFullScreen 退出全屏  无参数</li>
<li>.hideStatusBar  隐藏状态栏，仅在iOS全屏下有效 无参数</li>
<li>.pause          暂停视频  无参数</li>
<li>.play           播放视频  无参数</li>
<li>.playbackRate   设置倍速播放  参数：倍率，支持 0.5/0.8/1.0/1.25/1.5 （number）</li>
<li>.requestFullScreen 进入全屏   参数：direction  //设置全屏时视频的方向，不指定则根据宽高比自动判断。 否：不是必填（number）<pre><code>0   正常竖向
90  屏幕逆时针90度
-90 屏幕顺时针90度
</code></pre></li>
<li>.seek          跳转到指定位置 参数  position 跳转到的位置，单位 s（number）</li>
<li>.sendDanmu    发送弹幕 （观看视频发送弹幕）                      (obj)<br>  videoContext.sendDanmu({<pre><code>text:&apos;&apos;,// tring   必填 弹幕文字
color:&apos;&apos;// tring  否   弹幕颜色
</code></pre>  })</li>
<li>.showStatusBar 显示状态栏，仅在iOS全屏下有效  无参数</li>
<li>.stop         停止视频  无参数</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"page-body"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"page-section tc"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">video</span> <span class="attr">id</span>=<span class="string">"myVideo"</span> <span class="attr">src</span>=<span class="string">"http://wxsnsdy.tc.qq.com/105/20210/snsdyvideodownload?filekey=30280201010421301f0201690402534804102ca905ce620b1241b726bc41dcff44e00204012882540400&amp;bizid=1023&amp;hy=SH&amp;fileparam=302c020101042530230204136ffd93020457e3c4ff02024ef202031e8d7f02030f42400204045a320a0201000400"</span> <span class="attr">binderror</span>=<span class="string">"videoErrorCallback"</span> <span class="attr">danmu-list</span>=<span class="string">"&#123;&#123;danmuList&#125;&#125;"</span> <span class="attr">enable-danmu</span> <span class="attr">danmu-btn</span> <span class="attr">controls</span>&gt;</span><span class="tag">&lt;/<span class="name">video</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"weui-cells"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"weui-cell weui-cell_input"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"weui-cell__hd"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"weui-label"</span>&gt;</span>弹幕内容<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"weui-cell__bd"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">input</span> <span class="attr">bindblur</span>=<span class="string">"bindInputBlur"</span> <span class="attr">class</span>=<span class="string">"weui-input"</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">placeholder</span>=<span class="string">"在此处输入弹幕内容"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"btn-area"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">bindtap</span>=<span class="string">"bindSendDanmu"</span> <span class="attr">class</span>=<span class="string">"page-body-button"</span> <span class="attr">type</span>=<span class="string">"primary"</span> <span class="attr">formType</span>=<span class="string">"submit"</span>&gt;</span>发送弹幕<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">bindtap</span>=<span class="string">"bindPlay"</span> <span class="attr">class</span>=<span class="string">"page-body-button"</span> <span class="attr">type</span>=<span class="string">"primary"</span>&gt;</span>播放<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">bindtap</span>=<span class="string">"bindPause"</span> <span class="attr">class</span>=<span class="string">"page-body-button"</span> <span class="attr">type</span>=<span class="string">"primary"</span>&gt;</span>暂停<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getRandomColor</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> rgb = []</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span> ; i &lt; <span class="number">3</span>; ++i)&#123;</span><br><span class="line">    <span class="keyword">let</span> color = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">256</span>).toString(<span class="number">16</span>)</span><br><span class="line">    color = color.length == <span class="number">1</span> ? <span class="string">'0'</span> + color : color</span><br><span class="line">    rgb.push(color)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'#'</span> + rgb.join(<span class="string">''</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Page(&#123;</span><br><span class="line">  onReady: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.videoContext = wx.createVideoContext(<span class="string">'myVideo'</span>)<span class="comment">// 创建</span></span><br><span class="line">  &#125;,</span><br><span class="line">  inputValue: <span class="string">''</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">    src: <span class="string">''</span>,</span><br><span class="line">    danmuList:</span><br><span class="line">      [&#123;</span><br><span class="line">        text: <span class="string">'第 1s 出现的弹幕'</span>,</span><br><span class="line">        color: <span class="string">'#ff0000'</span>,</span><br><span class="line">        time: <span class="number">1</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        text: <span class="string">'第 3s 出现的弹幕'</span>,</span><br><span class="line">        color: <span class="string">'#ff00ff'</span>,</span><br><span class="line">        time: <span class="number">3</span></span><br><span class="line">      &#125;]</span><br><span class="line">    &#125;,</span><br><span class="line">  bindInputBlur: <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.inputValue = e.detail.value</span><br><span class="line">  &#125;,</span><br><span class="line">  bindSendDanmu: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 发送弹幕</span></span><br><span class="line">    <span class="keyword">this</span>.videoContext.sendDanmu(&#123;</span><br><span class="line">      text: <span class="keyword">this</span>.inputValue,</span><br><span class="line">      color: getRandomColor()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  bindPlay: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.videoContext.play()</span><br><span class="line">  &#125;,</span><br><span class="line">  bindPause: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.videoContext.pause()</span><br><span class="line">  &#125;,</span><br><span class="line">  videoErrorCallback: <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'视频错误信息:'</span>)</span><br><span class="line">    <span class="built_in">console</span>.log(e.detail.errMsg)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">import</span> <span class="string">"../lib/weui.wxss"</span>;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.weui-cells</span>&#123;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">80</span>rpx;</span><br><span class="line">  <span class="attribute">text-align</span>: left;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.weui-label</span>&#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">5em</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.page-body-button</span> &#123;</span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">30</span>rpx;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="四、文件"><a href="#四、文件" class="headerlink" title="四、文件"></a>四、文件</h2><p>wx.getFileInfo<br>wx.getFileSystemManager<br>wx.getSavedFileInfo<br>wx.getSavedFileList<br>wx.openDocument<br>wx.removeSavedFile<br>wx.saveFile</p>
<p>FileSystemManager<br>.access<br>.accessSync<br>.appendFile<br>.appendFileSync<br>.copyFile<br>.copyFileSync<br>.getFileInfo<br>.getSavedFileList<br>.mkdir<br>.mkdirSync<br>.readdir<br>.readdirSync<br>.readFile<br>.readFileSync<br>.removeSavedFile<br>.rename<br>.renameSync<br>.rmdir<br>.rmdirSync<br>.saveFile<br>.saveFileSync<br>.stat<br>.statSync<br>.unlink<br>.unlinkSync<br>.unzip<br>.writeFile<br>.writeFileSync</p>
<p>Stats<br>.isDirectory<br>.isFile</p>
<h2 id="五、数据缓存"><a href="#五、数据缓存" class="headerlink" title="五、数据缓存"></a>五、数据缓存</h2><p>synchronous：同步    sync  同步<br>asynchronous：异步   async 异步</p>
<h3 id="5-1-异步操作"><a href="#5-1-异步操作" class="headerlink" title="5.1 异步操作"></a>5.1 异步操作</h3><ul>
<li>wx.setStorage<br>  将数据存储在本地缓存中指定的 key 中。会覆盖掉原来该 key 对应的内容。数据存储生命周期跟小程序本身一致，即除用户主动删除或超过一定时间被自动清理，否则数据都一直可用。<strong>单个 key 允许存储的最大数据长度为 1MB，所有数据存储上限为 10MB。</strong></li>
<li>wx.getStorage      从本地缓存中异步获取指定 key 的内容</li>
<li>wx.getStorageInfo  异步获取当前storage的相关信息</li>
<li>wx.clearStorage    清理本地数据缓存</li>
<li>wx.removeStorage   从本地缓存中移除指定 key</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">wx.setStorage(&#123;</span><br><span class="line">  key:<span class="string">"key"</span>,<span class="comment">// 本地缓存中指定的 key   必填</span></span><br><span class="line">  data:<span class="string">"value"</span>,<span class="comment">// 需要存储的内容。只支持原生类型、Date、及能够通过 JSON.stringify 序列化的对象。  必填</span></span><br><span class="line">  success(res)&#123;&#125;,</span><br><span class="line">  fail(res)&#123;&#125;,</span><br><span class="line">  complete(res)&#123;&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">wx.getStorage(&#123;</span><br><span class="line">  key: <span class="string">'key'</span>,<span class="comment">//本地缓存中指定的 key   必填</span></span><br><span class="line">  success (res) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res.data)<span class="comment">// Object/string       key 对应的内容</span></span><br><span class="line">  &#125;,</span><br><span class="line">  fail(res)&#123;&#125;,</span><br><span class="line">  complete(res)&#123;&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">wx.getStorageInfo(&#123;</span><br><span class="line">  success (res) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res.keys)<span class="comment">//['']       当前 storage 中所有的 key</span></span><br><span class="line">    <span class="built_in">console</span>.log(res.currentSize)<span class="comment">//80  当前占用的空间大小, 单位 KB</span></span><br><span class="line">    <span class="built_in">console</span>.log(res.limitSize)<span class="comment">//90    限制的空间大小，单位 KB</span></span><br><span class="line">  &#125;,</span><br><span class="line">  fail(res)&#123;&#125;,</span><br><span class="line">  complete(res)&#123;&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">wx.clearStorage(&#123;</span><br><span class="line">  success (res) &#123;&#125;,</span><br><span class="line">  fail(res)&#123;&#125;,</span><br><span class="line">  complete(res)&#123;&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">wx.removeStorage(&#123;</span><br><span class="line">  key: <span class="string">'key'</span>,<span class="comment">// 本地缓存中指定的 key   必填</span></span><br><span class="line">  success (res) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res.data)</span><br><span class="line">  &#125;,</span><br><span class="line">  fail(res)&#123;&#125;,</span><br><span class="line">  complete(res)&#123;&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="5-2-同步操作"><a href="#5-2-同步操作" class="headerlink" title="5.2 同步操作"></a>5.2 同步操作</h3><ul>
<li>wx.setStorageSync     wx.setStorage 的同步版本</li>
<li>wx.getStorageSync     wx.getStorage 的同步版本</li>
<li>wx.getStorageInfoSync wx.getStorageInfo 的同步版本</li>
<li>wx.clearStorageSync   wx.clearStorage 的同步版本</li>
<li>wx.removeStorageSync  wx.removeStorage 的同步版本</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  wx.setStorageSync(<span class="string">'key'</span>, <span class="string">'value'</span>)</span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123; &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="keyword">var</span> value = wx.getStorageSync(<span class="string">'key'</span>)</span><br><span class="line">  <span class="keyword">if</span> (value) &#123;</span><br><span class="line">    <span class="comment">// Do something with return value</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">  <span class="comment">// Do something when catch error</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  wx.clearStorageSync()</span><br><span class="line">&#125; <span class="keyword">catch</span>(e) &#123;</span><br><span class="line">  <span class="comment">// Do something when catch error</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> res = wx.getStorageInfoSync()</span><br><span class="line">  <span class="built_in">console</span>.log(res.keys)</span><br><span class="line">  <span class="built_in">console</span>.log(res.currentSize)</span><br><span class="line">  <span class="built_in">console</span>.log(res.limitSize)</span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">  <span class="comment">// Do something when catch error</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  wx.clearStorageSync()</span><br><span class="line">&#125; <span class="keyword">catch</span>(e) &#123;</span><br><span class="line">  <span class="comment">// Do something when catch error</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  wx.removeStorageSync(<span class="string">'key'</span>)</span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">  <span class="comment">// Do something when catch error</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="六、位置（地理位置）调用前需要授权"><a href="#六、位置（地理位置）调用前需要授权" class="headerlink" title="六、位置（地理位置）调用前需要授权"></a>六、位置（地理位置）<strong>调用前需要授权</strong></h2><ul>
<li>wx.chooseLocation 打开地图选择位置。<strong>调用前需要授权</strong></li>
<li>wx.getLocation   获取当前的地理位置、速度。当用户离开小程序后，此接口无法调用。<strong>调用前需要授权</strong></li>
<li>wx.openLocation  使用微信内置地图查看位置</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">wx.chooseLocation(&#123;</span><br><span class="line">  success(res)&#123;</span><br><span class="line">    res.name<span class="comment">//string      位置名称</span></span><br><span class="line">    res.address<span class="comment">//string   详细地址</span></span><br><span class="line">    res.latitude<span class="comment">//string  纬度，浮点数，范围为-90~90，负数表示南纬。使用 gcj02 国测局坐标系	</span></span><br><span class="line">    res.longitude<span class="comment">//string 经度，浮点数，范围为-180~180，负数表示西经。使用 gcj02 国测局坐标系</span></span><br><span class="line">  &#125;,</span><br><span class="line">  fail(res)&#123;&#125;,</span><br><span class="line">  complete(res)&#123;&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">wx.getLocation(&#123;</span><br><span class="line"> type: <span class="string">'wgs84'</span>,<span class="comment">// wgs84 返回 gps 坐标，gcj02 返回可用于 wx.openLocation 的坐标   否 默认值 'wgs84'</span></span><br><span class="line"> altitude:<span class="string">'false'</span>,<span class="comment">//传入 true 会返回高度信息，由于获取高度需要较高精确度，会减慢接口返回速度  否，默认值是 'false'</span></span><br><span class="line"> success (res) &#123;</span><br><span class="line">   <span class="keyword">const</span> latitude = res.latitude<span class="comment">//80  纬度，范围为 -90~90，负数表示南纬</span></span><br><span class="line">   <span class="keyword">const</span> longitude = res.longitude<span class="comment">//100 经度，范围为 -180~180，负数表示西经</span></span><br><span class="line">   <span class="keyword">const</span> speed = res.speed<span class="comment">//2 速度，单位 m/s</span></span><br><span class="line">   <span class="keyword">const</span> accuracy = res.accuracy<span class="comment">//2 位置的精确度</span></span><br><span class="line">   res.altitude          <span class="comment">//2 高度，单位 m</span></span><br><span class="line">   res.verticalAccuracy  <span class="comment">//2    垂直精度，单位 m（Android 无法获取，返回 0）</span></span><br><span class="line">   res.horizontalAccuracy<span class="comment">//2 水平精度，单位 m</span></span><br><span class="line"></span><br><span class="line">   wx.openLocation(&#123;</span><br><span class="line">     latitude,<span class="comment">//这里是外层 wx.getLocation 返回值来的，纬度，范围为-90~90，负数表示南纬。使用 gcj02 国测局坐标系  必填</span></span><br><span class="line">     longitude,<span class="comment">//这里是外层 wx.getLocation 返回值来的，经度，范围为-180~180，负数表示西经。使用 gcj02 国测局坐标系 必填</span></span><br><span class="line">     scale: <span class="number">18</span>,<span class="comment">// 缩放比例，范围5~18  否</span></span><br><span class="line">     name:<span class="string">''</span>,<span class="comment">//位置名  否</span></span><br><span class="line">     address:<span class="string">''</span>,<span class="comment">//地址的详细说明 否</span></span><br><span class="line">    success(res)&#123;&#125;，</span><br><span class="line">    fail(res)&#123;&#125;,</span><br><span class="line">    complete(res)&#123;&#125;</span><br><span class="line">   &#125;)</span><br><span class="line"> &#125;,</span><br><span class="line"> fail(res)&#123;&#125;,</span><br><span class="line"> complete(res)&#123;&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>注意<br>工具中定位模拟使用 IP 定位，可能会有一定误差。且工具目前仅支持 gcj02 坐标。<br>使用第三方服务进行逆地址解析时，请确认第三方服务默认的坐标系，正确进行坐标转换。</p>
<h2 id="七、设备"><a href="#七、设备" class="headerlink" title="七、设备"></a>七、设备</h2><h3 id="7-1-加速计"><a href="#7-1-加速计" class="headerlink" title="7.1 加速计"></a>7.1 加速计</h3><p>wx.onAccelerometerChange 获取设备电量。同步 API wx.getBatteryInfoSync 在 iOS 上不可用。<br>wx.startAccelerometer<br>wx.stopAccelerometer</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">``</span><span class="string">`</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">### 7.2 电量</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">wx.getBatteryInfo     异步获取设备电量。</span></span><br><span class="line"><span class="string">wx.getBatteryInfoSync 同步获取设备电量。</span></span><br><span class="line"><span class="string">    顾名思义，这个api是需要同步的，所以可能会对游戏造成一定的卡顿；而且，这个api在iOS上是不可用的。</span></span><br><span class="line"><span class="string">    所以说同步的版本我们是不会用的咯？其他的接口我们也是不会用同步版本的咯。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">**在这里说一下小程序与小游戏的区别：他们的接口方法是不太一样的。**</span></span><br><span class="line"><span class="string">    在小游戏中 wx.getSystemInfo 系统的接口中 wx.getSystemInfo 中 success的参数res中，res.battery是代表电量的，我们可以用来设置界面上的电量显示。</span></span><br><span class="line"><span class="string">    但是我们在小程序中  wx.getSystemInfo 系统的接口中 wx.getSystemInfo 中 success的参数res中 是没有 res.battery ，所以我们是获取不到这个电量的。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">以上几个api都是只获取一次电量的值，所以我们在程序中需要做一个计时器以在固定的时间去获取电量值，这样才能保证实时更新电量。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>JS</span><br><span class="line">wx.getBatteryInfo(&#123;</span><br><span class="line">  success(res)&#123;</span><br><span class="line">    res.level<span class="comment">//string   设备电量，范围 1 - 100</span></span><br><span class="line">    isCharging<span class="comment">//boolean 是否正在充电中</span></span><br><span class="line">  &#125;,</span><br><span class="line">  fail(res)&#123;&#125;,</span><br><span class="line">  complete(res)&#123;&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="7-3-蓝牙"><a href="#7-3-蓝牙" class="headerlink" title="7.3 蓝牙"></a>7.3 蓝牙</h3><p>wx.closeBluetoothAdapter<br>wx.getBluetoothAdapterState<br>wx.getBluetoothDevices<br>wx.getConnectedBluetoothDevices<br>wx.onBluetoothAdapterStateChange<br>wx.onBluetoothDeviceFound<br>wx.openBluetoothAdapter<br>wx.startBluetoothDevicesDiscovery<br>wx.stopBluetoothDevicesDiscovery</p>
<h3 id="7-4-低功耗蓝牙"><a href="#7-4-低功耗蓝牙" class="headerlink" title="7.4 低功耗蓝牙"></a>7.4 低功耗蓝牙</h3><p>wx.closeBLEConnection<br>wx.createBLEConnection<br>wx.getBLEDeviceCharacteristics<br>wx.getBLEDeviceServices<br>wx.notifyBLECharacteristicValueChange<br>wx.onBLECharacteristicValueChange<br>wx.onBLEConnectionStateChange<br>wx.readBLECharacteristicValue<br>wx.writeBLECharacteristicValue</p>
<h3 id="7-5-剪贴板"><a href="#7-5-剪贴板" class="headerlink" title="7.5 剪贴板"></a>7.5 剪贴板</h3><p>wx.getClipboardData<br>wx.setClipboardData</p>
<h3 id="7-6-罗盘"><a href="#7-6-罗盘" class="headerlink" title="7.6 罗盘"></a>7.6 罗盘</h3><p>wx.onCompassChange<br>wx.startCompass<br>wx.stopCompass</p>
<h3 id="7-7-联系人-wx-addPhoneContact"><a href="#7-7-联系人-wx-addPhoneContact" class="headerlink" title="7.7 联系人 wx.addPhoneContact"></a>7.7 联系人 wx.addPhoneContact</h3><h3 id="7-8-陀螺仪"><a href="#7-8-陀螺仪" class="headerlink" title="7.8 陀螺仪"></a>7.8 陀螺仪</h3><p>wx.onGyroscopeChange<br>wx.startGyroscope<br>wx.stopGyroscope<br>iBeacon<br>wx.getBeacons<br>wx.onBeaconServiceChange<br>wx.onBeaconUpdate<br>wx.startBeaconDiscovery<br>wx.stopBeaconDiscovery<br>IBeaconInfo</p>
<h3 id="7-9-设备方向"><a href="#7-9-设备方向" class="headerlink" title="7.9 设备方向"></a>7.9 设备方向</h3><p>wx.onDeviceMotionChange<br>wx.startDeviceMotionListening<br>wx.stopDeviceMotionListening</p>
<h3 id="7-10-网络"><a href="#7-10-网络" class="headerlink" title="7.10 网络"></a>7.10 网络</h3><p>wx.getNetworkType<br>wx.onNetworkStatusChange</p>
<h3 id="7-10-NFC"><a href="#7-10-NFC" class="headerlink" title="7.10 NFC"></a>7.10 NFC</h3><p>wx.getHCEState<br>wx.onHCEMessage<br>wx.sendHCEMessage<br>wx.startHCE<br>wx.stopHCE</p>
<h3 id="7-11-性能"><a href="#7-11-性能" class="headerlink" title="7.11 性能"></a>7.11 性能</h3><p>wx.onMemoryWarning</p>
<h3 id="7-12-电话"><a href="#7-12-电话" class="headerlink" title="7.12 电话"></a>7.12 电话</h3><p>wx.makePhoneCall</p>
<h3 id="7-13-扫码"><a href="#7-13-扫码" class="headerlink" title="7.13 扫码"></a>7.13 扫码</h3><p>wx.scanCode</p>
<h3 id="7-14-屏幕"><a href="#7-14-屏幕" class="headerlink" title="7.14 屏幕"></a>7.14 屏幕</h3><p>wx.getScreenBrightness<br>wx.onUserCaptureScreen<br>wx.setKeepScreenOn<br>wx.setScreenBrightness</p>
<h3 id="7-15-振动"><a href="#7-15-振动" class="headerlink" title="7.15 振动"></a>7.15 振动</h3><p>wx.vibrateLong<br>wx.vibrateShort</p>
<h3 id="7-16-Wi-Fi"><a href="#7-16-Wi-Fi" class="headerlink" title="7.16 Wi-Fi"></a>7.16 Wi-Fi</h3><ul>
<li>wx.startWifi     初始化 Wi-Fi 模块。</li>
<li>wx.getConnectedWifi</li>
<li>wx.getWifiList</li>
<li>wx.onGetWifiList</li>
<li>wx.onWifiConnected</li>
<li>wx.setWifiList</li>
<li>wx.stopWifi</li>
<li>WifiInfo</li>
<li>wx.connectWifi  连接 Wi-Fi。若已知 Wi-Fi 信息，可以直接利用该接口连接。仅 Android 与 iOS 11 以上版本支持。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">wx.startWifi(&#123;</span><br><span class="line">  success (res) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res.errMsg)</span><br><span class="line">  &#125;,</span><br><span class="line">  fail(res)&#123;&#125;,</span><br><span class="line">  complete(res)&#123;&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">wx.connectWifi(&#123;</span><br><span class="line">  SSID: <span class="string">''</span>,<span class="comment">//SSID   必填</span></span><br><span class="line">  BSSID: <span class="string">''</span>,<span class="comment">// Wi-Fi 设备 BSSID  必填</span></span><br><span class="line">  password:<span class="string">''</span>,<span class="comment">//Wi-Fi 设备密码   否</span></span><br><span class="line">  success (res) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res.errMsg)</span><br><span class="line">  &#125;,</span><br><span class="line">  fail(res)&#123;&#125;,</span><br><span class="line">  complete(res)&#123;&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//0     ok                    正常</span></span><br><span class="line"><span class="comment">//12000 not init              未先调用 startWifi 接口</span></span><br><span class="line"><span class="comment">//12001 system not support    当前系统不支持相关能力</span></span><br><span class="line"><span class="comment">//12002 password error Wi-Fi  密码错误</span></span><br><span class="line"><span class="comment">//12003 connection timeout    连接超时</span></span><br><span class="line"><span class="comment">//12004 duplicate request     重复连接 Wi-Fi</span></span><br><span class="line"><span class="comment">//12005 wifi not turned on    Android 特有，未打开 Wi-Fi 开关</span></span><br><span class="line"><span class="comment">//12006 gps not turned on     Android 特有，未打开 GPS 定位开关</span></span><br><span class="line"><span class="comment">//12007 user denied           用户拒绝授权链接 Wi-Fi</span></span><br><span class="line"><span class="comment">//12008 invalid SSID          无效 SSID</span></span><br><span class="line"><span class="comment">//12009 system config err     系统运营商配置拒绝连接 Wi-Fi</span></span><br><span class="line"><span class="comment">//12010 system internal error 系统其他错误，需要在 errmsg 打印具体的错误原因</span></span><br><span class="line"><span class="comment">//12011 weapp in background   应用在后台无法配置 Wi-Fi</span></span><br></pre></td></tr></table></figure>
<h4 id="7-16-2-实例"><a href="#7-16-2-实例" class="headerlink" title="7.16.2 实例"></a>7.16.2 实例</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"page-body"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"page-body-info"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scroll-view</span> <span class="attr">class</span>=<span class="string">"device-list"</span> <span class="attr">scroll-y</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"item"</span> <span class="attr">wx:for</span>=<span class="string">"&#123;&#123;wifiList&#125;&#125;"</span> <span class="attr">wx:key</span>=<span class="string">"&#123;&#123;index&#125;&#125;"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"list"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">text</span>&gt;</span>&#123;&#123; item.SSID &#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"wifi-icon"</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"wifi-1"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"wifi-2 &#123;&#123;item.strength &lt; 2 ? 'off' : ''&#125;&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"wifi-3 &#123;&#123;item.strength &lt; 3 ? 'off' : ''&#125;&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"wifi-4 &#123;&#123;item.strength &lt; 4 ? 'off' : ''&#125;&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"lock"</span> <span class="attr">wx:if</span>=<span class="string">"&#123;&#123;item.secure&#125;&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">scroll-view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"btn-area"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"primary"</span> <span class="attr">bindtap</span>=<span class="string">"startSearch"</span>&gt;</span>搜索Wi-Fi<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">bindtap</span>=<span class="string">"stopSearch"</span>&gt;</span>停止搜索<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">  data: &#123;</span><br><span class="line">    wifiList: []</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  onUnload() &#123;</span><br><span class="line">    <span class="keyword">this</span>.stopSearch();</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  startSearch() &#123;</span><br><span class="line">    <span class="keyword">const</span> getWifiList = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      wx.getWifiList(&#123;</span><br><span class="line">        success: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">          wx.onGetWifiList(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> wifiList = res.wifiList</span><br><span class="line">              .sort(<span class="function">(<span class="params">a, b</span>) =&gt;</span> b.signalStrength - a.signalStrength)</span><br><span class="line">              .map(<span class="function"><span class="params">wifi</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">const</span> strength = <span class="built_in">Math</span>.ceil(wifi.signalStrength * <span class="number">4</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">Object</span>.assign(wifi, &#123; strength &#125;)</span><br><span class="line">              &#125;)</span><br><span class="line">            <span class="keyword">this</span>.setData(&#123;</span><br><span class="line">              wifiList</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;,</span><br><span class="line">        fail(err) &#123;</span><br><span class="line">          <span class="built_in">console</span>.error(err);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> startWifi = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      wx.startWifi(&#123;</span><br><span class="line">        success: getWifiList,</span><br><span class="line">        fail(err) &#123;</span><br><span class="line">          <span class="built_in">console</span>.error(err);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    wx.getSystemInfo(&#123;</span><br><span class="line">      success(res) &#123;</span><br><span class="line">        <span class="keyword">const</span> isIOS = res.platform === <span class="string">'ios'</span></span><br><span class="line">        <span class="keyword">if</span> (isIOS) &#123;</span><br><span class="line">          wx.showModal(&#123;</span><br><span class="line">            title: <span class="string">'提示'</span>,</span><br><span class="line">            content: <span class="string">'由于系统限制，iOS用户请手动进入系统WiFi页面，然后返回小程序。'</span>,</span><br><span class="line">            showCancel: <span class="literal">false</span>,</span><br><span class="line">            success() &#123;</span><br><span class="line">              startWifi()</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">          <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        startWifi()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  stopSearch() &#123;</span><br><span class="line">    wx.stopWifi(&#123;</span><br><span class="line">      success(res) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(res);</span><br><span class="line">      &#125;,</span><br><span class="line">      fail(err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.error(err);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="八、界面"><a href="#八、界面" class="headerlink" title="八、界面"></a>八、界面</h2><h3 id="8-1-动画"><a href="#8-1-动画" class="headerlink" title="8.1 动画"></a>8.1 动画</h3><h4 id="8-1-1-wx-createAnimation-创建-动画对象"><a href="#8-1-1-wx-createAnimation-创建-动画对象" class="headerlink" title="8.1.1  wx.createAnimation 创建 动画对象"></a>8.1.1  wx.createAnimation 创建 动画对象</h4><p>创建一个动画实例 animation。调用实例的方法来描述动画。最后通过动画实例的 export 方法导出动画数据传递给组件的 animation 属性。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">animation</span>=<span class="string">"&#123;&#123;animationData&#125;&#125;"</span> <span class="attr">style</span>=<span class="string">"background:red;height:100rpx;width:100rpx"</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> animation = wx.createAnimation(&#123;</span><br><span class="line">  duration:<span class="number">400</span>,<span class="comment">//动画持续时间，单位 ms   否，默认值 400</span></span><br><span class="line">  timingFunction:<span class="string">'linear'</span>,<span class="comment">// 动画的效果 否，默认值 'linear'</span></span><br><span class="line">  delay:<span class="number">0</span>,<span class="comment">//动画延迟时间，单位 ms       否，默认值 0</span></span><br><span class="line">  transformOrigin:<span class="string">'50% 50% 0'</span>          <span class="comment">//否默认值 '50% 50% 0'</span></span><br><span class="line">    <span class="comment">/*  'linear'      动画从头到尾的速度是相同的</span></span><br><span class="line"><span class="comment">        'ease'        动画以低速开始，然后加快，在结束前变慢</span></span><br><span class="line"><span class="comment">        'ease-in'     动画以低速开始</span></span><br><span class="line"><span class="comment">        'ease-in-out' 动画以低速开始和结束</span></span><br><span class="line"><span class="comment">        'ease-out'    动画以低速结束</span></span><br><span class="line"><span class="comment">        'step-start'  动画第一帧就跳至结束状态直到结束</span></span><br><span class="line"><span class="comment">        'step-end'    动画一直保持开始状态，最后一帧跳到结束状态 */</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="8-1-2-Animation-动画对象的方法"><a href="#8-1-2-Animation-动画对象的方法" class="headerlink" title="8.1.2  Animation 动画对象的方法"></a>8.1.2  Animation 动画对象的方法</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 6 个长度单位制，可以是 number 类型，可以是 字符串 '' 类型，</span></span><br><span class="line"><span class="comment"># ① 如果传入 number 则默认使用 px，</span></span><br><span class="line"><span class="comment"># ② 希望可传入其他自定义单位的长度值，就用字符串的形式</span></span><br><span class="line">.width    设置宽度       返回新的 Animation对象</span><br><span class="line">.height   设置高度       返回新的 Animation对象</span><br><span class="line">.left     设置 left，    返回新的 Animation对象</span><br><span class="line">.right    设置 right     返回新的 Animation对象</span><br><span class="line">.bottom   设置 bottom    返回新的 Animation对象</span><br><span class="line">.top      设置 top，     返回新的 Animation对象</span><br><span class="line"></span><br><span class="line">.backgroundColor  设置背景色         参数 <span class="string">''</span> 颜色值     返回新的 Animation对象</span><br><span class="line"></span><br><span class="line">.opacity  设置透明度</span><br><span class="line">     参数 透明度，范围 0-1                     返回新的 Animation对象</span><br><span class="line">.rotate  从 【原点】顺时针旋转一个角度</span><br><span class="line">     参数：旋转的角度。范围 [-180, 180]          返回新的 Animation对象</span><br><span class="line">.rotate3d 从 【X】 轴顺时针旋转一个角度</span><br><span class="line">    animation.rotate3d(x,y,z,angle) 旋转轴 x，y，z 轴的坐标  旋转的角度：[-180, 180]   返回新的 Animation对象</span><br><span class="line">.rotateX 从 X 轴顺时针旋转一个角度 旋转的角度：[-180, 180]   返回新的 Animation对象</span><br><span class="line">.rotateY 从 Y 轴顺时针旋转一个角度 旋转的角度：[-180, 180]   返回新的 Animation对象</span><br><span class="line">.rotateZ 从 Z 轴顺时针旋转一个角度 旋转的角度：[-180, 180]   返回新的 Animation对象</span><br><span class="line"></span><br><span class="line">.scale  缩放</span><br><span class="line">    animation.scale(sx,sy)</span><br><span class="line">    sx:在 X 轴缩放 sx 倍数  当仅有 sx 参数时，表示在 X 轴、Y 轴同时缩放sx倍数</span><br><span class="line">    sy:在 Y 轴缩放 sy 倍数</span><br><span class="line">.scale3d 缩放</span><br><span class="line">    animation.scale3d(sx,sy,sz)</span><br><span class="line">    sx:在 X 轴缩放 sx 倍数</span><br><span class="line">    sy:在 Y 轴缩放 sy 倍数</span><br><span class="line">    sz:在 Z 轴缩放 sz 倍数</span><br><span class="line">.scaleX(sx)  缩放 X 轴</span><br><span class="line">.scaleY(sy)  缩放 Y 轴</span><br><span class="line">.scaleZ(sz)  缩放 Z 轴</span><br><span class="line"></span><br><span class="line">.skew   对 X、Y 轴坐标进行倾斜</span><br><span class="line">    animation.skew(number ax, number ay)</span><br><span class="line">    ax:对 X 轴坐标倾斜的角度，范围 [-180, 180]</span><br><span class="line">    ay:对 Y 轴坐标倾斜的角度，范围 [-180, 180]</span><br><span class="line">.skewX  对 X 轴坐标进行倾斜</span><br><span class="line">.skewY  对 Y 轴坐标进行倾斜</span><br><span class="line"></span><br><span class="line">.translate   平移变换</span><br><span class="line">    animation.translate(number tx, number ty)</span><br><span class="line">    tx:在 X 轴平移的距离，单位为 px，当仅有该参数时表示在 X 轴偏移 tx，单位 px</span><br><span class="line">    ty:在 X 轴平移的距离，单位为 px</span><br><span class="line">.translate3d 对 xyz 坐标进行平移变换</span><br><span class="line">    animation.translate3d(number tx, number ty, number tz)</span><br><span class="line">    tx:在 X 轴平移的距离，单位为 px</span><br><span class="line">    ty:在 X 轴平移的距离，单位为 px</span><br><span class="line">    tz:在 Z 轴平移的距离，单位为 px</span><br><span class="line">.translateX 对 X 轴平移</span><br><span class="line">.translateY 对 Y 轴平移</span><br><span class="line">.translateZ 对 Z 轴平移</span><br><span class="line"></span><br><span class="line">.matrix</span><br><span class="line">    matrix(a, b, c, d, tx, ty) 是 matrix3d(a, b, 0, 0, c, d, 0, 0, 0, 0, 1, 0, tx, ty, 0, 1) 的简写</span><br><span class="line">.matrix3d</span><br><span class="line">    matrix3d（a1，b1，c1，d1，a2，b2，c2，d2，a3，b3，c3，d3，a4，b4，c4，d4）</span><br><span class="line"><span class="comment">#  .step 表示一组动画完成。可以在一组动画中调用任意多个动画方法，一组动画中的所有动画会同时开始，一组动画完成后才会进行下一组动画。</span></span><br><span class="line">    animation.step(&#123;</span><br><span class="line">      duration:400, <span class="comment"># 动画持续时间，单位 ms  否  默认值 400</span></span><br><span class="line">      timingFunction:<span class="string">'linear'</span>, <span class="comment"># 动画的效果 否  默认值 'linear'</span></span><br><span class="line">      delay:0,    <span class="comment">#动画延迟时间，单位 ms        否  默认值 0</span></span><br><span class="line">      transformOrigin:<span class="string">'50% 50% 0'</span> <span class="comment">#       否  默认值 '50% 50% 0'</span></span><br><span class="line">    &#125;)</span><br><span class="line"><span class="comment"># timingFunction 的合法值</span></span><br><span class="line"><span class="string">'linear'</span>      动画从头到尾的速度是相同的</span><br><span class="line"><span class="string">'ease'</span>        动画以低速开始，然后加快，在结束前变慢</span><br><span class="line"><span class="string">'ease-in'</span>     动画以低速开始</span><br><span class="line"><span class="string">'ease-in-out'</span> 动画以低速开始和结束</span><br><span class="line"><span class="string">'ease-out'</span>    动画以低速结束</span><br><span class="line"><span class="string">'step-start'</span>  动画第一帧就跳至结束状态直到结束</span><br><span class="line"><span class="string">'step-end'</span>    动画一直保持开始状态，最后一帧跳到结束状态 */</span><br><span class="line"></span><br><span class="line">.<span class="built_in">export</span>           导出动画队列。      无参数            返回 animationData  [&#123;&#125;]</span><br><span class="line">      <span class="built_in">export</span> 方法每次调用后会清掉之前的动画操作</span><br></pre></td></tr></table></figure>
<p>总结一下：<br>就是 ① 创建 动画对象， ② 给对象添加各种动作。 ③ 使用 .step 结束本轮动作。 ④ 使用 .export 导出并且清除原来的动作。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"page-body"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"page-section"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"animation-element-wrapper"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"animation-element"</span> <span class="attr">animation</span>=<span class="string">"&#123;&#123;animation&#125;&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"animation-buttons"</span> <span class="attr">scroll-y</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"animation-button"</span> <span class="attr">bindtap</span>=<span class="string">"rotate"</span>&gt;</span>旋转<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"animation-button"</span> <span class="attr">bindtap</span>=<span class="string">"scale"</span>&gt;</span>缩放<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"animation-button"</span> <span class="attr">bindtap</span>=<span class="string">"translate"</span>&gt;</span>移动<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"animation-button"</span> <span class="attr">bindtap</span>=<span class="string">"skew"</span>&gt;</span>倾斜<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"animation-button"</span> <span class="attr">bindtap</span>=<span class="string">"rotateAndScale"</span>&gt;</span>旋转并缩放<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"animation-button"</span> <span class="attr">bindtap</span>=<span class="string">"rotateThenScale"</span>&gt;</span>旋转后缩放<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"animation-button"</span> <span class="attr">bindtap</span>=<span class="string">"all"</span>&gt;</span>同时展示全部<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"animation-button"</span> <span class="attr">bindtap</span>=<span class="string">"allInQueue"</span>&gt;</span>顺序展示全部<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"animation-button animation-button-reset"</span> <span class="attr">bindtap</span>=<span class="string">"reset"</span>&gt;</span>还原<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">  onReady: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.animation = wx.createAnimation()<span class="comment">//创建动画</span></span><br><span class="line">  &#125;,</span><br><span class="line">  rotate: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.animation.rotate(<span class="built_in">Math</span>.random() * <span class="number">720</span> - <span class="number">360</span>).step()<span class="comment">// 围绕圆点旋转，然后停止 本轮动画</span></span><br><span class="line">    <span class="keyword">this</span>.setData(&#123;<span class="attr">animation</span>: <span class="keyword">this</span>.animation.export()&#125;)<span class="comment">//导出动画（给到页面展现），并且清除原来的动画</span></span><br><span class="line">  &#125;,</span><br><span class="line">  scale: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.animation.scale(<span class="built_in">Math</span>.random() * <span class="number">2</span>).step()<span class="comment">//缩放</span></span><br><span class="line">    <span class="keyword">this</span>.setData(&#123;<span class="attr">animation</span>: <span class="keyword">this</span>.animation.export()&#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  translate: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.animation.translate(<span class="built_in">Math</span>.random() * <span class="number">100</span> - <span class="number">50</span>, <span class="built_in">Math</span>.random() * <span class="number">100</span> - <span class="number">50</span>).step()<span class="comment">//平移</span></span><br><span class="line">    <span class="keyword">this</span>.setData(&#123;<span class="attr">animation</span>: <span class="keyword">this</span>.animation.export()&#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  skew: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.animation.skew(<span class="built_in">Math</span>.random() * <span class="number">90</span>, <span class="built_in">Math</span>.random() * <span class="number">90</span>).step()<span class="comment">//倾斜</span></span><br><span class="line">    <span class="keyword">this</span>.setData(&#123;<span class="attr">animation</span>: <span class="keyword">this</span>.animation.export()&#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  rotateAndScale: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.animation.rotate(<span class="built_in">Math</span>.random() * <span class="number">720</span> - <span class="number">360</span>)<span class="comment">//旋转 然后 缩放</span></span><br><span class="line">        .scale(<span class="built_in">Math</span>.random() * <span class="number">2</span>)</span><br><span class="line">        .step()</span><br><span class="line">    <span class="keyword">this</span>.setData(&#123;<span class="attr">animation</span>: <span class="keyword">this</span>.animation.export()&#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  rotateThenScale: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.animation.rotate(<span class="built_in">Math</span>.random() * <span class="number">720</span> - <span class="number">360</span>).step()</span><br><span class="line">        .scale(<span class="built_in">Math</span>.random() * <span class="number">2</span>).step()</span><br><span class="line">    <span class="keyword">this</span>.setData(&#123;<span class="attr">animation</span>: <span class="keyword">this</span>.animation.export()&#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  all: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.animation.rotate(<span class="built_in">Math</span>.random() * <span class="number">720</span> - <span class="number">360</span>)</span><br><span class="line">        .scale(<span class="built_in">Math</span>.random() * <span class="number">2</span>)</span><br><span class="line">        .translate(<span class="built_in">Math</span>.random() * <span class="number">100</span> - <span class="number">50</span>, <span class="built_in">Math</span>.random() * <span class="number">100</span> - <span class="number">50</span>)</span><br><span class="line">        .skew(<span class="built_in">Math</span>.random() * <span class="number">90</span>, <span class="built_in">Math</span>.random() * <span class="number">90</span>)</span><br><span class="line">        .step()</span><br><span class="line">    <span class="keyword">this</span>.setData(&#123;<span class="attr">animation</span>: <span class="keyword">this</span>.animation.export()&#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  allInQueue: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.animation.rotate(<span class="built_in">Math</span>.random() * <span class="number">720</span> - <span class="number">360</span>).step()</span><br><span class="line">        .scale(<span class="built_in">Math</span>.random() * <span class="number">2</span>).step()</span><br><span class="line">        .translate(<span class="built_in">Math</span>.random() * <span class="number">100</span> - <span class="number">50</span>, <span class="built_in">Math</span>.random() * <span class="number">100</span> - <span class="number">50</span>).step()</span><br><span class="line">        .skew(<span class="built_in">Math</span>.random() * <span class="number">90</span>, <span class="built_in">Math</span>.random() * <span class="number">90</span>).step()</span><br><span class="line">    <span class="keyword">this</span>.setData(&#123;<span class="attr">animation</span>: <span class="keyword">this</span>.animation.export()&#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  reset: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.animation.rotate(<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">                  .scale(<span class="number">1</span>)</span><br><span class="line">                  .translate(<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">                  .skew(<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">                  .step(&#123;<span class="attr">duration</span>: <span class="number">0</span>&#125;)</span><br><span class="line">    <span class="keyword">this</span>.setData(&#123;<span class="attr">animation</span>: <span class="keyword">this</span>.animation.export()&#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.animation-element-wrapper</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">padding-top</span>: <span class="number">150</span>rpx;</span><br><span class="line">  <span class="attribute">padding-bottom</span>: <span class="number">150</span>rpx;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#ffffff</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.animation-element</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">200</span>rpx;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">200</span>rpx;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#1AAD19</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.animation-buttons</span> &#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">30</span>rpx <span class="number">50</span>rpx <span class="number">10</span>rpx;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">700</span>rpx;</span><br><span class="line">  <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.animation-button</span> &#123;</span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">2</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">300</span>rpx;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">15</span>rpx <span class="number">12</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.animation-button-reset</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">620</span>rpx;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="8-2-背景"><a href="#8-2-背景" class="headerlink" title="8.2 背景"></a>8.2 背景</h3><p>wx.setBackgroundColor      动态设置窗口的背景色<br>wx.setBackgroundTextStyle  动态设置下拉背景字体、loading 图的样式</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">wx.setBackgroundColor(&#123;</span><br><span class="line">  backgroundColor: <span class="string">'#ffffff'</span>, <span class="comment">// 窗口的背景色，必须为十六进制颜色值   否</span></span><br><span class="line">  backgroundColorTop: <span class="string">'#ffffff'</span>, <span class="comment">// 顶部窗口的背景色，必须为十六进制颜色值，仅 iOS 支持  否</span></span><br><span class="line">  backgroundColorBottom: <span class="string">'#ffffff'</span>, <span class="comment">// 底部窗口的背景色，必须为十六进制颜色值，仅 iOS 支持 否</span></span><br><span class="line">  success(res)&#123;&#125;,</span><br><span class="line">  fail(res)&#123;&#125;,</span><br><span class="line">  complete(res)&#123;&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">wx.setBackgroundTextStyle(&#123;</span><br><span class="line">  textStyle: <span class="string">'dark'</span>, <span class="comment">// 下拉背景字体、loading 图的样式。  必填   'light'，'dark'</span></span><br><span class="line">  success(res)&#123;&#125;,</span><br><span class="line">  fail(res)&#123;&#125;,</span><br><span class="line">  complete(res)&#123;&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="8-3-自定义组件-wx-nextTick-延迟一部分操作到下一个时间片再执行。（类似于-setTimeout）？？？？？？？？"><a href="#8-3-自定义组件-wx-nextTick-延迟一部分操作到下一个时间片再执行。（类似于-setTimeout）？？？？？？？？" class="headerlink" title="8.3 自定义组件 wx.nextTick  延迟一部分操作到下一个时间片再执行。（类似于 setTimeout）？？？？？？？？"></a>8.3 自定义组件 wx.nextTick  延迟一部分操作到下一个时间片再执行。（类似于 setTimeout）？？？？？？？？</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 以 wepy 框架的来编辑示例</span></span><br><span class="line">data = &#123;</span><br><span class="line">  isplay:<span class="literal">false</span>,</span><br><span class="line">  intervalId = <span class="literal">null</span>,</span><br><span class="line">  text:<span class="string">'等会看我变'</span></span><br><span class="line">&#125;</span><br><span class="line">methods =&#123;</span><br><span class="line">  pause() &#123;</span><br><span class="line">    <span class="keyword">this</span>.isplay = <span class="literal">false</span>;</span><br><span class="line">    clearTimeout(<span class="keyword">this</span>.intervalId);</span><br><span class="line">  &#125;,</span><br><span class="line">  play() &#123;</span><br><span class="line">    <span class="keyword">this</span>.isplay = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">this</span>.setTimeoutFunc();</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line">setTimeoutFunc() &#123;</span><br><span class="line">    <span class="keyword">this</span>.intervalId = clearTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.text=<span class="string">'3 秒过了，我变啦'</span></span><br><span class="line">      <span class="keyword">this</span>.$apply();<span class="comment">// wepy 框架如是编辑</span></span><br><span class="line">    &#125;, <span class="number">3000</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Component(&#123;</span><br><span class="line">    doSth() &#123;</span><br><span class="line">        <span class="keyword">this</span>.setData(&#123;</span><br><span class="line">            number: <span class="number">1</span></span><br><span class="line">        &#125;) <span class="comment">// 直接在当前同步流程中执行</span></span><br><span class="line"></span><br><span class="line">        wx.nextTick(() = &gt; &#123;</span><br><span class="line">            <span class="keyword">this</span>.setData(&#123;</span><br><span class="line">                number: <span class="number">3</span></span><br><span class="line">            &#125;) <span class="comment">// 在当前同步流程结束后，下一个时间片执行</span></span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.setData(&#123;</span><br><span class="line">            number: <span class="number">2</span></span><br><span class="line">        &#125;) <span class="comment">// 直接在当前同步流程中执行</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>说明<br>因为自定义组件中的 setData 和 triggerEvent 等接口本身是同步的操作，当这几个接口被连续调用时，都是在一个同步流程中执行完的，因此若逻辑不当可能会导致出错。</p>
<p>一个极端的案例：当父组件的 setData 引发了子组件的 triggerEvent，进而使得父组件又进行了一次 setData，期间有通过 wx:if 语句对子组件进行卸载，就有可能引发奇怪的错误，所以对于不需要在一个同步流程内完成的逻辑，可以使用此接口延迟到下一个时间片再执行。</p>
<h3 id="8-4-交互（提示框，对话框）"><a href="#8-4-交互（提示框，对话框）" class="headerlink" title="8.4 交互（提示框，对话框）"></a>8.4 交互（提示框，对话框）</h3><p>wx.showActionSheet ​显示操作菜单<br>wx.showLoading  显示 loading 提示框。需主动调用 wx.hideLoading 才能关闭提示框<br>wx.hideLoading  隐藏 loading 提示框   三个回调函数<br>wx.showModal    显示模态对话框<br>wx.showToast    显示消息提示框<br>wx.hideToast    隐藏消息提示框        三个回调函数</p>
<p>loading 提示框<br><img src="https://upload-images.jianshu.io/upload_images/5616361-46ebe31f2d24e9f8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/163/format/webp" alt="loading 提示框"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">wx.showActionSheet(&#123;</span><br><span class="line">  itemList: [<span class="string">'A'</span>, <span class="string">'B'</span>, <span class="string">'C'</span>],<span class="comment">//按钮的文字数组，数组长度最大为 6  必填</span></span><br><span class="line">  itemColor:<span class="string">'#000000'</span>,<span class="comment">//按钮的文字颜色   否</span></span><br><span class="line">  success (res) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res.tapIndex)<span class="comment">//9     用户点击的按钮序号，从上到下的顺序，从0开始</span></span><br><span class="line">  &#125;,</span><br><span class="line">  fail (res) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res.errMsg)</span><br><span class="line">  &#125;,</span><br><span class="line">  complete(res)&#123;&#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//注意</span></span><br><span class="line"><span class="comment">//Android 6.7.2 以下版本，点击取消或蒙层时，回调 fail, errMsg 为 "fail cancel"；</span></span><br><span class="line"><span class="comment">//Android 6.7.2 及以上版本 和 iOS 点击蒙层不会关闭模态弹窗，所以尽量避免使用「取消」分支中实现业务逻辑</span></span><br><span class="line"></span><br><span class="line">wx.showLoading(&#123;</span><br><span class="line">  title: <span class="string">'加载中'</span>,  <span class="comment">//提示的内容             必填</span></span><br><span class="line">  mask:<span class="literal">false</span>,<span class="comment">//是否显示透明蒙层，防止触摸穿透  否 默认值 false</span></span><br><span class="line">  success(res)&#123;&#125;,</span><br><span class="line">  fail (res) &#123;&#125;,</span><br><span class="line">  complete(res)&#123;&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  wx.hideLoading(&#123;</span><br><span class="line">    success(res)&#123;&#125;,</span><br><span class="line">    fail (res) &#123;&#125;,</span><br><span class="line">    complete(res)&#123;&#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;, <span class="number">2000</span>)</span><br><span class="line"><span class="comment">//注意</span></span><br><span class="line"><span class="comment">//wx.showLoading 和 wx.showToast 同时只能显示一个</span></span><br><span class="line"><span class="comment">//wx.showLoading 应与 wx.hideLoading 配对使用</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">wx.showModal(&#123;</span><br><span class="line">  title: <span class="string">'提示'</span>,<span class="comment">// 提示的标题  必填</span></span><br><span class="line">  content: <span class="string">'这是一个模态弹窗'</span>,<span class="comment">//提示的内容  必填</span></span><br><span class="line">  showCancel:<span class="literal">true</span>,  <span class="comment">//是否显示取消按钮     否  默认值true</span></span><br><span class="line">  cancelText:<span class="string">'取消'</span>,<span class="comment">//取消按钮的文字，最多 4 个字符  否 默认值 '取消'</span></span><br><span class="line">  cancelColor:<span class="string">'#000000'</span>,<span class="comment">//取消按钮的文字颜色，必须是 16 进制格式的颜色字符串  否 默认值 '#000000'</span></span><br><span class="line">  confirmText:<span class="string">'确定'</span>,<span class="comment">//确认按钮的文字，最多 4 个字符  否 默认值 '确定'</span></span><br><span class="line">  confirmColor:<span class="string">'#3cc51f'</span>,<span class="comment">//确认按钮的文字颜色，必须是 16 进制格式的颜色字符串  否 默认值 #3cc51f</span></span><br><span class="line">  success (res) &#123;</span><br><span class="line">    res.confirm<span class="comment">//boolean  为 true 时，表示用户点击了确定按钮</span></span><br><span class="line">    res.cancel<span class="comment">//boolean   为 true 时，表示用户点击了取消（用于 Android 系统区分点击蒙层关闭还是点击取消按钮关闭）</span></span><br><span class="line">    <span class="keyword">if</span> (res.confirm) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'用户点击确定'</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (res.cancel) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'用户点击取消'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  fail (res) &#123;&#125;,</span><br><span class="line">  complete(res)&#123;&#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//注意</span></span><br><span class="line"><span class="comment">//Android 6.7.2 以下版本，点击取消或蒙层时，回调 fail, errMsg 为 "fail cancel"；</span></span><br><span class="line"><span class="comment">//Android 6.7.2 及以上版本 和 iOS 点击蒙层不会关闭模态弹窗，所以尽量避免使用「取消」分支中实现业务逻辑</span></span><br><span class="line"></span><br><span class="line">wx.showToast(&#123;</span><br><span class="line">  title: <span class="string">'成功'</span>,<span class="comment">//提示的内容  必填</span></span><br><span class="line">  icon: <span class="string">'success'</span>,<span class="comment">//图标      否  默认值 'success'</span></span><br><span class="line">        <span class="comment">//success 显示成功图标，此时 title 文本最多显示 7 个汉字长度</span></span><br><span class="line">        <span class="comment">//loading 显示加载图标，此时 title 文本最多显示 7 个汉字长度</span></span><br><span class="line">        <span class="comment">//none    不显示图标，此时 title 文本最多可显示两行，1.9.0及以上版本支持</span></span><br><span class="line">  image:<span class="string">''</span>,<span class="comment">//自定义图标的本地路径，image 的优先级高于 icon</span></span><br><span class="line">  duration: <span class="number">2000</span>,<span class="comment">// 提示的延迟时间  默认值 1500</span></span><br><span class="line">  mask:<span class="literal">false</span>,<span class="comment">//是否显示透明蒙层，防止触摸穿透  否 默认值 false</span></span><br><span class="line">  success(res)&#123;&#125;,</span><br><span class="line">  fail (res) &#123;&#125;,</span><br><span class="line">  complete(res)&#123;&#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//注意</span></span><br><span class="line"><span class="comment">//wx.showLoading 和 wx.showToast 同时只能显示一个</span></span><br><span class="line"><span class="comment">//wx.showToast 应与 wx.hideToast 配对使用</span></span><br></pre></td></tr></table></figure>
<h3 id="8-5-菜单（导航栏）-wx-getMenuButtonBoundingClientRect-获取菜单按钮（右上角胶囊按钮）的布局位置信息。"><a href="#8-5-菜单（导航栏）-wx-getMenuButtonBoundingClientRect-获取菜单按钮（右上角胶囊按钮）的布局位置信息。" class="headerlink" title="8.5 菜单（导航栏） wx.getMenuButtonBoundingClientRect 获取菜单按钮（右上角胶囊按钮）的布局位置信息。"></a>8.5 菜单（导航栏） wx.getMenuButtonBoundingClientRect 获取菜单按钮（右上角胶囊按钮）的布局位置信息。</h3><p>坐标信息以屏幕左上角为原点。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> menuButtonBoundingClientRect = wx.getMenuButtonBoundingClientRect()</span><br><span class="line">menuButtonBoundingClientRect.width<span class="comment">//number  宽度，单位：px</span></span><br><span class="line">menuButtonBoundingClientRect.height<span class="comment">//number 高度，单位：px</span></span><br><span class="line">menuButtonBoundingClientRect.top<span class="comment">//number    上边界坐标，单位：px</span></span><br><span class="line">menuButtonBoundingClientRect.right<span class="comment">//number  右边界坐标，单位：px</span></span><br><span class="line">menuButtonBoundingClientRect.bottom<span class="comment">//number 下边界坐标，单位：px</span></span><br><span class="line">menuButtonBoundingClientRect.left<span class="comment">//number   左边界坐标，单位：px</span></span><br></pre></td></tr></table></figure>
<h4 id="8-5-1-自定义导航栏-顶部导航条"><a href="#8-5-1-自定义导航栏-顶部导航条" class="headerlink" title="8.5.1 自定义导航栏(顶部导航条)"></a>8.5.1 自定义导航栏(顶部导航条)</h4><p><a href="https://juejin.im/post/5c0dc99c5188257d5e39657c" target="_blank" rel="noopener">自定义导航栏</a></p>
<h3 id="8-6-导航栏"><a href="#8-6-导航栏" class="headerlink" title="8.6 导航栏"></a>8.6 导航栏</h3><p>wx.hideNavigationBarLoading 在当前页面隐藏导航条加载动画（就是一个加载转动圆圈）  三个回调函数<br>wx.setNavigationBarColor    设置页面导航条颜色<br>wx.setNavigationBarTitle    动态设置当前页面的标题(顶部导航条)<br>wx.showNavigationBarLoading 在当前页面显示导航条加载动画（就是一个加载转动圆圈）  三个回调函数</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5616361-bc8fb4a9c86743ca.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/320/format/webp" alt="加载动画"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">wx.setNavigationBarColor(&#123;</span><br><span class="line">    frontColor: <span class="string">'#ffffff'</span>,<span class="comment">//前景颜色值，包括按钮、标题、状态栏的颜色，仅支持 #ffffff 和 #000000  必填</span></span><br><span class="line">    backgroundColor: <span class="string">'#ff0000'</span>,<span class="comment">//背景颜色值，有效值为十六进制颜色  必填</span></span><br><span class="line">    animation: &#123;<span class="comment">//动画效果 必填</span></span><br><span class="line">        duration: <span class="number">400</span>,<span class="comment">//动画变化时间，单位 ms   否，默认值 0</span></span><br><span class="line">        timingFunc: <span class="string">'easeIn'</span><span class="comment">//动画变化方式     否，默认值 'linear'</span></span><br><span class="line">                    <span class="comment">//'linear'  动画从头到尾的速度是相同的</span></span><br><span class="line">                    <span class="comment">//'easeIn'  动画以低速开始</span></span><br><span class="line">                    <span class="comment">//'easeOut' 动画以低速结束</span></span><br><span class="line">                    <span class="comment">//'easeInOut' 动画以低速开始和结束</span></span><br><span class="line">    &#125;,</span><br><span class="line">    success(res)&#123;&#125;,</span><br><span class="line">    fail(res)&#123;&#125;,</span><br><span class="line">    complete(res)&#123;&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">onready()&#123;</span><br><span class="line">  <span class="comment">// wx.setNavigationBarTitle 一定要写在 onReady 方法中，因为这是页面才完全渲染完成。</span></span><br><span class="line">  <span class="comment">// 通常在 onLoad 中我们是不能对 UI 进行操作的。</span></span><br><span class="line">  <span class="comment">// 我们可以从 onLoad 中获取到一个动态变量，那如何将这个变量从 onLoad 中传递给 onReady 方法呢？</span></span><br><span class="line">  <span class="comment">// 我们可以在 onLoad 中通过 this.setData(&#123;key: value&#125;) 将这个变量传递给 data，在 onReady 中再通过 this.data.key 获得这个变量。</span></span><br><span class="line">  <span class="comment">// 确定是写在 onready ？？  https://blog.csdn.net/m0_37893932/article/details/70155310 这个是写在 onload 有问题？？</span></span><br><span class="line">  wx.setNavigationBarTitle(&#123;</span><br><span class="line">    title: <span class="string">'当前页面'</span>,<span class="comment">//页面标题  必填</span></span><br><span class="line">    success(res)&#123;&#125;,</span><br><span class="line">    fail(res)&#123;&#125;,</span><br><span class="line">    complete(res)&#123;&#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="8-7-下拉刷新"><a href="#8-7-下拉刷新" class="headerlink" title="8.7 下拉刷新"></a>8.7 下拉刷新</h3><p>wx.startPullDownRefresh 开始下拉刷新。调用后触发下拉刷新动画，效果与用户手动下拉刷新一致。  三个回调函数<br>wx.stopPullDownRefresh  停止当前页面下拉刷新。                                          三个回调函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">  onPullDownRefresh () &#123;</span><br><span class="line">    wx.stopPullDownRefresh()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="8-8-滚动-wx-pageScrollTo-将页面滚动到目标位置"><a href="#8-8-滚动-wx-pageScrollTo-将页面滚动到目标位置" class="headerlink" title="8.8 滚动 wx.pageScrollTo 将页面滚动到目标位置"></a>8.8 滚动 wx.pageScrollTo 将页面滚动到目标位置</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">wx.pageScrollTo(&#123;</span><br><span class="line">  scrollTop: <span class="number">0</span>,<span class="comment">//滚动到页面的目标位置，单位 px  必填</span></span><br><span class="line">  duration: <span class="number">300</span>,<span class="comment">//滚动动画的时长，单位 ms  否， 默认 300</span></span><br><span class="line">  success(res)&#123;&#125;,</span><br><span class="line">  fail(res)&#123;&#125;,</span><br><span class="line">  complete(res)&#123;&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="8-9-置顶-（动态设置导航栏-与-tabbar-栏）"><a href="#8-9-置顶-（动态设置导航栏-与-tabbar-栏）" class="headerlink" title="8.9 置顶 （动态设置导航栏 与 tabbar 栏）"></a>8.9 置顶 （动态设置导航栏 与 tabbar 栏）</h3><h4 id="8-9-1-wx-setTopBarText-动态设置置顶栏文字内容。"><a href="#8-9-1-wx-setTopBarText-动态设置置顶栏文字内容。" class="headerlink" title="8.9.1 wx.setTopBarText 动态设置置顶栏文字内容。"></a>8.9.1 wx.setTopBarText 动态设置置顶栏文字内容。</h4><p>基础库 1.4.3 开始支持，低版本需做兼容处理。<strong>从基础库 1.9.9 开始，本接口停止维护</strong>?????几个意思</p>
<p>只有当前小程序被置顶时能生效，如果当前小程序没有被置顶，也能调用成功，但是不会立即生效，只有在用户将这个小程序置顶后才换上设置的文字内容.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wx.setTopBarText(&#123;</span><br><span class="line">  text: <span class="string">'hello, world!'</span>,<span class="comment">//置顶栏文字 必填</span></span><br><span class="line">  success(res)&#123;&#125;,</span><br><span class="line">  fail(res)&#123;&#125;,</span><br><span class="line">  complete(res)&#123;&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>注意<br>调用成功后，需间隔 5s 才能再次调用此接口，如果在 5s 内再次调用此接口，会回调<br><code>fail，errMsg：&quot;setTopBarText: fail invoke too frequently&quot;</code></p>
<h4 id="8-9-2-Tab-Bar-动态设置-tabbar-栏"><a href="#8-9-2-Tab-Bar-动态设置-tabbar-栏" class="headerlink" title="8.9.2 Tab Bar 动态设置 tabbar 栏"></a>8.9.2 Tab Bar 动态设置 tabbar 栏</h4><p>官方文档：<a href="https://developers.weixin.qq.com/miniprogram/dev/api/wx.hideTabBar.html" target="_blank" rel="noopener">网址</a></p>
<p>wx.hideTabBar        隐藏 tabBar<br>wx.hideTabBarRedDot  隐藏 tabBar 某一项的右上角的红点<br>wx.removeTabBarBadge 移除 tabBar 某一项右上角的文本<br>wx.setTabBarBadge    为 tabBar 某一项的右上角添加文本<br>wx.setTabBarItem     动态设置 tabBar 某一项的内容<br>wx.setTabBarStyle    动态设置 tabBar 的整体样式<br>wx.showTabBar        显示 tabBar<br>wx.showTabBarRedDot  显示 tabBar 某一项的右上角的红点</p>
<h3 id="8-10-窗口（窗口尺寸变化处理）"><a href="#8-10-窗口（窗口尺寸变化处理）" class="headerlink" title="8.10 窗口（窗口尺寸变化处理）"></a>8.10 窗口（窗口尺寸变化处理）</h3><p>wx.onWindowResize 监听窗口尺寸变化事件<br>wx.offWindowResize 取消监听窗口尺寸变化事件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">wx.onWindowResize(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">  res.size</span><br><span class="line">  <span class="comment">/* &#123;</span></span><br><span class="line"><span class="comment">      windowWidth//   number  变化后的窗口宽度，单位 px</span></span><br><span class="line"><span class="comment">      windowHeight//  number  变化后的窗口高度，单位 px</span></span><br><span class="line"><span class="comment">    &#125; */</span></span><br><span class="line">&#125;)</span><br><span class="line">wx.offWindowResize(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="九、开放接口-就是获取到用户的各种数据-的接口，开方消息的意思么"><a href="#九、开放接口-就是获取到用户的各种数据-的接口，开方消息的意思么" class="headerlink" title="九、开放接口 (就是获取到用户的各种数据 的接口，开方消息的意思么)"></a>九、开放接口 (就是获取到用户的各种数据 的接口，开方消息的意思么)</h2><p><a href="https://blog.csdn.net/weixin_39735923/article/details/79202563" target="_blank" rel="noopener">https://blog.csdn.net/weixin_39735923/article/details/79202563</a>  后面看下这个文章是什么意思。</p>
<h3 id="9-1-接口调用凭证"><a href="#9-1-接口调用凭证" class="headerlink" title="9.1 接口调用凭证"></a>9.1 接口调用凭证</h3><h4 id="9-1-1-什么是调用凭证，就是凭什么给你资料咯，就是给微信要的-token"><a href="#9-1-1-什么是调用凭证，就是凭什么给你资料咯，就是给微信要的-token" class="headerlink" title="9.1.1 什么是调用凭证，就是凭什么给你资料咯，就是给微信要的 token"></a>9.1.1 什么是调用凭证，就是凭什么给你资料咯，就是给微信要的 token</h4><p>access_token 是公众号的全局唯一票据，公众号调用各接口时都需使用 access_token。开发者需要进行妥善保存。access_token 的存储至少要保留512 个字符空间。access_token 的有效期目前为 2 个小时，需定时刷新，重复获取将导致上次获取的 access_token 失效。</p>
<p>公众平台的 API 调用所需的 access_token 的使用及生成方式说明：</p>
<ul>
<li>为了保密 appsecrect，第三方需要一个 access_token 获取和刷新的中控服务器。而其他业务逻辑服务器所使用的 access_token 均来自于该中控服务器，不应该各自去刷新，否则会造成 access_token 覆盖而影响业务；</li>
<li>目前 access_token 的有效期通过返回的 expire_in 来传达，目前是 7200 秒之内的值。中控服务器需要根据这个有效时间提前去刷新新access_token。在刷新过程中，中控服务器对外输出的依然是老 access_token，此时公众平台后台会保证在刷新短时间内，新老 access_token 都可用，这保证了第三方业务的平滑过渡；</li>
<li>access_token 的有效时间可能会在未来有调整，所以中控服务器不仅需要内部定时主动刷新，还需要提供被动刷新 access_token 的接口，这样便于业务服务器在 API 调用获知 access_token 已超时的情况下，可以触发 access_token 的刷新流程。</li>
</ul>
<h4 id="9-1-2-getAccessToken-获取小程序全局唯一后台接口调用凭据（access-token）。"><a href="#9-1-2-getAccessToken-获取小程序全局唯一后台接口调用凭据（access-token）。" class="headerlink" title="9.1.2 getAccessToken 获取小程序全局唯一后台接口调用凭据（access_token）。"></a>9.1.2 getAccessToken 获取小程序全局唯一后台接口调用凭据（access_token）。</h4><h5 id="9-1-2-1-获取Access-Token的3种方式："><a href="#9-1-2-1-获取Access-Token的3种方式：" class="headerlink" title="9.1.2.1 获取Access Token的3种方式："></a>9.1.2.1 获取Access Token的3种方式：</h5><p>【微信公众平台】<a href="https://blog.csdn.net/qq_32616843/article/details/78670303" target="_blank" rel="noopener">网址</a><br>当然 获取 token 是后端的工作。前端只要使用就好了。并且不要把 token 写在自己的前端代码中，这样做看到代码不就入侵了。总之就是后端写这个获取接口就对了。<a href="https://developers.weixin.qq.com/miniprogram/dev/api/open-api/access-token/getAccessToken.html" target="_blank" rel="noopener">官方获取接口方法/参数要求</a></p>
<p><strong>官方的接口调试工具。调试 token</strong></p>
<p><a href="https://mp.weixin.qq.com/debug/cgi-bin/apiinfo?t=index&amp;type=%E5%9F%BA%E7%A1%80%E6%94%AF%E6%8C%81&amp;form=%E8%8E%B7%E5%8F%96access_token%E6%8E%A5%E5%8F%A3%20/token" target="_blank" rel="noopener">官方网址</a></p>
<h5 id="9-1-2-2-调用各后台接口时都需使用-access-token，开发者需要进行妥善保存。"><a href="#9-1-2-2-调用各后台接口时都需使用-access-token，开发者需要进行妥善保存。" class="headerlink" title="9.1.2.2 **调用各后台接口时都需使用 access_token，开发者需要进行妥善保存。"></a>9.1.2.2 **调用各后台接口时都需使用 access_token，开发者需要进行妥善保存。</h5><p>本章下面所有的 API 接口都需要使用这个凭证才可以成功调用的。当然不能讲对应的值写在代码中，用变量保存就ok。<br>并且 token 是有时效的，2 小时。如果请求很多，还不保存，系统应付不来这么多请求，就会崩溃的。每天仅限2000次。<br>检查是否有效，重新请求也是后端的事情，不是前端干的事情。<a href="https://blog.csdn.net/vigliang/article/details/79998895" target="_blank" rel="noopener">后端 php 代码</a></p>
<h3 id="9-2-wx-getAccountInfoSync-获取当前帐号信息"><a href="#9-2-wx-getAccountInfoSync-获取当前帐号信息" class="headerlink" title="9.2 wx.getAccountInfoSync  获取当前帐号信息"></a>9.2 wx.getAccountInfoSync  获取当前帐号信息</h3><p>语法：Object wx.getAccountInfoSync()  无参数？？？ 不是说本章的 token 要带上的么？？</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> accountInfo = wx.getAccountInfoSync();</span><br><span class="line">accountInfo.miniProgram<span class="comment">//小程序帐号信息</span></span><br><span class="line"><span class="comment">/* &#123;</span></span><br><span class="line"><span class="comment">  appId:''//小程序 appId</span></span><br><span class="line"><span class="comment">&#125; */</span></span><br><span class="line"><span class="built_in">console</span>.log(accountInfo.miniProgram.appId) <span class="comment">// 小程序 appId</span></span><br><span class="line"></span><br><span class="line">accountInfo.plugin<span class="comment">//插件帐号信息（仅在插件中调用时包含这一项）</span></span><br><span class="line">&#123;</span><br><span class="line">  appId:<span class="string">''</span>,<span class="comment">//插件 appId</span></span><br><span class="line">  version:<span class="string">'1.0.0'</span><span class="comment">//插件版本号</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(accountInfo.plugin.appId) <span class="comment">// 插件 appId</span></span><br><span class="line"><span class="built_in">console</span>.log(accountInfo.plugin.version) <span class="comment">// 插件版本号， 'a.b.c' 这样的形式</span></span><br></pre></td></tr></table></figure>
<h3 id="9-3-wx-chooseAddress-获取用户收货地址。调起用户编辑收货地址原生界面，并在编辑完成后返回用户选择的地址。"><a href="#9-3-wx-chooseAddress-获取用户收货地址。调起用户编辑收货地址原生界面，并在编辑完成后返回用户选择的地址。" class="headerlink" title="9.3 wx.chooseAddress 获取用户收货地址。调起用户编辑收货地址原生界面，并在编辑完成后返回用户选择的地址。"></a>9.3 wx.chooseAddress 获取用户收货地址。调起用户编辑收货地址原生界面，并在编辑完成后返回用户选择的地址。</h3><h4 id="9-3-1-调用前需要-用户授权-scope-address，"><a href="#9-3-1-调用前需要-用户授权-scope-address，" class="headerlink" title="9.3.1  调用前需要 用户授权 scope.address，"></a>9.3.1  调用前需要 用户授权 scope.address，</h4><p><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/authorize.html" target="_blank" rel="noopener">用户授权</a>?????????</p>
<h4 id="9-3-2-语法：wx-chooseAddress-Object-object-获取用户收货地址-代码"><a href="#9-3-2-语法：wx-chooseAddress-Object-object-获取用户收货地址-代码" class="headerlink" title="9.3.2 语法：wx.chooseAddress(Object object) 获取用户收货地址 代码"></a>9.3.2 语法：wx.chooseAddress(Object object) 获取用户收货地址 代码</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"page-section"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"weui-cells weui-cells_after-title"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"weui-cell weui-cell_input"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"weui-cell__hd"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"weui-label"</span>&gt;</span>收货人姓名<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"weui-cell__bd"</span>&gt;</span></span><br><span class="line">            &#123;&#123; addressInfo.userName &#125;&#125;</span><br><span class="line">          <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"weui-cell weui-cell_input"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"weui-cell__hd"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"weui-label"</span>&gt;</span>邮编<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"weui-cell__bd"</span>&gt;</span></span><br><span class="line">            &#123;&#123; addressInfo.postalCode &#125;&#125;</span><br><span class="line">          <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"weui-cell weui-cell_input region"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"weui-cell__hd"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"weui-label"</span>&gt;</span>地区<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"weui-cell__bd"</span>&gt;</span></span><br><span class="line">            &#123;&#123; addressInfo.provinceName &#125;&#125;</span><br><span class="line">            &#123;&#123; addressInfo.cityName &#125;&#125;</span><br><span class="line">            &#123;&#123; addressInfo.countyName &#125;&#125;</span><br><span class="line">          <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"weui-cell weui-cell_input detail"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"weui-cell__hd"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"weui-label"</span>&gt;</span>收货地址<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"weui-cell__bd"</span>&gt;</span></span><br><span class="line">            &#123;&#123; addressInfo.detailInfo &#125;&#125;</span><br><span class="line">          <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">          <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"weui-cell weui-cell_input"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"weui-cell__hd"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"weui-label"</span>&gt;</span>国家码<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"weui-cell__bd"</span>&gt;</span></span><br><span class="line">            &#123;&#123; addressInfo.nationalCode &#125;&#125;</span><br><span class="line">          <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"weui-cell weui-cell_input"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"weui-cell__hd"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"weui-label"</span>&gt;</span>手机号码<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"weui-cell__bd"</span>&gt;</span></span><br><span class="line">            &#123;&#123; addressInfo.telNumber &#125;&#125;</span><br><span class="line">          <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"btn-area"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"primary"</span> <span class="attr">bindtap</span>=<span class="string">"chooseAddress"</span>&gt;</span>获取收货地址<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">  data: &#123;</span><br><span class="line">    addressInfo: <span class="literal">null</span></span><br><span class="line">  &#125;,</span><br><span class="line">  chooseAddress() &#123;</span><br><span class="line">    <span class="comment">//获取用户收货地址。调起用户编辑收货地址原生界面，并在编辑完成后返回用户选择的地址。</span></span><br><span class="line">    wx.chooseAddress(&#123;</span><br><span class="line">      success: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(res.userName)<span class="comment">//收货人姓名</span></span><br><span class="line">        <span class="built_in">console</span>.log(res.postalCode)<span class="comment">//邮编</span></span><br><span class="line">        <span class="built_in">console</span>.log(res.provinceName)<span class="comment">//国标收货地址第一级地址</span></span><br><span class="line">        <span class="built_in">console</span>.log(res.cityName)<span class="comment">//国标收货地址第一级地址</span></span><br><span class="line">        <span class="built_in">console</span>.log(res.countyName)<span class="comment">//国标收货地址第一级地址</span></span><br><span class="line">        <span class="built_in">console</span>.log(res.detailInfo)<span class="comment">//详细收货地址信息</span></span><br><span class="line">        <span class="built_in">console</span>.log(res.nationalCode)<span class="comment">//收货地址国家码</span></span><br><span class="line">        <span class="built_in">console</span>.log(res.telNumber)<span class="comment">//收货人手机号码</span></span><br><span class="line">        <span class="built_in">console</span>.log(res.errMsg)<span class="comment">//错误信息 String ????错误信息是在这里么？？？</span></span><br><span class="line">        <span class="keyword">this</span>.setData(&#123;</span><br><span class="line">          addressInfo: res</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      fail: <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err)</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">/* complete(res)&#123;</span></span><br><span class="line"><span class="comment">        //</span></span><br><span class="line"><span class="comment">      &#125; */</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">import</span> <span class="string">"../lib/weui.wxss"</span>;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">form</span> &#123;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">30</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.weui-cell__bd</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: flex-start;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">20</span>rpx <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">min-height</span>: <span class="number">60</span>rpx;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.btn-area</span> &#123;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">30</span>rpx;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*lib/weui.css*/</span></span><br></pre></td></tr></table></figure>
<h3 id="9-4-wx-authorize-授权-提前向用户发起授权请求。"><a href="#9-4-wx-authorize-授权-提前向用户发起授权请求。" class="headerlink" title="9.4 wx.authorize 授权: 提前向用户发起授权请求。"></a>9.4 wx.authorize 授权: 提前向用户发起授权请求。</h3><p>调用后会立刻弹窗询问用户是否同意授权小程序使用某项功能或获取用户的某些数据，但不会实际调用对应接口。如果用户之前已经同意授权，则不会出现弹窗，直接返回成功。更多用法详见 <a href="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/authorize.html" target="_blank" rel="noopener">用户授权</a>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 可以通过 wx.getSetting 先查询一下用户是否授权了 "scope.record" 这个 scope</span></span><br><span class="line">wx.getSetting(&#123;</span><br><span class="line">  success(res) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!res.authSetting[<span class="string">'scope.record'</span>]) &#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//提前向用户发起授权请求。</span></span><br><span class="line">      wx.authorize(&#123;</span><br><span class="line">        scope: <span class="string">'scope.record'</span>,<span class="comment">//需要获取权限的 scope，详见 scope 列表   必填</span></span><br><span class="line">        success () &#123;</span><br><span class="line">          wx.startRecord() <span class="comment">// 用户已经同意小程序使用录音功能，后续调用 wx.startRecord 接口不会弹窗询问</span></span><br><span class="line">        &#125;,</span><br><span class="line">        fail()&#123;</span><br><span class="line">          <span class="comment">//</span></span><br><span class="line">        &#125;,</span><br><span class="line">        complete()&#123;</span><br><span class="line">          <span class="comment">//</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="9-5-卡券"><a href="#9-5-卡券" class="headerlink" title="9.5 卡券"></a>9.5 卡券</h3><h4 id="9-5-1-小程序-认证"><a href="#9-5-1-小程序-认证" class="headerlink" title="9.5.1 小程序 认证"></a>9.5.1 小程序 认证</h4><p>只有 <strong>通过 认证 的小程序</strong> 才能使用卡券 功能。更多文档请参考 微信卡券接口文档。</p>
<p><a href="https://developers.weixin.qq.com/miniprogram/product/renzheng.html?t=18112821" target="_blank" rel="noopener">小程序认证</a><br><a href="https://mp.weixin.qq.com/cgi-bin/announce?action=getannouncement&amp;key=1490190158&amp;version=1&amp;lang=zh_CN&amp;platform=2" target="_blank" rel="noopener">微信卡券接口文档。</a></p>
<h4 id="9-5-2-wx-addCard-Object-object-批量添加卡券。小程序先要认证"><a href="#9-5-2-wx-addCard-Object-object-批量添加卡券。小程序先要认证" class="headerlink" title="9.5.2 wx.addCard(Object object) 批量添加卡券。小程序先要认证"></a>9.5.2 wx.addCard(Object object) 批量添加卡券。小程序先要认证</h4><p><a href="https://mp.weixin.qq.com/wiki?t=resource/res_main&amp;id=mp1499332673_Unm7V" target="_blank" rel="noopener">code 解码接口</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">wx.addCard(&#123;</span><br><span class="line">  cardList: [</span><br><span class="line">    <span class="comment">//参数：需要添加的卡券列表   必填</span></span><br><span class="line">    &#123;</span><br><span class="line">      cardId: <span class="string">''</span>,<span class="comment">//卡券 ID  必填</span></span><br><span class="line">      <span class="comment">// 卡券的扩展参数。需进行 JSON 序列化为字符串传入 必填</span></span><br><span class="line">      cardExt: <span class="string">'&#123;"code": "", "openid": "", "timestamp": "", "signature":""&#125;'</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">      cardId: <span class="string">''</span>,</span><br><span class="line">      cardExt: <span class="string">'&#123;"code": "", "openid": "", "timestamp": "", "signature":""&#125;'</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  success (res) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res.cardList) <span class="comment">// 卡券添加结果</span></span><br><span class="line">    &#123;</span><br><span class="line">      code:<span class="string">''</span>, <span class="comment">//加密 code，为用户领取到卡券的code加密后的字符串，解密请参照：code 解码接口</span></span><br><span class="line">      cardId: <span class="string">''</span>,<span class="comment">//用户领取到卡券的 ID</span></span><br><span class="line">      cardExt: <span class="string">''</span>,<span class="comment">//卡券的扩展参数，结构请参考前文</span></span><br><span class="line">      isSuccess:<span class="comment">//numean 是否成功</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><strong>cardExt 的结构</strong>:cardExt 是卡券的扩展参数，其值是一个 JSON 字符串。</p>
<ul>
<li>‘code’: ‘’,      //否<br>  用户领取的 code，仅自定义 code 模式的卡券须填写，非自定义 code 模式卡券不可填写，<a href="https://mp.weixin.qq.com/wiki?t=resource/res_main&amp;id=mp1451025056" target="_blank" rel="noopener">详情</a></li>
<li>‘openid’: ‘’,     // 否<br>  指定领取者的 openid，只有该用户能领取。 bind_openid 字段为 true 的卡券必须填写，bind_openid 字段为 false 不可填写。</li>
<li>‘timestamp’: 8,    必填<br>  时间戳，东八区时间,UTC+8，单位为秒  // number？？？？那上面的示例代码为什么是字符串？？？ </li>
<li>‘nonce_str’: ‘’,<br>  随机字符串，由开发者设置传入，加强安全性（若不填写可能被重放请求）。随机字符串，不长于 32 位。推荐使用大小写字母和数字，不同添加请求的 nonce_str 须动态生成，若重复将会导致领取失败。</li>
<li>‘fixed_begintimestamp’: 8,   // number  // number？？？？那上面的示例代码为什么是字符串？？？<br>  卡券在第三方系统的实际领取时间，为东八区时间戳（UTC+8,精确到秒）。当卡券的有效期类为 DATE_TYPE_FIX_TERM 时专用，标识卡券的实际生效时间，用于解决商户系统内起始时间和领取微信卡券时间不同步的问题。</li>
<li>‘outer_str’:’’,   // 否<br>  领取渠道参数，用于标识本次领取的渠道值。</li>
<li>‘signature’:’’,   // 必填<br>  签名，商户将接口列表中的参数按照指定方式进行签名,签名方式使用 SHA1，具体签名方案参见：卡券签名</li>
</ul>
<h4 id="9-5-3-wx-openCard-Object-object-查看微信卡包中的卡券。小程序先要认证"><a href="#9-5-3-wx-openCard-Object-object-查看微信卡包中的卡券。小程序先要认证" class="headerlink" title="9.5.3 wx.openCard(Object object) 查看微信卡包中的卡券。小程序先要认证"></a>9.5.3 wx.openCard(Object object) 查看微信卡包中的卡券。小程序先要认证</h4><p><a href="https://mp.weixin.qq.com/wiki?t=resource/res_main&amp;id=mp1499332673_Unm7V" target="_blank" rel="noopener">code 解码接口</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">wx.openCard(&#123;</span><br><span class="line">  cardList: [&#123;<span class="comment">//需要打开的卡券列表 必填</span></span><br><span class="line">    cardId: <span class="string">''</span>,<span class="comment">//卡券 ID  必填</span></span><br><span class="line">    code: <span class="string">''</span><span class="comment">//由 wx.addCard 的返回对象中的加密 code 通过解密后得到，解密请参照：code 解码接口   必填</span></span><br><span class="line">  &#125;, &#123;</span><br><span class="line">    cardId: <span class="string">''</span>,</span><br><span class="line">    code: <span class="string">''</span></span><br><span class="line">  &#125;],</span><br><span class="line">  success (res) &#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">  &#125;,</span><br><span class="line">  fail(res)&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">  &#125;,</span><br><span class="line">  complete(res)&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="9-6-客服消息？？？？？？？？？？？？？？？？？？？不知道具体是怎么做的"><a href="#9-6-客服消息？？？？？？？？？？？？？？？？？？？不知道具体是怎么做的" class="headerlink" title="9.6 客服消息？？？？？？？？？？？？？？？？？？？不知道具体是怎么做的"></a>9.6 客服消息？？？？？？？？？？？？？？？？？？？不知道具体是怎么做的</h3><h4 id="9-6-1-customerTyping-客服输入状态接口"><a href="#9-6-1-customerTyping-客服输入状态接口" class="headerlink" title="9.6.1 customerTyping 客服输入状态接口"></a>9.6.1 customerTyping 客服输入状态接口</h4><p>下发客服当前输入状态给用户。详见 <a href="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/customer-message/typing.html" target="_blank" rel="noopener">客服消息输入状态</a></p>
<p>客服输入状态:开发者可通过调用 [客服输入状态接口] customerTyping，返回客服当前输入状态给用户。</p>
<ul>
<li>此接口需要客服消息接口权限。</li>
<li>如果不满足发送客服消息的触发条件，则无法下发输入状态。</li>
<li>下发输入状态，需要客服之前 30 秒内跟用户有过消息交互。</li>
<li>在输入状态中（持续 15 秒），不可重复下发输入态。</li>
<li>在输入状态中，如果向用户下发消息，会同时取消输入状态。</li>
</ul>
<h4 id="9-6-1-getTempMedia-获取客服消息内的临时素材。即下载临时的多媒体文件。目前小程序仅支持下载图片文件。"><a href="#9-6-1-getTempMedia-获取客服消息内的临时素材。即下载临时的多媒体文件。目前小程序仅支持下载图片文件。" class="headerlink" title="9.6.1 getTempMedia  获取客服消息内的临时素材。即下载临时的多媒体文件。目前小程序仅支持下载图片文件。"></a>9.6.1 getTempMedia  获取客服消息内的临时素材。即下载临时的多媒体文件。目前小程序仅支持下载图片文件。</h4><h4 id="9-6-1-sendCustomerMessage-发送客服消息给用户。"><a href="#9-6-1-sendCustomerMessage-发送客服消息给用户。" class="headerlink" title="9.6.1 sendCustomerMessage 发送客服消息给用户。"></a>9.6.1 sendCustomerMessage 发送客服消息给用户。</h4><p>详细规则见 <a href="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/customer-message/send.html" target="_blank" rel="noopener">发送客服消息</a></p>
<p>发送客服消息<br>当用户和小程序客服产生特定动作的交互时（具体动作列表请见下方说明），微信将会把消息数据推送给开发者，开发者可以在一段时间内（目前为 48 小时）调用客服接口，通过调用 发送客服消息接口 来发送消息给普通用户。此接口主要用于客服等有人工消息处理环节的功能，方便开发者为用户提供更加优质的服务。</p>
<p>目前允许的动作列表如下，不同动作触发后，允许的客服接口下发消息条数和下发时限不同。</p>
<p>用户动作      允许下发条数限制    下发时限<br>用户发送消息         5 条        48 小时</p>
<h4 id="9-6-1-uploadTempMedia-把媒体文件上传到微信服务器。目前仅支持图片。用于发送客服消息或被动回复用户消息。"><a href="#9-6-1-uploadTempMedia-把媒体文件上传到微信服务器。目前仅支持图片。用于发送客服消息或被动回复用户消息。" class="headerlink" title="9.6.1 uploadTempMedia 把媒体文件上传到微信服务器。目前仅支持图片。用于发送客服消息或被动回复用户消息。"></a>9.6.1 uploadTempMedia 把媒体文件上传到微信服务器。目前仅支持图片。用于发送客服消息或被动回复用户消息。</h4><h3 id="9-7-数据分析"><a href="#9-7-数据分析" class="headerlink" title="9.7 数据分析"></a>9.7 数据分析</h3><h4 id="9-7-1-wx-reportAnalytics-自定义分析数据上报接口。"><a href="#9-7-1-wx-reportAnalytics-自定义分析数据上报接口。" class="headerlink" title="9.7.1 wx.reportAnalytics 自定义分析数据上报接口。"></a>9.7.1 wx.reportAnalytics 自定义分析数据上报接口。</h4><p>使用前，需要在小程序管理后台自定义分析中新建事件，配置好事件名与字段</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">wx.reportAnalytics(<span class="string">'purchase'</span>, &#123;</span><br><span class="line">  price: <span class="number">120</span>,</span><br><span class="line">  color: <span class="string">'red'</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//'purchase'  自动事件名  必填</span></span><br><span class="line"><span class="comment">/* &#123;</span></span><br><span class="line"><span class="comment">  price: 120,  配置中的字段名 price 上报的数据 120</span></span><br><span class="line"><span class="comment">  color: 'red' 配置中的字段名 color 上报的数据 'red'</span></span><br><span class="line"><span class="comment">&#125; */</span></span><br></pre></td></tr></table></figure>
<h4 id="9-7-1-getAnalysisDailyRetain-获取用户访问小程序日留存-本接口应在后端服务器调用-所以这个是后端的工作咯"><a href="#9-7-1-getAnalysisDailyRetain-获取用户访问小程序日留存-本接口应在后端服务器调用-所以这个是后端的工作咯" class="headerlink" title="9.7.1 getAnalysisDailyRetain 获取用户访问小程序日留存 (本接口应在后端服务器调用!!!!!所以这个是后端的工作咯)"></a>9.7.1 getAnalysisDailyRetain 获取用户访问小程序日留存 (本接口应在后端服务器调用!!!!!所以这个是后端的工作咯)</h4><p><a href="https://developers.weixin.qq.com/miniprogram/dev/api/open-api/data-analysis/getAnalysisDailyRetain.html" target="_blank" rel="noopener">官网地址</a></p>
<h4 id="9-7-1-getAnalysisDailySummary-获取用户访问小程序数据概况-本接口应在后端服务器调用"><a href="#9-7-1-getAnalysisDailySummary-获取用户访问小程序数据概况-本接口应在后端服务器调用" class="headerlink" title="9.7.1 getAnalysisDailySummary 获取用户访问小程序数据概况 本接口应在后端服务器调用"></a>9.7.1 getAnalysisDailySummary 获取用户访问小程序数据概况 本接口应在后端服务器调用</h4><p><a href="https://developers.weixin.qq.com/miniprogram/dev/api/open-api/data-analysis/getAnalysisDailySummary.html" target="_blank" rel="noopener">官网地址</a></p>
<h4 id="9-7-1-getAnalysisDailyVisitTrend-获取用户访问小程序数据日趋势-本接口应在后端服务器调用"><a href="#9-7-1-getAnalysisDailyVisitTrend-获取用户访问小程序数据日趋势-本接口应在后端服务器调用" class="headerlink" title="9.7.1 getAnalysisDailyVisitTrend 获取用户访问小程序数据日趋势 本接口应在后端服务器调用"></a>9.7.1 getAnalysisDailyVisitTrend 获取用户访问小程序数据日趋势 本接口应在后端服务器调用</h4><h4 id="9-7-1-getAnalysisMonthlyRetain-获取用户访问小程序周留存-本接口应在后端服务器调用"><a href="#9-7-1-getAnalysisMonthlyRetain-获取用户访问小程序周留存-本接口应在后端服务器调用" class="headerlink" title="9.7.1 getAnalysisMonthlyRetain  获取用户访问小程序周留存 本接口应在后端服务器调用"></a>9.7.1 getAnalysisMonthlyRetain  获取用户访问小程序周留存 本接口应在后端服务器调用</h4><h4 id="9-7-1-getAnalysisMonthlyVisitTrend-获取用户访问小程序数据月趋势-本接口应在后端服务器调用"><a href="#9-7-1-getAnalysisMonthlyVisitTrend-获取用户访问小程序数据月趋势-本接口应在后端服务器调用" class="headerlink" title="9.7.1 getAnalysisMonthlyVisitTrend 获取用户访问小程序数据月趋势 本接口应在后端服务器调用"></a>9.7.1 getAnalysisMonthlyVisitTrend 获取用户访问小程序数据月趋势 本接口应在后端服务器调用</h4><h4 id="9-7-1-getAnalysisUserPortrait-获取小程序新增或活跃用户的画像分布数据。本接口应在后端服务器调用"><a href="#9-7-1-getAnalysisUserPortrait-获取小程序新增或活跃用户的画像分布数据。本接口应在后端服务器调用" class="headerlink" title="9.7.1 getAnalysisUserPortrait  获取小程序新增或活跃用户的画像分布数据。本接口应在后端服务器调用"></a>9.7.1 getAnalysisUserPortrait  获取小程序新增或活跃用户的画像分布数据。本接口应在后端服务器调用</h4><p>时间范围支持昨天、最近7天、最近30天。其中，新增用户数为时间范围内首次访问小程序的去重用户数，活跃用户数为时间范围内访问过小程序的去重用户数。</p>
<h4 id="9-7-1-getAnalysisVisitDistribution-获取用户小程序访问分布数据-本接口应在后端服务器调用"><a href="#9-7-1-getAnalysisVisitDistribution-获取用户小程序访问分布数据-本接口应在后端服务器调用" class="headerlink" title="9.7.1 getAnalysisVisitDistribution 获取用户小程序访问分布数据 本接口应在后端服务器调用"></a>9.7.1 getAnalysisVisitDistribution 获取用户小程序访问分布数据 本接口应在后端服务器调用</h4><h4 id="9-7-1-getAnalysisVisitPage-访问页面。目前只提供按-page-visit-pv-排序的-top200。-本接口应在后端服务器调用"><a href="#9-7-1-getAnalysisVisitPage-访问页面。目前只提供按-page-visit-pv-排序的-top200。-本接口应在后端服务器调用" class="headerlink" title="9.7.1 getAnalysisVisitPage 访问页面。目前只提供按 page_visit_pv 排序的 top200。 本接口应在后端服务器调用"></a>9.7.1 getAnalysisVisitPage 访问页面。目前只提供按 page_visit_pv 排序的 top200。 本接口应在后端服务器调用</h4><h4 id="9-7-1-getAnalysisWeeklyRetain-获取用户访问小程序周留存-本接口应在后端服务器调用"><a href="#9-7-1-getAnalysisWeeklyRetain-获取用户访问小程序周留存-本接口应在后端服务器调用" class="headerlink" title="9.7.1 getAnalysisWeeklyRetain 获取用户访问小程序周留存 本接口应在后端服务器调用"></a>9.7.1 getAnalysisWeeklyRetain 获取用户访问小程序周留存 本接口应在后端服务器调用</h4><h4 id="9-7-1-getAnalysisWeeklyVisitTrend-获取用户访问小程序数据周趋势-本接口应在后端服务器调用"><a href="#9-7-1-getAnalysisWeeklyVisitTrend-获取用户访问小程序数据周趋势-本接口应在后端服务器调用" class="headerlink" title="9.7.1 getAnalysisWeeklyVisitTrend 获取用户访问小程序数据周趋势 本接口应在后端服务器调用"></a>9.7.1 getAnalysisWeeklyVisitTrend 获取用户访问小程序数据周趋势 本接口应在后端服务器调用</h4><h3 id="9-8-发票"><a href="#9-8-发票" class="headerlink" title="9.8 发票"></a>9.8 发票</h3><h4 id="9-8-1-用户授权"><a href="#9-8-1-用户授权" class="headerlink" title="9.8.1  用户授权"></a>9.8.1  用户授权</h4><p>调用前需要  scope.invoice <a href="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/authorize.html" target="_blank" rel="noopener">用户授权</a></p>
<h4 id="9-8-1-wx-chooseInvoice-选择用户已有的发票"><a href="#9-8-1-wx-chooseInvoice-选择用户已有的发票" class="headerlink" title="9.8.1 wx.chooseInvoice 选择用户已有的发票"></a>9.8.1 wx.chooseInvoice 选择用户已有的发票</h4><p>调用前需要  scope.invoice <a href="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/authorize.html" target="_blank" rel="noopener">用户授权</a></p>
<p>语法：wx.chooseInvoice(Object object)  基础库 2.3.0 开始支持，低版本需做兼容处理。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">wx.chooseInvoice(&#123;</span><br><span class="line">  success(res)&#123;</span><br><span class="line">    <span class="comment">//res.invoiceInfo  用户选中的发票列表</span></span><br><span class="line">    <span class="comment">/* &#123;</span></span><br><span class="line"><span class="comment">      ardId: '',//所选发票卡券的 cardId</span></span><br><span class="line"><span class="comment">      encryptCode: '',//所选发票卡券的加密 code，报销方可以通过 cardId 和 encryptCode 获得报销发票的信息</span></span><br><span class="line"><span class="comment">      publisherAppId:''//发票方的 appId</span></span><br><span class="line"><span class="comment">    &#125; */</span></span><br><span class="line">  &#125;,</span><br><span class="line">  fail(res)&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">  &#125;,</span><br><span class="line">  complete(res)&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>通过 cardId 和 encryptCode 获得报销发票的信息<br>请参考微信电子发票文档中，「查询报销发票信息」部分。 其中 access_token 的获取请参考getAccessToken文档</p>
<p><a href="https://mp.weixin.qq.com/wiki?t=resource/res_main&amp;id=21517918939oae3U" target="_blank" rel="noopener">微信电子发票文档</a><br><a href="https://developers.weixin.qq.com/miniprogram/dev/api/open-api/access-token/getAccessToken.html" target="_blank" rel="noopener">getAccessToken文档</a></p>
<h4 id="9-8-2-wx-chooseInvoiceTitle-选择用户的发票抬头"><a href="#9-8-2-wx-chooseInvoiceTitle-选择用户的发票抬头" class="headerlink" title="9.8.2 wx.chooseInvoiceTitle 选择用户的发票抬头"></a>9.8.2 wx.chooseInvoiceTitle 选择用户的发票抬头</h4><p>调用前需要  scope.invoiceTitle <a href="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/authorize.html" target="_blank" rel="noopener">用户授权</a></p>
<p>语法：wx.chooseInvoiceTitle(Object object)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">wx.chooseInvoiceTitle(&#123;</span><br><span class="line">  success(res)&#123;</span><br><span class="line">    res.type:<span class="string">'0'</span>,<span class="comment">//string 抬头类型  0：单位 1：个人</span></span><br><span class="line">    res.title:<span class="string">''</span>,<span class="comment">//抬头名称</span></span><br><span class="line">    res.taxNumber:<span class="string">''</span>,<span class="comment">//抬头税号</span></span><br><span class="line">    res.companyAddress:<span class="string">''</span>,<span class="comment">//单位地址</span></span><br><span class="line">    res.telephone:<span class="string">''</span>,<span class="comment">//手机号码</span></span><br><span class="line">    res.bankName:<span class="string">''</span>,<span class="comment">//银行名称</span></span><br><span class="line">    res.bankAccount:<span class="string">''</span>,<span class="comment">//银行账号</span></span><br><span class="line">    res.errMsg:<span class="string">''</span><span class="comment">//错误信息</span></span><br><span class="line">  &#125;,</span><br><span class="line">  fail(res)&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">  &#125;,</span><br><span class="line">  complete(res)&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="9-9-登录"><a href="#9-9-登录" class="headerlink" title="9.9 登录"></a>9.9 登录</h3><p><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/login.html" target="_blank" rel="noopener">官网小程序登录流程图</a></p>
<p>小程序可以通过微信官方提供的登录能力方便地获取微信提供的用户身份标识，快速建立小程序内的用户体系。</p>
<p><img src="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/image/api-login.jpg" alt="官网小程序登录流程图"></p>
<h4 id="9-9-1-wx-checkSession-检查登录态是否过期。"><a href="#9-9-1-wx-checkSession-检查登录态是否过期。" class="headerlink" title="9.9.1 wx.checkSession 检查登录态是否过期。"></a>9.9.1 wx.checkSession 检查登录态是否过期。</h4><p>通过 wx.login 接口获得的用户登录态拥有一定的时效性。用户越久未使用小程序，用户登录态越有可能失效。反之如果用户一直在使用小程序，则用户登录态一直保持有效。具体时效逻辑由微信维护，对开发者透明。开发者只需要调用 wx.checkSession 接口检测当前用户登录态是否有效。</p>
<p>登录态过期后开发者可以再调用 wx.login 获取新的用户登录态。调用成功说明当前 session_key 未过期，调用失败说明 session_key 已过期。更多使用方法详见 小程序登录。(就是  9.9 解释的流程)</p>
<h4 id="9-9-2-wx-login-调用接口获取登录凭证-code-（这个code是临时登录凭证，用于获取-openid-的）"><a href="#9-9-2-wx-login-调用接口获取登录凭证-code-（这个code是临时登录凭证，用于获取-openid-的）" class="headerlink" title="9.9.2 wx.login 调用接口获取登录凭证 code  （这个code是临时登录凭证，用于获取 openid 的）"></a>9.9.2 wx.login 调用接口获取登录凭证 code  （这个code是临时登录凭证，用于获取 openid 的）</h4><p>通过凭证进而换取用户登录态信息，包括用户的唯一标识（openid）及本次登录的会话密钥（session_key）等。用户数据的加解密通讯需要依赖会话密钥完成。更多使用方法详见 小程序登录。(就是  9.9 解释的流程)</p>
<h4 id="9-9-3-前端登录代码"><a href="#9-9-3-前端登录代码" class="headerlink" title="9.9.3 前端登录代码"></a>9.9.3 前端登录代码</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">wx.checkSession(&#123;</span><br><span class="line">  success () &#123;</span><br><span class="line">    <span class="comment">//session_key 未过期，并且在本生命周期一直有效</span></span><br><span class="line">  &#125;,</span><br><span class="line">  fail () &#123;</span><br><span class="line">    <span class="comment">// session_key 已经失效，需要重新执行登录流程</span></span><br><span class="line">    <span class="comment">//重新登录</span></span><br><span class="line">    wx.login(&#123;</span><br><span class="line">      success (res) &#123;</span><br><span class="line">        <span class="keyword">if</span> (res.code) &#123;</span><br><span class="line">          <span class="comment">//发起网络请求   wepy 框架对这个有封装了。</span></span><br><span class="line">          wx.request(&#123;</span><br><span class="line">            url: <span class="string">'https://test.com/onLogin'</span>,</span><br><span class="line">            data: &#123;</span><br><span class="line">              code: res.code</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">'登录失败！'</span> + res.errMsg)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      fail(res)&#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">      &#125;,</span><br><span class="line">      complete(res)&#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  fail(res)&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">  &#125;,</span><br><span class="line">  complete(res)&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//wepy 框架的写法</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法一、WePY 使用方式, 需要开启 Promise 支持，参考开发规范章节</span></span><br><span class="line">wepy.request(<span class="string">'xxxx'</span>).then(<span class="function">(<span class="params">d</span>) =&gt;</span> <span class="built_in">console</span>.log(d));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法二、async/await 的使用方式, 需要开启 Promise 和 async/await 支持，参考 WIKI</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">request</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="keyword">let</span> d = <span class="keyword">await</span> wepy.request(<span class="string">'xxxxx'</span>);</span><br><span class="line">   <span class="built_in">console</span>.log(d);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="9-9-4-code2Session-登录凭证校验。-本接口应在后端服务器调用"><a href="#9-9-4-code2Session-登录凭证校验。-本接口应在后端服务器调用" class="headerlink" title="9.9.4 code2Session 登录凭证校验。 本接口应在后端服务器调用"></a>9.9.4 code2Session 登录凭证校验。 本接口应在后端服务器调用</h4><p><a href="https://developers.weixin.qq.com/miniprogram/dev/api/code2Session.html" target="_blank" rel="noopener">官网地址</a></p>
<h3 id="9-10-小程序跳转-从一个小程序-跳转-另外一个小程序"><a href="#9-10-小程序跳转-从一个小程序-跳转-另外一个小程序" class="headerlink" title="9.10 小程序跳转 (从一个小程序 跳转 另外一个小程序)"></a>9.10 小程序跳转 (从一个小程序 跳转 另外一个小程序)</h3><h4 id="9-10-1-wx-navigateToMiniProgram-返回到上一个小程序。只有在当前小程序是被其他小程序打开时可以调用成功"><a href="#9-10-1-wx-navigateToMiniProgram-返回到上一个小程序。只有在当前小程序是被其他小程序打开时可以调用成功" class="headerlink" title="9.10.1 wx.navigateToMiniProgram   返回到上一个小程序。只有在当前小程序是被其他小程序打开时可以调用成功"></a>9.10.1 wx.navigateToMiniProgram   返回到上一个小程序。只有在当前小程序是被其他小程序打开时可以调用成功</h4><p>小程序 1.3.0，小游戏 2.2.0</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//A 小程序  =&gt; B 小程序</span></span><br><span class="line">wx.navigateToMiniProgram(&#123;</span><br><span class="line">  appId: <span class="string">''</span>,<span class="comment">//要打开的小程序 appId   必填</span></span><br><span class="line">  path: <span class="string">'page/index/index?id=123'</span>,<span class="comment">//打开的页面路径，如果为空则打开首页  否</span></span><br><span class="line">  extraData: &#123;<span class="comment">// 需要传递给目标小程序的数据，目标小程序可在 App.onLaunch，App.onShow 中获取到这份数据。  否</span></span><br><span class="line">    foo: <span class="string">'bar'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  envVersion: <span class="string">'develop'</span>,<span class="comment">//要打开的小程序版本。否   默认值 'release':正式版本，'develop':开发版本，'trial':体验版</span></span><br><span class="line">  <span class="comment">//仅在当前小程序为开发版或体验版时此参数有效。如果当前小程序是正式版，则打开的小程序必定是正式版。</span></span><br><span class="line">  success(res) &#123;</span><br><span class="line">    <span class="comment">// 打开成功</span></span><br><span class="line">  &#125;,</span><br><span class="line">  fail(res)&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">  &#125;,</span><br><span class="line">  complete(res)&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  B 小程序(app.js 或者 app.wpy 中)</span></span><br><span class="line"></span><br><span class="line">onShow()&#123;</span><br><span class="line">  <span class="comment">//获取到这份数据。extraData</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//或者</span></span><br><span class="line">onLaunch()&#123;</span><br><span class="line">  <span class="comment">//获取到这份数据。extraData</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用限制：</p>
<ul>
<li>需要用户触发跳转：<br>  从 2.3.0 版本开始，若用户未点击小程序页面任意位置，则开发者将无法调用此接口自动跳转至其他小程序。</li>
<li>需要用户确认跳转：<br>  从 2.3.0 版本开始，在跳转至其他小程序前，将统一增加弹窗，询问是否跳转，用户确认后才可以跳转其他小程序。如果用户点击取消，则回调 <code>fail cancel。</code></li>
<li>每个小程序可跳转的其他小程序数量限制为不超过 10 个：<br>  从 2.4.0 版本以及指定日期（具体待定）开始，开发者提交新版小程序代码时，如使用了跳转其他小程序功能，则需要在代码配置中声明将要跳转的小程序名单，限定不超过 10 个，否则将无法通过审核。该名单可在发布新版时更新，不支持动态修改。配置方法详见 配置。调用此接口时，所跳转的 appId 必须在配置列表中，否则回调 <code>fail appId &quot;${appId}&quot; is not in navigateToMiniProgramAppIdList。</code><br>  在 app.json  / 或者是 app.wpy 中设置如下<br>  <code>&quot;navigateToMiniProgramAppIdList&quot;: [&quot;wxe5f52902cf4de896&quot;]</code><br>  <a href="https://developers.weixin.qq.com/miniprogram/dev/framework/config.html#%E5%85%A8%E5%B1%80%E9%85%8D%E7%BD%AE" target="_blank" rel="noopener">该项配置</a></li>
</ul>
<p>关于调试</p>
<ul>
<li>在开发者工具上调用此 API 并不会真实的跳转到另外的小程序，但是开发者工具会校验本次调用跳转是否成功。<a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/different.html?t=18112917#%E8%B7%B3%E8%BD%AC%E5%B0%8F%E7%A8%8B%E5%BA%8F%E8%B0%83%E8%AF%95%E6%94%AF%E6%8C%81" target="_blank" rel="noopener">详情</a></li>
<li>开发者工具上支持被跳转的小程序处理接收参数的调试。<a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/different.html?t=18112917#%E8%B7%B3%E8%BD%AC%E5%B0%8F%E7%A8%8B%E5%BA%8F%E8%B0%83%E8%AF%95%E6%94%AF%E6%8C%81" target="_blank" rel="noopener">详情</a></li>
</ul>
<h4 id="9-10-2-wx-navigateBackMiniProgram-打开另一个小程序"><a href="#9-10-2-wx-navigateBackMiniProgram-打开另一个小程序" class="headerlink" title="9.10.2 wx.navigateBackMiniProgram  打开另一个小程序"></a>9.10.2 wx.navigateBackMiniProgram  打开另一个小程序</h4><p>基础库 1.3.0 开始支持，低版本需做兼容处理。注意：微信客户端 iOS 6.5.9，Android 6.5.10 及以上版本支持</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// B 小程序  =&gt; A 小程序</span></span><br><span class="line">wx.navigateBackMiniProgram(&#123;</span><br><span class="line">  <span class="comment">// 需要返回给上一个小程序的数据，上一个小程序可在 App.onShow 中获取到这份数据。</span></span><br><span class="line">    extraData: &#123;</span><br><span class="line">    foo: <span class="string">'bar'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  success(res) &#123;</span><br><span class="line">    <span class="comment">// 返回成功</span></span><br><span class="line">  &#125;,</span><br><span class="line">  fail(res)&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">  &#125;<span class="comment">/* ,</span></span><br><span class="line"><span class="comment">  complete(res)&#123;</span></span><br><span class="line"><span class="comment">    //</span></span><br><span class="line"><span class="comment">  &#125; */</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  A 小程序(app.js 或者 app.wpy 中)</span></span><br><span class="line">onShow()&#123;</span><br><span class="line">  <span class="comment">//获取到这份数据。extraData</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="9-11-附近的小程序（后端的工作）"><a href="#9-11-附近的小程序（后端的工作）" class="headerlink" title="9.11 附近的小程序（后端的工作）"></a>9.11 附近的小程序（后端的工作）</h3><p><a href="https://developers.weixin.qq.com/miniprogram/dev/api/addNearbyPoi.html" target="_blank" rel="noopener">官网文档地址</a></p>
<h4 id="9-11-1-addNearbyPoi-添加地点-本接口应在后端服务器调用"><a href="#9-11-1-addNearbyPoi-添加地点-本接口应在后端服务器调用" class="headerlink" title="9.11.1 addNearbyPoi 添加地点 本接口应在后端服务器调用"></a>9.11.1 addNearbyPoi 添加地点 本接口应在后端服务器调用</h4><h4 id="9-11-1-deleteNearbyPoi-删除地点-本接口应在后端服务器调用"><a href="#9-11-1-deleteNearbyPoi-删除地点-本接口应在后端服务器调用" class="headerlink" title="9.11.1 deleteNearbyPoi 删除地点 本接口应在后端服务器调用"></a>9.11.1 deleteNearbyPoi 删除地点 本接口应在后端服务器调用</h4><h4 id="9-11-1-getNearbyPoiList-查看地点列表-本接口应在后端服务器调用"><a href="#9-11-1-getNearbyPoiList-查看地点列表-本接口应在后端服务器调用" class="headerlink" title="9.11.1 getNearbyPoiList 查看地点列表 本接口应在后端服务器调用"></a>9.11.1 getNearbyPoiList 查看地点列表 本接口应在后端服务器调用</h4><h4 id="9-11-1-setNearbyPoiShowStatus-展示-取消展示附近小程序-本接口应在后端服务器调用"><a href="#9-11-1-setNearbyPoiShowStatus-展示-取消展示附近小程序-本接口应在后端服务器调用" class="headerlink" title="9.11.1 setNearbyPoiShowStatus 展示/取消展示附近小程序 本接口应在后端服务器调用"></a>9.11.1 setNearbyPoiShowStatus 展示/取消展示附近小程序 本接口应在后端服务器调用</h4><h3 id="9-12-支付（仅仅是微信支付）"><a href="#9-12-支付（仅仅是微信支付）" class="headerlink" title="9.12 支付（仅仅是微信支付）"></a>9.12 支付（仅仅是微信支付）</h3><h4 id="9-12-1-wx-requestPayment-发起微信支付。"><a href="#9-12-1-wx-requestPayment-发起微信支付。" class="headerlink" title="9.12.1 wx.requestPayment 发起微信支付。"></a>9.12.1 wx.requestPayment 发起微信支付。</h4><p>了解更多信息，<a href="https://pay.weixin.qq.com/wiki/doc/api/wxa/wxa_api.php?chapter=7_3&amp;index=1" target="_blank" rel="noopener">请查看微信支付接口文档</a><br>了解更多信息，<a href="https://pay.weixin.qq.com/wiki/doc/api/wxa/wxa_api.php?chapter=7_7&amp;index=3" target="_blank" rel="noopener">小程序支付接口文档</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">wx.requestPayment(&#123;</span><br><span class="line">  timeStamp: <span class="string">''</span>,  <span class="comment">// 必填  时间戳，从 1970 年 1 月 1 日 00:00:00 至今的秒数，即当前的时间</span></span><br><span class="line">  nonceStr: <span class="string">''</span>,   <span class="comment">// 必填  随机字符串，长度为32个字符以下</span></span><br><span class="line">  package: <span class="string">''</span>,    <span class="comment">// 必填  统一下单接口返回的 prepay_id 参数值，提交格式如：prepay_id=***</span></span><br><span class="line">  signType: <span class="string">'MD5'</span>,<span class="comment">// 否   签名算法  2 个合法值：'MD5',  'HMAC-SHA256'</span></span><br><span class="line">  paySign: <span class="string">''</span>,    <span class="comment">// 必填 签名，具体签名方案参见 小程序支付接口文档</span></span><br><span class="line">  success (res) &#123; &#125;,</span><br><span class="line">  fail (res) &#123; &#125;</span><br><span class="line">  <span class="comment">/* complete(res)&#123;&#125; */</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="9-13-插件管理-（本接口应在后端服务器调用）"><a href="#9-13-插件管理-（本接口应在后端服务器调用）" class="headerlink" title="9.13 插件管理 （本接口应在后端服务器调用）"></a>9.13 插件管理 （本接口应在后端服务器调用）</h3><p><a href="https://developers.weixin.qq.com/miniprogram/dev/api/applyPlugin.html" target="_blank" rel="noopener">官网教程</a></p>
<h4 id="9-13-1applyPlugin-向插件开发者发起使用插件的申请（本接口应在后端服务器调用）"><a href="#9-13-1applyPlugin-向插件开发者发起使用插件的申请（本接口应在后端服务器调用）" class="headerlink" title="9.13.1applyPlugin 向插件开发者发起使用插件的申请（本接口应在后端服务器调用）"></a>9.13.1applyPlugin 向插件开发者发起使用插件的申请（本接口应在后端服务器调用）</h4><h4 id="9-13-1getPluginDevApplyList-获取当前所有插件使用方（供插件开发者调用）（本接口应在后端服务器调用）"><a href="#9-13-1getPluginDevApplyList-获取当前所有插件使用方（供插件开发者调用）（本接口应在后端服务器调用）" class="headerlink" title="9.13.1getPluginDevApplyList 获取当前所有插件使用方（供插件开发者调用）（本接口应在后端服务器调用）"></a>9.13.1getPluginDevApplyList 获取当前所有插件使用方（供插件开发者调用）（本接口应在后端服务器调用）</h4><h4 id="9-13-1getPluginList-查询已添加的插件（本接口应在后端服务器调用）"><a href="#9-13-1getPluginList-查询已添加的插件（本接口应在后端服务器调用）" class="headerlink" title="9.13.1getPluginList  查询已添加的插件（本接口应在后端服务器调用）"></a>9.13.1getPluginList  查询已添加的插件（本接口应在后端服务器调用）</h4><h4 id="9-13-1setDevPluginApplyStatus-修改插件使用申请的状态（供插件开发者调用）（本接口应在后端服务器调用）"><a href="#9-13-1setDevPluginApplyStatus-修改插件使用申请的状态（供插件开发者调用）（本接口应在后端服务器调用）" class="headerlink" title="9.13.1setDevPluginApplyStatus 修改插件使用申请的状态（供插件开发者调用）（本接口应在后端服务器调用）"></a>9.13.1setDevPluginApplyStatus 修改插件使用申请的状态（供插件开发者调用）（本接口应在后端服务器调用）</h4><h4 id="9-13-1unbindPlugin-删除已添加的插件（本接口应在后端服务器调用）"><a href="#9-13-1unbindPlugin-删除已添加的插件（本接口应在后端服务器调用）" class="headerlink" title="9.13.1unbindPlugin 删除已添加的插件（本接口应在后端服务器调用）"></a>9.13.1unbindPlugin 删除已添加的插件（本接口应在后端服务器调用）</h4><h3 id="9-14-二维码-（本接口应在后端服务器调用）"><a href="#9-14-二维码-（本接口应在后端服务器调用）" class="headerlink" title="9.14 二维码 （本接口应在后端服务器调用）"></a>9.14 二维码 （本接口应在后端服务器调用）</h3><h4 id="9-14-1-createWXAQRCode-获取-小程序二维码-，适用于需要的码数量-较少-的业务场景。-（本接口应在后端服务器调用）"><a href="#9-14-1-createWXAQRCode-获取-小程序二维码-，适用于需要的码数量-较少-的业务场景。-（本接口应在后端服务器调用）" class="headerlink" title="9.14.1 createWXAQRCode 获取 [小程序二维码]，适用于需要的码数量  [较少]   的业务场景。 （本接口应在后端服务器调用）"></a>9.14.1 createWXAQRCode 获取 [小程序二维码]，适用于需要的码数量  [较少]   的业务场景。 （本接口应在后端服务器调用）</h4><p>通过该接口生成的小程序码，永久有效，有数量限制，<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/qr-code.html" target="_blank" rel="noopener">详见获取二维码</a></p>
<h4 id="9-14-1-getWXACode-获取-小程序码-，适用于需要的码数量-较少-的业务场景。-（本接口应在后端服务器调用）"><a href="#9-14-1-getWXACode-获取-小程序码-，适用于需要的码数量-较少-的业务场景。-（本接口应在后端服务器调用）" class="headerlink" title="9.14.1 getWXACode     获取 [小程序码]，适用于需要的码数量   [较少]   的业务场景。 （本接口应在后端服务器调用）"></a>9.14.1 getWXACode     获取 [小程序码]，适用于需要的码数量   [较少]   的业务场景。 （本接口应在后端服务器调用）</h4><p>通过该接口生成的小程序码，永久有效，有数量限制，<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/qr-code.html" target="_blank" rel="noopener">详见获取二维码</a></p>
<h4 id="9-14-1-getWXACodeUnlimit-获取-小程序码-，适用于需要的码数量-极多-的业务场景。-（本接口应在后端服务器调用）"><a href="#9-14-1-getWXACodeUnlimit-获取-小程序码-，适用于需要的码数量-极多-的业务场景。-（本接口应在后端服务器调用）" class="headerlink" title="9.14.1 getWXACodeUnlimit 获取 [小程序码]，适用于需要的码数量 [极多] 的业务场景。 （本接口应在后端服务器调用）"></a>9.14.1 getWXACodeUnlimit 获取 [小程序码]，适用于需要的码数量 [极多] 的业务场景。 （本接口应在后端服务器调用）</h4><p>通过该接口生成的小程序码，永久有效，数量暂无限制。 <a href="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/qr-code.html" target="_blank" rel="noopener">详见获取二维码</a></p>
<h3 id="9-15-内容安全（检查-用户-图片-或者-文本-的安全性）（本接口应在后端服务器调用）"><a href="#9-15-内容安全（检查-用户-图片-或者-文本-的安全性）（本接口应在后端服务器调用）" class="headerlink" title="9.15 内容安全（检查 用户  图片 或者 文本 的安全性）（本接口应在后端服务器调用）"></a>9.15 内容安全（检查 用户  图片 或者 文本 的安全性）（本接口应在后端服务器调用）</h3><p><a href="https://developers.weixin.qq.com/miniprogram/dev/api/imgSecCheck.html" target="_blank" rel="noopener">官网教程</a></p>
<h4 id="9-15-1-imgSecCheck-校验一张图片是否含有违法违规内容。（本接口应在后端服务器调用）"><a href="#9-15-1-imgSecCheck-校验一张图片是否含有违法违规内容。（本接口应在后端服务器调用）" class="headerlink" title="9.15.1 imgSecCheck  校验一张图片是否含有违法违规内容。（本接口应在后端服务器调用）"></a>9.15.1 imgSecCheck  校验一张图片是否含有违法违规内容。（本接口应在后端服务器调用）</h4><h4 id="9-15-1-msgSecCheck-检查一段文本是否含有违法违规内容。（本接口应在后端服务器调用）"><a href="#9-15-1-msgSecCheck-检查一段文本是否含有违法违规内容。（本接口应在后端服务器调用）" class="headerlink" title="9.15.1 msgSecCheck 检查一段文本是否含有违法违规内容。（本接口应在后端服务器调用）"></a>9.15.1 msgSecCheck 检查一段文本是否含有违法违规内容。（本接口应在后端服务器调用）</h4><h3 id="9-16-设置"><a href="#9-16-设置" class="headerlink" title="9.16 设置"></a>9.16 设置</h3><h4 id="9-16-1-AuthSetting"><a href="#9-16-1-AuthSetting" class="headerlink" title="9.16.1 AuthSetting"></a>9.16.1 AuthSetting</h4><p>AuthSetting<br>用户授权设置信息，详情参考<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/authorize.html" target="_blank" rel="noopener">权限</a></p>
<p>属性<br>boolean scope.userInfo<br>是否授权用户信息，对应接口 wx.getUserInfo</p>
<p>boolean scope.userLocation<br>是否授权地理位置，对应接口 wx.getLocation, wx.chooseLocation</p>
<p>boolean scope.address<br>是否授权通讯地址，对应接口 wx.chooseAddress</p>
<p>boolean scope.invoiceTitle<br>是否授权发票抬头，对应接口 wx.chooseInvoiceTitle</p>
<p>boolean scope.invoice<br>是否授权获取发票，对应接口 wx.chooseInvoice</p>
<p>boolean scope.werun<br>是否授权微信运动步数，对应接口 wx.getWeRunData</p>
<p>boolean scope.record<br>是否授权录音功能，对应接口 wx.startRecord</p>
<p>boolean scope.writePhotosAlbum<br>是否授权保存到相册 wx.saveImageToPhotosAlbum, wx.saveVideoToPhotosAlbum</p>
<p>boolean scope.camera<br>是否授权摄像头，对应<camera> 组件</camera></p>
<h4 id="9-16-2-wx-getSetting-获取用户的当前设置。"><a href="#9-16-2-wx-getSetting-获取用户的当前设置。" class="headerlink" title="9.16.2 wx.getSetting 获取用户的当前设置。"></a>9.16.2 wx.getSetting 获取用户的当前设置。</h4><p>返回值中只会出现小程序已经向用户请求过的权限。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">wx.getSetting(&#123;</span><br><span class="line">  success (res) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res.authSetting)<span class="comment">//用户授权结果</span></span><br><span class="line">    <span class="comment">// res.authSetting = &#123;</span></span><br><span class="line">    <span class="comment">//   "scope.userInfo": true,</span></span><br><span class="line">    <span class="comment">//   "scope.userLocation": true</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="9-16-3-wx-openSetting-调起客户端小程序设置界面，返回用户设置的操作结果。"><a href="#9-16-3-wx-openSetting-调起客户端小程序设置界面，返回用户设置的操作结果。" class="headerlink" title="9.16.3 wx.openSetting 调起客户端小程序设置界面，返回用户设置的操作结果。"></a>9.16.3 wx.openSetting 调起客户端小程序设置界面，返回用户设置的操作结果。</h4><p>设置界面只会出现小程序已经向用户请求过的<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/authorize.html" target="_blank" rel="noopener">权限</a><br>注意：2.3.0 版本开始，用户发生点击行为后，才可以跳转打开设置页，管理授权信息。<a href="https://developers.weixin.qq.com/community/develop/doc/000cea2305cc5047af5733de751008" target="_blank" rel="noopener">详情</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">wx.openSetting(&#123;</span><br><span class="line">  success (res) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res.authSetting)<span class="comment">//用户授权结果</span></span><br><span class="line">    <span class="comment">// res.authSetting = &#123;</span></span><br><span class="line">    <span class="comment">//   "scope.userInfo": true,</span></span><br><span class="line">    <span class="comment">//   "scope.userLocation": true</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="9-17-生物认证-指纹识别，人脸识别，声纹识别"><a href="#9-17-生物认证-指纹识别，人脸识别，声纹识别" class="headerlink" title="9.17 生物认证(指纹识别，人脸识别，声纹识别)"></a>9.17 生物认证(指纹识别，人脸识别，声纹识别)</h3><h4 id="9-17-1-wx-checkIsSoterEnrolledInDevice-获取设备内是否录入如指纹等生物信息的接口"><a href="#9-17-1-wx-checkIsSoterEnrolledInDevice-获取设备内是否录入如指纹等生物信息的接口" class="headerlink" title="9.17.1 wx.checkIsSoterEnrolledInDevice 获取设备内是否录入如指纹等生物信息的接口"></a>9.17.1 wx.checkIsSoterEnrolledInDevice 获取设备内是否录入如指纹等生物信息的接口</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">wx.checkIsSoterEnrolledInDevice(&#123;</span><br><span class="line">  checkAuthMode: <span class="string">'fingerPrint'</span>, <span class="comment">//Array.&lt;string&gt; 不是字符串数组 么？？？？？这里好像不对把？？？ 认证方式  必填</span></span><br><span class="line">  <span class="comment">// 'fingerPrint':指纹识别   'facial':人脸识别（暂未支持）  'speech':声纹识别（暂未支持）</span></span><br><span class="line">  success(res) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res.isEnrolled)<span class="comment">//是否已录入信息  boolean</span></span><br><span class="line">    <span class="built_in">console</span>.log(res.errMs)<span class="comment">//错误信息  string</span></span><br><span class="line">  &#125;,</span><br><span class="line">  fail(res)&#123;&#125;,</span><br><span class="line">  <span class="comment">//complete(res)&#123;&#125;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="9-17-1-wx-checkIsSupportSoterAuthentication"><a href="#9-17-1-wx-checkIsSupportSoterAuthentication" class="headerlink" title="9.17.1 wx.checkIsSupportSoterAuthentication"></a>9.17.1 wx.checkIsSupportSoterAuthentication</h4><h4 id="9-17-1-wx-startSoterAuthentication"><a href="#9-17-1-wx-startSoterAuthentication" class="headerlink" title="9.17.1 wx.startSoterAuthentication"></a>9.17.1 wx.startSoterAuthentication</h4><h3 id="9-18-模板消息-（本接口应在后端服务器调用）"><a href="#9-18-模板消息-（本接口应在后端服务器调用）" class="headerlink" title="9.18 模板消息 （本接口应在后端服务器调用）"></a>9.18 模板消息 （本接口应在后端服务器调用）</h3><p><a href="https://developers.weixin.qq.com/miniprogram/dev/api/addTemplate.html" target="_blank" rel="noopener">官网文档</a></p>
<h4 id="9-18-1-addTemplate-组合模板并添加至帐号下的个人模板库（本接口应在后端服务器调用）"><a href="#9-18-1-addTemplate-组合模板并添加至帐号下的个人模板库（本接口应在后端服务器调用）" class="headerlink" title="9.18.1 addTemplate 组合模板并添加至帐号下的个人模板库（本接口应在后端服务器调用）"></a>9.18.1 addTemplate 组合模板并添加至帐号下的个人模板库（本接口应在后端服务器调用）</h4><h4 id="9-18-1-deleteTemplate-删除帐号下的某个模板（本接口应在后端服务器调用）"><a href="#9-18-1-deleteTemplate-删除帐号下的某个模板（本接口应在后端服务器调用）" class="headerlink" title="9.18.1 deleteTemplate 删除帐号下的某个模板（本接口应在后端服务器调用）"></a>9.18.1 deleteTemplate 删除帐号下的某个模板（本接口应在后端服务器调用）</h4><h4 id="9-18-1-getTemplateLibraryById-获取模板库某个模板标题下关键词库（本接口应在后端服务器调用）"><a href="#9-18-1-getTemplateLibraryById-获取模板库某个模板标题下关键词库（本接口应在后端服务器调用）" class="headerlink" title="9.18.1 getTemplateLibraryById 获取模板库某个模板标题下关键词库（本接口应在后端服务器调用）"></a>9.18.1 getTemplateLibraryById 获取模板库某个模板标题下关键词库（本接口应在后端服务器调用）</h4><h4 id="9-18-1-getTemplateLibraryList-获取小程序模板库标题列表（本接口应在后端服务器调用）"><a href="#9-18-1-getTemplateLibraryList-获取小程序模板库标题列表（本接口应在后端服务器调用）" class="headerlink" title="9.18.1 getTemplateLibraryList 获取小程序模板库标题列表（本接口应在后端服务器调用）"></a>9.18.1 getTemplateLibraryList 获取小程序模板库标题列表（本接口应在后端服务器调用）</h4><h4 id="9-18-1-getTemplateList-获取帐号下已存在的模板列表（本接口应在后端服务器调用）"><a href="#9-18-1-getTemplateList-获取帐号下已存在的模板列表（本接口应在后端服务器调用）" class="headerlink" title="9.18.1 getTemplateList 获取帐号下已存在的模板列表（本接口应在后端服务器调用）"></a>9.18.1 getTemplateList 获取帐号下已存在的模板列表（本接口应在后端服务器调用）</h4><h4 id="9-18-1-sendTemplateMessage-发送模板消息（本接口应在后端服务器调用）"><a href="#9-18-1-sendTemplateMessage-发送模板消息（本接口应在后端服务器调用）" class="headerlink" title="9.18.1 sendTemplateMessage 发送模板消息（本接口应在后端服务器调用）"></a>9.18.1 sendTemplateMessage 发送模板消息（本接口应在后端服务器调用）</h4><h3 id="9-19-统一服务消息-（本接口应在后端服务器调用）"><a href="#9-19-统一服务消息-（本接口应在后端服务器调用）" class="headerlink" title="9.19 统一服务消息 （本接口应在后端服务器调用）"></a>9.19 统一服务消息 （本接口应在后端服务器调用）</h3><h4 id="9-19-1-sendUniformMessage-下发小程序和公众号统一的服务消息-（本接口应在后端服务器调用）"><a href="#9-19-1-sendUniformMessage-下发小程序和公众号统一的服务消息-（本接口应在后端服务器调用）" class="headerlink" title="9.19.1 sendUniformMessage   下发小程序和公众号统一的服务消息 （本接口应在后端服务器调用）"></a>9.19.1 sendUniformMessage   下发小程序和公众号统一的服务消息 （本接口应在后端服务器调用）</h4><h3 id="9-20-动态消息-（本接口应在后端服务器调用）"><a href="#9-20-动态消息-（本接口应在后端服务器调用）" class="headerlink" title="9.20 动态消息 （本接口应在后端服务器调用）"></a>9.20 动态消息 （本接口应在后端服务器调用）</h3><p><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/share/updatable-message.html" target="_blank" rel="noopener">动态消息</a></p>
<h4 id="9-20-1-createActivityId-创建被分享动态消息的-activity-id。-（本接口应在后端服务器调用）"><a href="#9-20-1-createActivityId-创建被分享动态消息的-activity-id。-（本接口应在后端服务器调用）" class="headerlink" title="9.20.1 createActivityId 创建被分享动态消息的 activity_id。 （本接口应在后端服务器调用）"></a>9.20.1 createActivityId 创建被分享动态消息的 activity_id。 （本接口应在后端服务器调用）</h4><h4 id="9-20-2-setUpdatableMsg-修改被分享的动态消息。详见动态消息。（本接口应在后端服务器调用）"><a href="#9-20-2-setUpdatableMsg-修改被分享的动态消息。详见动态消息。（本接口应在后端服务器调用）" class="headerlink" title="9.20.2 setUpdatableMsg 修改被分享的动态消息。详见动态消息。（本接口应在后端服务器调用）"></a>9.20.2 setUpdatableMsg 修改被分享的动态消息。详见动态消息。（本接口应在后端服务器调用）</h4><h3 id="9-21-用户信息-调用前需要-用户授权"><a href="#9-21-用户信息-调用前需要-用户授权" class="headerlink" title="9.21 用户信息 (调用前需要 用户授权)"></a>9.21 用户信息 (调用前需要 用户授权)</h3><h4 id="9-21-1-UserInfo-用户信息"><a href="#9-21-1-UserInfo-用户信息" class="headerlink" title="9.21.1 UserInfo  用户信息"></a>9.21.1 UserInfo  用户信息</h4><ul>
<li>nickName：string</li>
<li>avatarUrl：string<br>  用户头像图片的 URL。URL 最后一个数值代表正方形头像大小（有 0、46、64、96、132 数值可选，0 代表 640x640 的正方形头像，46 表示 46x46 的正方形头像，剩余数值以此类推。默认132），用户没有头像时该项为空。若用户更换头像，原有头像 URL 将失效。</li>
<li>gender:number<br>  0:未知   1:男性    2:女性</li>
<li>country:’’<br>  用户所在国家</li>
<li>province:’’<br>  用户所在省份</li>
<li>city:’’<br>  用户所在城市</li>
<li>‘language’:’’<br>  显示 country，province，city 所用的语言<br>  en:   英文<br>  zh_CN:简体中文<br>  zh_TW:体中文</li>
</ul>
<h4 id="9-21-2-wx-getUserInfo-获取用户信息。"><a href="#9-21-2-wx-getUserInfo-获取用户信息。" class="headerlink" title="9.21.2 wx.getUserInfo 获取用户信息。"></a>9.21.2 wx.getUserInfo 获取用户信息。</h4><p><strong>userInfo 类型的数据</strong>：就是 9.21.1 中说的类型<br><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/signature.html" target="_blank" rel="noopener">加密数据解密算法</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 必须是在用户已经授权的情况下调用</span></span><br><span class="line">wx.getUserInfo(&#123;</span><br><span class="line">    withCredentials:<span class="literal">true</span>,<span class="comment">//是否带上登录态信息。    否</span></span><br><span class="line">    <span class="comment">//当 withCredentials 为 true 时，要求此前有调用过 wx.login 且登录态尚未过期，</span></span><br><span class="line">    <span class="comment">//此时返回的数据会包含 encryptedData, iv 等敏感信息；</span></span><br><span class="line">    <span class="comment">//当 withCredentials 为 false 时，不要求有登录态，返回的数据不包含 encryptedData, iv 等敏感信息。</span></span><br><span class="line">    lang:<span class="string">'en'</span>,<span class="comment">//显示用户信息的语言    否   默认值'en'：英文   zh_CN：简体中文   zh_TW：繁体中文</span></span><br><span class="line">    success: <span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> userInfo = res.userInfo<span class="comment">// UserInfo  用户信息对象，不包含 openid 等敏感信息</span></span><br><span class="line">      res.rawData = <span class="string">''</span><span class="comment">//不包括敏感信息的原始数据字符串，用于计算签名</span></span><br><span class="line">      res.signature = <span class="string">''</span><span class="comment">//使用 sha1( rawData + sessionkey ) 得到字符串，用于校验用户信息，详见 用户数据的签名验证和加解密</span></span><br><span class="line">      res.encryptedData = <span class="string">''</span><span class="comment">//包括敏感数据在内的完整用户信息的加密数据，详见 用户数据的签名验证和加解密</span></span><br><span class="line">      res.iv = <span class="string">''</span><span class="comment">//加密算法的初始向量，详见 用户数据的签名验证和加解密</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> nickName = userInfo.nickName</span><br><span class="line">      <span class="keyword">var</span> avatarUrl = userInfo.avatarUrl</span><br><span class="line">      <span class="keyword">var</span> gender = userInfo.gender <span class="comment">//性别 0：未知、1：男、2：女</span></span><br><span class="line">      <span class="keyword">var</span> province = userInfo.province</span><br><span class="line">      <span class="keyword">var</span> city = userInfo.city</span><br><span class="line">      <span class="keyword">var</span> country = userInfo.country</span><br><span class="line">    &#125;,</span><br><span class="line">    fail(res)&#123;&#125;,</span><br><span class="line">  <span class="comment">/*   complete(res)&#123;&#125; */</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>encryptedData 解密后为以下 json 结构，详见加密数据解密算法</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"openId"</span>: <span class="string">"OPENID"</span>,</span><br><span class="line">    <span class="attr">"nickName"</span>: <span class="string">"NICKNAME"</span>,</span><br><span class="line">    <span class="attr">"gender"</span>: GENDER,</span><br><span class="line">    <span class="attr">"city"</span>: <span class="string">"CITY"</span>,</span><br><span class="line">    <span class="attr">"province"</span>: <span class="string">"PROVINCE"</span>,</span><br><span class="line">    <span class="attr">"country"</span>: <span class="string">"COUNTRY"</span>,</span><br><span class="line">    <span class="attr">"avatarUrl"</span>: <span class="string">"AVATARURL"</span>,</span><br><span class="line">    <span class="attr">"unionId"</span>: <span class="string">"UNIONID"</span>,</span><br><span class="line">    <span class="attr">"watermark"</span>: &#123;</span><br><span class="line">        <span class="attr">"appid"</span>: <span class="string">"APPID"</span>,</span><br><span class="line">        <span class="attr">"timestamp"</span>: TIMESTAMP</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="9-21-1-1-在用户未授权过的情况下调用此接口，将不再出现授权弹窗-每次小程序都提示的消息"><a href="#9-21-1-1-在用户未授权过的情况下调用此接口，将不再出现授权弹窗-每次小程序都提示的消息" class="headerlink" title="9.21.1.1 在用户未授权过的情况下调用此接口，将不再出现授权弹窗!!!!!!!!!!!!!!!!!!!!!!!!!!!!每次小程序都提示的消息"></a>9.21.1.1 在用户未授权过的情况下调用此接口，将不再出现授权弹窗!!!!!!!!!!!!!!!!!!!!!!!!!!!!每次小程序都提示的消息</h5><p>会直接进入 fail 回调（详见《公告》)。在用户已授权的情况下调用此接口，可成功获取用户信息。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 如果只是展示用户头像昵称，可以使用 &lt;open-data /&gt; 组件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">open-data</span> <span class="attr">type</span>=<span class="string">"userAvatarUrl"</span>&gt;</span><span class="tag">&lt;/<span class="name">open-data</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">open-data</span> <span class="attr">type</span>=<span class="string">"userNickName"</span>&gt;</span><span class="tag">&lt;/<span class="name">open-data</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 需要使用 button 来授权登录 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">wx:if</span>=<span class="string">"&#123;&#123;canIUse&#125;&#125;"</span> <span class="attr">open-type</span>=<span class="string">"getUserInfo"</span> <span class="attr">bindgetuserinfo</span>=<span class="string">"bindGetUserInfo"</span>&gt;</span>授权登录<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:else</span>&gt;</span>请升级微信版本<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">  data: &#123;</span><br><span class="line">    canIUse: wx.canIUse(<span class="string">'button.open-type.getUserInfo'</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  onLoad: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 查看是否授权</span></span><br><span class="line">    wx.getSetting(&#123;</span><br><span class="line">      success (res)&#123;</span><br><span class="line">        <span class="keyword">if</span> (res.authSetting[<span class="string">'scope.userInfo'</span>]) &#123;</span><br><span class="line">          <span class="comment">// 已经授权，可以直接调用 getUserInfo 获取头像昵称</span></span><br><span class="line">          wx.getUserInfo(&#123;</span><br><span class="line">            success: <span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;</span><br><span class="line">              <span class="built_in">console</span>.log(res.userInfo)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  bindGetUserInfo (e) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(e.detail.userInfo)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="9-22微信运动-调用前需要-用户授权"><a href="#9-22微信运动-调用前需要-用户授权" class="headerlink" title="9.22微信运动 (调用前需要 用户授权)"></a>9.22微信运动 (调用前需要 用户授权)</h3><h4 id="9-22-1-wx-getWeRunData-获取用户过去三十天微信运动步数。"><a href="#9-22-1-wx-getWeRunData-获取用户过去三十天微信运动步数。" class="headerlink" title="9.22.1 wx.getWeRunData 获取用户过去三十天微信运动步数。"></a>9.22.1 wx.getWeRunData 获取用户过去三十天微信运动步数。</h4><p>调用前需要 用户授权 scope.werun。<br>需要先调用 wx.login 接口。步数信息会在用户主动进入小程序时更新。</p>
<p><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/signature.html" target="_blank" rel="noopener">加密数据解密算法</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">wx.getWeRunData(&#123;</span><br><span class="line">  success(res) &#123;</span><br><span class="line">    <span class="comment">//res.encryptedData:'',  包括敏感数据在内的完整用户信息的加密数据，详细见加密数据解密算法。</span></span><br><span class="line">    <span class="comment">//res.iv:''              加密算法的初始向量</span></span><br><span class="line">    <span class="keyword">const</span> encryptedData = res.encryptedData</span><br><span class="line">  &#125;,</span><br><span class="line">  fail(res) &#123;&#125;,</span><br><span class="line">  <span class="comment">/* complete (res) &#123;&#125; */</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">//encryptedData 解密后 JSON 结构</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"stepInfoList"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      "timestamp": 1445866601,//时间戳，表示数据对应的时间</span><br><span class="line">      "step": 100//微信运动步数</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"timestamp"</span>: <span class="number">1445876601</span>,</span><br><span class="line">      <span class="attr">"step"</span>: <span class="number">120</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="十、更新-UpdateManager-小程序版本更新-（个人中心提示用户版本升级用的）"><a href="#十、更新-UpdateManager-小程序版本更新-（个人中心提示用户版本升级用的）" class="headerlink" title="十、更新 UpdateManager(小程序版本更新)（个人中心提示用户版本升级用的）"></a>十、更新 UpdateManager(小程序版本更新)（个人中心提示用户版本升级用的）</h2><p>UpdateManager 对象，用来管理更新，可通过 wx.getUpdateManager 接口获取实例。</p>
<h3 id="10-1-wx-getUpdateManager-获取全局唯一的版本更新管理器，用于管理小程序更新。关于小程序的更新机制，可以查看运行机制文档。"><a href="#10-1-wx-getUpdateManager-获取全局唯一的版本更新管理器，用于管理小程序更新。关于小程序的更新机制，可以查看运行机制文档。" class="headerlink" title="10.1 wx.getUpdateManager  获取全局唯一的版本更新管理器，用于管理小程序更新。关于小程序的更新机制，可以查看运行机制文档。"></a>10.1 wx.getUpdateManager  获取全局唯一的版本更新管理器，用于管理小程序更新。关于小程序的更新机制，可以查看运行机制文档。</h3><p><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/operating-mechanism.html" target="_blank" rel="noopener">小程序运行机制</a></p>
<p>小程序启动会有两种情况，一种是「冷启动」，一种是「热启动」。（这个跟小车的启动方式么~）</p>
<ul>
<li>热启动：假如用户已经打开过某小程序，然后在一定时间内再次打开该小程序，此时无需重新启动，只需将后台态的小程序切换到前台，这个过程就是热启动；</li>
<li>冷启动：指的是用户首次打开或小程序被微信主动销毁后再次打开的情况，此时小程序需要重新加载启动。</li>
</ul>
<h3 id="10-2-UpdateManager-applyUpdate-强制小程序重启并使用新版本。"><a href="#10-2-UpdateManager-applyUpdate-强制小程序重启并使用新版本。" class="headerlink" title="10.2 UpdateManager.applyUpdate  强制小程序重启并使用新版本。"></a>10.2 UpdateManager.applyUpdate  强制小程序重启并使用新版本。</h3><p>在小程序新版本下载完成后（即收到 onUpdateReady 回调）调用。</p>
<h3 id="10-3-UpdateManager-onCheckForUpdate-监听向微信后台请求检查更新结果事件。"><a href="#10-3-UpdateManager-onCheckForUpdate-监听向微信后台请求检查更新结果事件。" class="headerlink" title="10.3 UpdateManager.onCheckForUpdate 监听向微信后台请求检查更新结果事件。"></a>10.3 UpdateManager.onCheckForUpdate 监听向微信后台请求检查更新结果事件。</h3><p>微信在小程序冷启动时自动检查更新，不需由开发者主动触发。</p>
<h3 id="10-4-UpdateManager-onUpdateFailed-监听小程序更新失败事件。"><a href="#10-4-UpdateManager-onUpdateFailed-监听小程序更新失败事件。" class="headerlink" title="10.4 UpdateManager.onUpdateFailed 监听小程序更新失败事件。"></a>10.4 UpdateManager.onUpdateFailed 监听小程序更新失败事件。</h3><p>小程序有新版本，客户端主动触发下载（无需开发者触发），下载失败（可能是网络原因等）后回调</p>
<h3 id="10-5-UpdateManager-onUpdateReady-监听小程序有版本更新事件。"><a href="#10-5-UpdateManager-onUpdateReady-监听小程序有版本更新事件。" class="headerlink" title="10.5 UpdateManager.onUpdateReady 监听小程序有版本更新事件。"></a>10.5 UpdateManager.onUpdateReady 监听小程序有版本更新事件。</h3><p>客户端主动触发下载（无需开发者触发），下载成功后回调</p>
<h3 id="10-6-完整示例代码"><a href="#10-6-完整示例代码" class="headerlink" title="10.6 完整示例代码"></a>10.6 完整示例代码</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> updateManager = wx.getUpdateManager()<span class="comment">//获取全局唯一的版本更新管理器，用于管理小程序更新。(更新管理器对象)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//监听向微信后台请求检查更新结果事件。微信在小程序冷启动时自动检查更新，不需由开发者主动触发。</span></span><br><span class="line">updateManager.onCheckForUpdate(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="comment">// 请求完新版本信息的回调</span></span><br><span class="line">  <span class="built_in">console</span>.log(res.hasUpdate)<span class="comment">//是否有新版本  boolean</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//监听小程序有版本更新事件。客户端主动触发下载（无需开发者触发），下载成功后回调</span></span><br><span class="line">updateManager.onUpdateReady(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  wx.showModal(&#123;</span><br><span class="line">    title: <span class="string">'更新提示'</span>,</span><br><span class="line">    content: <span class="string">'新版本已经准备好，是否重启应用？'</span>,</span><br><span class="line">    success: <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (res.confirm) &#123;</span><br><span class="line">        <span class="comment">// 新的版本已经下载好，调用 applyUpdate 应用新版本并重启</span></span><br><span class="line">        <span class="comment">// 强制小程序重启并使用新版本。在小程序新版本下载完成后（即收到 onUpdateReady 回调）调用。</span></span><br><span class="line">        updateManager.applyUpdate()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//监听小程序更新失败事件。小程序有新版本，客户端主动触发下载（无需开发者触发），下载失败（可能是网络原因等）后回调</span></span><br><span class="line">updateManager.onUpdateFailed(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 新版本下载失败</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>注意：Tips<br>微信开发者工具上可以通过「编译模式」下的「下次编译模拟更新」开关来调试<br>小程序开发版/体验版没有「版本」概念，所以无法在开发版/体验版上测试更版本更新情况</p>
<h2 id="十一、Worker（运行一些异步处理的任务）（就是变成语言中的单线程-与-多线程-js-中是单线程工作的）"><a href="#十一、Worker（运行一些异步处理的任务）（就是变成语言中的单线程-与-多线程-js-中是单线程工作的）" class="headerlink" title="十一、Worker（运行一些异步处理的任务）（就是变成语言中的单线程 与 多线程 js 中是单线程工作的）"></a>十一、Worker（运行一些异步处理的任务）（就是变成语言中的单线程 与 多线程 js 中是单线程工作的）</h2><p>Worker 实例，主线程中可通过 wx.createWorker 接口获取，worker 线程中可通过全局变量 worker 获取。</p>
<p>一些异步处理的任务，可以放置于 Worker 中运行，待运行结束后，再把结果返回到小程序主线程。Worker 运行于一个单独的全局上下文与线程中，不能直接调用主线程的方法。</p>
<p>Worker 与主线程之间的数据传输，双方使用 Worker.postMessage() 来发送数据，Worker.onMessage() 来接收数据，传输的数据并不是直接共享，而是被复制的。</p>
<h3 id="11-1-wx-createWorker-创建一个-Worker-线程。"><a href="#11-1-wx-createWorker-创建一个-Worker-线程。" class="headerlink" title="11.1 wx.createWorker   创建一个 Worker 线程。"></a>11.1 wx.createWorker   创建一个 Worker 线程。</h3><p>目前限制最多只能创建一个 Worker，创建下一个 Worker 前请先调用 Worker.terminate</p>
<h3 id="11-2-Worker-onMessage-监听主线程-Worker-线程向当前线程发送的消息的事件。"><a href="#11-2-Worker-onMessage-监听主线程-Worker-线程向当前线程发送的消息的事件。" class="headerlink" title="11.2 Worker.onMessage   监听主线程/Worker 线程向当前线程发送的消息的事件。"></a>11.2 Worker.onMessage   监听主线程/Worker 线程向当前线程发送的消息的事件。</h3><h3 id="11-3-Worker-postMessage-向主线程-Worker-线程发送的消息。"><a href="#11-3-Worker-postMessage-向主线程-Worker-线程发送的消息。" class="headerlink" title="11.3 Worker.postMessage  向主线程/Worker 线程发送的消息。"></a>11.3 Worker.postMessage  向主线程/Worker 线程发送的消息。</h3><p>语法：Worker.postMessage(Object message)</p>
<p>参数：需要发送的消息，必须是一个可序列化的 JavaScript 对象。</p>
<h3 id="11-4-Worker-terminate-结束当前-Worker-线程。"><a href="#11-4-Worker-terminate-结束当前-Worker-线程。" class="headerlink" title="11.4 Worker.terminate()   结束当前 Worker 线程。"></a>11.4 Worker.terminate()   结束当前 Worker 线程。</h3><p>仅限在主线程 worker 对象上调用。无参数</p>
<h3 id="11-5-完整的示例代码！！！！！！！！！！！！！"><a href="#11-5-完整的示例代码！！！！！！！！！！！！！" class="headerlink" title="11.5 完整的示例代码！！！！！！！！！！！！！"></a>11.5 完整的示例代码！！！！！！！！！！！！！</h3><p>运行以下代码需先进行基础配置，详细请查阅 多线程 文档了解基础知识和配置方法。</p>
<h4 id="11-5-1-使用流程：配置过程"><a href="#11-5-1-使用流程：配置过程" class="headerlink" title="11.5.1 使用流程：配置过程"></a>11.5.1 使用流程：配置过程</h4><p><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/workers.html" target="_blank" rel="noopener">官网网址</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> worker = wx.createWorker(<span class="string">'workers/request/index.js'</span>) <span class="comment">// 文件名指定 worker 的入口文件路径，绝对路径</span></span><br><span class="line"></span><br><span class="line">worker.onMessage(<span class="function">(<span class="params">res</span>)=&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">worker.postMessage(&#123;</span><br><span class="line">  msg: <span class="string">'hello worker'</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">worker.terminate()</span><br></pre></td></tr></table></figure>
<h2 id="十二、数据上报（小程序管理后台-运维中心-性能监控-业务数据监控）（说白了就是小程序的用户使用各种情况数据？？？）"><a href="#十二、数据上报（小程序管理后台-运维中心-性能监控-业务数据监控）（说白了就是小程序的用户使用各种情况数据？？？）" class="headerlink" title="十二、数据上报（小程序管理后台-运维中心-性能监控-业务数据监控）（说白了就是小程序的用户使用各种情况数据？？？）"></a>十二、数据上报（小程序管理后台-运维中心-性能监控-业务数据监控）（说白了就是小程序的用户使用各种情况数据？？？）</h2><h3 id="12-1-wx-reportMonitor-自定义业务数据监控上报接口。"><a href="#12-1-wx-reportMonitor-自定义业务数据监控上报接口。" class="headerlink" title="12.1 wx.reportMonitor 自定义业务数据监控上报接口。"></a>12.1 wx.reportMonitor 自定义业务数据监控上报接口。</h3><p>语法：wx.reportMonitor(string name, number value)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wx.reportMonitor(<span class="string">'1'</span>, <span class="number">1</span>)</span><br><span class="line"><span class="comment">// 参数 ① string 监控 ID，在「小程序管理后台」新建数据指标后获得</span></span><br><span class="line"><span class="comment">// 参数 ② number 上报数值，经处理后会在「小程序管理后台」上展示每分钟的上报总量</span></span><br></pre></td></tr></table></figure>
<p>使用前，需要在「小程序管理后台-运维中心-性能监控-业务数据监控」中新建监控事件，配置监控描述与告警类型。每一个监控事件对应唯一的监控 ID，开发者最多可以创建 128 个监控事件。</p>
<h2 id="十三、小程序（事件错误-与-生命周期）"><a href="#十三、小程序（事件错误-与-生命周期）" class="headerlink" title="十三、小程序（事件错误 与 生命周期）"></a>十三、小程序（事件错误 与 生命周期）</h2><h3 id="13-1-wx-offError-事件：取消监听小程序错误事件。"><a href="#13-1-wx-offError-事件：取消监听小程序错误事件。" class="headerlink" title="13.1 wx.offError 事件：取消监听小程序错误事件。"></a>13.1 wx.offError 事件：取消监听小程序错误事件。</h3><p>语法：wx.offError(function callback)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wx.offError(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="13-2-wx-onError-事件：监听小程序错误事件。如脚本错误或API调用报错等。？？？？？看不懂啊？？？？"><a href="#13-2-wx-onError-事件：监听小程序错误事件。如脚本错误或API调用报错等。？？？？？看不懂啊？？？？" class="headerlink" title="13.2 wx.onError 事件：监听小程序错误事件。如脚本错误或API调用报错等。？？？？？看不懂啊？？？？"></a>13.2 wx.onError 事件：监听小程序错误事件。如脚本错误或API调用报错等。？？？？？看不懂啊？？？？</h3><p>语法：wx.onError(function callback)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wx.offError(<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="comment">//错误信息，包含堆栈</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="13-3-wx-getLaunchOptionsSync-生命周期-：获取小程序启动时的参数。与-App-onLaunch-的回调参数一致。"><a href="#13-3-wx-getLaunchOptionsSync-生命周期-：获取小程序启动时的参数。与-App-onLaunch-的回调参数一致。" class="headerlink" title="13.3 wx.getLaunchOptionsSync 生命周期 ：获取小程序启动时的参数。与 App.onLaunch 的回调参数一致。"></a>13.3 wx.getLaunchOptionsSync 生命周期 ：获取小程序启动时的参数。与 App.onLaunch 的回调参数一致。</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = wx.getLaunchOptionsSync()</span><br><span class="line">obj.path<span class="comment">//打开小程序的路径</span></span><br><span class="line">obj.scene<span class="comment">//打开小程序的场景值  number</span></span><br><span class="line">obj.query<span class="comment">//打开小程序的启动参数 Object 所以原生的 onload 接收参数就是 option.query 就是这个 url 传参的对象!!!</span></span><br><span class="line">obj.shareTicket<span class="comment">//获取更多转发信息 String</span></span><br><span class="line">obj.referrerInfo<span class="comment">//Object 来源信息。从另一个小程序、公众号或 App 进入小程序时返回。否则返回 &#123;&#125;。(参见后文注意)</span></span><br><span class="line"></span><br><span class="line">referrerInfo:&#123;</span><br><span class="line">  appId:<span class="string">''</span>,<span class="comment">//来源小程序、公众号或 App 的 appId</span></span><br><span class="line">  extraData:&#123;</span><br><span class="line">    <span class="comment">//来源小程序传过来的数据，scene=1037 或 1038 时支持， 13.3.4 中的其他值呢？？？支持么？？？？</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="13-3-1-scene-场景值"><a href="#13-3-1-scene-场景值" class="headerlink" title="13.3.1 scene 场景值"></a>13.3.1 scene 场景值</h4><p><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/app-service/scene.html" target="_blank" rel="noopener">官网网址</a></p>
<p>1005 ，1104 等</p>
<ul>
<li>对于小程序，可以在 App 的 onLaunch 和 onShow，或 wx.getLaunchOptionsSync 中获取上述场景值。</li>
<li>对于小游戏，可以在 wx.getLaunchOptionsSync 和 wx.onShow 中获取上述场景值</li>
</ul>
<h5 id="小游戏于小程序什么区别？？？？？？"><a href="#小游戏于小程序什么区别？？？？？？" class="headerlink" title="小游戏于小程序什么区别？？？？？？"></a>小游戏于小程序什么区别？？？？？？</h5><p>部分场景值下还可以获取来源应用、公众号或小程序的 appId。</p>
<p>Tip: 由于 Android 系统限制，目前还无法获取到按 Home 键退出到桌面，然后从桌面再次进小程序的场景值，对于这种情况，会保留上一次的场景值。</p>
<h4 id="13-3-2-wx-getLaunchOptionsSync-返回有效-referrerInfo-的场景"><a href="#13-3-2-wx-getLaunchOptionsSync-返回有效-referrerInfo-的场景" class="headerlink" title="13.3.2  wx.getLaunchOptionsSync 返回有效 referrerInfo 的场景"></a>13.3.2  wx.getLaunchOptionsSync 返回有效 referrerInfo 的场景</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1020  公众号 profile 页相关小程序列表   来源公众号</span><br><span class="line">1035  公众号自定义菜单                 来源公众号</span><br><span class="line">1036  App 分享消息卡片                 来源App</span><br><span class="line">1037  小程序打开小程序                 来源小程序</span><br><span class="line">1038  从另一个小程序返回               来源小程序</span><br><span class="line">1043  公众号模板消息                   来源公众号</span><br></pre></td></tr></table></figure>
<h4 id="13-3-3-注意"><a href="#13-3-3-注意" class="headerlink" title="13.3.3 注意"></a>13.3.3 注意</h4><p>部分版本在无 referrerInfo 的时候会返回 undefined，建议使用 wx.canIUse 接口进行判断。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wx.canIUse(<span class="string">'options.referrerInfo &amp;&amp; options.referrerInfo.appId'</span>)</span><br></pre></td></tr></table></figure>
<h2 id="十四、基础（判断是否可以-某些-API-接口：当然是能用才可以用）"><a href="#十四、基础（判断是否可以-某些-API-接口：当然是能用才可以用）" class="headerlink" title="十四、基础（判断是否可以 某些 API 接口：当然是能用才可以用）"></a>十四、基础（判断是否可以 某些 API 接口：当然是能用才可以用）</h2><h3 id="14-1-wx-canIUse-判断小程序的API，回调，参数，组件等是否在当前版本可用。"><a href="#14-1-wx-canIUse-判断小程序的API，回调，参数，组件等是否在当前版本可用。" class="headerlink" title="14.1 wx.canIUse 判断小程序的API，回调，参数，组件等是否在当前版本可用。"></a>14.1 wx.canIUse 判断小程序的API，回调，参数，组件等是否在当前版本可用。</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">参数的写法：</span><br><span class="line">①： <span class="variable">$&#123;API&#125;</span>.<span class="variable">$&#123;method&#125;</span>.<span class="variable">$&#123;param&#125;</span>.<span class="variable">$&#123;options&#125;</span>  <span class="comment"># API.method.param.options</span></span><br><span class="line">②:  <span class="variable">$&#123;component&#125;</span>.<span class="variable">$&#123;attribute&#125;</span>.<span class="variable">$&#123;option&#125;</span>   <span class="comment"># component.attribute.option</span></span><br><span class="line">参数说明:</span><br><span class="line"><span class="variable">$&#123;API&#125;</span> 代表 API 名字</span><br><span class="line"><span class="variable">$&#123;method&#125;</span> 代表调用方式，有效值为<span class="built_in">return</span>, success, object, callback</span><br><span class="line"><span class="variable">$&#123;param&#125;</span> 代表参数或者返回值</span><br><span class="line"><span class="variable">$&#123;options&#125;</span> 代表参数的可选值</span><br><span class="line"><span class="variable">$&#123;component&#125;</span> 代表组件名字</span><br><span class="line"><span class="variable">$&#123;attribute&#125;</span> 代表组件属性</span><br><span class="line"><span class="variable">$&#123;option&#125;</span> 代表组件属性的可选值</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">wx.canIUse(<span class="string">'openBluetoothAdapter'</span>) <span class="comment">//API</span></span><br><span class="line">wx.canIUse(<span class="string">'getSystemInfoSync.return.screenWidth'</span>)<span class="comment">//API.method.options</span></span><br><span class="line">wx.canIUse(<span class="string">'getSystemInfo.success.screenWidth'</span>)<span class="comment">//API.method.options</span></span><br><span class="line">wx.canIUse(<span class="string">'showToast.object.image'</span>)</span><br><span class="line">wx.canIUse(<span class="string">'onCompassChange.callback.direction'</span>)</span><br><span class="line">wx.canIUse(<span class="string">'request.object.method.GET'</span>)<span class="comment">//？？？？？？？？？？？？？这个就看不懂了呀</span></span><br><span class="line"></span><br><span class="line">wx.canIUse(<span class="string">'live-player'</span>)</span><br><span class="line">wx.canIUse(<span class="string">'text.selectable'</span>)</span><br><span class="line">wx.canIUse(<span class="string">'button.open-type.contact'</span>)</span><br></pre></td></tr></table></figure>
<h2 id="十五、画布（是不是做动画的？？？？？后面再学习吧）"><a href="#十五、画布（是不是做动画的？？？？？后面再学习吧）" class="headerlink" title="十五、画布（是不是做动画的？？？？？后面再学习吧）"></a>十五、画布（是不是做动画的？？？？？后面再学习吧）</h2><h3 id="15-1-Color-颜色。可以用以下几种方式来表示-canvas-中使用的颜色："><a href="#15-1-Color-颜色。可以用以下几种方式来表示-canvas-中使用的颜色：" class="headerlink" title="15.1 Color 颜色。可以用以下几种方式来表示 canvas 中使用的颜色："></a>15.1 Color 颜色。可以用以下几种方式来表示 canvas 中使用的颜色：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># RGB 颜色：    如 'rgb(255, 0, 0)'</span></span><br><span class="line"><span class="comment"># RGBA 颜色：   如 'rgba(255, 0, 0, 0.3)' 带有透明度</span></span><br><span class="line"><span class="comment"># 16 进制颜色： 如 '#FF0000'，大小写不敏感</span></span><br><span class="line"><span class="comment"># 预定义的颜色： 如 'red'，   大小写不敏感</span></span><br></pre></td></tr></table></figure>
<p><a href="https://developers.weixin.qq.com/miniprogram/dev/api/canvas/Color.html" target="_blank" rel="noopener">预定义的颜色官网网址</a></p>
<h3 id="15-2-CanvasContext-是-canvas-组件的绘图上下文"><a href="#15-2-CanvasContext-是-canvas-组件的绘图上下文" class="headerlink" title="15.2 CanvasContext 是 canvas 组件的绘图上下文"></a>15.2 CanvasContext 是 canvas 组件的绘图上下文</h3><p><a href="https://developers.weixin.qq.com/miniprogram/dev/api/canvas/CanvasContext.fill.html" target="_blank" rel="noopener">官网地址</a></p>
<h4 id="15-2-1-wx-createCanvasContext（）-创建-创建-CanvasContext-对象"><a href="#15-2-1-wx-createCanvasContext（）-创建-创建-CanvasContext-对象" class="headerlink" title="15.2.1 wx.createCanvasContext（） 创建 创建 CanvasContext 对象"></a>15.2.1 wx.createCanvasContext（） 创建 创建 CanvasContext 对象</h4><p><strong>一个参数</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">canvas</span> <span class="attr">canvas-id</span>=<span class="string">"myCanvas"</span> <span class="attr">class</span>=<span class="string">"myCanvas"</span> &gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">onLoad()&#123;</span><br><span class="line">  <span class="comment">// 一、创建对象</span></span><br><span class="line">  <span class="keyword">const</span> ctx = wx.createCanvasContext(<span class="string">'myCanvas'</span>)<span class="comment">//</span></span><br><span class="line">  <span class="comment">//对应的参数</span></span><br><span class="line">  <span class="comment">// 参数 ① ：是 &lt;canvas&gt; 组件的  canvas-id  属性值</span></span><br><span class="line">  <span class="comment">//没有 this（省略第二个参数），则不在任何自定义组件内查找，就是重新绘制。？？？？</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>2 个参数</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">canvas</span> <span class="attr">canvas-id</span>=<span class="string">"canvasIn"</span> <span class="attr">class</span>=<span class="string">"canvas"</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">canvas</span> <span class="attr">canvas-id</span>=<span class="string">"canvasOut"</span> <span class="attr">class</span>=<span class="string">"canvas"</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">bindtap</span>=<span class="string">"openAndDraw"</span>&gt;</span>打开图片并绘制<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">bindtap</span>=<span class="string">"process"</span>&gt;</span>处理图像<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">bindtap</span>=<span class="string">"export"</span>&gt;</span>导出画布至图片<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">  openAndDraw() &#123;</span><br><span class="line">    wx.chooseImage(&#123;</span><br><span class="line">      success: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> ctx = wx.createCanvasContext(<span class="string">'canvasIn'</span>, <span class="keyword">this</span>);</span><br><span class="line">        ctx.drawImage(res.tempFilePaths[<span class="number">0</span>], <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">        ctx.draw()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">// 参数 ① ： 是 &lt;canvas&gt; 组件的  canvas-id  属性值</span></span><br><span class="line"><span class="comment">// 参数 ② ： 在自定义组件下，当前组件实例的 this，表示在这个自定义组件下查找拥有 canvas-id 的 &lt;canvas&gt; ，</span></span><br></pre></td></tr></table></figure>
<h4 id="15-2-1-CanvasContext-arc-与-CanvasContext-arcTo-绘制一段弧线"><a href="#15-2-1-CanvasContext-arc-与-CanvasContext-arcTo-绘制一段弧线" class="headerlink" title="15.2.1 CanvasContext.arc 与 CanvasContext.arcTo  绘制一段弧线"></a>15.2.1 CanvasContext.arc 与 CanvasContext.arcTo  绘制一段弧线</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">canvas</span> <span class="attr">canvas-id</span>=<span class="string">"myCanvas"</span> <span class="attr">class</span>=<span class="string">"myCanvas"</span> &gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">onLoad()&#123;</span><br><span class="line">  <span class="keyword">const</span> ctx = wx.createCanvasContext(<span class="string">'myCanvas'</span>)<span class="comment">//</span></span><br><span class="line">  <span class="comment">//对应的参数是 &lt;canvas&gt; 组件的  canvas-id  属性值</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//绘制弧线</span></span><br><span class="line">  ctx.arc(<span class="number">100</span>, <span class="number">75</span>, <span class="number">50</span>, <span class="number">0</span>, <span class="number">2</span> * <span class="built_in">Math</span>.PI)</span><br><span class="line">  <span class="comment">// 参数 ： ① 圆心 x 坐标, ② y 坐标,③ r 半径， ④ 起始弧度,单位弧度（在3点钟方向）???， ⑤ 终止弧度???，</span></span><br><span class="line">  <span class="comment">// ⑥ 弧度的方向是否是逆时针 number????</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//根据 控制点 和 半径 绘制圆弧路径</span></span><br><span class="line">  ctx.arcTo(<span class="number">0</span>, <span class="number">0</span>, <span class="number">50</span>, <span class="number">50</span>, <span class="number">50</span>)</span><br><span class="line">  <span class="comment">// 参数 ： ① 第 1 个控制点的 x 轴坐标, ② 第 1 个控制点的 y 轴坐标</span></span><br><span class="line">  <span class="comment">//         ③ 第2 个控制点的 x 轴坐标, ④  第 2 个控制点的 y 轴坐标，⑤ 圆弧的半径</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="15-2-2-CanvasContext-rect-绘制矩形"><a href="#15-2-2-CanvasContext-rect-绘制矩形" class="headerlink" title="15.2.2  CanvasContext.rect 绘制矩形"></a>15.2.2  CanvasContext.rect 绘制矩形</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">canvas</span> <span class="attr">canvas-id</span>=<span class="string">"myCanvas"</span> <span class="attr">class</span>=<span class="string">"myCanvas"</span> &gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">onLoad()&#123;</span><br><span class="line">  <span class="comment">// 一、创建对象</span></span><br><span class="line">  <span class="keyword">const</span> ctx = wx.createCanvasContext(<span class="string">'myCanvas'</span>)<span class="comment">//</span></span><br><span class="line">  <span class="comment">//对应的参数是 &lt;canvas&gt; 组件的  canvas-id  属性值</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//绘制矩形路径</span></span><br><span class="line">  ctx.rect(<span class="number">10</span>, <span class="number">10</span>, <span class="number">150</span>, <span class="number">75</span>)</span><br><span class="line">  <span class="comment">// 参数 ： ① 矩形路径左上角的横坐标, ② 矩形路径左上角的横坐标</span></span><br><span class="line">  <span class="comment">//         ③ 矩形路径的宽度         ④ 矩形路径的高度</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//清除画布上在该矩形区域内的内容</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="15-2-3-CanvasContext-bezierCurveTo-绘制三次方贝塞尔曲线路径。曲线的起始点为路径中前一个点。"><a href="#15-2-3-CanvasContext-bezierCurveTo-绘制三次方贝塞尔曲线路径。曲线的起始点为路径中前一个点。" class="headerlink" title="15.2.3  CanvasContext.bezierCurveTo() 绘制三次方贝塞尔曲线路径。曲线的起始点为路径中前一个点。"></a>15.2.3  CanvasContext.bezierCurveTo() 绘制三次方贝塞尔曲线路径。曲线的起始点为路径中前一个点。</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">canvas</span> <span class="attr">canvas-id</span>=<span class="string">"myCanvas"</span> <span class="attr">class</span>=<span class="string">"myCanvas"</span> &gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">onLoad()&#123;</span><br><span class="line">  <span class="comment">// 一、创建对象</span></span><br><span class="line">  <span class="keyword">const</span> ctx = wx.createCanvasContext(<span class="string">'myCanvas'</span>)<span class="comment">//</span></span><br><span class="line">  <span class="comment">//对应的参数是 &lt;canvas&gt; 组件的  canvas-id  属性值</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 二、</span></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">  ctx.setFillStyle(<span class="string">'#EEEEEE'</span>)<span class="comment">// 三、 设置填充色。</span></span><br><span class="line">  ctx.fill()<span class="comment">//对当前路径中的内容进行填充。无参数，颜色由 setFillStyle() 决定，没有设置的话就 默认的填充色为黑色。</span></span><br><span class="line">  <span class="comment">// 如果当前路径没有闭合，fill() 方法会将起点和终点进行连接，然后填充。也就数把弧度首位链接填充起来</span></span><br><span class="line"></span><br><span class="line">  ctx.beginPath()</span><br><span class="line">  ctx.moveTo(<span class="number">40</span>, <span class="number">75</span>)</span><br><span class="line">  ctx.lineTo(<span class="number">160</span>, <span class="number">75</span>)</span><br><span class="line">  ctx.moveTo(<span class="number">100</span>, <span class="number">15</span>)</span><br><span class="line">  ctx.lineTo(<span class="number">100</span>, <span class="number">135</span>)</span><br><span class="line">  ctx.setStrokeStyle(<span class="string">'#AAAAAA'</span>)</span><br><span class="line">  ctx.stroke()</span><br><span class="line"></span><br><span class="line">  ctx.setFontSize(<span class="number">12</span>)</span><br><span class="line">  ctx.setFillStyle(<span class="string">'black'</span>)</span><br><span class="line">  ctx.fillText(<span class="string">'0'</span>, <span class="number">165</span>, <span class="number">78</span>)</span><br><span class="line">  ctx.fillText(<span class="string">'0.5*PI'</span>, <span class="number">83</span>, <span class="number">145</span>)</span><br><span class="line">  ctx.fillText(<span class="string">'1*PI'</span>, <span class="number">15</span>, <span class="number">78</span>)</span><br><span class="line">  ctx.fillText(<span class="string">'1.5*PI'</span>, <span class="number">83</span>, <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Draw points</span></span><br><span class="line">  ctx.beginPath()</span><br><span class="line">  ctx.arc(<span class="number">100</span>, <span class="number">75</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span> * <span class="built_in">Math</span>.PI)</span><br><span class="line">  ctx.setFillStyle(<span class="string">'lightgreen'</span>)</span><br><span class="line">  ctx.fill()</span><br><span class="line"></span><br><span class="line">  ctx.beginPath()</span><br><span class="line">  ctx.arc(<span class="number">100</span>, <span class="number">25</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span> * <span class="built_in">Math</span>.PI)</span><br><span class="line">  ctx.setFillStyle(<span class="string">'blue'</span>)</span><br><span class="line">  ctx.fill()</span><br><span class="line"></span><br><span class="line">  ctx.beginPath()</span><br><span class="line">  ctx.arc(<span class="number">150</span>, <span class="number">75</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span> * <span class="built_in">Math</span>.PI)</span><br><span class="line">  ctx.setFillStyle(<span class="string">'red'</span>)</span><br><span class="line">  ctx.fill()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Draw arc</span></span><br><span class="line">  ctx.beginPath()</span><br><span class="line">  ctx.arc(<span class="number">100</span>, <span class="number">75</span>, <span class="number">50</span>, <span class="number">0</span>, <span class="number">1.5</span> * <span class="built_in">Math</span>.PI)</span><br><span class="line">  ctx.setStrokeStyle(<span class="string">'#333333'</span>)</span><br><span class="line">  ctx.stroke()</span><br><span class="line">  ctx.draw()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="15-3-CanvasGradient-渐变对象"><a href="#15-3-CanvasGradient-渐变对象" class="headerlink" title="15.3 CanvasGradient 渐变对象"></a>15.3 CanvasGradient 渐变对象</h3><h4 id="15-3-1-CanvasGradient-addColorStop-添加颜色的渐变点。"><a href="#15-3-1-CanvasGradient-addColorStop-添加颜色的渐变点。" class="headerlink" title="15.3.1 CanvasGradient.addColorStop 添加颜色的渐变点。"></a>15.3.1 CanvasGradient.addColorStop 添加颜色的渐变点。</h4><p>小于最小 stop 的部分会按最小 stop 的 color 来渲染，大于最大 stop 的部分会按最大 stop 的 color 来渲染</p>
<p>语法：CanvasGradient.addColorStop(number stop, Color color)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ctx = wx.createCanvasContext(<span class="string">'myCanvas'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create circular gradient</span></span><br><span class="line"><span class="keyword">const</span> grd = ctx.createLinearGradient(<span class="number">30</span>, <span class="number">10</span>, <span class="number">120</span>, <span class="number">10</span>)</span><br><span class="line">grd.addColorStop(<span class="number">0</span>, <span class="string">'red'</span>)<span class="comment">//  0 表示渐变中开始与结束之间的位置，范围 0-1。</span></span><br><span class="line">grd.addColorStop(<span class="number">0.16</span>, <span class="string">'orange'</span>)<span class="comment">// orange 渐变点的颜色。</span></span><br><span class="line">grd.addColorStop(<span class="number">0.33</span>, <span class="string">'yellow'</span>)</span><br><span class="line">grd.addColorStop(<span class="number">0.5</span>, <span class="string">'green'</span>)</span><br><span class="line">grd.addColorStop(<span class="number">0.66</span>, <span class="string">'cyan'</span>)</span><br><span class="line">grd.addColorStop(<span class="number">0.83</span>, <span class="string">'blue'</span>)</span><br><span class="line">grd.addColorStop(<span class="number">1</span>, <span class="string">'purple'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Fill with gradient</span></span><br><span class="line">ctx.setFillStyle(grd)</span><br><span class="line">ctx.fillRect(<span class="number">10</span>, <span class="number">10</span>, <span class="number">150</span>, <span class="number">80</span>)</span><br><span class="line">ctx.draw()</span><br></pre></td></tr></table></figure>
<h3 id="15-4-wx-canvasGetImageData-获取-canvas-区域隐含的像素数据。"><a href="#15-4-wx-canvasGetImageData-获取-canvas-区域隐含的像素数据。" class="headerlink" title="15.4 wx.canvasGetImageData 获取 canvas 区域隐含的像素数据。"></a>15.4 wx.canvasGetImageData 获取 canvas 区域隐含的像素数据。</h3><p>语法：wx.canvasGetImageData(Object object, Object this)</p>
<p>第二个参数：this 在自定义组件下，当前组件实例的this，以操作组件内 <canvas> 组件  可选</canvas></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">canvas</span> <span class="attr">canvas-id</span>=<span class="string">"canvasIn"</span> <span class="attr">class</span>=<span class="string">"canvas"</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">canvas</span> <span class="attr">canvas-id</span>=<span class="string">"canvasOut"</span> <span class="attr">class</span>=<span class="string">"canvas"</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">bindtap</span>=<span class="string">"openAndDraw"</span>&gt;</span>打开图片并绘制<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">bindtap</span>=<span class="string">"process"</span>&gt;</span>处理图像<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">bindtap</span>=<span class="string">"export"</span>&gt;</span>导出画布至图片<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> cfg = &#123;</span><br><span class="line">    x: <span class="number">0</span>,</span><br><span class="line">    y: <span class="number">0</span>,</span><br><span class="line">    width: <span class="number">300</span>,</span><br><span class="line">    height: <span class="number">300</span>,</span><br><span class="line">&#125;</span><br><span class="line">wx.canvasGetImageData(&#123;</span><br><span class="line">  canvasId: <span class="string">'canvasIn'</span>,<span class="comment">// 画布标识，传入 &lt;canvas&gt; 组件的 canvas-id 属性。  必填</span></span><br><span class="line">  <span class="comment">//x:0,//将要被提取的图像数据矩形区域的左上角横坐标 必填</span></span><br><span class="line">  <span class="comment">//y:0,//将要被提取的图像数据矩形区域的左上角纵坐标 必填</span></span><br><span class="line">  <span class="comment">//width:300,//将要被提取的图像数据矩形区域的宽度 必填</span></span><br><span class="line">  <span class="comment">//height:300,//将要被提取的图像数据矩形区域的高度 必填</span></span><br><span class="line">  ...cfg,<span class="comment">//以这种方法把上面的几个属性移到外面写</span></span><br><span class="line">  success: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> data = convertToGrayscale(res.data)</span><br><span class="line">    <span class="comment">//console.log(res.width) // 300 图像数据矩形的宽度</span></span><br><span class="line">    <span class="comment">//console.log(res.height) // 300 图像数据矩形的高度</span></span><br><span class="line">    <span class="comment">//console.log(res.data instanceof Uint8ClampedArray) // true</span></span><br><span class="line">    <span class="comment">//Uint8ClampedArray data  图像像素点数据，一维数组，每四项表示一个像素点的 rgba</span></span><br><span class="line">    <span class="comment">//console.log(res.data.length) // 300 * 300 * 4</span></span><br><span class="line">    wx.canvasPutImageData(&#123;</span><br><span class="line">      canvasId: <span class="string">'canvasOut'</span>,</span><br><span class="line">      data,</span><br><span class="line">      ...cfg,</span><br><span class="line">      success: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(res)</span><br><span class="line">      &#125;,</span><br><span class="line">      fail: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.error(err)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  fail: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(err)</span><br><span class="line">  &#125;,</span><br><span class="line">  complete:<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">  &#125;</span><br><span class="line"> )</span><br></pre></td></tr></table></figure>
<h3 id="15-5-wx-canvasPutImageData-将像素数据绘制到画布。"><a href="#15-5-wx-canvasPutImageData-将像素数据绘制到画布。" class="headerlink" title="15.5 wx.canvasPutImageData 将像素数据绘制到画布。"></a>15.5 wx.canvasPutImageData 将像素数据绘制到画布。</h3><p>在自定义组件下，第二个参数传入自定义组件实例 this，以操作组件内  <code>&lt;canvas&gt;</code> 组件</p>
<p>语法：wx.canvasPutImageData(Object object, Object this)</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">canvas</span> <span class="attr">canvas-id</span>=<span class="string">"canvasIn"</span> <span class="attr">class</span>=<span class="string">"canvas"</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">canvas</span> <span class="attr">canvas-id</span>=<span class="string">"canvasOut"</span> <span class="attr">class</span>=<span class="string">"canvas"</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">bindtap</span>=<span class="string">"openAndDraw"</span>&gt;</span>打开图片并绘制<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">bindtap</span>=<span class="string">"process"</span>&gt;</span>处理图像<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">bindtap</span>=<span class="string">"export"</span>&gt;</span>导出画布至图片<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">process() &#123;</span><br><span class="line">    <span class="keyword">const</span> cfg = &#123;</span><br><span class="line">      x: <span class="number">0</span>,</span><br><span class="line">      y: <span class="number">0</span>,</span><br><span class="line">      width: <span class="number">300</span>,</span><br><span class="line">      height: <span class="number">300</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 获取 canvas 区域隐含的像素数据。</span></span><br><span class="line">    wx.canvasGetImageData(&#123;</span><br><span class="line">      canvasId: <span class="string">'canvasIn'</span>,</span><br><span class="line">      ...cfg,</span><br><span class="line">      success: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> data = convertToGrayscale(res.data)<span class="comment">// 在这里定义了data</span></span><br><span class="line">        <span class="comment">//将像素数据绘制到画布。</span></span><br><span class="line">        wx.canvasPutImageData(&#123;</span><br><span class="line">          canvasId: <span class="string">'canvasOut'</span>,<span class="comment">// 画布标识，传入 &lt;canvas&gt; 组件的 canvas-id 属性。  必填</span></span><br><span class="line">          data,<span class="comment">//这样使用外面定义的参数，//Uint8ClampedArray  图像像素点数据，一维数组，每四项表示一个像素点的 rgba 必填</span></span><br><span class="line">            <span class="comment">//x:0,//将要被提取的图像数据矩形区域的左上角横坐标 必填</span></span><br><span class="line">            <span class="comment">//y:0,//将要被提取的图像数据矩形区域的左上角纵坐标 必填</span></span><br><span class="line">            <span class="comment">//width:300,//将要被提取的图像数据矩形区域的宽度 必填</span></span><br><span class="line">            <span class="comment">//height:300,//将要被提取的图像数据矩形区域的高度 必填</span></span><br><span class="line">          ...cfg,<span class="comment">//这样使用外面定义的参数对象</span></span><br><span class="line">          success: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(res)</span><br><span class="line">          &#125;,</span><br><span class="line">          fail: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.error(err)</span><br><span class="line">          &#125;,</span><br><span class="line">          complete:<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">            <span class="comment">//</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      fail: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.error(err)</span><br><span class="line">      &#125;,</span><br><span class="line">      complete:<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h3 id="15-6-wx-canvasToTempFilePath-把当前画布指定区域的内容导出生成指定大小的图片。"><a href="#15-6-wx-canvasToTempFilePath-把当前画布指定区域的内容导出生成指定大小的图片。" class="headerlink" title="15.6 wx.canvasToTempFilePath 把当前画布指定区域的内容导出生成指定大小的图片。"></a>15.6 wx.canvasToTempFilePath 把当前画布指定区域的内容导出生成指定大小的图片。</h3><p>在 draw() 回调里调用该方法才能保证图片导出成功。</p>
<p>语法：wx.canvasToTempFilePath(Object object, Object this)<br>第二个参数：在自定义组件下，当前组件实例的 this，以操作组件内  <code>&lt;canvas&gt;</code> 组件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">canvas</span> <span class="attr">canvas-id</span>=<span class="string">"canvasIn"</span> <span class="attr">class</span>=<span class="string">"canvas"</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">canvas</span> <span class="attr">canvas-id</span>=<span class="string">"canvasOut"</span> <span class="attr">class</span>=<span class="string">"canvas"</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">bindtap</span>=<span class="string">"openAndDraw"</span>&gt;</span>打开图片并绘制<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">bindtap</span>=<span class="string">"process"</span>&gt;</span>处理图像<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">bindtap</span>=<span class="string">"export"</span>&gt;</span>导出画布至图片<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span>() &#123;</span><br><span class="line">  <span class="keyword">const</span> cfg = &#123;</span><br><span class="line">    x: <span class="number">0</span>,</span><br><span class="line">    y: <span class="number">0</span>,</span><br><span class="line">    width: <span class="number">300</span>,</span><br><span class="line">    height: <span class="number">300</span>,</span><br><span class="line">    destWidth: <span class="number">100</span>,</span><br><span class="line">    destHeight: <span class="number">100</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//把当前画布指定区域的内容导出生成指定大小的图片。</span></span><br><span class="line">  wx.canvasToTempFilePath(&#123;</span><br><span class="line">    canvasId: <span class="string">'canvasOut'</span>,<span class="comment">// 画布标识，传入 &lt;canvas&gt; 组件的 canvas-id   必填</span></span><br><span class="line">    <span class="comment">//x:0,//将要被提取的图像数据矩形区域的左上角横坐标 否</span></span><br><span class="line">    <span class="comment">//y:0,//将要被提取的图像数据矩形区域的左上角纵坐标 否</span></span><br><span class="line">    <span class="comment">//width:300,//将要被提取的图像数据矩形区域的宽度  否   canvas宽度-x</span></span><br><span class="line">    <span class="comment">//height:300,//将要被提取的图像数据矩形区域的高度 否   canvas高度-y</span></span><br><span class="line">    <span class="comment">//destWidth: 100,//指定的画布区域的高度          否   width*屏幕像素密度</span></span><br><span class="line">    <span class="comment">//destHeight: 100//输出的图片的宽度              否   height*屏幕像素密度</span></span><br><span class="line">    ...cfg,<span class="comment">// 上面几个参数的外面 定义里面应用</span></span><br><span class="line">    fileType:<span class="string">'png'</span>,<span class="comment">// 目标文件的类型（jpg/png）      否  默认为 png 格式</span></span><br><span class="line">    quality:<span class="number">0.8</span>,<span class="comment">//图片的质量，目前仅对 jpg 有效。取值范围为 (0, 1]，不在范围内时当作 1.0 处理。  必填</span></span><br><span class="line">    success: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">//res.tempFilePath</span></span><br><span class="line">      wx.saveImageToPhotosAlbum(&#123;</span><br><span class="line">        filePath: res.tempFilePath,<span class="comment">//res.tempFilePath  生成文件的临时路径，wx.canvasToTempFilePath 接口的 成功回调</span></span><br><span class="line">        success: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(res)</span><br><span class="line">        &#125;,</span><br><span class="line">        fail: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">console</span>.error(err)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    fail: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.error(err)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, <span class="keyword">this</span>)<span class="comment">//第二个 参数 在自定义组件下，当前组件实例的this，以操作组件内 &lt;canvas&gt; 组件</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="15-7-完整的示例"><a href="#15-7-完整的示例" class="headerlink" title="15.7 完整的示例!!!!!!!!!!!!!!!!!!"></a>15.7 完整的示例!!!!!!!!!!!!!!!!!!</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">canvas</span> <span class="attr">canvas-id</span>=<span class="string">"canvasIn"</span> <span class="attr">class</span>=<span class="string">"canvas"</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">canvas</span> <span class="attr">canvas-id</span>=<span class="string">"canvasOut"</span> <span class="attr">class</span>=<span class="string">"canvas"</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">bindtap</span>=<span class="string">"openAndDraw"</span>&gt;</span>打开图片并绘制<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">bindtap</span>=<span class="string">"process"</span>&gt;</span>处理图像<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">bindtap</span>=<span class="string">"export"</span>&gt;</span>导出画布至图片<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>
 <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">convertToGrayscale</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> g = <span class="number">0</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; data.length; i += <span class="number">4</span>) &#123;</span><br><span class="line">    g = (data[i] * <span class="number">0.3</span> + data[i+<span class="number">1</span>] * <span class="number">0.59</span> + data[i+<span class="number">2</span>] * <span class="number">0.11</span>)</span><br><span class="line">    data[i] = g</span><br><span class="line">    data[i+<span class="number">1</span>] = g</span><br><span class="line">    data[i+<span class="number">2</span>] = g</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Page(&#123;</span><br><span class="line">  onReady() &#123;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line"><span class="comment">//打开图片并绘制</span></span><br><span class="line">  openAndDraw() &#123;</span><br><span class="line">    wx.chooseImage(&#123;</span><br><span class="line">      success: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> ctx = wx.createCanvasContext(<span class="string">'canvasIn'</span>, <span class="keyword">this</span>); <span class="comment">//wx.createCanvasContext 创建上下文对象</span></span><br><span class="line">        ctx.drawImage(res.tempFilePaths[<span class="number">0</span>], <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">        ctx.draw()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line"> <span class="comment">//导出画布至图片</span></span><br><span class="line">  <span class="keyword">export</span>() &#123;</span><br><span class="line">    wx.canvasToTempFilePath(&#123;</span><br><span class="line">      canvasId: <span class="string">'canvasOut'</span>,</span><br><span class="line">      success: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        wx.saveImageToPhotosAlbum(&#123;</span><br><span class="line">          filePath: res.tempFilePath,</span><br><span class="line">          success: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(res)</span><br><span class="line">          &#125;,</span><br><span class="line">          fail: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.error(err)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      fail: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.error(err)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, <span class="keyword">this</span>)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line"><span class="comment">//处理图像</span></span><br><span class="line">  process() &#123;</span><br><span class="line">    <span class="keyword">const</span> cfg = &#123;</span><br><span class="line">      x: <span class="number">0</span>,</span><br><span class="line">      y: <span class="number">0</span>,</span><br><span class="line">      width: <span class="number">300</span>,</span><br><span class="line">      height: <span class="number">300</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    wx.canvasGetImageData(&#123;</span><br><span class="line">      canvasId: <span class="string">'canvasIn'</span>,</span><br><span class="line">      ...cfg,</span><br><span class="line">      success: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> data = convertToGrayscale(res.data)</span><br><span class="line">        wx.canvasPutImageData(&#123;</span><br><span class="line">          canvasId: <span class="string">'canvasOut'</span>,</span><br><span class="line">          data,</span><br><span class="line">          ...cfg,</span><br><span class="line">          success: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(res)</span><br><span class="line">          &#125;,</span><br><span class="line">          fail: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.error(err)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">      fail: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.error(err)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="十六、调试（开发过程中对-小程序代码的调试）"><a href="#十六、调试（开发过程中对-小程序代码的调试）" class="headerlink" title="十六、调试（开发过程中对 小程序代码的调试）"></a>十六、调试（开发过程中对 小程序代码的调试）</h2><h3 id="16-1-LogManager-日志管理器实例，"><a href="#16-1-LogManager-日志管理器实例，" class="headerlink" title="16.1 LogManager 日志管理器实例，"></a>16.1 LogManager 日志管理器实例，</h3><p>可以通过 wx.getLogManager 获取。</p>
<ul>
<li>最多保存 5M 的日志内容，超过 5M 后，旧的日志内容会被删除。</li>
<li>用户可以通过使用 <code>&lt;Button&gt;</code> 组件的 <code>open-type=&quot;feedback&quot;</code> 来上传打印的日志。</li>
<li>开发者可以通过小程序管理后台左侧菜单“客服反馈”页面查看。日志</li>
</ul>
<p>基础库默认会把 App、Page 的生命周期函数和 wx 命名空间下的函数调用写入日志。？？？？？？什么东西？？</p>
<h4 id="16-1-1-wx-getLogManager-创建-日志管理器实例-对象"><a href="#16-1-1-wx-getLogManager-创建-日志管理器实例-对象" class="headerlink" title="16.1.1 wx.getLogManager  创建 日志管理器实例 对象"></a>16.1.1 wx.getLogManager  创建 日志管理器实例 对象</h4><p>参数：取值为 0/1，<br>取值为0：表示是否会把 App、Page 的生命周期函数和 wx 命名空间下的函数调用写入日志，默认值是 0<br>取值为1 ：则不会….写入日志</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> logger = wx.getLogManager()<span class="comment">// 不给参数 默认为 0</span></span><br><span class="line">logger.log(&#123;<span class="attr">str</span>: <span class="string">'hello world'</span>&#125;, <span class="string">'basic log'</span>, <span class="number">100</span>, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line">logger.info(&#123;<span class="attr">str</span>: <span class="string">'hello world'</span>&#125;, <span class="string">'info log'</span>, <span class="number">100</span>, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line">logger.debug(&#123;<span class="attr">str</span>: <span class="string">'hello world'</span>&#125;, <span class="string">'debug log'</span>, <span class="number">100</span>, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line">logger.warn(&#123;<span class="attr">str</span>: <span class="string">'hello world'</span>&#125;, <span class="string">'warn log'</span>, <span class="number">100</span>, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br></pre></td></tr></table></figure>
<h4 id="16-1-2-LogManager-debug-写-debug-日志"><a href="#16-1-2-LogManager-debug-写-debug-日志" class="headerlink" title="16.1.2 LogManager.debug  写 debug 日志"></a>16.1.2 LogManager.debug  写 debug 日志</h4><p>Object|Array.<any>|number|string …args<br>日志内容，可以有任意多个。每次调用的参数的总大小不超过100Kb</any></p>
<h4 id="16-1-3-LogManager-info-写-info-日志"><a href="#16-1-3-LogManager-info-写-info-日志" class="headerlink" title="16.1.3 LogManager.info   写 info 日志"></a>16.1.3 LogManager.info   写 info 日志</h4><p>Object|Array.<any>|number|string …args<br>日志内容，可以有任意多个。每次调用的参数的总大小不超过100Kb</any></p>
<h4 id="16-1-4-LogManager-log-写-log-日志"><a href="#16-1-4-LogManager-log-写-log-日志" class="headerlink" title="16.1.4 LogManager.log    写 log 日志"></a>16.1.4 LogManager.log    写 log 日志</h4><p>Object|Array.<any>|number|string …args<br>日志内容，可以有任意多个。每次调用的参数的总大小不超过100Kb</any></p>
<h4 id="16-1-5-LogManager-warn-写-warn-日志"><a href="#16-1-5-LogManager-warn-写-warn-日志" class="headerlink" title="16.1.5 LogManager.warn   写 warn 日志"></a>16.1.5 LogManager.warn   写 warn 日志</h4><p>Object|Array.<any>|number|string …args<br>日志内容，可以有任意多个。每次调用的参数的总大小不超过100Kb</any></p>
<h3 id="16-2-wx-setEnableDebug-设置是否打开调试开关。此开关对正式版也能生效。"><a href="#16-2-wx-setEnableDebug-设置是否打开调试开关。此开关对正式版也能生效。" class="headerlink" title="16.2 wx.setEnableDebug 设置是否打开调试开关。此开关对正式版也能生效。"></a>16.2 wx.setEnableDebug 设置是否打开调试开关。此开关对正式版也能生效。</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wx.setEnableDebug(&#123;</span><br><span class="line">  enableDebug:<span class="literal">true</span>,<span class="comment">//是否打开调试  必填</span></span><br><span class="line">  success(res)&#123;&#125;,<span class="comment">//回调函数</span></span><br><span class="line">  fail(res)&#123;&#125;,<span class="comment">//回调函数</span></span><br><span class="line">  complete(res)&#123;&#125;<span class="comment">//回调函数</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="16-2-1-在正式版打开调试还有一种方法，就是先在开发版或体验版打开调试，再切到正式版就能看到vConsole。"><a href="#16-2-1-在正式版打开调试还有一种方法，就是先在开发版或体验版打开调试，再切到正式版就能看到vConsole。" class="headerlink" title="16.2.1 在正式版打开调试还有一种方法，就是先在开发版或体验版打开调试，再切到正式版就能看到vConsole。"></a>16.2.1 在正式版打开调试还有一种方法，就是先在开发版或体验版打开调试，再切到正式版就能看到vConsole。</h4><h3 id="16-3-console-向调试面板中打印日志。console-是一个全局对象，可以直接访问。"><a href="#16-3-console-向调试面板中打印日志。console-是一个全局对象，可以直接访问。" class="headerlink" title="16.3 console 向调试面板中打印日志。console 是一个全局对象，可以直接访问。"></a>16.3 console 向调试面板中打印日志。console 是一个全局对象，可以直接访问。</h3><p>console 是一个全局对象，可以直接访问。在微信客户端中，向 vConsole 中输出日志。</p>
<h4 id="16-3-1-console-debug-向调试面板中打印-debug-日志"><a href="#16-3-1-console-debug-向调试面板中打印-debug-日志" class="headerlink" title="16.3.1  console.debug 向调试面板中打印 debug 日志"></a>16.3.1  console.debug 向调试面板中打印 debug 日志</h4><p>any …args<br>日志内容，可以有任意多个。</p>
<h4 id="16-3-2-console-error-向调试面板中打印-error-日志"><a href="#16-3-2-console-error-向调试面板中打印-error-日志" class="headerlink" title="16.3.2  console.error 向调试面板中打印 error 日志"></a>16.3.2  console.error 向调试面板中打印 error 日志</h4><p>any …args<br>日志内容，可以有任意多个。</p>
<h4 id="16-3-3-console-group-在调试面板中创建一个新的分组。"><a href="#16-3-3-console-group-在调试面板中创建一个新的分组。" class="headerlink" title="16.3.3  console.group 在调试面板中创建一个新的分组。"></a>16.3.3  console.group 在调试面板中创建一个新的分组。</h4><p>console.group(string label)  分组标记，可选。<br>注意：仅在工具中有效，在 vConsole 中为空函数实现。</p>
<p>随后输出的内容都会被添加一个缩进，表示该内容属于当前分组。调用 console.groupEnd之后分组结束。</p>
<h4 id="16-3-1-console-groupEnd-结束由-console-group-创建的分组"><a href="#16-3-1-console-groupEnd-结束由-console-group-创建的分组" class="headerlink" title="16.3.1  console.groupEnd() 结束由 console.group 创建的分组,"></a>16.3.1  console.groupEnd() 结束由 console.group 创建的分组,</h4><p>无参数<br>注意：仅在工具中有效，在 vConsole 中为空函数实现。</p>
<h4 id="16-3-4-console-info-向调试面板中打印-info-日志"><a href="#16-3-4-console-info-向调试面板中打印-info-日志" class="headerlink" title="16.3.4  console.info 向调试面板中打印 info 日志"></a>16.3.4  console.info 向调试面板中打印 info 日志</h4><p>any …args<br>日志内容，可以有任意多个。</p>
<h4 id="16-3-5-console-log-向调试面板中打印-log-日志"><a href="#16-3-5-console-log-向调试面板中打印-log-日志" class="headerlink" title="16.3.5  console.log 向调试面板中打印 log 日志"></a>16.3.5  console.log 向调试面板中打印 log 日志</h4><p>any …args<br>日志内容，可以有任意多个。</p>
<h4 id="16-3-6-console-warn-向调试面板中打印-warn-日志"><a href="#16-3-6-console-warn-向调试面板中打印-warn-日志" class="headerlink" title="16.3.6  console.warn 向调试面板中打印 warn 日志"></a>16.3.6  console.warn 向调试面板中打印 warn 日志</h4><p>any …args<br>日志内容，可以有任意多个。</p>
<h4 id="16-3-7-注意事项"><a href="#16-3-7-注意事项" class="headerlink" title="16.3.7 注意事项"></a>16.3.7 注意事项</h4><ul>
<li>由于 vConsole 功能有限，以及不同客户端对 console 方法的支持情况有差异，建议开发者在小程序中只使用本文档中提供的方法。</li>
<li>部分内容展示的限制请参见<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/usability/debug.html" target="_blank" rel="noopener">调试</a></li>
</ul>
<h2 id="十七、第三方平台"><a href="#十七、第三方平台" class="headerlink" title="十七、第三方平台"></a>十七、第三方平台</h2><h3 id="17-1-wx-getExtConfig-获取第三方平台自定义的数据字段。"><a href="#17-1-wx-getExtConfig-获取第三方平台自定义的数据字段。" class="headerlink" title="17.1 wx.getExtConfig 获取第三方平台自定义的数据字段。"></a>17.1 wx.getExtConfig 获取第三方平台自定义的数据字段。</h3><p>语法：wx.getExtConfig(Object object)</p>
<h4 id="17-1-1-本接口暂时无法通过-wx-canIUse-判断是否兼容，开发者需要自行判断-wx-getExtConfig-是否存在来兼容"><a href="#17-1-1-本接口暂时无法通过-wx-canIUse-判断是否兼容，开发者需要自行判断-wx-getExtConfig-是否存在来兼容" class="headerlink" title="17.1.1  本接口暂时无法通过 wx.canIUse 判断是否兼容，开发者需要自行判断 wx.getExtConfig 是否存在来兼容"></a>17.1.1  本接口暂时无法通过 wx.canIUse 判断是否兼容，开发者需要自行判断 wx.getExtConfig 是否存在来兼容</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (wx.getExtConfig) &#123;<span class="comment">// 判断兼容</span></span><br><span class="line">  wx.getExtConfig(&#123;</span><br><span class="line">    success(res)&#123;</span><br><span class="line">      res.extConfig<span class="comment">// Object  第三方平台自定义的数据</span></span><br><span class="line">    &#125;,</span><br><span class="line">    fail()&#123;&#125;,</span><br><span class="line">    complete()&#123;&#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="17-2-wx-getExtConfigSync-是-wx-getExtConfig-的同步版本。-无参数"><a href="#17-2-wx-getExtConfigSync-是-wx-getExtConfig-的同步版本。-无参数" class="headerlink" title="17.2 wx.getExtConfigSync() 是 wx.getExtConfig 的同步版本。 无参数!!!!!!!!!!!"></a>17.2 wx.getExtConfigSync() 是 wx.getExtConfig 的同步版本。 无参数!!!!!!!!!!!</h3><p>语法：Object getExtConfigSync()</p>
<h4 id="17-2-1-本接口暂时无法通过-wx-canIUse-判断是否兼容，开发者需要自行判断-wx-getExtConfigSync-是否存在来兼容"><a href="#17-2-1-本接口暂时无法通过-wx-canIUse-判断是否兼容，开发者需要自行判断-wx-getExtConfigSync-是否存在来兼容" class="headerlink" title="17.2.1  本接口暂时无法通过 wx.canIUse 判断是否兼容，开发者需要自行判断 wx.getExtConfigSync 是否存在来兼容"></a>17.2.1  本接口暂时无法通过 wx.canIUse 判断是否兼容，开发者需要自行判断 wx.getExtConfigSync 是否存在来兼容</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> extConfig = wx.getExtConfigSync? wx.getExtConfigSync(): &#123;&#125;</span><br><span class="line"><span class="built_in">console</span>.log(extConfig)</span><br></pre></td></tr></table></figure>
<h3 id="17-3-wx-getExtConfigSync（）-与-wx-getExtConfig（obj）-的区别？？？？？？？？？？？？？？？？？？"><a href="#17-3-wx-getExtConfigSync（）-与-wx-getExtConfig（obj）-的区别？？？？？？？？？？？？？？？？？？" class="headerlink" title="17.3 wx.getExtConfigSync（） 与 wx.getExtConfig（obj） 的区别？？？？？？？？？？？？？？？？？？"></a>17.3 wx.getExtConfigSync（） 与 wx.getExtConfig（obj） 的区别？？？？？？？？？？？？？？？？？？</h3><p>wx.getExtConfigSync（） 是不带参数的，它的返回值就是  extConfig  对象，也就是 第三方数据字段。</p>
<p>wx.getExtConfig(obj)  带参数，返回值在 success 回调函数里面。</p>
<h2 id="十八、地图-map"><a href="#十八、地图-map" class="headerlink" title="十八、地图 map"></a>十八、地图 map</h2><h3 id="18-1-MapContext-map-上下文-MapContext-对象。"><a href="#18-1-MapContext-map-上下文-MapContext-对象。" class="headerlink" title="18.1 MapContext         map 上下文 MapContext 对象。"></a>18.1 MapContext         map 上下文 MapContext 对象。</h3><p>mapContext 通过 id 跟一个 <code>&lt;map&gt;</code> 组件绑定，操作对应的 <code>&lt;map&gt;</code> 组件。</p>
<h3 id="18-2-wx-createMapContext-创建-map-上下文-MapContext-对象。"><a href="#18-2-wx-createMapContext-创建-map-上下文-MapContext-对象。" class="headerlink" title="18.2 wx.createMapContext 创建 map 上下文 MapContext 对象。"></a>18.2 wx.createMapContext 创建 map 上下文 MapContext 对象。</h3><p>语法：MapContext wx.createMapContext(string mapId, Object this)</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">map</span> <span class="attr">id</span>=<span class="string">"map"</span> <span class="attr">longitude</span>=<span class="string">"&#123;&#123;longitude&#125;&#125;"</span> <span class="attr">latitude</span>=<span class="string">"&#123;&#123;latitude&#125;&#125;"</span> <span class="attr">show-location</span> <span class="attr">scale</span>=<span class="string">"12"</span> <span class="attr">style</span>=<span class="string">"width: 100%; height: 00px;"</span>&gt;</span><span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">onReady: <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">  <span class="comment">//关联&lt;map /&gt;组件</span></span><br><span class="line">  <span class="keyword">this</span>.mapCtx = wx.createMapContext(<span class="string">'map'</span>) <span class="comment">// 创建 map 上下文 MapContext 对象。</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h3 id="18-3-MapContext-getCenterLocation-获取当前地图中心的经纬度。返回的是-gcj02-坐标系，可以用于-wx-openLocation"><a href="#18-3-MapContext-getCenterLocation-获取当前地图中心的经纬度。返回的是-gcj02-坐标系，可以用于-wx-openLocation" class="headerlink" title="18.3  MapContext.getCenterLocation 获取当前地图中心的经纬度。返回的是 gcj02 坐标系，可以用于 wx.openLocation()"></a>18.3  MapContext.getCenterLocation 获取当前地图中心的经纬度。返回的是 gcj02 坐标系，可以用于 wx.openLocation()</h3><p>语法：MapContext.getCenterLocation(Object object)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 以下 为 mina 框架写法</span></span><br><span class="line">onReady(e)&#123;</span><br><span class="line">  <span class="comment">//关联&lt;map /&gt;组件</span></span><br><span class="line">  <span class="keyword">this</span>.mapCtx = wx.createMapContext(<span class="string">'map'</span>) <span class="comment">// 创建 map 上下文 MapContext 对象。</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">//获取地图中心点</span></span><br><span class="line">getCenterPoint(e)&#123;</span><br><span class="line">  <span class="keyword">var</span> that = <span class="keyword">this</span>;</span><br><span class="line">  <span class="keyword">this</span>.mapCtx.getCenterLocation(&#123;</span><br><span class="line">    success(res)&#123;</span><br><span class="line">      that.setData(&#123;</span><br><span class="line">        longitude: res.longitude,<span class="comment">//经度,number</span></span><br><span class="line">        latitude: res.latitude<span class="comment">//纬度,number</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    fail(res)&#123;&#125;,</span><br><span class="line">    complete(res)&#123;&#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="comment">// wepy 框架</span></span><br><span class="line">onReady(e)&#123;</span><br><span class="line">  <span class="comment">//关联&lt;map /&gt;组件</span></span><br><span class="line">  <span class="keyword">this</span>.mapCtx = wx.createMapContext(<span class="string">'map'</span>) <span class="comment">// 创建 map 上下文 MapContext 对象。</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">//获取地图中心点</span></span><br><span class="line">getCenterPoint(e)&#123;</span><br><span class="line">  <span class="keyword">var</span> that = <span class="keyword">this</span>;</span><br><span class="line">  <span class="keyword">this</span>.mapCtx.getCenterLocation(&#123;</span><br><span class="line">    success(res)&#123;</span><br><span class="line">      that.longitude = res.longitude,<span class="comment">//经度,number</span></span><br><span class="line">      that.latitude = res.latitude<span class="comment">//纬度,number</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    fail(res)&#123;&#125;,</span><br><span class="line">    complete()&#123;res&#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h3 id="18-3-MapContext-getRegion-获取当前地图的视野范围"><a href="#18-3-MapContext-getRegion-获取当前地图的视野范围" class="headerlink" title="18.3  MapContext.getRegion 获取当前地图的视野范围"></a>18.3  MapContext.getRegion 获取当前地图的视野范围</h3><p>语法:MapContext.getRegion(Object object)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 以下 为 mina 框架写法</span></span><br><span class="line">onReady(e)&#123;</span><br><span class="line">  <span class="comment">//关联&lt;map /&gt;组件</span></span><br><span class="line">  <span class="keyword">this</span>.mapCtx = wx.createMapContext(<span class="string">'map'</span>) <span class="comment">// 创建 map 上下文 MapContext 对象。</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">//获取视野范围</span></span><br><span class="line">getRegionFunc(e)&#123;</span><br><span class="line">  <span class="keyword">var</span> that = <span class="keyword">this</span>;</span><br><span class="line">  <span class="keyword">this</span>.mapCtx.getRegion(&#123;</span><br><span class="line">    success(res)&#123;</span><br><span class="line">      that.setData(&#123;</span><br><span class="line">        southwest: res.southwest,<span class="comment">//西南角经纬度,number</span></span><br><span class="line">        northeast: res.latitude<span class="comment">//东北角经纬度,number</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    fail(res)&#123;&#125;,</span><br><span class="line">    complete(res)&#123;&#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="comment">// wepy 框架</span></span><br><span class="line">onReady(e)&#123;</span><br><span class="line">  <span class="comment">//关联&lt;map /&gt;组件</span></span><br><span class="line">  <span class="keyword">this</span>.mapCtx = wx.createMapContext(<span class="string">'map'</span>) <span class="comment">// 创建 map 上下文 MapContext 对象。</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">//获取视野范围</span></span><br><span class="line">getRegionFunc(e)&#123;</span><br><span class="line">  <span class="keyword">var</span> that = <span class="keyword">this</span>;</span><br><span class="line">  <span class="keyword">this</span>.mapCtx.getRegion(&#123;</span><br><span class="line">    success(res)&#123;</span><br><span class="line">      that.southwest = res.southwest,<span class="comment">//西南角经纬度,number</span></span><br><span class="line">      that.northeast = res.northeast<span class="comment">//东北角经纬度,number</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    fail(res)&#123;&#125;,</span><br><span class="line">    complete()&#123;res&#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h3 id="18-3-MapContext-getScale-获取当前地图的缩放级别"><a href="#18-3-MapContext-getScale-获取当前地图的缩放级别" class="headerlink" title="18.3  MapContext.getScale 获取当前地图的缩放级别"></a>18.3  MapContext.getScale 获取当前地图的缩放级别</h3><p>语法:MapContext.getScale(Object object)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 以下 为 mina 框架写法</span></span><br><span class="line">onReady(e)&#123;</span><br><span class="line">  <span class="comment">//关联&lt;map /&gt;组件</span></span><br><span class="line">  <span class="keyword">this</span>.mapCtx = wx.createMapContext(<span class="string">'map'</span>) <span class="comment">// 创建 map 上下文 MapContext 对象。</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">//获取缩放级别</span></span><br><span class="line">getScaleFunc(e)&#123;</span><br><span class="line">  <span class="keyword">var</span> that = <span class="keyword">this</span>;</span><br><span class="line">  <span class="keyword">this</span>.mapCtx.getScale(&#123;</span><br><span class="line">    success(res)&#123;</span><br><span class="line">      that.setData(&#123;</span><br><span class="line">        scale: res.scale<span class="comment">//缩放值,number</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    fail(res)&#123;&#125;,</span><br><span class="line">    complete(res)&#123;&#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="comment">// wepy 框架</span></span><br><span class="line">onReady(e)&#123;</span><br><span class="line">  <span class="comment">//关联&lt;map /&gt;组件</span></span><br><span class="line">  <span class="keyword">this</span>.mapCtx = wx.createMapContext(<span class="string">'map'</span>) <span class="comment">// 创建 map 上下文 MapContext 对象。</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">//缩放级别</span></span><br><span class="line">getScaleFunc(e)&#123;</span><br><span class="line">  <span class="keyword">var</span> that = <span class="keyword">this</span>;</span><br><span class="line">  <span class="keyword">this</span>.mapCtx.getScale(&#123;</span><br><span class="line">    success(res)&#123;</span><br><span class="line">      that.scale = res.scale<span class="comment">//缩放值,number</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    fail(res)&#123;&#125;,</span><br><span class="line">    complete()&#123;res&#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h3 id="18-3-MapContext-includePoints-缩放视野展示所有经纬度"><a href="#18-3-MapContext-includePoints-缩放视野展示所有经纬度" class="headerlink" title="18.3  MapContext.includePoints 缩放视野展示所有经纬度"></a>18.3  MapContext.includePoints 缩放视野展示所有经纬度</h3><p>语法:MapContext.includePoints(Object object)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 以下 为 mina 框架写法</span></span><br><span class="line">onReady(e)&#123;</span><br><span class="line">  <span class="comment">//关联&lt;map /&gt;组件</span></span><br><span class="line">  <span class="keyword">this</span>.mapCtx = wx.createMapContext(<span class="string">'map'</span>) <span class="comment">// 创建 map 上下文 MapContext 对象。</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">//获取 缩放视野展示所有经纬度</span></span><br><span class="line">getIncludePointsFunc(e)&#123;</span><br><span class="line">  <span class="keyword">var</span> that = <span class="keyword">this</span>;</span><br><span class="line">  <span class="keyword">this</span>.mapCtx.includePoints(&#123;</span><br><span class="line">    points:[<span class="comment">// 要显示在可视区域内的坐标点列表   必填</span></span><br><span class="line">      &#123;</span><br><span class="line">        latitude: <span class="number">30.4919168</span>,<span class="comment">//纬度</span></span><br><span class="line">        longitude: <span class="number">114.3061654</span><span class="comment">//经度</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        latitude: <span class="number">30.4919168</span>,</span><br><span class="line">        longitude: <span class="number">114.3061654</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    padding:[],<span class="comment">// 否  坐标点形成的矩形边缘到地图边缘的距离，单位像素。</span></span><br><span class="line">    <span class="comment">//格式为[上,右,下,左]，安卓上只能识别数组第一项，上下左右的padding一致。开发者工具暂不支持padding参数。</span></span><br><span class="line">    success(res)&#123;</span><br><span class="line">      that.setData(&#123;</span><br><span class="line">        scale: res.scale<span class="comment">//缩放值,number</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    fail(res)&#123;&#125;,</span><br><span class="line">    complete(res)&#123;&#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="comment">// wepy 框架</span></span><br><span class="line">onReady(e)&#123;</span><br><span class="line">  <span class="comment">//关联&lt;map /&gt;组件</span></span><br><span class="line">  <span class="keyword">this</span>.mapCtx = wx.createMapContext(<span class="string">'map'</span>) <span class="comment">// 创建 map 上下文 MapContext 对象。</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 缩放视野展示所有经纬度</span></span><br><span class="line">getIncludePointsFunc(e)&#123;</span><br><span class="line">  <span class="keyword">var</span> that = <span class="keyword">this</span>;</span><br><span class="line">  <span class="keyword">this</span>.mapCtx.includePoints(&#123;</span><br><span class="line">    success(res)&#123;</span><br><span class="line">      that.scale = res.scale<span class="comment">//缩放值,number</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    fail(res)&#123;&#125;,</span><br><span class="line">    complete()&#123;res&#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<h3 id="18-3-MapContext-moveToLocation-将地图中心移动到当前定位点。-无参数"><a href="#18-3-MapContext-moveToLocation-将地图中心移动到当前定位点。-无参数" class="headerlink" title="18.3  MapContext.moveToLocation() 将地图中心移动到当前定位点。  无参数"></a>18.3  MapContext.moveToLocation() 将地图中心移动到当前定位点。  无参数</h3><p>语法：MapContext.moveToLocation()</p>
<p>需要配合 map 组件的 show-location 使用，<code>&lt;map&gt;</code> 组件中要有 <code>show-location</code> 属性</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">map</span> <span class="attr">id</span>=<span class="string">"map"</span> <span class="attr">longitude</span>=<span class="string">"&#123;&#123;longitude&#125;&#125;"</span> <span class="attr">latitude</span>=<span class="string">"&#123;&#123;latitude&#125;&#125;"</span> <span class="attr">show-location</span> <span class="attr">scale</span>=<span class="string">"12"</span> <span class="attr">style</span>=<span class="string">"width: 100%; height: 00px;"</span>&gt;</span><span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">onReady(e)&#123;</span><br><span class="line">  <span class="comment">//关联&lt;map /&gt;组件</span></span><br><span class="line">  <span class="keyword">this</span>.mapCtx = wx.createMapContext(<span class="string">'map'</span>) <span class="comment">// 创建 map 上下文 MapContext 对象。</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">//获取地图中心点</span></span><br><span class="line">getCenterPoint(e)&#123;</span><br><span class="line">  <span class="keyword">var</span> $<span class="keyword">this</span> = <span class="keyword">this</span>;</span><br><span class="line">  <span class="keyword">this</span>.mapCtx.getCenterLocation(&#123;</span><br><span class="line">    success(res)&#123;</span><br><span class="line">      $<span class="keyword">this</span>.setData(&#123;</span><br><span class="line">        latitude: res.latitude,</span><br><span class="line">        longitude: res.longitude</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    fail()&#123;&#125;,</span><br><span class="line">    complete()&#123;&#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">//将地图中心点移动到当前位置</span></span><br><span class="line">setCenterPoint(e)&#123;</span><br><span class="line">  <span class="keyword">this</span>.mapCtx.moveToLocation()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="18-3-MapContext-translateMarker-平移-marker，带动画"><a href="#18-3-MapContext-translateMarker-平移-marker，带动画" class="headerlink" title="18.3  MapContext.translateMarker 平移 marker，带动画"></a>18.3  MapContext.translateMarker 平移 marker，带动画</h3><p>语法：MapContext.translateMarker(Object object)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">onReady(e)&#123;</span><br><span class="line">  <span class="comment">//关联&lt;map /&gt;组件</span></span><br><span class="line">  <span class="keyword">this</span>.mapCtx = wx.createMapContext(<span class="string">'map'</span>) <span class="comment">// 创建 map 上下文 MapContext 对象。</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">//获取地图中心点</span></span><br><span class="line">translateMarkerFunc(e)&#123;</span><br><span class="line">  <span class="keyword">var</span> $<span class="keyword">this</span> = <span class="keyword">this</span>;</span><br><span class="line">  <span class="keyword">this</span>.mapCtx.translateMarker(&#123;</span><br><span class="line">    markerId:<span class="number">999</span>,<span class="comment">//number  指定 marker  必填</span></span><br><span class="line">    destination:&#123;</span><br><span class="line">      <span class="comment">//指定 marker 移动到的目标点 必填</span></span><br><span class="line">      latitude: <span class="number">30.4919168</span>,<span class="comment">//纬度</span></span><br><span class="line">      longitude: <span class="number">114.3061654</span><span class="comment">//经度</span></span><br><span class="line">    &#125;,</span><br><span class="line">    autoRotate:<span class="literal">true</span>, <span class="comment">//移动过程中是否自动旋转 marker 必填</span></span><br><span class="line">    rotate:<span class="number">90</span>,<span class="comment">//marker 的旋转角度  必填</span></span><br><span class="line">    duration:<span class="number">1000</span>,<span class="comment">//动画持续时长，平移与旋转分别计算   否  默认值 1000</span></span><br><span class="line">    animationEnd()&#123;</span><br><span class="line">      <span class="comment">//  否  动画结束回调函数</span></span><br><span class="line">    &#125;</span><br><span class="line">    success(res)&#123;</span><br><span class="line">      $<span class="keyword">this</span>.setData(&#123;</span><br><span class="line">        latitude: res.latitude,</span><br><span class="line">        longitude: res.longitude</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    fail()&#123;&#125;,</span><br><span class="line">    complete()&#123;&#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">//将地图中心点移动到当前位置</span></span><br><span class="line">setCenterPoint(e)&#123;</span><br><span class="line">  <span class="keyword">this</span>.mapCtx.moveToLocation()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="18-4-综合示例"><a href="#18-4-综合示例" class="headerlink" title="18.4 综合示例"></a>18.4 综合示例</h3><p>以下示例 为 mina 框架的示例。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">map</span> <span class="attr">id</span>=<span class="string">"map"</span> <span class="attr">longitude</span>=<span class="string">"&#123;&#123;longitude&#125;&#125;"</span> <span class="attr">latitude</span>=<span class="string">"&#123;&#123;latitude&#125;&#125;"</span> <span class="attr">show-location</span> <span class="attr">scale</span>=<span class="string">"12"</span> <span class="attr">style</span>=<span class="string">"width: 100%; height: 00px;"</span>&gt;</span><span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">bindtap</span>=<span class="string">"getCenterPoint"</span>&gt;</span>获取地图中心点<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">text</span>&gt;</span>中心点经度：&#123;&#123;longitude&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">text</span>&gt;</span>中心点纬度：&#123;&#123;latitude&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">bindtap</span>=<span class="string">"setCenterPoint"</span>&gt;</span>移动到当前位置<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//index.js</span></span><br><span class="line"><span class="comment">//获取应用实例</span></span><br><span class="line"><span class="keyword">var</span> app = getApp()</span><br><span class="line">Page(&#123;</span><br><span class="line">  data: &#123;</span><br><span class="line">    latitude: <span class="number">30.4919168</span>,</span><br><span class="line">    longitude: <span class="number">114.3061654</span></span><br><span class="line">  &#125;,</span><br><span class="line">  onReady: <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">    <span class="comment">//关联&lt;map /&gt;组件</span></span><br><span class="line">    <span class="keyword">this</span>.mapCtx = wx.createMapContext(<span class="string">'map'</span>) <span class="comment">// 创建 map 上下文 MapContext 对象。</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//获取地图中心点</span></span><br><span class="line">  getCenterPoint: <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $<span class="keyword">this</span> = <span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">this</span>.mapCtx.getCenterLocation(&#123;</span><br><span class="line">      success: <span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line">        $<span class="keyword">this</span>.setData(&#123;</span><br><span class="line">          latitude: res.latitude,</span><br><span class="line">          longitude: res.longitude</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//将地图中心点移动到当前位置</span></span><br><span class="line">  setCenterPoint: <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.mapCtx.moveToLocation()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="十九、路由-页面跳转"><a href="#十九、路由-页面跳转" class="headerlink" title="十九、路由(页面跳转)"></a>十九、路由(页面跳转)</h2><p>以下是 原生的 API ，如果是 wepy 框架又对这几个 API 进行封装了</p>
<h3 id="19-1-wx-navigateTo-保留当前页面，跳转到应用内的某个页面。但是不能跳到-tabbar-页面。使用-wx-navigateBack-可以返回到原页面。"><a href="#19-1-wx-navigateTo-保留当前页面，跳转到应用内的某个页面。但是不能跳到-tabbar-页面。使用-wx-navigateBack-可以返回到原页面。" class="headerlink" title="19.1 wx.navigateTo 保留当前页面，跳转到应用内的某个页面。但是不能跳到 tabbar 页面。使用 wx.navigateBack 可以返回到原页面。"></a>19.1 wx.navigateTo 保留当前页面，跳转到应用内的某个页面。但是不能跳到 tabbar 页面。使用 wx.navigateBack 可以返回到原页面。</h3><p>也就是说需要跳转到某个不在 tabbar 设置过的页面，并且需要返回 原来的页面的话就使用这个方法 wx.navigateTo。</p>
<p>调用 navigateTo 跳转时，调用该方法的页面会被加入堆栈，而 redirectTo 方法则不会。需要返回 原来的页面的话就使用这个方法 wx.navigateTo。<br>将经历过 的页面压入栈，后面就可以使用 wx.navigateBack 调用跳转回来。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">wx.navigateTo(&#123;</span><br><span class="line">  url: <span class="string">'test?id=1'</span><span class="comment">// test 是  test 的路径，例如    "pages/products/products"</span></span><br><span class="line">  <span class="comment">//    url:"pages/products/products?id=1"</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// test.js</span></span><br><span class="line">Page(&#123;</span><br><span class="line">  onLoad(option) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(option.query)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// A 页面 =&gt; B 页面</span></span><br><span class="line"><span class="comment">// ①：原生写法</span></span><br><span class="line">wx.navigateTo(&#123;</span><br><span class="line">  url: <span class="string">'./B?id=1'</span>, <span class="comment">// 必填  需要跳转的应用内非 tabBar 的页面的路径, 路径后可以带参数。</span></span><br><span class="line">                    <span class="comment">//参数与路径之间使用 ? 分隔，参数键与参数值用 = 相连，不同参数用 &amp; 分隔；如 'path?key=value&amp;key2=value2</span></span><br><span class="line">  success(res)&#123;</span><br><span class="line">    <span class="comment">//否</span></span><br><span class="line">  &#125;,</span><br><span class="line">  fail()&#123;</span><br><span class="line">    <span class="comment">// 否</span></span><br><span class="line">  &#125;,</span><br><span class="line">  complete()&#123;</span><br><span class="line">    <span class="comment">// 否</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// B.js 页面</span></span><br><span class="line"><span class="comment">//① mina 框架</span></span><br><span class="line">Page(&#123;</span><br><span class="line">  onLoad: <span class="function"><span class="keyword">function</span>(<span class="params">option</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(option.query)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">//wepy 框架 可以使用上面的方法，并且还封装了方法  注意这里没有 TO 了 哦!!!!!!!!!!!!!!!!!!!!!!!!!!</span><br><span class="line">//②：wepy 框架包装写法</span><br><span class="line">  this.$navigate(&#123;</span><br><span class="line">    url: &apos;./B?id=1&apos;,</span><br><span class="line">    success(res)&#123;&#125;,</span><br><span class="line">    fail()&#123;&#125;,</span><br><span class="line">    complete()&#123;&#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">//wepy 框架 或者更加直接的</span><br><span class="line">//③：wepy 框架包装写法</span><br><span class="line">  this.$navigate(&apos;./B&apos;,&#123;id:1&#125;)</span><br><span class="line">  // 问题：然后这里的 success 这 3 个属性是怎么用的？？？是下面这样么</span><br><span class="line">  this.$navigate(&apos;./B&apos;,&#123;id:1&#125;).success(res=&gt;&#123;</span><br><span class="line">    //</span><br><span class="line">  &#125;).fail(res=&gt;&#123;</span><br><span class="line">    //</span><br><span class="line">  &#125;).complete(res=&gt;&#123;</span><br><span class="line">    //</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//② wepy 框架</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Index</span> <span class="keyword">extends</span> <span class="title">wepy</span>.<span class="title">page</span> </span>&#123;</span><br><span class="line">  onLoad(options) &#123;</span><br><span class="line">    <span class="keyword">this</span>.pageBId = options.id;</span><br><span class="line">    <span class="built_in">console</span>.log(options.id)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="19-2-wx-navigateBack-关闭当前页面，返回上一页面或多级页面。可通过-getCurrentPages-获取当前的页面栈，决定需要返回几层。"><a href="#19-2-wx-navigateBack-关闭当前页面，返回上一页面或多级页面。可通过-getCurrentPages-获取当前的页面栈，决定需要返回几层。" class="headerlink" title="19.2 wx.navigateBack 关闭当前页面，返回上一页面或多级页面。可通过 getCurrentPages() 获取当前的页面栈，决定需要返回几层。"></a>19.2 wx.navigateBack 关闭当前页面，返回上一页面或多级页面。可通过 getCurrentPages() 获取当前的页面栈，决定需要返回几层。</h3><p>当前页面是通过 wx.navigateTo 接口过来的话，那么可以使用 wx.navigateBack  返回原来的页面。</p>
<p>调用 navigateTo 跳转时，调用该方法的页面会被加入堆栈，而 redirectTo 方法则不会。需要返回 原来的页面的话就使用这个方法 wx.navigateTo。<br>将经历过 的页面压入栈，后面就可以使用 wx.navigateBack 调用跳转回来。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 此处是 A 页面 =&gt; B 页面</span></span><br><span class="line">toPageB()&#123;</span><br><span class="line">  wx.navigateTo(&#123;</span><br><span class="line">    url: <span class="string">'./B?id=1'</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 此处是 B 页面 =&gt; C 页面</span></span><br><span class="line">toPageC()&#123;</span><br><span class="line">  wx.navigateTo(&#123;</span><br><span class="line">    url: <span class="string">'./C?id=1'</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 此处是 C 页面 =&gt; A 页面</span></span><br><span class="line">Back()&#123;</span><br><span class="line">  wx.navigateBack(&#123;</span><br><span class="line">    delta:<span class="number">2</span>,<span class="comment">//number   必填 返回的页面数，如果 delta 大于现有页面数，则返回到首页。</span></span><br><span class="line">    <span class="comment">// delta:1  返回 B 页面， delta:2/3/4..... 返回 A页面（这里假设 A 是首页）</span></span><br><span class="line">    success(res)&#123;&#125;,<span class="comment">//   否 接口调用成功的回调函数</span></span><br><span class="line">    fail(res)&#123;&#125;,<span class="comment">//      否 接口调用失败的回调函数</span></span><br><span class="line">    complete(res)&#123;&#125;<span class="comment">//   否 接口调用结束的回调函数（调用成功、失败都会执行）</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="19-2-1-wx-navigateBack-返回上一个页面并且带参数"><a href="#19-2-1-wx-navigateBack-返回上一个页面并且带参数" class="headerlink" title="19.2.1  wx.navigateBack 返回上一个页面并且带参数"></a>19.2.1  wx.navigateBack 返回上一个页面并且带参数</h4><p>看上面的内容之后发现，wx.navigateBack 只有三个回调函数参数，没有其他的参数，那么如果希望返回上面一个页面，并且传参怎么办？</p>
<p><a href="https://www.jianshu.com/p/f846a2cc6c53" target="_blank" rel="noopener">文档</a><br>文档这里只是 mina 框架可以这样用，发现并不能用在 wepy 框架。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// A页面</span></span><br><span class="line">data=&#123;</span><br><span class="line">  <span class="keyword">this</span>.title=<span class="string">'title'</span></span><br><span class="line">&#125;</span><br><span class="line">onLoad()&#123;</span><br><span class="line">  <span class="keyword">this</span>.$navigate(<span class="string">'./B'</span>)</span><br><span class="line">  <span class="keyword">this</span>.title<span class="comment">//'title'</span></span><br><span class="line">&#125;</span><br><span class="line">onShow()&#123;</span><br><span class="line">  <span class="keyword">this</span>.title<span class="comment">//'title' 这里希望会改变</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//b 页面</span></span><br><span class="line"> methods = &#123;</span><br><span class="line">    test() &#123;</span><br><span class="line">      <span class="keyword">var</span> pages = <span class="keyword">this</span>.getCurrentPages();</span><br><span class="line">      <span class="built_in">console</span>.log(pages)</span><br><span class="line">      <span class="keyword">var</span> prevPage = pages[pages.length - <span class="number">2</span>];</span><br><span class="line">      <span class="built_in">console</span>.log(prevPage)</span><br><span class="line">      prevPage.title = <span class="string">'newTitle'</span>;<span class="comment">// prevPage 改变了，但是 A 页面的值没有被改变，这个压入栈的东西是不是要自己取出来使用呀？</span></span><br><span class="line">      <span class="comment">// this.$apply() 可以使用么？ 是 this 么？？  原生的 setData 还这样用么？</span></span><br><span class="line">      wepy.navigateBack(&#123; <span class="attr">delta</span>: <span class="number">1</span> &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>
<p>问题？success(res){}, 不能传么？？后面做到的时候自己研究一下。</p>
<h3 id="19-3-wx-redirectTo-关闭当前页面，跳转到应用内的某个页面。但是不允许跳转到-tabbar-页面。"><a href="#19-3-wx-redirectTo-关闭当前页面，跳转到应用内的某个页面。但是不允许跳转到-tabbar-页面。" class="headerlink" title="19.3 wx.redirectTo 关闭当前页面，跳转到应用内的某个页面。但是不允许跳转到 tabbar 页面。"></a>19.3 wx.redirectTo 关闭当前页面，跳转到应用内的某个页面。但是不允许跳转到 tabbar 页面。</h3><p>关闭当前页面，跳转到应用内的某个页面。但是不允许跳转到 tabbar 页面。</p>
<p>wx.redirectTo 不会压入栈，不能使用 返回 API 接口。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// A 页面 =&gt; B 页面</span></span><br><span class="line"><span class="comment">// ①：原生写法</span></span><br><span class="line">wx.redirectTo(&#123;</span><br><span class="line">  url: <span class="string">'./B?id=1'</span>, <span class="comment">// 必填  需要跳转的应用内非 tabBar 的页面的路径, 路径后可以带参数。</span></span><br><span class="line">                    <span class="comment">//参数与路径之间使用 ? 分隔，参数键与参数值用 = 相连，不同参数用 &amp; 分隔；如 'path?key=value&amp;key2=value2</span></span><br><span class="line">  success(res)&#123;</span><br><span class="line">    <span class="comment">//否</span></span><br><span class="line">  &#125;,</span><br><span class="line">  fail()&#123;</span><br><span class="line">    <span class="comment">// 否</span></span><br><span class="line">  &#125;,</span><br><span class="line">  complete()&#123;</span><br><span class="line">    <span class="comment">// 否</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//wepy 框架 可以使用上面的方法，并且还封装了方法</span></span><br><span class="line"><span class="comment">//②：wepy 框架包装写法</span></span><br><span class="line">  <span class="keyword">this</span>.$redirectTo(&#123;</span><br><span class="line">    url: <span class="string">'./B?id=1'</span>,</span><br><span class="line">    success(res)&#123;&#125;,</span><br><span class="line">    fail()&#123;&#125;,</span><br><span class="line">    complete()&#123;&#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//wepy 框架 或者更加直接的</span></span><br><span class="line"><span class="comment">//③：wepy 框架包装写法</span></span><br><span class="line">  <span class="keyword">this</span>.$redirectTo(<span class="string">'./B'</span>,&#123;<span class="attr">id</span>:<span class="number">1</span>&#125;)</span><br><span class="line">  <span class="comment">// 问题：然后这里的 success 这 3 个属性是怎么用的？？？是下面这样么</span></span><br><span class="line">  <span class="keyword">this</span>.$redirectTo(<span class="string">'./B'</span>,&#123;<span class="attr">id</span>:<span class="number">1</span>&#125;).success(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">  &#125;).fail(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">  &#125;).complete(<span class="function"><span class="params">res</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// B.js 页面</span></span><br><span class="line"><span class="comment">//① mina 框架</span></span><br><span class="line">Page(&#123;</span><br><span class="line">  onLoad: <span class="function"><span class="keyword">function</span>(<span class="params">option</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(option.query)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//② wepy 框架</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Index</span> <span class="keyword">extends</span> <span class="title">wepy</span>.<span class="title">page</span> </span>&#123;</span><br><span class="line">  onLoad(options) &#123;</span><br><span class="line">    <span class="keyword">this</span>.pageBId = options.id;</span><br><span class="line">    <span class="built_in">console</span>.log(options.id)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="19-4-wx-reLaunch-关闭所有页面，打开到应用内的某个页面"><a href="#19-4-wx-reLaunch-关闭所有页面，打开到应用内的某个页面" class="headerlink" title="19.4 wx.reLaunch 关闭所有页面，打开到应用内的某个页面"></a>19.4 wx.reLaunch 关闭所有页面，打开到应用内的某个页面</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// A 页面 =&gt; B 页面 （可以是任意的页面）</span></span><br><span class="line"><span class="comment">// ①：原生写法</span></span><br><span class="line">wx.reLaunch(&#123;</span><br><span class="line">  url: <span class="string">'./B?id=1'</span>, <span class="comment">//需要跳转的应用内页面路径，路径后可以带参数。参数与路径之间使用?分隔，参数键与参数值用=相连，不同参数用&amp;分隔；</span></span><br><span class="line">                  <span class="comment">//如 'path?key=value&amp;key2=value2'，如果跳转的页面路径是 tabBar 页面则不能带参数</span></span><br><span class="line">  success(res)&#123;</span><br><span class="line">    <span class="comment">//否</span></span><br><span class="line">  &#125;,</span><br><span class="line">  fail()&#123;</span><br><span class="line">    <span class="comment">// 否</span></span><br><span class="line">  &#125;,</span><br><span class="line">  complete()&#123;</span><br><span class="line">    <span class="comment">// 否</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// B.js 页面</span></span><br><span class="line"><span class="comment">//① mina 框架</span></span><br><span class="line">Page(&#123;</span><br><span class="line">  onLoad: <span class="function"><span class="keyword">function</span>(<span class="params">option</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(option.query)<span class="comment">// 如果是 tabbar 页面就没有这里了</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//② wepy 框架</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Index</span> <span class="keyword">extends</span> <span class="title">wepy</span>.<span class="title">page</span> </span>&#123;</span><br><span class="line">  onLoad(options) &#123;</span><br><span class="line">    <span class="keyword">this</span>.pageBId = options.id; <span class="comment">// 如果是 tabbar 页面就没有这里了</span></span><br><span class="line">    <span class="built_in">console</span>.log(options.id)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="19-5-wx-switchTab-跳转到-tabBar-页面，并关闭其他所有非-tabBar-页面"><a href="#19-5-wx-switchTab-跳转到-tabBar-页面，并关闭其他所有非-tabBar-页面" class="headerlink" title="19.5 wx.switchTab 跳转到 tabBar 页面，并关闭其他所有非 tabBar 页面"></a>19.5 wx.switchTab 跳转到 tabBar 页面，并关闭其他所有非 tabBar 页面</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// A 页面 =&gt; index 页面（ index 页面必须以是 tebbar 页面）</span></span><br><span class="line"><span class="comment">// ①：原生写法</span></span><br><span class="line">wx.switchTab(&#123;</span><br><span class="line">  url: <span class="string">'./index'</span>  <span class="comment">//不能带参数的</span></span><br><span class="line">  success(res)&#123;</span><br><span class="line">    <span class="comment">//否</span></span><br><span class="line">  &#125;,</span><br><span class="line">  fail()&#123;</span><br><span class="line">    <span class="comment">// 否</span></span><br><span class="line">  &#125;,</span><br><span class="line">  complete()&#123;</span><br><span class="line">    <span class="comment">// 否</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//app.wpy 中的 cinfig</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"tabBar"</span>: &#123;</span><br><span class="line">    <span class="string">"list"</span>: [&#123;</span><br><span class="line">      <span class="string">"pagePath"</span>: <span class="string">"index"</span>,</span><br><span class="line">      <span class="string">"text"</span>: <span class="string">"首页"</span></span><br><span class="line">    &#125;,&#123;</span><br><span class="line">      <span class="string">"pagePath"</span>: <span class="string">"other"</span>,</span><br><span class="line">      <span class="string">"text"</span>: <span class="string">"其他"</span></span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="二十、转发（右上角的转发功能，或者在其他地方自定义的转发功能）"><a href="#二十、转发（右上角的转发功能，或者在其他地方自定义的转发功能）" class="headerlink" title="二十、转发（右上角的转发功能，或者在其他地方自定义的转发功能）"></a>二十、转发（右上角的转发功能，或者在其他地方自定义的转发功能）</h2><h3 id="20-1-wx-getShareInfo-获取转发详细信息-基础库-1-1-0-开始支持，低版本需做兼容处理。"><a href="#20-1-wx-getShareInfo-获取转发详细信息-基础库-1-1-0-开始支持，低版本需做兼容处理。" class="headerlink" title="20.1 wx.getShareInfo 获取转发详细信息       基础库 1.1.0 开始支持，低版本需做兼容处理。"></a>20.1 wx.getShareInfo 获取转发详细信息       基础库 1.1.0 开始支持，低版本需做兼容处理。</h3><p>wx.getShareInfo 接口是在 <strong>页面的周期函数  onShareAppMessage 函数中 中设置分享的界面。</strong> 20.1.3 实例中有几个相关的 api 接口完整的示例。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">onShareAppMessage()&#123;</span><br><span class="line">  <span class="keyword">if</span> (res.from === <span class="string">'button'</span>) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(res.target)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    title: <span class="string">'自定义转发标题'</span>,</span><br><span class="line">    path: <span class="string">'/pages/main'</span>,</span><br><span class="line">    success(res) &#123;</span><br><span class="line">      <span class="keyword">let</span> shareId = res.shareTickets[<span class="number">0</span>]</span><br><span class="line">      wx.getShareInfo(&#123;</span><br><span class="line">        shareTicket:shareId,<span class="comment">//string   必填  shareTicket 获取分享信息</span></span><br><span class="line">        timeout:<span class="number">1000</span>,<span class="comment">//number          否    超时时间，单位 ms 1.9.90</span></span><br><span class="line">        success(res)&#123;</span><br><span class="line">        <span class="comment">//function    否    接口调用成功的回调函数</span></span><br><span class="line">        res.errMsg        <span class="comment">//string 错误信息</span></span><br><span class="line">        res.encryptedData <span class="comment">//string 包括敏感数据在内的完整转发信息的加密数据，详细见加密数据解密算法</span></span><br><span class="line">        res.iv            <span class="comment">//string 加密算法的初始向量，详细见加密数据解密算法</span></span><br><span class="line">        &#125;,</span><br><span class="line">        fail(res)&#123;</span><br><span class="line">                    <span class="comment">//function    否    接口调用失败的回调函数</span></span><br><span class="line">        &#125;,</span><br><span class="line">        complete(res)&#123;</span><br><span class="line">                    <span class="comment">//function    否    接口调用结束的回调函数（调用成功、失败都会执行</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="20-1-1-加密数据解密算法"><a href="#20-1-1-加密数据解密算法" class="headerlink" title="20.1.1 加密数据解密算法"></a>20.1.1 加密数据解密算法</h4><p><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/signature.html" target="_blank" rel="noopener">官网网址</a></p>
<p>加密数据解密算法：接口如果涉及敏感数据（如wx.getUserInfo当中的 openId 和 unionId），接口的明文内容将不包含这些敏感数据。开发者如需要获取敏感数据，需要对接口返回的加密数据(encryptedData) 进行对称解密。 解密算法如下：</p>
<ul>
<li>对称解密使用的算法为 AES-128-CBC，数据采用PKCS#7填充。</li>
<li>对称解密的目标密文为 Base64_Decode(encryptedData)。</li>
<li>对称解密秘钥 aeskey = Base64_Decode(session_key), aeskey 是16字节。</li>
<li>对称解密算法初始向量 为Base64_Decode(iv)，其中iv由数据接口返回。</li>
</ul>
<p>微信官方提供了多种编程语言的示例代码（点击下载）。每种语言类型的接口名字均一致。调用方式可以参照示例。</p>
<p>另外，为了应用能校验数据的有效性，会在敏感数据加上数据水印( watermark )</p>
<p>watermark参数说明：</p>
<p>参数    类型    说明<br>appid    String    敏感数据归属 appId，开发者可校验此参数与自身 appId 是否一致<br>timestamp    Int    敏感数据获取的时间戳, 开发者可以用于数据时效性校验<br>如接口 wx.getUserInfo 敏感数据当中的 watermark：</p>
<p>{<br>    “openId”: “OPENID”,<br>    “nickName”: “NICKNAME”,<br>    “gender”: GENDER,<br>    “city”: “CITY”,<br>    “province”: “PROVINCE”,<br>    “country”: “COUNTRY”,<br>    “avatarUrl”: “AVATARURL”,<br>    “unionId”: “UNIONID”,<br>    “watermark”:<br>    {<br>        “appid”:”APPID”,<br>        “timestamp”:TIMESTAMP<br>    }<br>}<br>注：</p>
<p>解密后得到的json数据根据需求可能会增加新的字段，旧字段不会改变和删减，开发者需要预留足够的空间<br>会话密钥 session_key 有效性<br>开发者如果遇到因为 session_key 不正确而校验签名失败或解密失败，请关注下面几个与 session_key 有关的注意事项。</p>
<p>wx.login 调用时，用户的 session_key 可能会被更新而致使旧 session_key 失效（刷新机制存在最短周期，如果同一个用户短时间内多次调用 wx.login，并非每次调用都导致 session_key 刷新）。开发者应该在明确需要重新登录时才调用 wx.login，及时通过 code2Session 接口更新服务器存储的 session_key。<br>微信不会把 session_key 的有效期告知开发者。我们会根据用户使用小程序的行为对 session_key 进行续期。用户越频繁使用小程序，session_key 有效期越长。<br>开发者在 session_key 失效时，可以通过重新执行登录流程获取有效的 session_key。使用接口 wx.checkSession可以校验 session_key 是否有效，从而避免小程序反复执行登录流程。<br>当开发者在实现自定义登录态时，可以考虑以 session_key 有效期作为自身登录态有效期，也可以实现自定义的时效性策略。</p>
<h4 id="20-1-2-如需要展示群名称，可以使用开放数据组件-open-data"><a href="#20-1-2-如需要展示群名称，可以使用开放数据组件-open-data" class="headerlink" title="20.1.2 如需要展示群名称，可以使用开放数据组件 open-data"></a>20.1.2 如需要展示群名称，可以使用开放数据组件 open-data</h4><p><a href="https://developers.weixin.qq.com/miniprogram/dev/component/open-data.html" target="_blank" rel="noopener">官网开方组件网址</a></p>
<p>open-data<br>基础库 1.4.0 开始支持，低版本需做兼容处理。</p>
<p>用于展示微信开放的数据。</p>
<p>属性名    类型    默认值    说明<br>type    String        开放数据类型<br>open-gid    String        当 type=”groupName” 时生效, 群id<br>lang    String    en    当 type=”user*” 时生效，以哪种语言展示 userInfo，有效值有：en, zh_CN, zh_TW<br>type 有效值：</p>
<p>值    说明    最低版本<br>groupName    拉取群名称    1.4.0<br>userNickName    用户昵称    1.9.90<br>userAvatarUrl    用户头像    1.9.90<br>userGender    用户性别    1.9.90<br>userCity    用户所在城市    1.9.90<br>userProvince    用户所在省份    1.9.90<br>userCountry    用户所在国家    1.9.90<br>userLanguage    用户的语言    1.9.90<br>Tips: 只有当前用户在此群内才能拉取到群名称</p>
<p>示例：</p>
<p>在开发者工具中预览效果</p>
<p><open-data type="groupName" open-gid="xxxxxx"></open-data></p>
<p><open-data type="userAvatarUrl"></open-data></p>
<p><open-data type="userGender" lang="zh_CN"></open-data><br>Tips: 关于open-gid的获取请使用 wx.getShareInfo</p>
<h3 id="20-2-wx-hideShareMenu-隐藏转发按钮-基础库-1-1-0-开始支持，低版本需做兼容处理。"><a href="#20-2-wx-hideShareMenu-隐藏转发按钮-基础库-1-1-0-开始支持，低版本需做兼容处理。" class="headerlink" title="20.2 wx.hideShareMenu 隐藏转发按钮          基础库 1.1.0 开始支持，低版本需做兼容处理。"></a>20.2 wx.hideShareMenu 隐藏转发按钮          基础库 1.1.0 开始支持，低版本需做兼容处理。</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">wx.hideShareMenu(&#123;</span><br><span class="line">  success (res) &#123;</span><br><span class="line">    <span class="comment">// 接口调用成功的回调函数</span></span><br><span class="line">  &#125;,</span><br><span class="line">  fail(res)&#123;</span><br><span class="line">    <span class="comment">//② 接口调用失败的回调函数</span></span><br><span class="line">  &#125;,</span><br><span class="line">  complete(res)&#123;</span><br><span class="line">    <span class="comment">//② 接口调用结束的回调函数（调用成功、失败都会执行)</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="20-3-wx-showShareMenu-显示当前页面的转发按钮-基础库-1-1-0-开始支持，低版本需做兼容处理。"><a href="#20-3-wx-showShareMenu-显示当前页面的转发按钮-基础库-1-1-0-开始支持，低版本需做兼容处理。" class="headerlink" title="20.3 wx.showShareMenu 显示当前页面的转发按钮 基础库 1.1.0 开始支持，低版本需做兼容处理。"></a>20.3 wx.showShareMenu 显示当前页面的转发按钮 基础库 1.1.0 开始支持，低版本需做兼容处理。</h3><p>这个接口是在 onload 周期函数中使用的。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">onload()&#123;</span><br><span class="line">  wx.showShareMenu(&#123;</span><br><span class="line">    withShareTicket: <span class="literal">true</span>,<span class="comment">//获取更多转发信息 否(不是必须的) // 用于显示分享的群列表</span></span><br><span class="line">    success (res) &#123;</span><br><span class="line">      <span class="comment">// 接口调用成功的回调函数 否</span></span><br><span class="line">    &#125;,</span><br><span class="line">    fail(res)&#123;</span><br><span class="line">      <span class="comment">//② 接口调用失败的回调函数 否</span></span><br><span class="line">    &#125;,</span><br><span class="line">    complete(res)&#123;</span><br><span class="line">      <span class="comment">//② 接口调用结束的回调函数（调用成功、失败都会执行) 否</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="20-3-1-获取更多转发信息"><a href="#20-3-1-获取更多转发信息" class="headerlink" title="20.3.1 获取更多转发信息"></a>20.3.1 获取更多转发信息</h4><p>通常开发者希望转发出去的小程序被二次打开的时候能够获取到一些信息，例如群的标识。现在通过调用 wx.showShareMenu 并且设置 withShareTicket 为 true ，当用户将小程序转发到任一群聊之后，此转发卡片在群聊中被其他用户打开时，可以在 App.onLaunch 或 App.onShow 获取到一个 shareTicket。通过调用 wx.getShareInfo() 接口传入此 shareTicket 可以获取到转发信息。</p>
<h3 id="20-4-wx-updateShareMenu-更新转发属性-基础库-1-2-0-开始支持，低版本需做兼容处理。"><a href="#20-4-wx-updateShareMenu-更新转发属性-基础库-1-2-0-开始支持，低版本需做兼容处理。" class="headerlink" title="20.4 wx.updateShareMenu 更新转发属性         基础库 1.2.0 开始支持，低版本需做兼容处理。"></a>20.4 wx.updateShareMenu 更新转发属性         基础库 1.2.0 开始支持，低版本需做兼容处理。</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">wx.updateShareMenu(&#123;</span><br><span class="line">  withShareTicket: <span class="literal">true</span>,<span class="comment">//是否使用带 shareTicket 的转发 否(不是必须的) 默认值为 false</span></span><br><span class="line">  isUpdatableMessage:<span class="literal">true</span>,<span class="comment">//是否是动态消息              否(不是必须的) 默认值为 false</span></span><br><span class="line">  activityId:<span class="string">''</span>,<span class="comment">//string 动态消息的 activityId。通过 createActivityId 接口获取 否(不是必须的)</span></span><br><span class="line">  templateInfo:&#123;</span><br><span class="line">    <span class="comment">//动态消息的模板信息 否(不是必须的),</span></span><br><span class="line">    parameterList: [&#123;<span class="comment">// 参数列表</span></span><br><span class="line">      name: <span class="string">'member_count'</span>,<span class="comment">//参数名</span></span><br><span class="line">      value: <span class="string">'1'</span>          <span class="comment">// 参数值</span></span><br><span class="line">    &#125;, &#123;</span><br><span class="line">      name: <span class="string">'room_limit'</span>,</span><br><span class="line">      value: <span class="string">'3'</span></span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;,</span><br><span class="line">  success (res) &#123;</span><br><span class="line">    <span class="comment">// 接口调用成功的回调函数 否</span></span><br><span class="line">  &#125;,</span><br><span class="line">  fail(res)&#123;</span><br><span class="line">    <span class="comment">//② 接口调用失败的回调函数 否</span></span><br><span class="line">  &#125;,</span><br><span class="line">  complete(res)&#123;</span><br><span class="line">    <span class="comment">//② 接口调用结束的回调函数（调用成功、失败都会执行) 否</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="20-4-1-获取更多转发消息"><a href="#20-4-1-获取更多转发消息" class="headerlink" title="20.4.1 获取更多转发消息"></a>20.4.1 获取更多转发消息</h4><p>通常开发者希望转发出去的小程序被二次打开的时候能够获取到一些信息，例如群的标识。现在通过调用 wx.showShareMenu 并且设置 withShareTicket 为 true ，当用户将小程序转发到任一群聊之后，此转发卡片在群聊中被其他用户打开时，可以在 App.onLaunch 或 App.onShow 获取到一个 shareTicket。通过调用 wx.getShareInfo() 接口传入此 shareTicket 可以获取到转发信息。</p>
<h4 id="20-4-2-动态消息"><a href="#20-4-2-动态消息" class="headerlink" title="20.4.2 动态消息"></a>20.4.2 动态消息</h4><p><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/share/updatable-message.html" target="_blank" rel="noopener">官网动态消息网址</a></p>
<p>动态消息<br>从基础库 2.4.0 开始，支持转发动态消息。动态消息对比普通消息，有以下特点：</p>
<p>消息发出去之后，开发者可以通过后台接口修改部分消息内容。<br>消息有对应的提醒按钮，用户点击提醒按钮可以订阅提醒，开发者可以通过后台修改消息状态并推送一次提醒消息给订阅了提醒的用户<br>消息属性<br>动态消息有状态、文字内容、文字颜色。</p>
<p>状态<br>消息有两个状态，分别有其对应的文字内容和颜色。其中状态 0 可以转移到状态 0 和 1，状态 1 无法再转移。</p>
<p>状态    文字内容    颜色    允许转移的状态<br>0    “成员正在加入，当前 {member_count}/{room_limit} 人”    #FA9D39    0, 1<br>1    “已开始”    #CCCCCC    无<br>状态参数<br>每个状态转移的时候可以携带参数，具体参数说明如下。</p>
<p>参数    类型    说明<br>member_count    string    状态 0 时有效，文字内容模板中 member_count 的值<br>room_limit    string    状态 0 时有效，文字内容模板中 room_limit 的值<br>path    string    状态 1 时有效，点击「进入」启动小程序时使用的路径。对于小游戏，没有页面的概念，可以用于传递查询字符串（query），如 “?foo=bar”<br>version_type    string    状态 1 时有效，状态 1 时有效，点击「进入」启动小程序时使用的版本。有效参数值为：develop（开发版），trial（体验版），release（正式版）<br>使用方法<br>一、创建 activity_id<br>每条动态消息可以理解为一个活动，活动发起前需要通过 createActivityId 接口创建 activity_id。后续转发动态消息以及更新动态消息都需要传入这个 activity_id。</p>
<p>活动的默认有效期是 24 小时。活动结束后，消息内容会变成统一的样式：</p>
<p>文字内容：“已结束”<br>文字颜色：#00ff00<br>二、在转发之前声明消息类型为动态消息<br>通过调用 wx.updateShareMenu 接口，传入 isUpdatableMessage: true，以及 templateInfo、activityId 参数。其中 activityId 从步骤一中获得。</p>
<p>三、修改动态消息内容<br>动态消息发出去之后，可以通过 setUpdatableMsg 修改消息内容。</p>
<p>低版本兼容<br>对于不支持动态消息的客户端版本，收到动态消息后会展示成普通消息</p>
<h3 id="20-5-转发功能-实际使用示例：群转发设置"><a href="#20-5-转发功能-实际使用示例：群转发设置" class="headerlink" title="20.5 转发功能 实际使用示例：群转发设置!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!"></a>20.5 转发功能 实际使用示例：群转发设置!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</h3><p>以下实例是在 wepy 框架下写的。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在wpy类型文件的onload中设置 eg： 用于显示分享的群列表</span></span><br><span class="line">onload()&#123;</span><br><span class="line">  wepy.showShareMenu(&#123;</span><br><span class="line">    withShareTicket: <span class="literal">true</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//在 onShareAppMessage 页面周期函数中 中设置分享的界面，在分享成功后的回调函数中通过 wepy.getShareInfo 获取分享群的信息。</span></span><br><span class="line"><span class="comment">//群的信息是经过加密的，需要通过后台来进行解密操作。</span></span><br><span class="line">onShareAppMessage (res) &#123;</span><br><span class="line">  <span class="keyword">if</span> (res.from === <span class="string">'button'</span>) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(res.target)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    title: <span class="string">'自定义转发标题'</span>,</span><br><span class="line">    path: <span class="string">'/pages/main'</span>,</span><br><span class="line">    success(res) &#123;</span><br><span class="line">        <span class="keyword">let</span> shareId = res.shareTickets[<span class="number">0</span>]</span><br><span class="line">        <span class="comment">// 转发成功</span></span><br><span class="line">        wepy.getShareInfo(&#123;</span><br><span class="line">            shareTicket: shareId,</span><br><span class="line">            success: <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">              <span class="keyword">var</span> appId = <span class="string">'小程序的appID'</span></span><br><span class="line">              <span class="keyword">var</span> encryptedData = data.encryptedData</span><br><span class="line">              <span class="keyword">var</span> iv = data.iv</span><br><span class="line">              wepy.request(&#123;</span><br><span class="line">                url: <span class="string">'http://localhost:3000/api/decode'</span>,</span><br><span class="line">                method: <span class="string">'post'</span>,</span><br><span class="line">                data: &#123;</span><br><span class="line">                  appId: appId,</span><br><span class="line">                  encryptedData: encryptedData,</span><br><span class="line">                  iv: iv</span><br><span class="line">                &#125;,</span><br><span class="line">                success: <span class="function">(<span class="params">info</span>) =&gt;</span> &#123;</span><br><span class="line">                  <span class="built_in">console</span>.log(<span class="string">'info:'</span> + info)</span><br><span class="line">                &#125;,</span><br><span class="line">                fail: <span class="function">(<span class="params">info</span>) =&gt;</span> &#123;</span><br><span class="line">                  <span class="built_in">console</span>.log(info)</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;)</span><br><span class="line">              <span class="built_in">console</span>.log(data)</span><br><span class="line">            &#125;,</span><br><span class="line">            fail: <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">              <span class="built_in">console</span>.log(data)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="built_in">console</span>.log(res)</span><br><span class="line">    &#125;,</span><br><span class="line">    fail(res) &#123;</span><br><span class="line">      <span class="comment">// 转发失败</span></span><br><span class="line">      <span class="built_in">console</span>.log(res)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="二十一、系统-手机系统，设备系统"><a href="#二十一、系统-手机系统，设备系统" class="headerlink" title="二十一、系统 (手机系统，设备系统)"></a>二十一、系统 (手机系统，设备系统)</h2><h3 id="21-1-wx-getSystemInfo-获取系统信息"><a href="#21-1-wx-getSystemInfo-获取系统信息" class="headerlink" title="21.1 wx.getSystemInfo 获取系统信息"></a>21.1 wx.getSystemInfo 获取系统信息</h3><p>wx.getSystemInfo 有三种状态 success，fail，complete</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">wx.getSystemInfo(&#123;</span><br><span class="line">  success (res) &#123;</span><br><span class="line">    <span class="comment">// 接口调用成功的回调函数,目前 success 的回调数据中有 16 个数据</span></span><br><span class="line">    res.brand       <span class="comment">//①string 手机品牌   1.5.0</span></span><br><span class="line">    res.model       <span class="comment">//②String 手机型号</span></span><br><span class="line">    res.pixelRatio  <span class="comment">//③number 设备像素比</span></span><br><span class="line">    res.screenWidth <span class="comment">//④number 屏幕宽度</span></span><br><span class="line">    res.screenHeight<span class="comment">//⑤number屏幕高度</span></span><br><span class="line">    res.windowWidth <span class="comment">//⑥number 可使用窗口宽度</span></span><br><span class="line">    res.windowHeight<span class="comment">//⑦number 可使用窗口高度</span></span><br><span class="line">    res.statusBarHeight<span class="comment">//⑧number 状态栏的高度 1.9.0</span></span><br><span class="line">    res.language      <span class="comment">//⑨string 微信设置的语言</span></span><br><span class="line">    res.version       <span class="comment">//⑩string  微信版本号</span></span><br><span class="line">    res.system        <span class="comment">//⑪string   操作系统版本</span></span><br><span class="line">    res.platform      <span class="comment">//⑫string 客户端平台</span></span><br><span class="line">    res.fontSizeSetting<span class="comment">//⑬number 用户字体大小设置。以“我-设置-通用-字体大小”中的设置为准，单位 px。 1.5.0</span></span><br><span class="line">    res.SDKVersion      <span class="comment">//⑭string 客户端基础库版本      1.1.0</span></span><br><span class="line">    res.benchmarkLevel  <span class="comment">//⑮(仅Android小游戏) 性能等级， 1.8.0</span></span><br><span class="line">    <span class="comment">//-2 或 0：该设备无法运行小游戏，</span></span><br><span class="line">    <span class="comment">//-1：性能未知，</span></span><br><span class="line">    <span class="comment">//&gt;=1 设备性能值，该值越高，设备性能越好 (目前设备最高不到50)</span></span><br><span class="line">  &#125;,</span><br><span class="line">  fail(res)&#123;</span><br><span class="line">    <span class="comment">//② 接口调用失败的回调函数</span></span><br><span class="line">  &#125;,</span><br><span class="line">  complete(res)&#123;</span><br><span class="line">    <span class="comment">//② 接口调用结束的回调函数（调用成功、失败都会执行)</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="21-2-wx-getSystemInfoSync-获取系统信息-wx-getSystemInfo-的同步版本"><a href="#21-2-wx-getSystemInfoSync-获取系统信息-wx-getSystemInfo-的同步版本" class="headerlink" title="21.2 wx.getSystemInfoSync 获取系统信息 wx.getSystemInfo 的同步版本"></a>21.2 wx.getSystemInfoSync 获取系统信息 wx.getSystemInfo 的同步版本</h3><p>wx.getSystemInfoSync 有 2 种状态 try ，catch</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> res = wx.getSystemInfoSync()</span><br><span class="line">  <span class="comment">// try 返回的数据与 wx.getSystemInfo 中 success 一致。</span></span><br><span class="line">  <span class="comment">// 上面有的在这都有的</span></span><br><span class="line">  <span class="built_in">console</span>.log(res.model)</span><br><span class="line">  <span class="built_in">console</span>.log(res.pixelRatio)</span><br><span class="line">  <span class="built_in">console</span>.log(res.windowWidth)</span><br><span class="line">  <span class="built_in">console</span>.log(res.windowHeight)</span><br><span class="line">  <span class="built_in">console</span>.log(res.language)</span><br><span class="line">  <span class="built_in">console</span>.log(res.version)</span><br><span class="line">  <span class="built_in">console</span>.log(res.platform)</span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">  <span class="comment">// Do something when catch error</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="21-3-wx-getSystemInfoSync-与-wx-getSystemInfo-obj-区别"><a href="#21-3-wx-getSystemInfoSync-与-wx-getSystemInfo-obj-区别" class="headerlink" title="21.3  wx.getSystemInfoSync()  与  wx.getSystemInfo(obj)  区别"></a>21.3  wx.getSystemInfoSync()  与  wx.getSystemInfo(obj)  区别</h3><p>wx.getSystemInfoSync() 是不带参数的，它的返回值就是  res  对象。</p>
<p>wx.getSystemInfo(obj)  带参数，返回值在 success 回调函数里面。</p>
<h2 id="二十二、定时器"><a href="#二十二、定时器" class="headerlink" title="二十二、定时器"></a>二十二、定时器</h2><h3 id="22-1-setInterval-amp-amp-clearInterval-设定-取消一个定时器。间隔执行（多次）"><a href="#22-1-setInterval-amp-amp-clearInterval-设定-取消一个定时器。间隔执行（多次）" class="headerlink" title="22.1 setInterval &amp;&amp; clearInterval 设定/取消一个定时器。间隔执行（多次）"></a>22.1 setInterval &amp;&amp; clearInterval 设定/取消一个定时器。间隔执行（多次）</h3><p><strong>语法</strong></p>
<p>number setInterval(function callback, number delay, any rest)</p>
<p>按照指定的周期（以毫秒计）来执行注册的回调函数</p>
<p><strong>参数：</strong></p>
<ul>
<li>function callback : 回调函数</li>
<li>number delay      : <strong>执行回调函数之间的时间间隔，单位 ms。</strong></li>
<li>any rest          : param1, param2, …, paramN 等附加参数，它们会作为参数传递给回调函数。（可选参数）</li>
</ul>
<p><strong>返回值:</strong></p>
<ul>
<li>number 定时器的编号。这个值可以传递给 clearInterval 来取消该定时。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 以 wepy 框架的来编辑示例</span></span><br><span class="line">data = &#123;</span><br><span class="line">  isplay:<span class="literal">false</span>,</span><br><span class="line">  intervalId:<span class="literal">null</span>,</span><br><span class="line">  useTime:<span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line">methods =&#123;</span><br><span class="line">  pause() &#123;</span><br><span class="line">    <span class="keyword">this</span>.isplay = <span class="literal">false</span>;</span><br><span class="line">    clearInterval(<span class="keyword">this</span>.intervalId);</span><br><span class="line">  &#125;,</span><br><span class="line">  play() &#123;</span><br><span class="line">    <span class="keyword">this</span>.isplay = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">this</span>.setIntervalFunc();</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line">setIntervalFunc() &#123;</span><br><span class="line">    <span class="keyword">this</span>.intervalId = setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.useTime++;</span><br><span class="line">      <span class="keyword">this</span>.$apply();<span class="comment">// wepy 框架如是编辑</span></span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h3 id="22-2-setTimeout-amp-amp-clearTimeout-设定-取消一个定时器。延迟执行（1-次）"><a href="#22-2-setTimeout-amp-amp-clearTimeout-设定-取消一个定时器。延迟执行（1-次）" class="headerlink" title="22.2 setTimeout  &amp;&amp; clearTimeout 设定/取消一个定时器。延迟执行（1 次）"></a>22.2 setTimeout  &amp;&amp; clearTimeout 设定/取消一个定时器。延迟执行（1 次）</h3><p>在定时到期以后执行注册的回调函数</p>
<p><strong>语法</strong></p>
<p>number setTimeout(function callback, number delay, any rest)</p>
<p>按照指定的周期（以毫秒计）来执行注册的回调函数</p>
<p><strong>参数：</strong></p>
<ul>
<li>function callback : 回调函数</li>
<li>number delay      : <strong>延迟的时间，函数的调用会在该延迟之后发生，单位 ms。</strong></li>
<li>any rest          : param1, param2, …, paramN 等附加参数，它们会作为参数传递给回调函数。（可选参数）</li>
</ul>
<p><strong>返回值:</strong></p>
<ul>
<li>number 定时器的编号。这个值可以传递给 clearInterval 来取消该定时。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 以 wepy 框架的来编辑示例</span></span><br><span class="line">data = &#123;</span><br><span class="line">  isplay:<span class="literal">false</span>,</span><br><span class="line">  intervalId = <span class="literal">null</span>,</span><br><span class="line">  text:<span class="string">'等会看我变'</span></span><br><span class="line">&#125;</span><br><span class="line">methods =&#123;</span><br><span class="line">  pause() &#123;</span><br><span class="line">    <span class="keyword">this</span>.isplay = <span class="literal">false</span>;</span><br><span class="line">    clearTimeout(<span class="keyword">this</span>.intervalId);</span><br><span class="line">  &#125;,</span><br><span class="line">  play() &#123;</span><br><span class="line">    <span class="keyword">this</span>.isplay = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">this</span>.setTimeoutFunc();</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line">setTimeoutFunc() &#123;</span><br><span class="line">    <span class="keyword">this</span>.intervalId = clearTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.text=<span class="string">'3 秒过了，我变啦'</span></span><br><span class="line">      <span class="keyword">this</span>.$apply();<span class="comment">// wepy 框架如是编辑</span></span><br><span class="line">    &#125;, <span class="number">3000</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h2 id="二十三、WXML"><a href="#二十三、WXML" class="headerlink" title="二十三、WXML"></a>二十三、WXML</h2><h3 id="23-1-IntersectionObserver-布局相交状态-对象"><a href="#23-1-IntersectionObserver-布局相交状态-对象" class="headerlink" title="23.1 IntersectionObserver 布局相交状态 对象"></a>23.1 IntersectionObserver 布局相交状态 对象</h3><p>IntersectionObserver 对象，用于推断某些节点是否可以被用户看见、有多大比例可以被用户看见。</p>
<h4 id="23-1-1-IntersectionObserver-disconnectt-停止监听。回调函数将不再触发"><a href="#23-1-1-IntersectionObserver-disconnectt-停止监听。回调函数将不再触发" class="headerlink" title="23.1.1 IntersectionObserver.disconnectt() 停止监听。回调函数将不再触发"></a>23.1.1 IntersectionObserver.disconnectt() 停止监听。回调函数将不再触发</h4><p>注意：<br>与页面显示区域的相交区域并不准确代表用户可见的区域，因为参与计算的区域是“布局区域”，布局区域可能会在绘制时被其他节点裁剪隐藏（如遇祖先节点中 overflow 样式为 hidden 的节点）或遮盖（如遇 fixed 定位的节点）。</p>
<h4 id="23-1-2-IntersectionObserver-observet-指定目标节点并开始监听相交状态变化情况"><a href="#23-1-2-IntersectionObserver-observet-指定目标节点并开始监听相交状态变化情况" class="headerlink" title="23.1.2 IntersectionObserver.observet() 指定目标节点并开始监听相交状态变化情况"></a>23.1.2 IntersectionObserver.observet() 指定目标节点并开始监听相交状态变化情况</h4><p>IntersectionObserver.observet(string targetSelector, function callback)</p>
<p>参数<br>string targetSelector：选择器</p>
<p>function callback：监听相交状态变化的回调函数</p>
<p>参数<br>Object res</p>
<p>属性    类型    说明    最低版本<br>intersectionRatio    number    相交比例<br>intersectionRect    Object    相交区域的边界<br>boundingClientRect    Object    目标边界<br>relativeRect    Object    参照区域的边界<br>time    number    相交检测时的时间戳</p>
<p>es.intersectionRect 的结构</p>
<p>属性    类型    说明    最低版本<br>left    number    左边界<br>right    number    右边界<br>top    number    上边界<br>bottom    number    下边界<br>res.boundingClientRect 的结构</p>
<p>属性    类型    说明    最低版本<br>left    number    左边界<br>right    number    右边界<br>top    number    上边界<br>bottom    number    下边界<br>res.relativeRect 的结构</p>
<p>属性    类型    说明    最低版本<br>left    number    左边界<br>right    number    右边界<br>top    number    上边界<br>bottom    number    下边界</p>
<h4 id="23-1-3-IntersectionObserver-relativeTot-使用选择器指定一个节点，作为参照区域之一。"><a href="#23-1-3-IntersectionObserver-relativeTot-使用选择器指定一个节点，作为参照区域之一。" class="headerlink" title="23.1.3 IntersectionObserver.relativeTot() 使用选择器指定一个节点，作为参照区域之一。"></a>23.1.3 IntersectionObserver.relativeTot() 使用选择器指定一个节点，作为参照区域之一。</h4><p>IntersectionObserver.relativeTo(string selector, Object margins)</p>
<p>参数<br>string selector<br>选择器</p>
<p>Object margins<br>用来扩展（或收缩）参照节点布局区域的边界</p>
<p>属性    类型    默认值    必填    说明    最低版本<br>left    number        否    节点布局区域的左边界<br>right    number        否    节点布局区域的右边界<br>top    number        否    节点布局区域的上边界<br>bottom    number        否    节点布局区域的下边界</p>
<h4 id="23-1-4-IntersectionObserver-relativeToViewportt-指定页面显示区域作为参照区域之一"><a href="#23-1-4-IntersectionObserver-relativeToViewportt-指定页面显示区域作为参照区域之一" class="headerlink" title="23.1.4 IntersectionObserver.relativeToViewportt() 指定页面显示区域作为参照区域之一"></a>23.1.4 IntersectionObserver.relativeToViewportt() 指定页面显示区域作为参照区域之一</h4><p>IntersectionObserver.relativeToViewport(Object margins)</p>
<p>参数<br>Object margins<br>用来扩展（或收缩）参照节点布局区域的边界</p>
<p>属性    类型    默认值    必填    说明    最低版本<br>left    number        否    节点布局区域的左边界<br>right    number        否    节点布局区域的右边界<br>top    number        否    节点布局区域的上边界<br>bottom    number        否    节点布局区域的下边界<br>示例代码<br>下面的示例代码中，如果目标节点（用选择器 .target-class 指定）进入显示区域以下 100px 时，就会触发回调函数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">  onLoad: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    wx.createIntersectionObserver().relativeToViewport(&#123;<span class="attr">bottom</span>: <span class="number">100</span>&#125;).observe(<span class="string">'.target-class'</span>, (res) =&gt; &#123;</span><br><span class="line">      res.intersectionRatio <span class="comment">// 相交区域占目标节点的布局区域的比例</span></span><br><span class="line">      res.intersectionRect <span class="comment">// 相交区域</span></span><br><span class="line">      res.intersectionRect.left <span class="comment">// 相交区域的左边界坐标</span></span><br><span class="line">      res.intersectionRect.top <span class="comment">// 相交区域的上边界坐标</span></span><br><span class="line">      res.intersectionRect.width <span class="comment">// 相交区域的宽度</span></span><br><span class="line">      res.intersectionRect.height <span class="comment">// 相交区域的高度</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="23-2-wx-createIntersectionObserver-创建布局相交状态"><a href="#23-2-wx-createIntersectionObserver-创建布局相交状态" class="headerlink" title="23.2 wx.createIntersectionObserver 创建布局相交状态"></a>23.2 wx.createIntersectionObserver 创建布局相交状态</h3><p>语法：<code>wx.createIntersectionObserver(Object this, Object options)</code>，<br>在自定义组件中，可以使用 <code>this.createIntersectionObserver([options])</code> 来代替</p>
<p>参数：Object this：自定义组件实例<br>     Object options：选项</p>
<p>返回值：IntersectionObserver 对象实例</p>
<p><a href="https://developers.weixin.qq.com/s/LAbMxkmI7F2A" target="_blank" rel="noopener">开发者工具中查看效果</a></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="css"><span class="selector-class">.scroll-view</span> &#123;</span></span><br><span class="line"><span class="undefined">  height: 400rpx;</span></span><br><span class="line"><span class="css">  <span class="selector-tag">background</span>: <span class="selector-id">#fff</span>;</span></span><br><span class="line"><span class="css">  <span class="selector-tag">border</span>: 1<span class="selector-tag">px</span> <span class="selector-tag">solid</span> <span class="selector-id">#ccc</span>;</span></span><br><span class="line"><span class="undefined">  box-sizing: border-box;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css"><span class="selector-class">.scroll-area</span> &#123;</span></span><br><span class="line"><span class="undefined">  height: 1300rpx;</span></span><br><span class="line"><span class="undefined">  display: flex;</span></span><br><span class="line"><span class="undefined">  flex-direction: column;</span></span><br><span class="line"><span class="undefined">  align-items: center;</span></span><br><span class="line"><span class="css">  <span class="selector-tag">transition</span>: <span class="selector-class">.5s</span>;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css"><span class="selector-class">.notice</span> &#123;</span></span><br><span class="line"><span class="undefined">  margin-top: 150rpx;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css"><span class="selector-class">.ball</span> &#123;</span></span><br><span class="line"><span class="undefined">  width: 200rpx;</span></span><br><span class="line"><span class="undefined">  height: 200rpx;</span></span><br><span class="line"><span class="css">  <span class="selector-tag">background</span>: <span class="selector-id">#1AAD19</span>;</span></span><br><span class="line"><span class="undefined">  border-radius: 50%;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css"><span class="selector-class">.filling</span> &#123;</span></span><br><span class="line"><span class="undefined">  height: 400rpx;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css"><span class="selector-class">.message</span> &#123;</span></span><br><span class="line"><span class="undefined">  width: 100%;</span></span><br><span class="line"><span class="undefined">  display: flex;</span></span><br><span class="line"><span class="undefined">  justify-content: center;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css"><span class="selector-class">.message</span> <span class="selector-tag">text</span> &#123;</span></span><br><span class="line"><span class="undefined">  font-size: 40rpx;</span></span><br><span class="line"><span class="undefined">  font-family: -apple-system-font, Helvetica Neue,Helvetica,sans-serif;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"page-body"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"page-section message"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">text</span> <span class="attr">wx:if</span>=<span class="string">"&#123;&#123;appear&#125;&#125;"</span>&gt;</span></span><br><span class="line">        小球出现</span><br><span class="line">      <span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">text</span> <span class="attr">wx:else</span>&gt;</span></span><br><span class="line">        小球消失</span><br><span class="line">      <span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"page-section"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scroll-view</span> <span class="attr">class</span>=<span class="string">"scroll-view"</span> <span class="attr">scroll-y</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"scroll-area"</span> <span class="attr">style</span>=<span class="string">"&#123;&#123;appear ? 'background: #ccc' : ''&#125;&#125;"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">"notice"</span>&gt;</span>向下滚动让小球出现<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"filling"</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"ball"</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">scroll-view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">Page(&#123;</span></span><br><span class="line"><span class="undefined">  data: &#123;</span></span><br><span class="line"><span class="javascript">    appear: <span class="literal">false</span></span></span><br><span class="line"><span class="undefined">  &#125;,</span></span><br><span class="line"><span class="undefined">  onLoad() &#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">this</span>._observer = wx.createIntersectionObserver(<span class="keyword">this</span>)</span></span><br><span class="line"><span class="javascript">    <span class="keyword">this</span>._observer</span></span><br><span class="line"><span class="javascript">      .relativeTo(<span class="string">'.scroll-view'</span>)</span></span><br><span class="line"><span class="javascript">      .observe(<span class="string">'.ball'</span>, (res) =&gt; &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(res);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">this</span>.setData(&#123;</span></span><br><span class="line"><span class="undefined">          appear: res.intersectionRatio &gt; 0</span></span><br><span class="line"><span class="undefined">        &#125;)</span></span><br><span class="line"><span class="undefined">      &#125;)</span></span><br><span class="line"><span class="undefined">  &#125;,</span></span><br><span class="line"><span class="undefined">  onUnload() &#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">if</span> (<span class="keyword">this</span>._observer) <span class="keyword">this</span>._observer.disconnect()</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined">&#125;)</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="23-5-SelectorQuery-查询节点信息的对象"><a href="#23-5-SelectorQuery-查询节点信息的对象" class="headerlink" title="23.5 SelectorQuery 查询节点信息的对象"></a>23.5 SelectorQuery 查询节点信息的对象</h3><h4 id="23-1-1-SelectorQuery-exec"><a href="#23-1-1-SelectorQuery-exec" class="headerlink" title="23.1.1 SelectorQuery.exec"></a>23.1.1 SelectorQuery.exec</h4><h4 id="23-1-1-SelectorQuery-in"><a href="#23-1-1-SelectorQuery-in" class="headerlink" title="23.1.1 SelectorQuery.in"></a>23.1.1 SelectorQuery.in</h4><h4 id="23-1-1-SelectorQuery-select"><a href="#23-1-1-SelectorQuery-select" class="headerlink" title="23.1.1 SelectorQuery.select"></a>23.1.1 SelectorQuery.select</h4><h4 id="23-1-1-SelectorQuery-selectAll"><a href="#23-1-1-SelectorQuery-selectAll" class="headerlink" title="23.1.1 SelectorQuery.selectAll"></a>23.1.1 SelectorQuery.selectAll</h4><h4 id="23-1-1-SelectorQuery-selectViewport"><a href="#23-1-1-SelectorQuery-selectViewport" class="headerlink" title="23.1.1 SelectorQuery.selectViewport"></a>23.1.1 SelectorQuery.selectViewport</h4><h3 id="23-4-wx-createSelectorQuery"><a href="#23-4-wx-createSelectorQuery" class="headerlink" title="23.4 wx.createSelectorQuery"></a>23.4 wx.createSelectorQuery</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> query = wx.createSelectorQuery()</span><br><span class="line">query.select(<span class="string">'#the-id'</span>).boundingClientRect()</span><br><span class="line">query.selectViewport().scrollOffset()</span><br><span class="line">query.exec(<span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line">  res[<span class="number">0</span>].top       <span class="comment">// #the-id节点的上边界坐标</span></span><br><span class="line">  res[<span class="number">1</span>].scrollTop <span class="comment">// 显示区域的竖直滚动位置</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="23-5-NodesRef"><a href="#23-5-NodesRef" class="headerlink" title="23.5 NodesRef"></a>23.5 NodesRef</h3><h4 id="23-5-1-boundingClientRect"><a href="#23-5-1-boundingClientRect" class="headerlink" title="23.5.1 .boundingClientRect"></a>23.5.1 .boundingClientRect</h4><h4 id="23-5-2-fields"><a href="#23-5-2-fields" class="headerlink" title="23.5.2 .fields"></a>23.5.2 .fields</h4><h4 id="23-5-3-scrollOffset"><a href="#23-5-3-scrollOffset" class="headerlink" title="23.5.3 .scrollOffset"></a>23.5.3 .scrollOffset</h4></div><div class="tags"></div><div class="post-share"><div class="bdsharebuttonbox"><span style="float:left;line-height: 28px;height: 28px;font-size:16px;font-weight:blod">分享到：</span><a href="#" data-cmd="more" class="bds_more"></a><a href="#" data-cmd="mshare" title="分享到一键分享" class="bds_mshare"></a><a href="#" data-cmd="fbook" title="分享到Facebook" class="bds_fbook"></a><a href="#" data-cmd="twi" title="分享到Twitter" class="bds_twi"></a><a href="#" data-cmd="linkedin" title="分享到linkedin" class="bds_linkedin"></a><a href="#" data-cmd="youdao" title="分享到有道云笔记" class="bds_youdao"></a><a href="#" data-cmd="evernotecn" title="分享到印象笔记" class="bds_evernotecn"></a><a href="#" data-cmd="weixin" title="分享到微信" class="bds_weixin"></a><a href="#" data-cmd="qzone" title="分享到QQ空间" class="bds_qzone"></a><a href="#" data-cmd="tsina" title="分享到新浪微博" class="bds_tsina"></a></div></div><div class="post-nav"><a href="/2018/08/18/[Javascript]-js-所有的遍历方法详解/" class="pre">所有遍历方法详解</a><a href="/2018/08/18/⑤ -【react.js 框架】-less-scss 在 react中使用/" class="next">react 中使用 less 或者 scss</a></div><div id="comments"></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">文章目录</i></div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#一、前言"><span class="toc-text">一、前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#二、网络"><span class="toc-text">二、网络</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-下载"><span class="toc-text">2.1 下载</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-1-wx-downloadFile-下载文件资源到本地。"><span class="toc-text">2.1.1 wx.downloadFile 下载文件资源到本地。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-1-DownloadTask-abort（）-中断下载任务-无参数"><span class="toc-text">2.1.1 DownloadTask.abort（） 中断下载任务  无参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-1-DownloadTask-offHeadersReceived-取消监听-HTTP-Response-Header-事件。会比请求完成事件更早"><span class="toc-text">2.1.1 DownloadTask.offHeadersReceived 取消监听 HTTP Response Header 事件。会比请求完成事件更早</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-1-DownloadTask-offProgressUpdate-取消监听下载进度变化事件"><span class="toc-text">2.1.1 DownloadTask.offProgressUpdate 取消监听下载进度变化事件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-1-DownloadTask-onHeadersReceived-监听-HTTP-Response-Header-事件。会比请求完成事件更早"><span class="toc-text">2.1.1 DownloadTask.onHeadersReceived 监听 HTTP Response Header 事件。会比请求完成事件更早</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-1-DownloadTask-onProgressUpdate-监听下载进度变化事件"><span class="toc-text">2.1.1 DownloadTask.onProgressUpdate 监听下载进度变化事件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-mDNS-服务器-IP-使用"><span class="toc-text">2.2 mDNS 服务器/IP 使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-1-wx-offLocalServiceDiscoveryStop-取消监听-mDNS-服务停止搜索的事件"><span class="toc-text">2.2.1 wx.offLocalServiceDiscoveryStop 取消监听 mDNS 服务停止搜索的事件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-1-wx-offLocalServiceFound-取消监听-mDNS-服务发现的事件"><span class="toc-text">2.2.1 wx.offLocalServiceFound 取消监听 mDNS 服务发现的事件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-1-wx-offLocalServiceLost-取消监听-mDNS-服务离开的事件"><span class="toc-text">2.2.1 wx.offLocalServiceLost 取消监听 mDNS 服务离开的事件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-1-wx-offLocalServiceResolveFail-取消监听-mDNS-服务解析失败的事件"><span class="toc-text">2.2.1 wx.offLocalServiceResolveFail 取消监听 mDNS 服务解析失败的事件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-1-wx-onLocalServiceDiscoveryStop-监听-mDNS-服务停止搜索的事件"><span class="toc-text">2.2.1 wx.onLocalServiceDiscoveryStop 监听 mDNS 服务停止搜索的事件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-1-wx-onLocalServiceFound-监听-mDNS-服务发现的事件"><span class="toc-text">2.2.1 wx.onLocalServiceFound 监听 mDNS 服务发现的事件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-1-wx-onLocalServiceLost-监听-mDNS-服务离开的事件"><span class="toc-text">2.2.1 wx.onLocalServiceLost 监听 mDNS 服务离开的事件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-1-wx-onLocalServiceResolveFail-监听-mDNS-服务解析失败的事件"><span class="toc-text">2.2.1 wx.onLocalServiceResolveFail 监听 mDNS 服务解析失败的事件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-1-wx-startLocalServiceDiscovery-开始搜索局域网下的-mDNS-服务。搜索的结果会通过-wx-onLocalService-事件返回。"><span class="toc-text">2.2.1 wx.startLocalServiceDiscovery 开始搜索局域网下的 mDNS 服务。搜索的结果会通过 wx.onLocalService* 事件返回。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-1-wx-stopLocalServiceDiscovery-停止搜索-mDNS-服务"><span class="toc-text">2.2.1 wx.stopLocalServiceDiscovery 停止搜索 mDNS 服务</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-发起请求-（请求后端数据）"><span class="toc-text">2.3 发起请求 （请求后端数据）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-1-wx-request-发起-HTTPS-网络请求。"><span class="toc-text">2.3.1 wx.request 发起 HTTPS 网络请求。</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-1-1-ArrayBuffer-对象-就是各种类数组对象"><span class="toc-text">2.3.1.1 ArrayBuffer 对象(就是各种类数组对象)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-1-2-http-文档学习请求头"><span class="toc-text">2.3.1.2 http 文档学习请求头</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-1-3-data-参数说明"><span class="toc-text">2.3.1.3 data 参数说明</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-1-RequestTask-abort-中断请求任务"><span class="toc-text">2.3.1 RequestTask.abort 中断请求任务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-1-RequestTask-offHeadersReceived-取消监听-HTTP-Response-Header-事件。会比请求完成事件更早"><span class="toc-text">2.3.1 RequestTask.offHeadersReceived 取消监听 HTTP Response Header 事件。会比请求完成事件更早</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-1-RequestTask-onHeadersReceived-监听-HTTP-Response-Header-事件。会比请求完成事件更早"><span class="toc-text">2.3.1 RequestTask.onHeadersReceived 监听 HTTP Response Header 事件。会比请求完成事件更早</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-上传"><span class="toc-text">2.4 上传</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-1-wx-uploadFile-将本地资源上传到服务器。"><span class="toc-text">2.4.1 wx.uploadFile 将本地资源上传到服务器。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-2-UploadTask-abort-中断上传任务"><span class="toc-text">2.4.2 UploadTask.abort 中断上传任务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-3-UploadTask-offHeadersReceived-取消监听-HTTP-Response-Header-事件。会比请求完成事件更早"><span class="toc-text">2.4.3 UploadTask.offHeadersReceived 取消监听 HTTP Response Header 事件。会比请求完成事件更早</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-4-UploadTask-offProgressUpdate-取消监听上传进度变化事件"><span class="toc-text">2.4.4 UploadTask.offProgressUpdate 取消监听上传进度变化事件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-5-UploadTask-onHeadersReceived-监听-HTTP-Response-Header-事件。会比请求完成事件更早"><span class="toc-text">2.4.5 UploadTask.onHeadersReceived 监听 HTTP Response Header 事件。会比请求完成事件更早</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-6-UploadTask-onProgressUpdate-监听上传进度变化事件"><span class="toc-text">2.4.6 UploadTask.onProgressUpdate 监听上传进度变化事件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-WebSocket"><span class="toc-text">2.5 WebSocket</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5-4-SocketTask-close，SocketTask-onClose，SocketTask-onError，SocketTask-onMessage，SocketTask-onOpen，SocketTask-send"><span class="toc-text">2.5.4 SocketTask.close，SocketTask.onClose，SocketTask.onError，SocketTask.onMessage，SocketTask.onOpen，SocketTask.send</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#三、媒体"><span class="toc-text">三、媒体</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-音频-AudioContext-对象-（是单个组件的音频对象？？？？？）"><span class="toc-text">3.1 音频 AudioContext  对象 （是单个组件的音频对象？？？？？）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-1-wx-createAudioContext-创建音频对象"><span class="toc-text">3.1.1 wx.createAudioContext  创建音频对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-2-wx-getAvailableAudioSources-获取当前支持的音频输入源"><span class="toc-text">3.1.2 wx.getAvailableAudioSources 获取当前支持的音频输入源</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-3-wx-playVoice、wx-pauseVoice、wx-stopVoice-暂停-播放-停止-正在播放的语音"><span class="toc-text">3.1.3 wx.playVoice、wx.pauseVoice、wx.stopVoice 暂停/播放/停止 正在播放的语音</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-4-AudioContext-音频对象的方法"><span class="toc-text">3.1.4  AudioContext 音频对象的方法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-音频-InnerAudioContext-对象-（是整个小程序的音频对象？？？？？）"><span class="toc-text">3.2 音频 InnerAudioContext  对象 （是整个小程序的音频对象？？？？？）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-1-wx-createInnerAudioContext-创建-内部音频对象"><span class="toc-text">3.2.1 wx.createInnerAudioContext   创建 内部音频对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-2-wx-setInnerAudioOption-设置-InnerAudioContext-的播放选项。设置之后对当前小程序全局生效。"><span class="toc-text">3.2.2 wx.setInnerAudioOption 设置 InnerAudioContext 的播放选项。设置之后对当前小程序全局生效。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-3-内部音频对象的方法"><span class="toc-text">3.2.3 内部音频对象的方法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-背景音频-BackgroundAudioManager-对象-（背景音频对象）"><span class="toc-text">3.3 背景音频 BackgroundAudioManager 对象 （背景音频对象）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-1-创建-背景音频-BackgroundAudioManager-对象"><span class="toc-text">3.3.1 创建 背景音频 BackgroundAudioManager 对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-2-背景音频-BackgroundAudioManager-对象-wx-API-接口方法"><span class="toc-text">3.3.2 背景音频 BackgroundAudioManager 对象  wx.API 接口方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-2-背景音频-BackgroundAudioManager-对象-的方法"><span class="toc-text">3.3.2 背景音频 BackgroundAudioManager 对象  的方法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-相机"><span class="toc-text">3.4 相机</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-1-wx-createCameraContext-创建-相机上下文对象-无参数"><span class="toc-text">3.4.1 wx.createCameraContext 创建 相机上下文对象 [无参数]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-2-CameraContext-相机上下文对象-的方法"><span class="toc-text">3.4.2 CameraContext  相机上下文对象 的方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-3-相机完整的代码实例"><span class="toc-text">3.4.3 相机完整的代码实例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-字体-wx-loadFontFace-动态加载网络字体。"><span class="toc-text">3.5 字体 wx.loadFontFace 动态加载网络字体。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6-图片"><span class="toc-text">3.6 图片</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-6-1-运用实例"><span class="toc-text">3.6.1 运用实例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-7-实时音视频-直播"><span class="toc-text">3.7 实时音视频 (直播)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-7-1-LivePlayerContext-对象-观看直播"><span class="toc-text">3.7.1 LivePlayerContext 对象  (观看直播)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-7-2-LivePusherContext-对象-（开直播）"><span class="toc-text">3.7.2 LivePusherContext 对象 （开直播）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-7-3-实时音视频-直播-权限"><span class="toc-text">3.7.3 实时音视频 (直播) 权限</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-7-录音"><span class="toc-text">3.7 录音</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-7-1-wx-getRecorderManager-获取全局唯一的录音管理器-RecorderManager-对象-无参数"><span class="toc-text">3.7.1 wx.getRecorderManager  获取全局唯一的录音管理器 RecorderManager 对象   无参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-7-3-RecorderManager-对象的方法"><span class="toc-text">3.7.3  RecorderManager 对象的方法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-8-视频"><span class="toc-text">3.8 视频</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-8-1-VideoContext-的-wx-Api"><span class="toc-text">3.8.1 VideoContext 的 wx.Api</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-8-1-VideoContext-对象的-方法"><span class="toc-text">3.8.1 VideoContext 对象的 方法</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#四、文件"><span class="toc-text">四、文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#五、数据缓存"><span class="toc-text">五、数据缓存</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-异步操作"><span class="toc-text">5.1 异步操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-同步操作"><span class="toc-text">5.2 同步操作</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#六、位置（地理位置）调用前需要授权"><span class="toc-text">六、位置（地理位置）调用前需要授权</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#七、设备"><span class="toc-text">七、设备</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-加速计"><span class="toc-text">7.1 加速计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-蓝牙"><span class="toc-text">7.3 蓝牙</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-4-低功耗蓝牙"><span class="toc-text">7.4 低功耗蓝牙</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-5-剪贴板"><span class="toc-text">7.5 剪贴板</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-6-罗盘"><span class="toc-text">7.6 罗盘</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-7-联系人-wx-addPhoneContact"><span class="toc-text">7.7 联系人 wx.addPhoneContact</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-8-陀螺仪"><span class="toc-text">7.8 陀螺仪</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-9-设备方向"><span class="toc-text">7.9 设备方向</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-10-网络"><span class="toc-text">7.10 网络</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-10-NFC"><span class="toc-text">7.10 NFC</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-11-性能"><span class="toc-text">7.11 性能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-12-电话"><span class="toc-text">7.12 电话</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-13-扫码"><span class="toc-text">7.13 扫码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-14-屏幕"><span class="toc-text">7.14 屏幕</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-15-振动"><span class="toc-text">7.15 振动</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-16-Wi-Fi"><span class="toc-text">7.16 Wi-Fi</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-16-2-实例"><span class="toc-text">7.16.2 实例</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#八、界面"><span class="toc-text">八、界面</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-动画"><span class="toc-text">8.1 动画</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-1-wx-createAnimation-创建-动画对象"><span class="toc-text">8.1.1  wx.createAnimation 创建 动画对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-2-Animation-动画对象的方法"><span class="toc-text">8.1.2  Animation 动画对象的方法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-背景"><span class="toc-text">8.2 背景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-自定义组件-wx-nextTick-延迟一部分操作到下一个时间片再执行。（类似于-setTimeout）？？？？？？？？"><span class="toc-text">8.3 自定义组件 wx.nextTick  延迟一部分操作到下一个时间片再执行。（类似于 setTimeout）？？？？？？？？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-4-交互（提示框，对话框）"><span class="toc-text">8.4 交互（提示框，对话框）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-5-菜单（导航栏）-wx-getMenuButtonBoundingClientRect-获取菜单按钮（右上角胶囊按钮）的布局位置信息。"><span class="toc-text">8.5 菜单（导航栏） wx.getMenuButtonBoundingClientRect 获取菜单按钮（右上角胶囊按钮）的布局位置信息。</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-5-1-自定义导航栏-顶部导航条"><span class="toc-text">8.5.1 自定义导航栏(顶部导航条)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-6-导航栏"><span class="toc-text">8.6 导航栏</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-7-下拉刷新"><span class="toc-text">8.7 下拉刷新</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-8-滚动-wx-pageScrollTo-将页面滚动到目标位置"><span class="toc-text">8.8 滚动 wx.pageScrollTo 将页面滚动到目标位置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-9-置顶-（动态设置导航栏-与-tabbar-栏）"><span class="toc-text">8.9 置顶 （动态设置导航栏 与 tabbar 栏）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-9-1-wx-setTopBarText-动态设置置顶栏文字内容。"><span class="toc-text">8.9.1 wx.setTopBarText 动态设置置顶栏文字内容。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-9-2-Tab-Bar-动态设置-tabbar-栏"><span class="toc-text">8.9.2 Tab Bar 动态设置 tabbar 栏</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-10-窗口（窗口尺寸变化处理）"><span class="toc-text">8.10 窗口（窗口尺寸变化处理）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#九、开放接口-就是获取到用户的各种数据-的接口，开方消息的意思么"><span class="toc-text">九、开放接口 (就是获取到用户的各种数据 的接口，开方消息的意思么)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-1-接口调用凭证"><span class="toc-text">9.1 接口调用凭证</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-1-1-什么是调用凭证，就是凭什么给你资料咯，就是给微信要的-token"><span class="toc-text">9.1.1 什么是调用凭证，就是凭什么给你资料咯，就是给微信要的 token</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-1-2-getAccessToken-获取小程序全局唯一后台接口调用凭据（access-token）。"><span class="toc-text">9.1.2 getAccessToken 获取小程序全局唯一后台接口调用凭据（access_token）。</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#9-1-2-1-获取Access-Token的3种方式："><span class="toc-text">9.1.2.1 获取Access Token的3种方式：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#9-1-2-2-调用各后台接口时都需使用-access-token，开发者需要进行妥善保存。"><span class="toc-text">9.1.2.2 **调用各后台接口时都需使用 access_token，开发者需要进行妥善保存。</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-2-wx-getAccountInfoSync-获取当前帐号信息"><span class="toc-text">9.2 wx.getAccountInfoSync  获取当前帐号信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-3-wx-chooseAddress-获取用户收货地址。调起用户编辑收货地址原生界面，并在编辑完成后返回用户选择的地址。"><span class="toc-text">9.3 wx.chooseAddress 获取用户收货地址。调起用户编辑收货地址原生界面，并在编辑完成后返回用户选择的地址。</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-3-1-调用前需要-用户授权-scope-address，"><span class="toc-text">9.3.1  调用前需要 用户授权 scope.address，</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-3-2-语法：wx-chooseAddress-Object-object-获取用户收货地址-代码"><span class="toc-text">9.3.2 语法：wx.chooseAddress(Object object) 获取用户收货地址 代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-4-wx-authorize-授权-提前向用户发起授权请求。"><span class="toc-text">9.4 wx.authorize 授权: 提前向用户发起授权请求。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-5-卡券"><span class="toc-text">9.5 卡券</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-5-1-小程序-认证"><span class="toc-text">9.5.1 小程序 认证</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-5-2-wx-addCard-Object-object-批量添加卡券。小程序先要认证"><span class="toc-text">9.5.2 wx.addCard(Object object) 批量添加卡券。小程序先要认证</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-5-3-wx-openCard-Object-object-查看微信卡包中的卡券。小程序先要认证"><span class="toc-text">9.5.3 wx.openCard(Object object) 查看微信卡包中的卡券。小程序先要认证</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-6-客服消息？？？？？？？？？？？？？？？？？？？不知道具体是怎么做的"><span class="toc-text">9.6 客服消息？？？？？？？？？？？？？？？？？？？不知道具体是怎么做的</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-6-1-customerTyping-客服输入状态接口"><span class="toc-text">9.6.1 customerTyping 客服输入状态接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-6-1-getTempMedia-获取客服消息内的临时素材。即下载临时的多媒体文件。目前小程序仅支持下载图片文件。"><span class="toc-text">9.6.1 getTempMedia  获取客服消息内的临时素材。即下载临时的多媒体文件。目前小程序仅支持下载图片文件。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-6-1-sendCustomerMessage-发送客服消息给用户。"><span class="toc-text">9.6.1 sendCustomerMessage 发送客服消息给用户。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-6-1-uploadTempMedia-把媒体文件上传到微信服务器。目前仅支持图片。用于发送客服消息或被动回复用户消息。"><span class="toc-text">9.6.1 uploadTempMedia 把媒体文件上传到微信服务器。目前仅支持图片。用于发送客服消息或被动回复用户消息。</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-7-数据分析"><span class="toc-text">9.7 数据分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-7-1-wx-reportAnalytics-自定义分析数据上报接口。"><span class="toc-text">9.7.1 wx.reportAnalytics 自定义分析数据上报接口。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-7-1-getAnalysisDailyRetain-获取用户访问小程序日留存-本接口应在后端服务器调用-所以这个是后端的工作咯"><span class="toc-text">9.7.1 getAnalysisDailyRetain 获取用户访问小程序日留存 (本接口应在后端服务器调用!!!!!所以这个是后端的工作咯)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-7-1-getAnalysisDailySummary-获取用户访问小程序数据概况-本接口应在后端服务器调用"><span class="toc-text">9.7.1 getAnalysisDailySummary 获取用户访问小程序数据概况 本接口应在后端服务器调用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-7-1-getAnalysisDailyVisitTrend-获取用户访问小程序数据日趋势-本接口应在后端服务器调用"><span class="toc-text">9.7.1 getAnalysisDailyVisitTrend 获取用户访问小程序数据日趋势 本接口应在后端服务器调用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-7-1-getAnalysisMonthlyRetain-获取用户访问小程序周留存-本接口应在后端服务器调用"><span class="toc-text">9.7.1 getAnalysisMonthlyRetain  获取用户访问小程序周留存 本接口应在后端服务器调用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-7-1-getAnalysisMonthlyVisitTrend-获取用户访问小程序数据月趋势-本接口应在后端服务器调用"><span class="toc-text">9.7.1 getAnalysisMonthlyVisitTrend 获取用户访问小程序数据月趋势 本接口应在后端服务器调用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-7-1-getAnalysisUserPortrait-获取小程序新增或活跃用户的画像分布数据。本接口应在后端服务器调用"><span class="toc-text">9.7.1 getAnalysisUserPortrait  获取小程序新增或活跃用户的画像分布数据。本接口应在后端服务器调用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-7-1-getAnalysisVisitDistribution-获取用户小程序访问分布数据-本接口应在后端服务器调用"><span class="toc-text">9.7.1 getAnalysisVisitDistribution 获取用户小程序访问分布数据 本接口应在后端服务器调用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-7-1-getAnalysisVisitPage-访问页面。目前只提供按-page-visit-pv-排序的-top200。-本接口应在后端服务器调用"><span class="toc-text">9.7.1 getAnalysisVisitPage 访问页面。目前只提供按 page_visit_pv 排序的 top200。 本接口应在后端服务器调用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-7-1-getAnalysisWeeklyRetain-获取用户访问小程序周留存-本接口应在后端服务器调用"><span class="toc-text">9.7.1 getAnalysisWeeklyRetain 获取用户访问小程序周留存 本接口应在后端服务器调用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-7-1-getAnalysisWeeklyVisitTrend-获取用户访问小程序数据周趋势-本接口应在后端服务器调用"><span class="toc-text">9.7.1 getAnalysisWeeklyVisitTrend 获取用户访问小程序数据周趋势 本接口应在后端服务器调用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-8-发票"><span class="toc-text">9.8 发票</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-8-1-用户授权"><span class="toc-text">9.8.1  用户授权</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-8-1-wx-chooseInvoice-选择用户已有的发票"><span class="toc-text">9.8.1 wx.chooseInvoice 选择用户已有的发票</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-8-2-wx-chooseInvoiceTitle-选择用户的发票抬头"><span class="toc-text">9.8.2 wx.chooseInvoiceTitle 选择用户的发票抬头</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-9-登录"><span class="toc-text">9.9 登录</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-9-1-wx-checkSession-检查登录态是否过期。"><span class="toc-text">9.9.1 wx.checkSession 检查登录态是否过期。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-9-2-wx-login-调用接口获取登录凭证-code-（这个code是临时登录凭证，用于获取-openid-的）"><span class="toc-text">9.9.2 wx.login 调用接口获取登录凭证 code  （这个code是临时登录凭证，用于获取 openid 的）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-9-3-前端登录代码"><span class="toc-text">9.9.3 前端登录代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-9-4-code2Session-登录凭证校验。-本接口应在后端服务器调用"><span class="toc-text">9.9.4 code2Session 登录凭证校验。 本接口应在后端服务器调用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-10-小程序跳转-从一个小程序-跳转-另外一个小程序"><span class="toc-text">9.10 小程序跳转 (从一个小程序 跳转 另外一个小程序)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-10-1-wx-navigateToMiniProgram-返回到上一个小程序。只有在当前小程序是被其他小程序打开时可以调用成功"><span class="toc-text">9.10.1 wx.navigateToMiniProgram   返回到上一个小程序。只有在当前小程序是被其他小程序打开时可以调用成功</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-10-2-wx-navigateBackMiniProgram-打开另一个小程序"><span class="toc-text">9.10.2 wx.navigateBackMiniProgram  打开另一个小程序</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-11-附近的小程序（后端的工作）"><span class="toc-text">9.11 附近的小程序（后端的工作）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-11-1-addNearbyPoi-添加地点-本接口应在后端服务器调用"><span class="toc-text">9.11.1 addNearbyPoi 添加地点 本接口应在后端服务器调用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-11-1-deleteNearbyPoi-删除地点-本接口应在后端服务器调用"><span class="toc-text">9.11.1 deleteNearbyPoi 删除地点 本接口应在后端服务器调用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-11-1-getNearbyPoiList-查看地点列表-本接口应在后端服务器调用"><span class="toc-text">9.11.1 getNearbyPoiList 查看地点列表 本接口应在后端服务器调用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-11-1-setNearbyPoiShowStatus-展示-取消展示附近小程序-本接口应在后端服务器调用"><span class="toc-text">9.11.1 setNearbyPoiShowStatus 展示/取消展示附近小程序 本接口应在后端服务器调用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-12-支付（仅仅是微信支付）"><span class="toc-text">9.12 支付（仅仅是微信支付）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-12-1-wx-requestPayment-发起微信支付。"><span class="toc-text">9.12.1 wx.requestPayment 发起微信支付。</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-13-插件管理-（本接口应在后端服务器调用）"><span class="toc-text">9.13 插件管理 （本接口应在后端服务器调用）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-13-1applyPlugin-向插件开发者发起使用插件的申请（本接口应在后端服务器调用）"><span class="toc-text">9.13.1applyPlugin 向插件开发者发起使用插件的申请（本接口应在后端服务器调用）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-13-1getPluginDevApplyList-获取当前所有插件使用方（供插件开发者调用）（本接口应在后端服务器调用）"><span class="toc-text">9.13.1getPluginDevApplyList 获取当前所有插件使用方（供插件开发者调用）（本接口应在后端服务器调用）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-13-1getPluginList-查询已添加的插件（本接口应在后端服务器调用）"><span class="toc-text">9.13.1getPluginList  查询已添加的插件（本接口应在后端服务器调用）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-13-1setDevPluginApplyStatus-修改插件使用申请的状态（供插件开发者调用）（本接口应在后端服务器调用）"><span class="toc-text">9.13.1setDevPluginApplyStatus 修改插件使用申请的状态（供插件开发者调用）（本接口应在后端服务器调用）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-13-1unbindPlugin-删除已添加的插件（本接口应在后端服务器调用）"><span class="toc-text">9.13.1unbindPlugin 删除已添加的插件（本接口应在后端服务器调用）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-14-二维码-（本接口应在后端服务器调用）"><span class="toc-text">9.14 二维码 （本接口应在后端服务器调用）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-14-1-createWXAQRCode-获取-小程序二维码-，适用于需要的码数量-较少-的业务场景。-（本接口应在后端服务器调用）"><span class="toc-text">9.14.1 createWXAQRCode 获取 [小程序二维码]，适用于需要的码数量  [较少]   的业务场景。 （本接口应在后端服务器调用）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-14-1-getWXACode-获取-小程序码-，适用于需要的码数量-较少-的业务场景。-（本接口应在后端服务器调用）"><span class="toc-text">9.14.1 getWXACode     获取 [小程序码]，适用于需要的码数量   [较少]   的业务场景。 （本接口应在后端服务器调用）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-14-1-getWXACodeUnlimit-获取-小程序码-，适用于需要的码数量-极多-的业务场景。-（本接口应在后端服务器调用）"><span class="toc-text">9.14.1 getWXACodeUnlimit 获取 [小程序码]，适用于需要的码数量 [极多] 的业务场景。 （本接口应在后端服务器调用）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-15-内容安全（检查-用户-图片-或者-文本-的安全性）（本接口应在后端服务器调用）"><span class="toc-text">9.15 内容安全（检查 用户  图片 或者 文本 的安全性）（本接口应在后端服务器调用）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-15-1-imgSecCheck-校验一张图片是否含有违法违规内容。（本接口应在后端服务器调用）"><span class="toc-text">9.15.1 imgSecCheck  校验一张图片是否含有违法违规内容。（本接口应在后端服务器调用）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-15-1-msgSecCheck-检查一段文本是否含有违法违规内容。（本接口应在后端服务器调用）"><span class="toc-text">9.15.1 msgSecCheck 检查一段文本是否含有违法违规内容。（本接口应在后端服务器调用）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-16-设置"><span class="toc-text">9.16 设置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-16-1-AuthSetting"><span class="toc-text">9.16.1 AuthSetting</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-16-2-wx-getSetting-获取用户的当前设置。"><span class="toc-text">9.16.2 wx.getSetting 获取用户的当前设置。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-16-3-wx-openSetting-调起客户端小程序设置界面，返回用户设置的操作结果。"><span class="toc-text">9.16.3 wx.openSetting 调起客户端小程序设置界面，返回用户设置的操作结果。</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-17-生物认证-指纹识别，人脸识别，声纹识别"><span class="toc-text">9.17 生物认证(指纹识别，人脸识别，声纹识别)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-17-1-wx-checkIsSoterEnrolledInDevice-获取设备内是否录入如指纹等生物信息的接口"><span class="toc-text">9.17.1 wx.checkIsSoterEnrolledInDevice 获取设备内是否录入如指纹等生物信息的接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-17-1-wx-checkIsSupportSoterAuthentication"><span class="toc-text">9.17.1 wx.checkIsSupportSoterAuthentication</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-17-1-wx-startSoterAuthentication"><span class="toc-text">9.17.1 wx.startSoterAuthentication</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-18-模板消息-（本接口应在后端服务器调用）"><span class="toc-text">9.18 模板消息 （本接口应在后端服务器调用）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-18-1-addTemplate-组合模板并添加至帐号下的个人模板库（本接口应在后端服务器调用）"><span class="toc-text">9.18.1 addTemplate 组合模板并添加至帐号下的个人模板库（本接口应在后端服务器调用）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-18-1-deleteTemplate-删除帐号下的某个模板（本接口应在后端服务器调用）"><span class="toc-text">9.18.1 deleteTemplate 删除帐号下的某个模板（本接口应在后端服务器调用）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-18-1-getTemplateLibraryById-获取模板库某个模板标题下关键词库（本接口应在后端服务器调用）"><span class="toc-text">9.18.1 getTemplateLibraryById 获取模板库某个模板标题下关键词库（本接口应在后端服务器调用）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-18-1-getTemplateLibraryList-获取小程序模板库标题列表（本接口应在后端服务器调用）"><span class="toc-text">9.18.1 getTemplateLibraryList 获取小程序模板库标题列表（本接口应在后端服务器调用）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-18-1-getTemplateList-获取帐号下已存在的模板列表（本接口应在后端服务器调用）"><span class="toc-text">9.18.1 getTemplateList 获取帐号下已存在的模板列表（本接口应在后端服务器调用）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-18-1-sendTemplateMessage-发送模板消息（本接口应在后端服务器调用）"><span class="toc-text">9.18.1 sendTemplateMessage 发送模板消息（本接口应在后端服务器调用）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-19-统一服务消息-（本接口应在后端服务器调用）"><span class="toc-text">9.19 统一服务消息 （本接口应在后端服务器调用）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-19-1-sendUniformMessage-下发小程序和公众号统一的服务消息-（本接口应在后端服务器调用）"><span class="toc-text">9.19.1 sendUniformMessage   下发小程序和公众号统一的服务消息 （本接口应在后端服务器调用）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-20-动态消息-（本接口应在后端服务器调用）"><span class="toc-text">9.20 动态消息 （本接口应在后端服务器调用）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-20-1-createActivityId-创建被分享动态消息的-activity-id。-（本接口应在后端服务器调用）"><span class="toc-text">9.20.1 createActivityId 创建被分享动态消息的 activity_id。 （本接口应在后端服务器调用）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-20-2-setUpdatableMsg-修改被分享的动态消息。详见动态消息。（本接口应在后端服务器调用）"><span class="toc-text">9.20.2 setUpdatableMsg 修改被分享的动态消息。详见动态消息。（本接口应在后端服务器调用）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-21-用户信息-调用前需要-用户授权"><span class="toc-text">9.21 用户信息 (调用前需要 用户授权)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-21-1-UserInfo-用户信息"><span class="toc-text">9.21.1 UserInfo  用户信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-21-2-wx-getUserInfo-获取用户信息。"><span class="toc-text">9.21.2 wx.getUserInfo 获取用户信息。</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#9-21-1-1-在用户未授权过的情况下调用此接口，将不再出现授权弹窗-每次小程序都提示的消息"><span class="toc-text">9.21.1.1 在用户未授权过的情况下调用此接口，将不再出现授权弹窗!!!!!!!!!!!!!!!!!!!!!!!!!!!!每次小程序都提示的消息</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-22微信运动-调用前需要-用户授权"><span class="toc-text">9.22微信运动 (调用前需要 用户授权)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-22-1-wx-getWeRunData-获取用户过去三十天微信运动步数。"><span class="toc-text">9.22.1 wx.getWeRunData 获取用户过去三十天微信运动步数。</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#十、更新-UpdateManager-小程序版本更新-（个人中心提示用户版本升级用的）"><span class="toc-text">十、更新 UpdateManager(小程序版本更新)（个人中心提示用户版本升级用的）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#10-1-wx-getUpdateManager-获取全局唯一的版本更新管理器，用于管理小程序更新。关于小程序的更新机制，可以查看运行机制文档。"><span class="toc-text">10.1 wx.getUpdateManager  获取全局唯一的版本更新管理器，用于管理小程序更新。关于小程序的更新机制，可以查看运行机制文档。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-2-UpdateManager-applyUpdate-强制小程序重启并使用新版本。"><span class="toc-text">10.2 UpdateManager.applyUpdate  强制小程序重启并使用新版本。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-3-UpdateManager-onCheckForUpdate-监听向微信后台请求检查更新结果事件。"><span class="toc-text">10.3 UpdateManager.onCheckForUpdate 监听向微信后台请求检查更新结果事件。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-4-UpdateManager-onUpdateFailed-监听小程序更新失败事件。"><span class="toc-text">10.4 UpdateManager.onUpdateFailed 监听小程序更新失败事件。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-5-UpdateManager-onUpdateReady-监听小程序有版本更新事件。"><span class="toc-text">10.5 UpdateManager.onUpdateReady 监听小程序有版本更新事件。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-6-完整示例代码"><span class="toc-text">10.6 完整示例代码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#十一、Worker（运行一些异步处理的任务）（就是变成语言中的单线程-与-多线程-js-中是单线程工作的）"><span class="toc-text">十一、Worker（运行一些异步处理的任务）（就是变成语言中的单线程 与 多线程 js 中是单线程工作的）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#11-1-wx-createWorker-创建一个-Worker-线程。"><span class="toc-text">11.1 wx.createWorker   创建一个 Worker 线程。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-2-Worker-onMessage-监听主线程-Worker-线程向当前线程发送的消息的事件。"><span class="toc-text">11.2 Worker.onMessage   监听主线程/Worker 线程向当前线程发送的消息的事件。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-3-Worker-postMessage-向主线程-Worker-线程发送的消息。"><span class="toc-text">11.3 Worker.postMessage  向主线程/Worker 线程发送的消息。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-4-Worker-terminate-结束当前-Worker-线程。"><span class="toc-text">11.4 Worker.terminate()   结束当前 Worker 线程。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-5-完整的示例代码！！！！！！！！！！！！！"><span class="toc-text">11.5 完整的示例代码！！！！！！！！！！！！！</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#11-5-1-使用流程：配置过程"><span class="toc-text">11.5.1 使用流程：配置过程</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#十二、数据上报（小程序管理后台-运维中心-性能监控-业务数据监控）（说白了就是小程序的用户使用各种情况数据？？？）"><span class="toc-text">十二、数据上报（小程序管理后台-运维中心-性能监控-业务数据监控）（说白了就是小程序的用户使用各种情况数据？？？）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#12-1-wx-reportMonitor-自定义业务数据监控上报接口。"><span class="toc-text">12.1 wx.reportMonitor 自定义业务数据监控上报接口。</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#十三、小程序（事件错误-与-生命周期）"><span class="toc-text">十三、小程序（事件错误 与 生命周期）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#13-1-wx-offError-事件：取消监听小程序错误事件。"><span class="toc-text">13.1 wx.offError 事件：取消监听小程序错误事件。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-2-wx-onError-事件：监听小程序错误事件。如脚本错误或API调用报错等。？？？？？看不懂啊？？？？"><span class="toc-text">13.2 wx.onError 事件：监听小程序错误事件。如脚本错误或API调用报错等。？？？？？看不懂啊？？？？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-3-wx-getLaunchOptionsSync-生命周期-：获取小程序启动时的参数。与-App-onLaunch-的回调参数一致。"><span class="toc-text">13.3 wx.getLaunchOptionsSync 生命周期 ：获取小程序启动时的参数。与 App.onLaunch 的回调参数一致。</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#13-3-1-scene-场景值"><span class="toc-text">13.3.1 scene 场景值</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#小游戏于小程序什么区别？？？？？？"><span class="toc-text">小游戏于小程序什么区别？？？？？？</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#13-3-2-wx-getLaunchOptionsSync-返回有效-referrerInfo-的场景"><span class="toc-text">13.3.2  wx.getLaunchOptionsSync 返回有效 referrerInfo 的场景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#13-3-3-注意"><span class="toc-text">13.3.3 注意</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#十四、基础（判断是否可以-某些-API-接口：当然是能用才可以用）"><span class="toc-text">十四、基础（判断是否可以 某些 API 接口：当然是能用才可以用）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#14-1-wx-canIUse-判断小程序的API，回调，参数，组件等是否在当前版本可用。"><span class="toc-text">14.1 wx.canIUse 判断小程序的API，回调，参数，组件等是否在当前版本可用。</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#十五、画布（是不是做动画的？？？？？后面再学习吧）"><span class="toc-text">十五、画布（是不是做动画的？？？？？后面再学习吧）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#15-1-Color-颜色。可以用以下几种方式来表示-canvas-中使用的颜色："><span class="toc-text">15.1 Color 颜色。可以用以下几种方式来表示 canvas 中使用的颜色：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#15-2-CanvasContext-是-canvas-组件的绘图上下文"><span class="toc-text">15.2 CanvasContext 是 canvas 组件的绘图上下文</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#15-2-1-wx-createCanvasContext（）-创建-创建-CanvasContext-对象"><span class="toc-text">15.2.1 wx.createCanvasContext（） 创建 创建 CanvasContext 对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#15-2-1-CanvasContext-arc-与-CanvasContext-arcTo-绘制一段弧线"><span class="toc-text">15.2.1 CanvasContext.arc 与 CanvasContext.arcTo  绘制一段弧线</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#15-2-2-CanvasContext-rect-绘制矩形"><span class="toc-text">15.2.2  CanvasContext.rect 绘制矩形</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#15-2-3-CanvasContext-bezierCurveTo-绘制三次方贝塞尔曲线路径。曲线的起始点为路径中前一个点。"><span class="toc-text">15.2.3  CanvasContext.bezierCurveTo() 绘制三次方贝塞尔曲线路径。曲线的起始点为路径中前一个点。</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#15-3-CanvasGradient-渐变对象"><span class="toc-text">15.3 CanvasGradient 渐变对象</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#15-3-1-CanvasGradient-addColorStop-添加颜色的渐变点。"><span class="toc-text">15.3.1 CanvasGradient.addColorStop 添加颜色的渐变点。</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#15-4-wx-canvasGetImageData-获取-canvas-区域隐含的像素数据。"><span class="toc-text">15.4 wx.canvasGetImageData 获取 canvas 区域隐含的像素数据。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#15-5-wx-canvasPutImageData-将像素数据绘制到画布。"><span class="toc-text">15.5 wx.canvasPutImageData 将像素数据绘制到画布。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#15-6-wx-canvasToTempFilePath-把当前画布指定区域的内容导出生成指定大小的图片。"><span class="toc-text">15.6 wx.canvasToTempFilePath 把当前画布指定区域的内容导出生成指定大小的图片。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#15-7-完整的示例"><span class="toc-text">15.7 完整的示例!!!!!!!!!!!!!!!!!!</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#十六、调试（开发过程中对-小程序代码的调试）"><span class="toc-text">十六、调试（开发过程中对 小程序代码的调试）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#16-1-LogManager-日志管理器实例，"><span class="toc-text">16.1 LogManager 日志管理器实例，</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#16-1-1-wx-getLogManager-创建-日志管理器实例-对象"><span class="toc-text">16.1.1 wx.getLogManager  创建 日志管理器实例 对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#16-1-2-LogManager-debug-写-debug-日志"><span class="toc-text">16.1.2 LogManager.debug  写 debug 日志</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#16-1-3-LogManager-info-写-info-日志"><span class="toc-text">16.1.3 LogManager.info   写 info 日志</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#16-1-4-LogManager-log-写-log-日志"><span class="toc-text">16.1.4 LogManager.log    写 log 日志</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#16-1-5-LogManager-warn-写-warn-日志"><span class="toc-text">16.1.5 LogManager.warn   写 warn 日志</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#16-2-wx-setEnableDebug-设置是否打开调试开关。此开关对正式版也能生效。"><span class="toc-text">16.2 wx.setEnableDebug 设置是否打开调试开关。此开关对正式版也能生效。</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#16-2-1-在正式版打开调试还有一种方法，就是先在开发版或体验版打开调试，再切到正式版就能看到vConsole。"><span class="toc-text">16.2.1 在正式版打开调试还有一种方法，就是先在开发版或体验版打开调试，再切到正式版就能看到vConsole。</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#16-3-console-向调试面板中打印日志。console-是一个全局对象，可以直接访问。"><span class="toc-text">16.3 console 向调试面板中打印日志。console 是一个全局对象，可以直接访问。</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#16-3-1-console-debug-向调试面板中打印-debug-日志"><span class="toc-text">16.3.1  console.debug 向调试面板中打印 debug 日志</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#16-3-2-console-error-向调试面板中打印-error-日志"><span class="toc-text">16.3.2  console.error 向调试面板中打印 error 日志</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#16-3-3-console-group-在调试面板中创建一个新的分组。"><span class="toc-text">16.3.3  console.group 在调试面板中创建一个新的分组。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#16-3-1-console-groupEnd-结束由-console-group-创建的分组"><span class="toc-text">16.3.1  console.groupEnd() 结束由 console.group 创建的分组,</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#16-3-4-console-info-向调试面板中打印-info-日志"><span class="toc-text">16.3.4  console.info 向调试面板中打印 info 日志</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#16-3-5-console-log-向调试面板中打印-log-日志"><span class="toc-text">16.3.5  console.log 向调试面板中打印 log 日志</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#16-3-6-console-warn-向调试面板中打印-warn-日志"><span class="toc-text">16.3.6  console.warn 向调试面板中打印 warn 日志</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#16-3-7-注意事项"><span class="toc-text">16.3.7 注意事项</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#十七、第三方平台"><span class="toc-text">十七、第三方平台</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#17-1-wx-getExtConfig-获取第三方平台自定义的数据字段。"><span class="toc-text">17.1 wx.getExtConfig 获取第三方平台自定义的数据字段。</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#17-1-1-本接口暂时无法通过-wx-canIUse-判断是否兼容，开发者需要自行判断-wx-getExtConfig-是否存在来兼容"><span class="toc-text">17.1.1  本接口暂时无法通过 wx.canIUse 判断是否兼容，开发者需要自行判断 wx.getExtConfig 是否存在来兼容</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#17-2-wx-getExtConfigSync-是-wx-getExtConfig-的同步版本。-无参数"><span class="toc-text">17.2 wx.getExtConfigSync() 是 wx.getExtConfig 的同步版本。 无参数!!!!!!!!!!!</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#17-2-1-本接口暂时无法通过-wx-canIUse-判断是否兼容，开发者需要自行判断-wx-getExtConfigSync-是否存在来兼容"><span class="toc-text">17.2.1  本接口暂时无法通过 wx.canIUse 判断是否兼容，开发者需要自行判断 wx.getExtConfigSync 是否存在来兼容</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#17-3-wx-getExtConfigSync（）-与-wx-getExtConfig（obj）-的区别？？？？？？？？？？？？？？？？？？"><span class="toc-text">17.3 wx.getExtConfigSync（） 与 wx.getExtConfig（obj） 的区别？？？？？？？？？？？？？？？？？？</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#十八、地图-map"><span class="toc-text">十八、地图 map</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#18-1-MapContext-map-上下文-MapContext-对象。"><span class="toc-text">18.1 MapContext         map 上下文 MapContext 对象。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#18-2-wx-createMapContext-创建-map-上下文-MapContext-对象。"><span class="toc-text">18.2 wx.createMapContext 创建 map 上下文 MapContext 对象。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#18-3-MapContext-getCenterLocation-获取当前地图中心的经纬度。返回的是-gcj02-坐标系，可以用于-wx-openLocation"><span class="toc-text">18.3  MapContext.getCenterLocation 获取当前地图中心的经纬度。返回的是 gcj02 坐标系，可以用于 wx.openLocation()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#18-3-MapContext-getRegion-获取当前地图的视野范围"><span class="toc-text">18.3  MapContext.getRegion 获取当前地图的视野范围</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#18-3-MapContext-getScale-获取当前地图的缩放级别"><span class="toc-text">18.3  MapContext.getScale 获取当前地图的缩放级别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#18-3-MapContext-includePoints-缩放视野展示所有经纬度"><span class="toc-text">18.3  MapContext.includePoints 缩放视野展示所有经纬度</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#18-3-MapContext-moveToLocation-将地图中心移动到当前定位点。-无参数"><span class="toc-text">18.3  MapContext.moveToLocation() 将地图中心移动到当前定位点。  无参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#18-3-MapContext-translateMarker-平移-marker，带动画"><span class="toc-text">18.3  MapContext.translateMarker 平移 marker，带动画</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#18-4-综合示例"><span class="toc-text">18.4 综合示例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#十九、路由-页面跳转"><span class="toc-text">十九、路由(页面跳转)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#19-1-wx-navigateTo-保留当前页面，跳转到应用内的某个页面。但是不能跳到-tabbar-页面。使用-wx-navigateBack-可以返回到原页面。"><span class="toc-text">19.1 wx.navigateTo 保留当前页面，跳转到应用内的某个页面。但是不能跳到 tabbar 页面。使用 wx.navigateBack 可以返回到原页面。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#19-2-wx-navigateBack-关闭当前页面，返回上一页面或多级页面。可通过-getCurrentPages-获取当前的页面栈，决定需要返回几层。"><span class="toc-text">19.2 wx.navigateBack 关闭当前页面，返回上一页面或多级页面。可通过 getCurrentPages() 获取当前的页面栈，决定需要返回几层。</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#19-2-1-wx-navigateBack-返回上一个页面并且带参数"><span class="toc-text">19.2.1  wx.navigateBack 返回上一个页面并且带参数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#19-3-wx-redirectTo-关闭当前页面，跳转到应用内的某个页面。但是不允许跳转到-tabbar-页面。"><span class="toc-text">19.3 wx.redirectTo 关闭当前页面，跳转到应用内的某个页面。但是不允许跳转到 tabbar 页面。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#19-4-wx-reLaunch-关闭所有页面，打开到应用内的某个页面"><span class="toc-text">19.4 wx.reLaunch 关闭所有页面，打开到应用内的某个页面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#19-5-wx-switchTab-跳转到-tabBar-页面，并关闭其他所有非-tabBar-页面"><span class="toc-text">19.5 wx.switchTab 跳转到 tabBar 页面，并关闭其他所有非 tabBar 页面</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#二十、转发（右上角的转发功能，或者在其他地方自定义的转发功能）"><span class="toc-text">二十、转发（右上角的转发功能，或者在其他地方自定义的转发功能）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#20-1-wx-getShareInfo-获取转发详细信息-基础库-1-1-0-开始支持，低版本需做兼容处理。"><span class="toc-text">20.1 wx.getShareInfo 获取转发详细信息       基础库 1.1.0 开始支持，低版本需做兼容处理。</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#20-1-1-加密数据解密算法"><span class="toc-text">20.1.1 加密数据解密算法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#20-1-2-如需要展示群名称，可以使用开放数据组件-open-data"><span class="toc-text">20.1.2 如需要展示群名称，可以使用开放数据组件 open-data</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#20-2-wx-hideShareMenu-隐藏转发按钮-基础库-1-1-0-开始支持，低版本需做兼容处理。"><span class="toc-text">20.2 wx.hideShareMenu 隐藏转发按钮          基础库 1.1.0 开始支持，低版本需做兼容处理。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#20-3-wx-showShareMenu-显示当前页面的转发按钮-基础库-1-1-0-开始支持，低版本需做兼容处理。"><span class="toc-text">20.3 wx.showShareMenu 显示当前页面的转发按钮 基础库 1.1.0 开始支持，低版本需做兼容处理。</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#20-3-1-获取更多转发信息"><span class="toc-text">20.3.1 获取更多转发信息</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#20-4-wx-updateShareMenu-更新转发属性-基础库-1-2-0-开始支持，低版本需做兼容处理。"><span class="toc-text">20.4 wx.updateShareMenu 更新转发属性         基础库 1.2.0 开始支持，低版本需做兼容处理。</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#20-4-1-获取更多转发消息"><span class="toc-text">20.4.1 获取更多转发消息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#20-4-2-动态消息"><span class="toc-text">20.4.2 动态消息</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#20-5-转发功能-实际使用示例：群转发设置"><span class="toc-text">20.5 转发功能 实际使用示例：群转发设置!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#二十一、系统-手机系统，设备系统"><span class="toc-text">二十一、系统 (手机系统，设备系统)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#21-1-wx-getSystemInfo-获取系统信息"><span class="toc-text">21.1 wx.getSystemInfo 获取系统信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#21-2-wx-getSystemInfoSync-获取系统信息-wx-getSystemInfo-的同步版本"><span class="toc-text">21.2 wx.getSystemInfoSync 获取系统信息 wx.getSystemInfo 的同步版本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#21-3-wx-getSystemInfoSync-与-wx-getSystemInfo-obj-区别"><span class="toc-text">21.3  wx.getSystemInfoSync()  与  wx.getSystemInfo(obj)  区别</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#二十二、定时器"><span class="toc-text">二十二、定时器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#22-1-setInterval-amp-amp-clearInterval-设定-取消一个定时器。间隔执行（多次）"><span class="toc-text">22.1 setInterval &amp;&amp; clearInterval 设定/取消一个定时器。间隔执行（多次）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-2-setTimeout-amp-amp-clearTimeout-设定-取消一个定时器。延迟执行（1-次）"><span class="toc-text">22.2 setTimeout  &amp;&amp; clearTimeout 设定/取消一个定时器。延迟执行（1 次）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#二十三、WXML"><span class="toc-text">二十三、WXML</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#23-1-IntersectionObserver-布局相交状态-对象"><span class="toc-text">23.1 IntersectionObserver 布局相交状态 对象</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#23-1-1-IntersectionObserver-disconnectt-停止监听。回调函数将不再触发"><span class="toc-text">23.1.1 IntersectionObserver.disconnectt() 停止监听。回调函数将不再触发</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#23-1-2-IntersectionObserver-observet-指定目标节点并开始监听相交状态变化情况"><span class="toc-text">23.1.2 IntersectionObserver.observet() 指定目标节点并开始监听相交状态变化情况</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#23-1-3-IntersectionObserver-relativeTot-使用选择器指定一个节点，作为参照区域之一。"><span class="toc-text">23.1.3 IntersectionObserver.relativeTot() 使用选择器指定一个节点，作为参照区域之一。</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#23-1-4-IntersectionObserver-relativeToViewportt-指定页面显示区域作为参照区域之一"><span class="toc-text">23.1.4 IntersectionObserver.relativeToViewportt() 指定页面显示区域作为参照区域之一</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#23-2-wx-createIntersectionObserver-创建布局相交状态"><span class="toc-text">23.2 wx.createIntersectionObserver 创建布局相交状态</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#23-5-SelectorQuery-查询节点信息的对象"><span class="toc-text">23.5 SelectorQuery 查询节点信息的对象</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#23-1-1-SelectorQuery-exec"><span class="toc-text">23.1.1 SelectorQuery.exec</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#23-1-1-SelectorQuery-in"><span class="toc-text">23.1.1 SelectorQuery.in</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#23-1-1-SelectorQuery-select"><span class="toc-text">23.1.1 SelectorQuery.select</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#23-1-1-SelectorQuery-selectAll"><span class="toc-text">23.1.1 SelectorQuery.selectAll</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#23-1-1-SelectorQuery-selectViewport"><span class="toc-text">23.1.1 SelectorQuery.selectViewport</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#23-4-wx-createSelectorQuery"><span class="toc-text">23.4 wx.createSelectorQuery</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#23-5-NodesRef"><span class="toc-text">23.5 NodesRef</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#23-5-1-boundingClientRect"><span class="toc-text">23.5.1 .boundingClientRect</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#23-5-2-fields"><span class="toc-text">23.5.2 .fields</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#23-5-3-scrollOffset"><span class="toc-text">23.5.3 .scrollOffset</span></a></li></ol></li></ol></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/①-html-css/">① html-css</a><span class="category-list-count">19</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/①-html-css/Normalize-css/">Normalize.css</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/①-html-css/css/">css</a><span class="category-list-count">11</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/①-html-css/html/">html</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/①-html-css/less/">less</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/①-html-css/scss/">scss</a><span class="category-list-count">3</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/②-Javascript-ES6-Typescript/">② Javascript-ES6-Typescript</a><span class="category-list-count">12</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/②-Javascript-ES6-Typescript/ES6/">ES6</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/②-Javascript-ES6-Typescript/Javascript/">Javascript</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/②-Javascript-ES6-Typescript/TypeScript/">TypeScript</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/③-Jquery-js/">③ Jquery.js</a><span class="category-list-count">3</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/③-Jquery-js/JQurey-UI/">JQurey-UI</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/③-Jquery-js/Jquery-js-框架学习/">Jquery.js 框架学习</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/③-Jquery-js/ajax-前后端数据交互/">ajax 前后端数据交互</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/④-vue-js/">④ vue.js</a><span class="category-list-count">28</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/④-vue-js/axios-前后端数据交互/">axios 前后端数据交互</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/④-vue-js/vue-中使用-less-scss-等预处理器/">vue 中使用 less/scss 等预处理器</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/④-vue-js/vue-cli-脚手架/">vue-cli 脚手架</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/④-vue-js/vue-router-路由设置/">vue-router 路由设置</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/④-vue-js/vue-js-框架学习/">vue.js 框架学习</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/④-vue-js/vue-js-的-UI-组件库/">vue.js 的 UI 组件库</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/④-vue-js/vuex-状态管理器/">vuex 状态管理器</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/⑤-react-js/">⑤ react.js</a><span class="category-list-count">15</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/⑤-react-js/axios-在-react-js-中使用/">axios 在 react.js 中使用</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/⑤-react-js/create-react-app-脚手架/">create-react-app 脚手架</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/⑤-react-js/less-scss-在-react-中使用/">less/scss 在 react 中使用</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/⑤-react-js/mixins-混合组件-与-hoc-高阶组件/">mixins 混合组件 与 hoc 高阶组件</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/⑤-react-js/react-router-v4-路由管理器/">react-router v4 路由管理器</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/⑤-react-js/react-js-框架学习/">react.js 框架学习</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/⑤-react-js/react-js-的-UI-组件库/">react.js 的 UI 组件库</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/⑤-react-js/taro-js-多终端框架-京东/">taro.js 多终端框架(京东)</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/⑤-react-js/状态管理器/">状态管理器</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/⑥-react-native-js/">⑥ react-native.js</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/⑥-react-native-js/react-native-框架/">react-native 框架</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/⑦-小程序/">⑦ 小程序</a><span class="category-list-count">13</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/⑦-小程序/MINA-框架/">MINA 框架</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/⑦-小程序/mpvue-框架/">mpvue 框架</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/⑦-小程序/wepy-框架/">wepy 框架</a><span class="category-list-count">3</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/⑧-JS-工具集-JS拓展语言/">⑧ JS 工具集/ JS拓展语言</a><span class="category-list-count">9</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/⑧-JS-工具集-JS拓展语言/Chrome-开发者工具/">Chrome 开发者工具</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/⑧-JS-工具集-JS拓展语言/JSL-拓展语言/">JSL 拓展语言</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/⑧-JS-工具集-JS拓展语言/day-js-框架/">day.js 框架</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/⑧-JS-工具集-JS拓展语言/markdown/">markdown</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/⑧-JS-工具集-JS拓展语言/node-js-语言/">node.js 语言</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/⑧-JS-工具集-JS拓展语言/render-函数/">render 函数</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/⑧-JS-工具集-JS拓展语言/阿里矢量图用法（字符实体）/">阿里矢量图用法（字符实体）</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/⑨-HTTP/">⑨ HTTP</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/⑩-打包工具-命令行工具-包管理器-github/">⑩ 打包工具-命令行工具-包管理器-github</a><span class="category-list-count">6</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/⑩-打包工具-命令行工具-包管理器-github/github/">github</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/⑩-打包工具-命令行工具-包管理器-github/npm-yarn/">npm & yarn</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/⑩-打包工具-命令行工具-包管理器-github/webpack/">webpack</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/⑩-打包工具-命令行工具-包管理器-github/编辑器/">编辑器</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/⑪-网站部署/">⑪ 网站部署</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/⑫-综合实战项目/">⑫ 综合实战项目</a><span class="category-list-count">3</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/⑫-综合实战项目/jQuery/">jQuery</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/⑫-综合实战项目/vue/">vue</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/⑬-数据结构与算法/">⑬ 数据结构与算法</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/⑭-静态网页生成器/">⑭ 静态网页生成器</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/⑭-静态网页生成器/hexo/">hexo</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/⑮-bug-集合/">⑮ bug 集合</a><span class="category-list-count">4</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/⑮-bug-集合/ESlint-这个大坑/">ESlint 这个大坑</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/⑮-bug-集合/vue-中遇到的-bug/">vue 中遇到的 bug</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/⑮-bug-集合/小程序-中遇到的-bug/">小程序 中遇到的 bug</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/㊿-无关编程/">㊿ 无关编程</a><span class="category-list-count">4</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/animation-动画/" style="font-size: 15px;">animation 动画</a> <a href="/tags/cookie-session-token/" style="font-size: 15px;">cookie,session,token</a> <a href="/tags/立即执行函数/" style="font-size: 15px;">立即执行函数</a> <a href="/tags/gradients-线性/" style="font-size: 15px;">gradients 线性</a> <a href="/tags/Jquery-ajax/" style="font-size: 15px;">Jquery->ajax</a> <a href="/tags/interceptor-请求拦截器/" style="font-size: 15px;">interceptor 请求拦截器</a> <a href="/tags/v-charts-图标库/" style="font-size: 15px;">v-charts 图标库</a> <a href="/tags/react-js-组件传值/" style="font-size: 15px;">react.js 组件传值</a> <a href="/tags/递归函数/" style="font-size: 15px;">递归函数</a> <a href="/tags/transition-过渡/" style="font-size: 15px;">transition 过渡</a> <a href="/tags/react-js事件处理/" style="font-size: 15px;">react.js事件处理</a> <a href="/tags/react-js-生命周期/" style="font-size: 15px;">react.js 生命周期</a> <a href="/tags/transform-转换-变形/" style="font-size: 15px;">transform 转换/变形</a> <a href="/tags/flex/" style="font-size: 15px;">flex</a> <a href="/tags/ESlint之坑/" style="font-size: 15px;">ESlint之坑</a> <a href="/tags/axios-使用于-vue-js-react-js/" style="font-size: 15px;">axios(使用于 vue.js react.js)</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/09/06/⑧-【JS 工具集-拓展语言】-node.js- 爬虫/">node.js--爬虫</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/19/[Javascript]-js-cookie-token/">JavaScript【1】--[cookie,session,token 详解]</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/19/[Javascript]-js-正则表达式/">JavaScript--正则表达式</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/19/[Javascript]-js-递归函数/">JavaScript【2】--[递归函数的深入了解]</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/19/[Javascript]-js-立即执行函数/">JavaScript【4】--[立即执行函数 IIFE ]</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/19/[Javascript]-js-高质量高效率代码编辑/">[编写高质量 JS 代码 ]</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/19/⑮ -  bug 集合 -iview-ui 中遇到的 bug/">iview-ui 使用过程的各种问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/19/⑮ -  bug 集合 - mina 小程序 中遇到的 bug/">小程序 MINA 框架 中遇到的 bug</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/19/{ jqurey.js 框架 }-ui 组件/">JQurey-ui--[ui 组件库]</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/08/19/{ jqurey.js 框架 }-ajax 前后端交换数据/">ajax 小白入门篇、速学篇</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-you"> 友情链接</i></div><ul></ul><a href="https://gofoer.com/" title="Gofoer" target="_blank">Gofoer</a></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p></p><p><span> &nbsp;&nbsp;Copyright &copy;2018&nbsp;<a href="/." rel="nofollow">小米粥.</a></span><span> <a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> </a></span><span> <a rel="nofollow" target="_blank" href="https://hexo.io"> </a></span></p></div></div></div><script type="text/javascript" src="/js/search.json.js?v=2.0.1"></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.1" async></script><script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":["mshare","weixin","tsina","qzone","linkedin","fbook","twi","print","renren","sqq","evernotecn","bdysc","tqq","tqf","bdxc","kaixin001","tieba","douban","bdhome","thx","ibaidu","meilishuo","mogujie","diandian","huaban","duitang","hx","fx","youdao","sdo","qingbiji","people","xinhua","mail","isohu","yaolan","wealink","ty","iguba","h163","copy"],"bdPic":"","bdStyle":"1","bdSize":"16"},"share":{},"image":{"viewList":["tsina","qzone","weixin","fbook","twi","linkedin","youdao","evernotecn","mshare"],"viewText":"分享到：","viewSize":"16"},"selectShare":{"bdContainerClass":null,"bdSelectMiniList":["tsina","qzone","weixin","fbook","twi","linkedin","youdao","evernotecn","mshare"]}};with(document)0[(getElementsByTagName('head')[0]||head).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script></body></html>